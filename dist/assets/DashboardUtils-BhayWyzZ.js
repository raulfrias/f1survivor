import{getPicksWithResults as m,isPlayerAlive as l,calculateSurvivalRate as u}from"./RaceResultsApi-BOSDOCeH.js";const v={USER_PICKS:"f1survivor_user_picks",CURRENT_SEASON:"f1survivor_season",USER_SETTINGS:"f1survivor_settings"};function N(){try{const e=localStorage.getItem(v.USER_PICKS);if(!e)return[];const r=JSON.parse(e);return r.currentSeason!==I()?[]:r.picks?Array.isArray(r.picks)?r.picks:typeof r.picks=="object"&&r.picks.driverId?[r.picks]:typeof r.picks=="number"?[{driverId:r.picks,timestamp:new Date().toISOString()}]:[]:[]}catch(e){return console.error("Failed to load picks from localStorage:",e),[]}}function I(){return"2025"}async function S(){try{console.log("Loading dashboard data...");const e=N();console.log("User picks loaded:",e);const r=await m(e);console.log("Picks with results:",r);const a=g(r),i=p(e),t=D();return{userPicks:r,stats:a,availableDrivers:i,upcomingRaces:t}}catch(e){throw console.error("Error loading dashboard data:",e),e}}function g(e){const i=e.length,t=20-i,s=e.filter(o=>o.survivalStatus&&o.survivalStatus.status!=="PENDING").length,n=l(e),c=u(e),d=Math.round(s/24*100);return{picksUsed:i,totalDrivers:20,remainingDrivers:t,racesCompleted:s,totalRaces:24,seasonProgress:d,playerAlive:n,survivalRate:c,playerStatus:n?"ALIVE":"ELIMINATED"}}function p(e){const r=[{driverId:1,driverName:"Max Verstappen",teamName:"Red Bull Racing",number:1},{driverId:11,driverName:"Sergio Perez",teamName:"Red Bull Racing",number:11},{driverId:44,driverName:"Lewis Hamilton",teamName:"Mercedes",number:44},{driverId:63,driverName:"George Russell",teamName:"Mercedes",number:63},{driverId:16,driverName:"Charles Leclerc",teamName:"Ferrari",number:16},{driverId:55,driverName:"Carlos Sainz",teamName:"Ferrari",number:55},{driverId:4,driverName:"Lando Norris",teamName:"McLaren",number:4},{driverId:81,driverName:"Oscar Piastri",teamName:"McLaren",number:81},{driverId:14,driverName:"Fernando Alonso",teamName:"Aston Martin",number:14},{driverId:18,driverName:"Lance Stroll",teamName:"Aston Martin",number:18},{driverId:10,driverName:"Pierre Gasly",teamName:"Alpine",number:10},{driverId:31,driverName:"Esteban Ocon",teamName:"Alpine",number:31},{driverId:23,driverName:"Alexander Albon",teamName:"Williams",number:23},{driverId:2,driverName:"Logan Sargeant",teamName:"Williams",number:2},{driverId:27,driverName:"Nico Hulkenberg",teamName:"Haas",number:27},{driverId:20,driverName:"Kevin Magnussen",teamName:"Haas",number:20},{driverId:77,driverName:"Valtteri Bottas",teamName:"Kick Sauber",number:77},{driverId:24,driverName:"Zhou Guanyu",teamName:"Kick Sauber",number:24},{driverId:22,driverName:"Yuki Tsunoda",teamName:"RB",number:22},{driverId:3,driverName:"Daniel Ricciardo",teamName:"RB",number:3}],a=e.map(t=>t.driverId);return r.filter(t=>!a.includes(t.driverId))}function D(){const e=new Date;return[{raceId:"aus-2025",raceName:"Australian GP",location:"Melbourne",date:"2025-03-16",raceDate:new Date("2025-03-16T05:00:00Z")},{raceId:"jpn-2025",raceName:"Japanese GP",location:"Suzuka",date:"2025-04-06",raceDate:new Date("2025-04-06T05:00:00Z")},{raceId:"chn-2025",raceName:"Chinese GP",location:"Shanghai",date:"2025-04-20",raceDate:new Date("2025-04-20T07:00:00Z")},{raceId:"mia-2025",raceName:"Miami GP",location:"Miami",date:"2025-05-04",raceDate:new Date("2025-05-04T19:30:00Z")},{raceId:"imo-2025",raceName:"Emilia Romagna GP",location:"Imola",date:"2025-05-18",raceDate:new Date("2025-05-18T13:00:00Z")}].filter(a=>a.raceDate>e).slice(0,5).map(a=>({...a,countdown:b(a.raceDate)}))}function b(e){const r=new Date,a=e.getTime()-r.getTime();if(a<=0)return"Race started";const i=Math.floor(a/(1e3*60*60*24)),t=Math.floor(a%(1e3*60*60*24)/(1e3*60*60));if(i>0)return`${i} day${i!==1?"s":""}`;if(t>0)return`${t} hour${t!==1?"s":""}`;{const s=Math.floor(a%36e5/6e4);return`${s} minute${s!==1?"s":""}`}}function k(){try{const e=localStorage.getItem("f1survivor_user_picks"),r=e?JSON.parse(e):{userId:"local-user",currentSeason:"2025",picks:[]};if(r.picks.length===0){const a=[{raceId:"bhr-2025",driverId:1,driverName:"Max Verstappen",teamName:"Red Bull Racing",timestamp:"2025-03-02T12:00:00.000Z",isAutoPick:!1},{raceId:"sau-2025",driverId:4,driverName:"Lando Norris",teamName:"McLaren",timestamp:"2025-03-09T12:00:00.000Z",isAutoPick:!1}];r.picks=a,localStorage.setItem("f1survivor_user_picks",JSON.stringify(r)),console.log("Test dashboard data added successfully")}return!0}catch(e){return console.error("Failed to add test dashboard data:",e),!1}}export{k as addTestDashboardData,g as calculateDashboardStats,p as getAvailableDrivers,S as getDashboardData,D as getUpcomingRaces};
