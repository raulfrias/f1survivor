(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Ao=[{id:"aus-2025",location:"Melbourne",raceName:"Australian GP",country:"Australia",circuit:"Melbourne",date:"2025-03-16",timeLocal:"15:00",timeGMT:"04:00",dateStart:"2025-03-16T04:00:00+00:00",round:1},{id:"chn-2025",location:"Shanghai",raceName:"Chinese GP",country:"China",circuit:"Shanghai",date:"2025-03-23",timeLocal:"15:00",timeGMT:"07:00",dateStart:"2025-03-23T07:00:00+00:00",round:2},{id:"jpn-2025",location:"Suzuka",raceName:"Japanese GP",country:"Japan",circuit:"Suzuka",date:"2025-04-06",timeLocal:"14:00",timeGMT:"05:00",dateStart:"2025-04-06T05:00:00+00:00",round:3},{id:"bhr-2025",location:"Sakhir",raceName:"Bahrain GP",country:"Bahrain",circuit:"Sakhir",date:"2025-04-13",timeLocal:"18:00",timeGMT:"15:00",dateStart:"2025-04-13T15:00:00+00:00",round:4},{id:"sau-2025",location:"Jeddah",raceName:"Saudi Arabian GP",country:"Saudi Arabia",circuit:"Jeddah",date:"2025-04-20",timeLocal:"20:00",timeGMT:"17:00",dateStart:"2025-04-20T17:00:00+00:00",round:5},{id:"mia-2025",location:"Miami",raceName:"Miami GP",country:"United States",circuit:"Miami",date:"2025-05-04",timeLocal:"16:00",timeGMT:"20:00",dateStart:"2025-05-04T20:00:00+00:00",round:6},{id:"emi-2025",location:"Imola",raceName:"Emilia-Romagna GP",country:"Italy",circuit:"Imola",date:"2025-05-18",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-05-18T13:00:00+00:00",round:7},{id:"mon-2025",location:"Monaco",raceName:"Monaco GP",country:"Monaco",circuit:"Monaco",date:"2025-05-25",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-05-25T13:00:00+00:00",round:8},{id:"esp-2025",location:"Barcelona",raceName:"Spanish GP",country:"Spain",circuit:"Barcelona",date:"2025-06-01",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-06-01T13:00:00+00:00",round:9},{id:"can-2025",location:"Montreal",raceName:"Canadian GP",country:"Canada",circuit:"Montreal",date:"2025-06-15",timeLocal:"14:00",timeGMT:"18:00",dateStart:"2025-06-15T18:00:00+00:00",round:10},{id:"aut-2025",location:"Spielberg",raceName:"Austrian GP",country:"Austria",circuit:"Red Bull Ring",date:"2025-06-29",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-06-29T13:00:00+00:00",round:11},{id:"gbr-2025",location:"Silverstone",raceName:"British GP",country:"Great Britain",circuit:"Silverstone",date:"2025-07-06",timeLocal:"15:00",timeGMT:"14:00",dateStart:"2025-07-06T14:00:00+00:00",round:12},{id:"bel-2025",location:"Spa",raceName:"Belgian GP",country:"Belgium",circuit:"Spa-Francorchamps",date:"2025-07-27",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-07-27T13:00:00+00:00",round:13},{id:"hun-2025",location:"Budapest",raceName:"Hungarian GP",country:"Hungary",circuit:"Hungaroring",date:"2025-08-03",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-08-03T13:00:00+00:00",round:14},{id:"ned-2025",location:"Zandvoort",raceName:"Dutch GP",country:"Netherlands",circuit:"Zandvoort",date:"2025-08-31",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-08-31T13:00:00+00:00",round:15},{id:"ita-2025",location:"Monza",raceName:"Italian GP",country:"Italy",circuit:"Monza",date:"2025-09-07",timeLocal:"15:00",timeGMT:"13:00",dateStart:"2025-09-07T13:00:00+00:00",round:16},{id:"aze-2025",location:"Baku",raceName:"Azerbaijan GP",country:"Azerbaijan",circuit:"Baku",date:"2025-09-21",timeLocal:"15:00",timeGMT:"11:00",dateStart:"2025-09-21T11:00:00+00:00",round:17},{id:"sgp-2025",location:"Singapore",raceName:"Singapore GP",country:"Singapore",circuit:"Marina Bay",date:"2025-10-05",timeLocal:"20:00",timeGMT:"12:00",dateStart:"2025-10-05T12:00:00+00:00",round:18},{id:"usa-2025",location:"Austin",raceName:"United States GP",country:"United States",circuit:"COTA",date:"2025-10-19",timeLocal:"14:00",timeGMT:"19:00",dateStart:"2025-10-19T19:00:00+00:00",round:19},{id:"mex-2025",location:"Mexico City",raceName:"Mexico City GP",country:"Mexico",circuit:"Mexico City",date:"2025-10-26",timeLocal:"14:00",timeGMT:"20:00",dateStart:"2025-10-26T20:00:00+00:00",round:20},{id:"bra-2025",location:"São Paulo",raceName:"São Paulo GP",country:"Brazil",circuit:"Interlagos",date:"2025-11-09",timeLocal:"14:00",timeGMT:"17:00",dateStart:"2025-11-09T17:00:00+00:00",round:21},{id:"lv-2025",location:"Las Vegas",raceName:"Las Vegas GP",country:"United States",circuit:"Las Vegas",date:"2025-11-22",timeLocal:"20:00",timeGMT:"04:00",dateStart:"2025-11-23T04:00:00+00:00",round:22},{id:"qat-2025",location:"Lusail",raceName:"Qatar GP",country:"Qatar",circuit:"Lusail",date:"2025-11-30",timeLocal:"19:00",timeGMT:"16:00",dateStart:"2025-11-30T16:00:00+00:00",round:23},{id:"uae-2025",location:"Abu Dhabi",raceName:"Abu Dhabi GP",country:"United Arab Emirates",circuit:"Yas Marina",date:"2025-12-07",timeLocal:"17:00",timeGMT:"13:00",dateStart:"2025-12-07T13:00:00+00:00",round:24}];function Ac(t=new Date){const e=Ao.filter(n=>new Date(n.dateStart)>t);return e.length===0?null:e.sort((n,r)=>new Date(n.dateStart)-new Date(r.dateStart))[0]}const nv=Object.freeze(Object.defineProperty({__proto__:null,F1_2025_CALENDAR:Ao,getNextRace:Ac},Symbol.toStringTag,{value:"Module"})),Tc="modulepreload",Cc=function(t,e){return new URL(t,e).href},Mi={},Di=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let o=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const a=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));i=o(n.map(u=>{if(u=Cc(u,r),u in Mi)return;Mi[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(!!r)for(let g=a.length-1;g>=0;g--){const m=a[g];if(m.href===u&&(!d||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Tc,d||(p.as="script"),p.crossOrigin="",p.href=u,l&&p.setAttribute("nonce",l),document.head.appendChild(p),d)return new Promise((g,m)=>{p.addEventListener("load",g),p.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},Lc="Logging",To="x-amz-user-agent",xc="NoHubcallbackProvidedException";var he;(function(t){t.DEBUG="DEBUG",t.ERROR="ERROR",t.INFO="INFO",t.WARN="WARN",t.VERBOSE="VERBOSE",t.NONE="NONE"})(he||(he={}));const Ui={VERBOSE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,NONE:6};class Y{constructor(e,n=he.WARN){this.name=e,this.level=n,this._pluggables=[]}_padding(e){return e<10?"0"+e:""+e}_ts(){const e=new Date;return[this._padding(e.getMinutes()),this._padding(e.getSeconds())].join(":")+"."+e.getMilliseconds()}configure(e){return e?(this._config=e,this._config):this._config}_log(e,...n){let r=this.level;Y.LOG_LEVEL&&(r=Y.LOG_LEVEL),typeof window<"u"&&window.LOG_LEVEL&&(r=window.LOG_LEVEL);const i=Ui[r];if(!(Ui[e]>=i))return;let o=console.log.bind(console);e===he.ERROR&&console.error&&(o=console.error.bind(console)),e===he.WARN&&console.warn&&(o=console.warn.bind(console)),Y.BIND_ALL_LOG_LEVELS&&(e===he.INFO&&console.info&&(o=console.info.bind(console)),e===he.DEBUG&&console.debug&&(o=console.debug.bind(console)));const a=`[${e}] ${this._ts()} ${this.name}`;let c="";if(n.length===1&&typeof n[0]=="string")c=`${a} - ${n[0]}`,o(c);else if(n.length===1)c=`${a} ${n[0]}`,o(a,n[0]);else if(typeof n[0]=="string"){let l=n.slice(1);l.length===1&&(l=l[0]),c=`${a} - ${n[0]} ${l}`,o(`${a} - ${n[0]}`,l)}else c=`${a} ${n}`,o(a,n);for(const l of this._pluggables){const u={message:c,timestamp:Date.now()};l.pushLogs([u])}}log(...e){this._log(he.INFO,...e)}info(...e){this._log(he.INFO,...e)}warn(...e){this._log(he.WARN,...e)}error(...e){this._log(he.ERROR,...e)}debug(...e){this._log(he.DEBUG,...e)}verbose(...e){this._log(he.VERBOSE,...e)}addPluggable(e){e&&e.getCategoryName()===Lc&&(this._pluggables.push(e),e.configure(this._config))}listPluggables(){return this._pluggables}}Y.LOG_LEVEL=null;Y.BIND_ALL_LOG_LEVELS=!1;class se extends Error{constructor({message:e,name:n,recoverySuggestion:r,underlyingError:i,metadata:s}){if(super(e),this.name=n,this.underlyingError=i,this.recoverySuggestion=r,s){const{extendedRequestId:o,httpStatusCode:a,requestId:c}=s;this.metadata={extendedRequestId:o,httpStatusCode:a,requestId:c}}this.constructor=se,Object.setPrototypeOf(this,se.prototype)}}var nt;(function(t){t.NoEndpointId="NoEndpointId",t.PlatformNotSupported="PlatformNotSupported",t.Unknown="Unknown",t.NetworkError="NetworkError"})(nt||(nt={}));const Vr=(t,e=se)=>(n,r,i)=>{const{message:s,recoverySuggestion:o}=t[r];if(!n)throw new e({name:r,message:i?`${s} ${i}`:s,recoverySuggestion:o})},Le=typeof Symbol<"u"?Symbol("amplify_default"):"@@amplify_default",qt=new Y("Hub");class Co{constructor(e){this.listeners=new Map,this.protectedChannels=["core","auth","api","analytics","interactions","pubsub","storage","ui","xr"],this.name=e}_remove(e,n){const r=this.listeners.get(e);if(!r){qt.warn(`No listeners for ${e}`);return}this.listeners.set(e,[...r.filter(({callback:i})=>i!==n)])}dispatch(e,n,r,i){typeof e=="string"&&this.protectedChannels.indexOf(e)>-1&&(i===Le||qt.warn(`WARNING: ${e} is protected and dispatching on it can have unintended consequences`));const s={channel:e,payload:{...n},source:r,patternInfo:[]};try{this._toListeners(s)}catch(o){qt.error(o)}}listen(e,n,r="noname"){let i;if(typeof n!="function")throw new se({name:xc,message:"No callback supplied to Hub"});i=n;let s=this.listeners.get(e);return s||(s=[],this.listeners.set(e,s)),s.push({name:r,callback:i}),()=>{this._remove(e,i)}}_toListeners(e){const{channel:n,payload:r}=e,i=this.listeners.get(n);i&&i.forEach(s=>{qt.debug(`Dispatching to ${n} with `,r);try{s.callback(e)}catch(o){qt.error(o)}})}}const xe=new Co("__default__"),Mn=new Co("internal-hub"),Wr=()=>{if(typeof window=="object"&&typeof window.crypto=="object")return window.crypto;if(typeof crypto=="object")return crypto;throw new se({name:"MissingPolyfill",message:"Cannot resolve the `crypto` function from the environment."})},Nc=()=>{if(typeof window<"u"&&typeof window.btoa=="function")return window.btoa;if(typeof btoa=="function")return btoa;throw new se({name:"Base64EncoderError",message:"Cannot resolve the `btoa` function from the environment."})},Pc=()=>{if(typeof window<"u"&&typeof window.atob=="function")return window.atob;if(typeof atob=="function")return atob;throw new se({name:"Base64EncoderError",message:"Cannot resolve the `atob` function from the environment."})},Gr={convert(t,e){let n=t;return e!=null&&e.urlSafe&&(n=n.replace(/-/g,"+").replace(/_/g,"/")),Pc()(n)}};var _e;(function(t){t.AuthTokenConfigException="AuthTokenConfigException",t.AuthUserPoolAndIdentityPoolException="AuthUserPoolAndIdentityPoolException",t.AuthUserPoolException="AuthUserPoolException",t.InvalidIdentityPoolIdException="InvalidIdentityPoolIdException",t.OAuthNotConfigureException="OAuthNotConfigureException"})(_e||(_e={}));const kc={[_e.AuthTokenConfigException]:{message:"Auth Token Provider not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app."},[_e.AuthUserPoolAndIdentityPoolException]:{message:"Auth UserPool or IdentityPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with UserPoolId and IdentityPoolId."},[_e.AuthUserPoolException]:{message:"Auth UserPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with userPoolId and userPoolClientId."},[_e.InvalidIdentityPoolIdException]:{message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."},[_e.OAuthNotConfigureException]:{message:"oauth param not configured.",recoverySuggestion:"Make sure to call Amplify.configure with oauth parameter in your app."}},zr=Vr(kc);function U(t){let e=!0;t?e=!!t.userPoolId&&!!t.userPoolClientId:e=!1,zr(e,_e.AuthUserPoolException)}function Wn(t){var n,r,i,s,o,a,c,l;const e=!!((r=(n=t==null?void 0:t.loginWith)==null?void 0:n.oauth)!=null&&r.domain)&&!!((s=(i=t==null?void 0:t.loginWith)==null?void 0:i.oauth)!=null&&s.redirectSignOut)&&!!((a=(o=t==null?void 0:t.loginWith)==null?void 0:o.oauth)!=null&&a.redirectSignIn)&&!!((l=(c=t==null?void 0:t.loginWith)==null?void 0:c.oauth)!=null&&l.responseType);zr(e,_e.OAuthNotConfigureException)}function In(t){const e=!!(t!=null&&t.identityPoolId);zr(e,_e.InvalidIdentityPoolIdException)}function Ve(t){const e=t.split(".");if(e.length!==3)throw new Error("Invalid token");try{const r=e[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(Gr.convert(r).split("").map(o=>`%${`00${o.charCodeAt(0).toString(16)}`.slice(-2)}`).join("")),s=JSON.parse(i);return{toString:()=>t,payload:s}}catch{throw new Error("Invalid token payload")}}const Lo=t=>t&&t["nonRetryable"],fn=new Y("retryUtil");async function Rc(t,e,n,r){if(typeof t!="function")throw Error("functionToRetry must be a function");return new Promise(async(i,s)=>{let o=0,a=!1,c=()=>{},l;for(;!a;){o++,fn.debug(`${t.name} attempt #${o} with this vars: ${JSON.stringify(e)}`);try{i(await t(...e));return}catch(u){if(l=u,fn.debug(`error on ${t.name}`,u),Lo(u)){fn.debug(`${t.name} non retryable error`,u),s(u);return}const d=n(o,e,u);if(fn.debug(`${t.name} retrying in ${d} ms`),d===!1||a){s(u);return}else await new Promise(h=>{c=h,setTimeout(c,d)})}}s(l)})}const xo=t=>{const e=Reflect.ownKeys(t);for(const n of e){const r=t[n];(r&&typeof r=="object"||typeof r=="function")&&xo(r)}return Object.freeze(t)},_c=new Y("parseAWSExports"),Oc={API_KEY:"apiKey",AWS_IAM:"iam",AMAZON_COGNITO_USER_POOLS:"userPool",OPENID_CONNECT:"oidc",NONE:"none",AWS_LAMBDA:"lambda",LAMBDA:"lambda"},Mc=(t={})=>{var Li,xi,Ni,Pi,ki,Ri;if(!Object.prototype.hasOwnProperty.call(t,"aws_project_region"))throw new se({name:"InvalidParameterException",message:"Invalid config parameter.",recoverySuggestion:"Ensure passing the config object imported from  `amplifyconfiguration.json`."});const{aws_appsync_apiKey:e,aws_appsync_authenticationType:n,aws_appsync_graphqlEndpoint:r,aws_appsync_region:i,aws_bots_config:s,aws_cognito_identity_pool_id:o,aws_cognito_sign_up_verification_method:a,aws_cognito_mfa_configuration:c,aws_cognito_mfa_types:l,aws_cognito_password_protection_settings:u,aws_cognito_verification_mechanisms:d,aws_cognito_signup_attributes:h,aws_cognito_social_providers:f,aws_cognito_username_attributes:p,aws_mandatory_sign_in:g,aws_mobile_analytics_app_id:m,aws_mobile_analytics_app_region:v,aws_user_files_s3_bucket:E,aws_user_files_s3_bucket_region:I,aws_user_files_s3_dangerously_connect_to_http_endpoint_for_testing:S,aws_user_pools_id:w,aws_user_pools_web_client_id:A,geo:P,oauth:_,predictions:M,aws_cloud_logic_custom:K,Notifications:V,modelIntrospection:D}=t,k={};m&&(k.Analytics={Pinpoint:{appId:m,region:v}});const{InAppMessaging:$,Push:X}=V??{};if($!=null&&$.AWSPinpoint||X!=null&&X.AWSPinpoint){if($!=null&&$.AWSPinpoint){const{appId:G,region:ot}=$.AWSPinpoint;k.Notifications={InAppMessaging:{Pinpoint:{appId:G,region:ot}}}}if(X!=null&&X.AWSPinpoint){const{appId:G,region:ot}=X.AWSPinpoint;k.Notifications={...k.Notifications,PushNotification:{Pinpoint:{appId:G,region:ot}}}}}if(Array.isArray(s)&&(k.Interactions={LexV1:Object.fromEntries(s.map(G=>[G.name,G]))}),r){const G=Oc[n];G||_c.debug(`Invalid authentication type ${n}. Falling back to IAM.`),k.API={GraphQL:{endpoint:r,apiKey:e,region:i,defaultAuthMode:G??"iam"}},D&&(k.API.GraphQL.modelIntrospection=D)}const ye=c?{status:c&&c.toLowerCase(),totpEnabled:(l==null?void 0:l.includes("TOTP"))??!1,smsEnabled:(l==null?void 0:l.includes("SMS"))??!1}:void 0,O=u?{minLength:u.passwordPolicyMinLength,requireLowercase:((Li=u.passwordPolicyCharacters)==null?void 0:Li.includes("REQUIRES_LOWERCASE"))??!1,requireUppercase:((xi=u.passwordPolicyCharacters)==null?void 0:xi.includes("REQUIRES_UPPERCASE"))??!1,requireNumbers:((Ni=u.passwordPolicyCharacters)==null?void 0:Ni.includes("REQUIRES_NUMBERS"))??!1,requireSpecialCharacters:((Pi=u.passwordPolicyCharacters)==null?void 0:Pi.includes("REQUIRES_SYMBOLS"))??!1}:void 0,F=Array.from(new Set([...d??[],...h??[]])).reduce((G,ot)=>({...G,[ot.toLowerCase()]:{required:!0}}),{}),q=(p==null?void 0:p.includes("EMAIL"))??!1,Qe=(p==null?void 0:p.includes("PHONE_NUMBER"))??!1;(o||w)&&(k.Auth={Cognito:{identityPoolId:o,allowGuestAccess:g!=="enable",signUpVerificationMethod:a,userAttributes:F,userPoolClientId:A,userPoolId:w,mfa:ye,passwordFormat:O,loginWith:{username:!(q||Qe),email:q,phone:Qe}}});const $t=_?Object.keys(_).length>0:!1,ur=f?f.length>0:!1;if(k.Auth&&$t&&(k.Auth.Cognito.loginWith={...k.Auth.Cognito.loginWith,oauth:{...Dc(_),...ur&&{providers:Uc(f)}}}),E&&(k.Storage={S3:{bucket:E,region:I,dangerouslyConnectToHttpEndpointForTesting:S}}),P){const{amazon_location_service:G}=P;k.Geo={LocationService:{maps:G.maps,geofenceCollections:G.geofenceCollections,searchIndices:G.search_indices,region:G.region}}}if(K&&(k.API={...k.API,REST:K.reduce((G,ot)=>{const{name:Ic,endpoint:bc,region:_i,service:Oi}=ot;return{...G,[Ic]:{endpoint:bc,...Oi?{service:Oi}:void 0,..._i?{region:_i}:void 0}}},{})}),M){const{VoiceId:G}=((Ri=(ki=M==null?void 0:M.convert)==null?void 0:ki.speechGenerator)==null?void 0:Ri.defaults)??{};k.Predictions=G?{...M,convert:{...M.convert,speechGenerator:{...M.convert.speechGenerator,defaults:{voiceId:G}}}}:M}return k},Fi=t=>(t==null?void 0:t.split(","))??[],Dc=({domain:t,scope:e,redirectSignIn:n,redirectSignOut:r,responseType:i})=>({domain:t,scopes:e,redirectSignIn:Fi(n),redirectSignOut:Fi(r),responseType:i}),Uc=t=>t.map(e=>{const n=e.toLowerCase();return n.charAt(0).toUpperCase()+n.slice(1)}),No=Symbol("oauth-listener");let pn;const Fc=new Uint8Array(16);function $c(){if(!pn&&(pn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!pn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return pn(Fc)}const re=[];for(let t=0;t<256;++t)re.push((t+256).toString(16).slice(1));function qc(t,e=0){return re[t[e+0]]+re[t[e+1]]+re[t[e+2]]+re[t[e+3]]+"-"+re[t[e+4]]+re[t[e+5]]+"-"+re[t[e+6]]+re[t[e+7]]+"-"+re[t[e+8]]+re[t[e+9]]+"-"+re[t[e+10]]+re[t[e+11]]+re[t[e+12]]+re[t[e+13]]+re[t[e+14]]+re[t[e+15]]}const Bc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$i={randomUUID:Bc};function Kc(t,e,n){if($i.randomUUID&&!e&&!t)return $i.randomUUID();t=t||{};const r=t.random||(t.rng||$c)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(let i=0;i<16;++i)e[n+i]=r[i];return e}return qc(r)}function Hc(t){const{version:e}=t;return e?e.startsWith("1"):!1}function jc(t){if(!t)return;const{bucket_name:e,aws_region:n,buckets:r}=t;return{S3:{bucket:e,region:n,buckets:r&&tl(r)}}}function Vc(t){if(!t)return;const{user_pool_id:e,user_pool_client_id:n,identity_pool_id:r,password_policy:i,mfa_configuration:s,mfa_methods:o,unauthenticated_identities_enabled:a,oauth:c,username_attributes:l,standard_required_attributes:u,groups:d}=t,h={Cognito:{userPoolId:e,userPoolClientId:n,groups:d}};return r&&(h.Cognito={...h.Cognito,identityPoolId:r}),i&&(h.Cognito.passwordFormat={requireLowercase:i.require_lowercase,requireNumbers:i.require_numbers,requireUppercase:i.require_uppercase,requireSpecialCharacters:i.require_symbols,minLength:i.min_length??6}),s&&(h.Cognito.mfa={status:el(s),smsEnabled:o==null?void 0:o.includes("SMS"),totpEnabled:o==null?void 0:o.includes("TOTP")}),a&&(h.Cognito.allowGuestAccess=a),c&&(h.Cognito.loginWith={oauth:{domain:c.domain,redirectSignIn:c.redirect_sign_in_uri,redirectSignOut:c.redirect_sign_out_uri,responseType:c.response_type==="token"?"token":"code",scopes:c.scopes,providers:Zc(c.identity_providers)}}),l&&(h.Cognito.loginWith={...h.Cognito.loginWith,email:l.includes("email"),phone:l.includes("phone_number"),username:l.includes("username")}),u&&(h.Cognito.userAttributes=u.reduce((f,p)=>({...f,[p]:{required:!0}}),{})),h}function Wc(t){if(!(t!=null&&t.amazon_pinpoint))return;const{amazon_pinpoint:e}=t;return{Pinpoint:{appId:e.app_id,region:e.aws_region}}}function Gc(t){if(!t)return;const{aws_region:e,geofence_collections:n,maps:r,search_indices:i}=t;return{LocationService:{region:e,searchIndices:i,geofenceCollections:n,maps:r}}}function zc(t){if(!t)return;const{aws_region:e,default_authorization_type:n,url:r,api_key:i,model_introspection:s}=t;return{GraphQL:{endpoint:r,defaultAuthMode:Po(n),region:e,apiKey:i,modelIntrospection:s}}}function Jc(t){if(!(t!=null&&t.events))return;const{url:e,aws_region:n,api_key:r,default_authorization_type:i}=t.events;return{Events:{endpoint:e,defaultAuthMode:Po(i),region:n,apiKey:r}}}function Yc(t){if(!t)return;const{aws_region:e,channels:n,amazon_pinpoint_app_id:r}=t,i=n.includes("IN_APP_MESSAGING"),s=n.includes("APNS")||n.includes("FCM");if(!(i||s))return;const o={};return i&&(o.InAppMessaging={Pinpoint:{appId:r,region:e}}),s&&(o.PushNotification={Pinpoint:{appId:r,region:e}}),o}function Qc(t){const e={};if(t.storage&&(e.Storage=jc(t.storage)),t.auth&&(e.Auth=Vc(t.auth)),t.analytics&&(e.Analytics=Wc(t.analytics)),t.geo&&(e.Geo=Gc(t.geo)),t.data&&(e.API=zc(t.data)),t.custom){const n=Jc(t.custom);n&&"Events"in n&&(e.API={...e.API,...n})}return t.notifications&&(e.Notifications=Yc(t.notifications)),e}const Xc={AMAZON_COGNITO_USER_POOLS:"userPool",API_KEY:"apiKey",AWS_IAM:"iam",AWS_LAMBDA:"lambda",OPENID_CONNECT:"oidc"};function Po(t){return Xc[t]}const qi={GOOGLE:"Google",LOGIN_WITH_AMAZON:"Amazon",FACEBOOK:"Facebook",SIGN_IN_WITH_APPLE:"Apple"};function Zc(t=[]){return t.reduce((e,n)=>(qi[n]!==void 0&&e.push(qi[n]),e),[])}function el(t){return t==="OPTIONAL"?"optional":t==="REQUIRED"?"on":"off"}function tl(t){const e={};return t.forEach(({name:n,bucket_name:r,aws_region:i,paths:s})=>{if(n in e)throw new Error(`Duplicate friendly name found: ${n}. Name must be unique.`);const o=s?Object.entries(s).reduce((a,[c,l])=>(l!==void 0&&(a[c]=l),a),{}):void 0;e[n]={bucketName:r,region:i,paths:o}}),e}const ko=t=>Object.keys(t).some(e=>e.startsWith("aws_"))?Mc(t):Hc(t)?Qc(t):t;var wr=function(t,e){return wr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},wr(t,e)};function Jr(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");wr(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Ro(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(d){o(d)}}function c(u){try{l(r.throw(u))}catch(d){o(d)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function Yr(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Qt(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sr(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Ir(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Et(t){return this instanceof Et?(this.v=t,this):new Et(t)}function nl(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(f){return function(p){return Promise.resolve(p).then(f,d)}}function a(f,p){r[f]&&(i[f]=function(g){return new Promise(function(m,v){s.push([f,g,m,v])>1||c(f,g)})},p&&(i[f]=p(i[f])))}function c(f,p){try{l(r[f](p))}catch(g){h(s[0][3],g)}}function l(f){f.value instanceof Et?Promise.resolve(f.value.v).then(u,d):h(s[0][2],f)}function u(f){c("next",f)}function d(f){c("throw",f)}function h(f,p){f(p),s.shift(),s.length&&c(s[0][0],s[0][1])}}function rl(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Qt=="function"?Qt(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var ve=64,il=32,sl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ol=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],al=Math.pow(2,53)-1,bn=function(){function t(){this.state=Int32Array.from(ol),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return t.prototype.update=function(e){if(this.finished)throw new Error("Attempted to update an already finished hash.");var n=0,r=e.byteLength;if(this.bytesHashed+=r,this.bytesHashed*8>al)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;r>0;)this.buffer[this.bufferLength++]=e[n++],r--,this.bufferLength===ve&&(this.hashBuffer(),this.bufferLength=0)},t.prototype.digest=function(){if(!this.finished){var e=this.bytesHashed*8,n=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),r=this.bufferLength;if(n.setUint8(this.bufferLength++,128),r%ve>=ve-8){for(var i=this.bufferLength;i<ve;i++)n.setUint8(i,0);this.hashBuffer(),this.bufferLength=0}for(var i=this.bufferLength;i<ve-8;i++)n.setUint8(i,0);n.setUint32(ve-8,Math.floor(e/4294967296),!0),n.setUint32(ve-4,e),this.hashBuffer(),this.finished=!0}for(var s=new Uint8Array(il),i=0;i<8;i++)s[i*4]=this.state[i]>>>24&255,s[i*4+1]=this.state[i]>>>16&255,s[i*4+2]=this.state[i]>>>8&255,s[i*4+3]=this.state[i]>>>0&255;return s},t.prototype.hashBuffer=function(){for(var e=this,n=e.buffer,r=e.state,i=r[0],s=r[1],o=r[2],a=r[3],c=r[4],l=r[5],u=r[6],d=r[7],h=0;h<ve;h++){if(h<16)this.temp[h]=(n[h*4]&255)<<24|(n[h*4+1]&255)<<16|(n[h*4+2]&255)<<8|n[h*4+3]&255;else{var f=this.temp[h-2],p=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10;f=this.temp[h-15];var g=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3;this.temp[h]=(p+this.temp[h-7]|0)+(g+this.temp[h-16]|0)}var m=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&l^~c&u)|0)+(d+(sl[h]+this.temp[h]|0)|0)|0,v=((i>>>2|i<<30)^(i>>>13|i<<19)^(i>>>22|i<<10))+(i&s^i&o^s&o)|0;d=u,u=l,l=c,c=a+m|0,a=o,o=s,s=i,i=m+v|0}r[0]+=i,r[1]+=s,r[2]+=o,r[3]+=a,r[4]+=c,r[5]+=l,r[6]+=u,r[7]+=d},t}();const cl=t=>new TextEncoder().encode(t);var ll=typeof Buffer<"u"&&Buffer.from?function(t){return Buffer.from(t,"utf8")}:cl;function _o(t){return t instanceof Uint8Array?t:typeof t=="string"?ll(t):ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(t)}function ul(t){return typeof t=="string"?t.length===0:t.byteLength===0}var bt=function(){function t(e){this.secret=e,this.hash=new bn,this.reset()}return t.prototype.update=function(e){if(!(ul(e)||this.error))try{this.hash.update(_o(e))}catch(n){this.error=n}},t.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},t.prototype.digest=function(){return Ro(this,void 0,void 0,function(){return Yr(this,function(e){return[2,this.digestSync()]})})},t.prototype.reset=function(){if(this.hash=new bn,this.secret){this.outer=new bn;var e=dl(this.secret),n=new Uint8Array(ve);n.set(e);for(var r=0;r<ve;r++)e[r]^=54,n[r]^=92;this.hash.update(e),this.outer.update(n);for(var r=0;r<e.byteLength;r++)e[r]=0}},t}();function dl(t){var e=_o(t);if(e.byteLength>ve){var n=new bn;n.update(e),e=n.digest()}var r=new Uint8Array(ve);return r.set(e),r}const Oo={};for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),Oo[t]=e}function hl(t){let e="";for(let n=0;n<t.byteLength;n++)e+=Oo[t[n]];return e}var J;(function(t){t.WebUnknown="0",t.React="1",t.NextJs="2",t.Angular="3",t.VueJs="4",t.Nuxt="5",t.Svelte="6",t.ServerSideUnknown="100",t.ReactSSR="101",t.NextJsSSR="102",t.AngularSSR="103",t.VueJsSSR="104",t.NuxtSSR="105",t.SvelteSSR="106",t.ReactNative="201",t.Expo="202"})(J||(J={}));var Dn;(function(t){t.AI="ai",t.API="api",t.Auth="auth",t.Analytics="analytics",t.DataStore="datastore",t.Geo="geo",t.InAppMessaging="inappmessaging",t.Interactions="interactions",t.Predictions="predictions",t.PubSub="pubsub",t.PushNotification="pushnotification",t.Storage="storage"})(Dn||(Dn={}));var Bi;(function(t){t.CreateConversation="1",t.GetConversation="2",t.ListConversations="3",t.DeleteConversation="4",t.SendMessage="5",t.ListMessages="6",t.OnMessage="7",t.Generation="8",t.UpdateConversation="9"})(Bi||(Bi={}));var Ki;(function(t){t.Record="1",t.IdentifyUser="2"})(Ki||(Ki={}));var br;(function(t){t.GraphQl="1",t.Get="2",t.Post="3",t.Put="4",t.Patch="5",t.Del="6",t.Head="7"})(br||(br={}));var oe;(function(t){t.SignUp="1",t.ConfirmSignUp="2",t.ResendSignUpCode="3",t.SignIn="4",t.FetchMFAPreference="6",t.UpdateMFAPreference="7",t.SetUpTOTP="10",t.VerifyTOTPSetup="11",t.ConfirmSignIn="12",t.DeleteUserAttributes="15",t.DeleteUser="16",t.UpdateUserAttributes="17",t.FetchUserAttributes="18",t.ConfirmUserAttribute="22",t.SignOut="26",t.UpdatePassword="27",t.ResetPassword="28",t.ConfirmResetPassword="29",t.FederatedSignIn="30",t.RememberDevice="32",t.ForgetDevice="33",t.FetchDevices="34",t.SendUserAttributeVerificationCode="35",t.SignInWithRedirect="36",t.StartWebAuthnRegistration="37",t.CompleteWebAuthnRegistration="38",t.ListWebAuthnCredentials="39",t.DeleteWebAuthnCredential="40"})(oe||(oe={}));var Hi;(function(t){t.Subscribe="1",t.GraphQl="2"})(Hi||(Hi={}));var ji;(function(t){t.SearchByText="0",t.SearchByCoordinates="1",t.SearchForSuggestions="2",t.SearchByPlaceId="3",t.SaveGeofences="4",t.GetGeofence="5",t.ListGeofences="6",t.DeleteGeofences="7"})(ji||(ji={}));var Vi;(function(t){t.SyncMessages="1",t.IdentifyUser="2",t.NotifyMessageInteraction="3"})(Vi||(Vi={}));var Wi;(function(t){t.None="0"})(Wi||(Wi={}));var Gi;(function(t){t.Convert="1",t.Identify="2",t.Interpret="3"})(Gi||(Gi={}));var zi;(function(t){t.Subscribe="1"})(zi||(zi={}));var Ji;(function(t){t.InitializePushNotifications="1",t.IdentifyUser="2"})(Ji||(Ji={}));var Yi;(function(t){t.UploadData="1",t.DownloadData="2",t.List="3",t.Copy="4",t.Remove="5",t.GetProperties="6",t.GetUrl="7",t.GetDataAccess="8",t.ListCallerAccessGrants="9"})(Yi||(Yi={}));const fl="6.15.0",Gn=()=>typeof global<"u",Lt=()=>typeof window<"u",Mo=()=>typeof document<"u",Qr=()=>typeof process<"u",Xt=(t,e)=>!!Object.keys(t).find(n=>n.startsWith(e));var Qi={};function pl(){const t=r=>r.startsWith("_react")||r.startsWith("__react"),e=r=>Object.keys(r).find(t),n=()=>Array.from(document.querySelectorAll("[id]"));return Mo()&&n().some(e)}function gl(){return Qr()&&typeof Qi<"u"&&!!Object.keys(Qi).find(t=>t.includes("react"))}function ml(){return Lt()&&Xt(window,"__VUE")}function yl(){return Gn()&&Xt(global,"__VUE")}var Xi={};function vl(){return Lt()&&Xt(window,"__SVELTE")}function El(){return Qr()&&typeof Xi<"u"&&!!Object.keys(Xi).find(t=>t.includes("svelte"))}function wl(){return Lt()&&window.next&&typeof window.next=="object"}function Sl(){return Gn()&&(Xt(global,"__next")||Xt(global,"__NEXT"))}function Il(){return Lt()&&(window.__NUXT__!==void 0||window.$nuxt!==void 0)}function bl(){return Gn()&&typeof global.__NUXT_PATHS__<"u"}var Zi={};function Al(){const t=!!(Mo()&&document.querySelector("[ng-version]")),e=!!(Lt()&&typeof window.ng<"u");return t||e}function Tl(){var t;return Qr()&&typeof Zi=="object"&&((t=Zi.npm_lifecycle_script)==null?void 0:t.startsWith("ng "))||!1}function Cl(){return typeof navigator<"u"&&typeof navigator.product<"u"&&navigator.product==="ReactNative"}function Ll(){return Gn()&&typeof global.expo<"u"}function xl(){return Lt()}const Nl=[{platform:J.Expo,detectionMethod:Ll},{platform:J.ReactNative,detectionMethod:Cl},{platform:J.NextJs,detectionMethod:wl},{platform:J.Nuxt,detectionMethod:Il},{platform:J.Angular,detectionMethod:Al},{platform:J.React,detectionMethod:pl},{platform:J.VueJs,detectionMethod:ml},{platform:J.Svelte,detectionMethod:vl},{platform:J.WebUnknown,detectionMethod:xl},{platform:J.NextJsSSR,detectionMethod:Sl},{platform:J.NuxtSSR,detectionMethod:bl},{platform:J.ReactSSR,detectionMethod:gl},{platform:J.VueJsSSR,detectionMethod:yl},{platform:J.AngularSSR,detectionMethod:Tl},{platform:J.SvelteSSR,detectionMethod:El}];function Pl(){var t;return((t=Nl.find(e=>e.detectionMethod()))==null?void 0:t.platform)||J.ServerSideUnknown}let zt;const dr=[];let Ar=!1;const kl=10,Rl=10,_l=1e3,Do=()=>{var t;if(!zt){if(zt=Pl(),Ar)for(;dr.length;)(t=dr.pop())==null||t();else dr.forEach(e=>{e()});es(J.ServerSideUnknown,kl),es(J.WebUnknown,Rl)}return zt};function Ol(){zt=void 0}function es(t,e){zt===t&&!Ar&&setTimeout(()=>{Ol(),Ar=!0,setTimeout(Do,_l)},e)}const Ml={},Dl=(t,e)=>{var n,r;return(r=(n=Ml[t])==null?void 0:n[e])==null?void 0:r.additionalDetails},Ul="aws-amplify",Fl=t=>t.replace(/\+.*/,""),$l=({category:t,action:e}={})=>{const n=[[Ul,Fl(fl)]];if(t&&n.push([t,e]),n.push(["framework",Do()]),t&&e){const r=Dl(t,e);r&&r.forEach(i=>{n.push(i)})}return n},xt=t=>$l(t).map(([r,i])=>r&&i?`${r}/${i}`:r).join(" ");function ie(t){return typeof t=="function"}function ql(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var hr=ql(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ts(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Xr=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Qt(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(g){e={error:g}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(ie(u))try{u()}catch(g){s=g instanceof hr?g.errors:[g]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=Qt(d),f=h.next();!f.done;f=h.next()){var p=f.value;try{ns(p)}catch(g){s=s??[],g instanceof hr?s=Ir(Ir([],Sr(s)),Sr(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{f&&!f.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}if(s)throw new hr(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)ns(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&ts(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&ts(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();Xr.EMPTY;function Uo(t){return t instanceof Xr||t&&"closed"in t&&ie(t.remove)&&ie(t.add)&&ie(t.unsubscribe)}function ns(t){ie(t)?t():t.unsubscribe()}var Bl={Promise:void 0},Kl={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Ir([t,e],Sr(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Fo(t){Kl.setTimeout(function(){throw t})}function rs(){}function Hl(t){t()}var Zr=function(t){Jr(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Uo(n)&&n.add(r)):r.destination=Wl,r}return e.create=function(n,r,i){return new Tr(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Xr),jl=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){gn(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){gn(r)}else gn(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){gn(n)}},t}(),Tr=function(t){Jr(e,t);function e(n,r,i){var s=t.call(this)||this,o;return ie(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new jl(o),s}return e}(Zr);function gn(t){Fo(t)}function Vl(t){throw t}var Wl={closed:!0,next:rs,error:Vl,complete:rs},ei=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Gl(t){return t}function zl(t){return t.length===0?Gl:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var ue=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=Yl(e)?e:new Tr(e,n,r);return Hl(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=is(n),new n(function(i,s){var o=new Tr({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[ei]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return zl(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=is(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t}();function is(t){var e;return(e=t??Bl.Promise)!==null&&e!==void 0?e:Promise}function Jl(t){return t&&ie(t.next)&&ie(t.error)&&ie(t.complete)}function Yl(t){return t&&t instanceof Zr||Jl(t)&&Uo(t)}function Ql(t){return ie(t==null?void 0:t.lift)}function rn(t){return function(e){if(Ql(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function zn(t,e,n,r,i){return new Xl(t,e,n,r,i)}var Xl=function(t){Jr(e,t);function e(n,r,i,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){n.error(u)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(Zr),$o=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function qo(t){return ie(t==null?void 0:t.then)}function Bo(t){return ie(t[ei])}function Ko(t){return Symbol.asyncIterator&&ie(t==null?void 0:t[Symbol.asyncIterator])}function Ho(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Zl(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var jo=Zl();function Vo(t){return ie(t==null?void 0:t[jo])}function Wo(t){return nl(this,arguments,function(){var n,r,i,s;return Yr(this,function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Et(n.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,Et(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Et(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Go(t){return ie(t==null?void 0:t.getReader)}function Jn(t){if(t instanceof ue)return t;if(t!=null){if(Bo(t))return eu(t);if($o(t))return tu(t);if(qo(t))return nu(t);if(Ko(t))return zo(t);if(Vo(t))return ru(t);if(Go(t))return iu(t)}throw Ho(t)}function eu(t){return new ue(function(e){var n=t[ei]();if(ie(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function tu(t){return new ue(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function nu(t){return new ue(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Fo)})}function ru(t){return new ue(function(e){var n,r;try{for(var i=Qt(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function zo(t){return new ue(function(e){su(t,e).catch(function(n){return e.error(n)})})}function iu(t){return zo(Wo(t))}function su(t,e){var n,r,i,s;return Ro(this,void 0,void 0,function(){var o,a;return Yr(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=rl(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ct(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function Jo(t,e){return e===void 0&&(e=0),rn(function(n,r){n.subscribe(zn(r,function(i){return ct(r,t,function(){return r.next(i)},e)},function(){return ct(r,t,function(){return r.complete()},e)},function(i){return ct(r,t,function(){return r.error(i)},e)}))})}function Yo(t,e){return e===void 0&&(e=0),rn(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function ou(t,e){return Jn(t).pipe(Yo(e),Jo(e))}function au(t,e){return Jn(t).pipe(Yo(e),Jo(e))}function cu(t,e){return new ue(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function lu(t,e){return new ue(function(n){var r;return ct(n,e,function(){r=t[jo](),ct(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return ie(r==null?void 0:r.return)&&r.return()}})}function Qo(t,e){if(!t)throw new Error("Iterable cannot be null");return new ue(function(n){ct(n,e,function(){var r=t[Symbol.asyncIterator]();ct(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function uu(t,e){return Qo(Wo(t),e)}function du(t,e){if(t!=null){if(Bo(t))return ou(t,e);if($o(t))return cu(t,e);if(qo(t))return au(t,e);if(Ko(t))return Qo(t,e);if(Vo(t))return lu(t,e);if(Go(t))return uu(t,e)}throw Ho(t)}function hu(t,e){return e?du(t,e):Jn(t)}function ti(t,e){return rn(function(n,r){var i=0;n.subscribe(zn(r,function(s){r.next(t.call(e,s,i++))}))})}function fu(t,e){return rn(function(n,r){var i=0;n.subscribe(zn(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function Xo(t){return rn(function(e,n){var r=null,i=!1,s;r=e.subscribe(zn(n,void 0,void 0,function(o){s=Jn(t(o,Xo(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}const pu=()=>{if(typeof self>"u")return!1;const t=self;return typeof t.WorkerGlobalScope<"u"&&self instanceof t.WorkerGlobalScope};class wt{networkMonitor(e){const n=pu()?self:typeof window<"u"&&window;return n?new ue(r=>{r.next({online:n.navigator.onLine});const i=()=>{r.next({online:!0})},s=()=>{r.next({online:!1})};return n.addEventListener("online",i),n.addEventListener("offline",s),wt._observers.push(r),()=>{n.removeEventListener("online",i),n.removeEventListener("offline",s),wt._observers=wt._observers.filter(o=>o!==r)}}):hu([{online:!0}])}static _observerOverride(e){for(const n of this._observers){if(n.closed){this._observers=this._observers.filter(r=>r!==n);continue}n!=null&&n.next&&n.next(e)}}}wt._observers=[];const Yn=()=>typeof window<"u"&&typeof window.document<"u",ss=new Y("Auth");class gu{configure(e,n){var r,i;this.authConfig=e,this.authOptions=n,e&&((r=e.Cognito)!=null&&r.userPoolEndpoint)&&ss.warn(os("Amazon Cognito User Pool")),e&&((i=e.Cognito)!=null&&i.identityPoolEndpoint)&&ss.warn(os("Amazon Cognito Identity Pool"))}async fetchAuthSession(e={}){var s,o,a,c,l,u;let n,r;const i=await this.getTokens(e);return i?(r=(o=(s=i.accessToken)==null?void 0:s.payload)==null?void 0:o.sub,n=await((c=(a=this.authOptions)==null?void 0:a.credentialsProvider)==null?void 0:c.getCredentialsAndIdentityId({authConfig:this.authConfig,tokens:i,authenticated:!0,forceRefresh:e.forceRefresh}))):n=await((u=(l=this.authOptions)==null?void 0:l.credentialsProvider)==null?void 0:u.getCredentialsAndIdentityId({authConfig:this.authConfig,authenticated:!1,forceRefresh:e.forceRefresh})),{tokens:i,credentials:n==null?void 0:n.credentials,identityId:n==null?void 0:n.identityId,userSub:r}}async clearCredentials(){var e,n;await((n=(e=this.authOptions)==null?void 0:e.credentialsProvider)==null?void 0:n.clearCredentialsAndIdentityId())}async getTokens(e){var n,r;return await((r=(n=this.authOptions)==null?void 0:n.tokenProvider)==null?void 0:r.getTokens(e))??void 0}}const os=t=>`You are using a custom Amazon ${t} endpoint, ensure the endpoint is correct.`;class mu{constructor(){this.oAuthListener=void 0,this.resourcesConfig={},this.libraryOptions={},this.Auth=new gu}configure(e,n){const r=ko(e);this.resourcesConfig=r,n&&(this.libraryOptions=n),this.resourcesConfig=xo(this.resourcesConfig),this.Auth.configure(this.resourcesConfig.Auth,this.libraryOptions.Auth),xe.dispatch("core",{event:"configure",data:this.resourcesConfig},"Configure",Le),this.notifyOAuthListener()}getConfig(){return this.resourcesConfig}[No](e){var n,r,i;(r=(n=this.resourcesConfig.Auth)==null?void 0:n.Cognito.loginWith)!=null&&r.oauth?e((i=this.resourcesConfig.Auth)==null?void 0:i.Cognito):this.oAuthListener=e}notifyOAuthListener(){var e,n,r;!((n=(e=this.resourcesConfig.Auth)==null?void 0:e.Cognito.loginWith)!=null&&n.oauth)||!this.oAuthListener||(this.oAuthListener((r=this.resourcesConfig.Auth)==null?void 0:r.Cognito),this.oAuthListener=void 0)}}const B=new mu,yu=(t,e)=>t.Auth.fetchAuthSession(e),Un=t=>yu(B,t);function Zo(){return B.Auth.clearCredentials()}const Qn=t=>{const{headers:e,statusCode:n}=t;return{...vu(t)?t.$metadata:{},httpStatusCode:n,requestId:e["x-amzn-requestid"]??e["x-amzn-request-id"]??e["x-amz-request-id"],extendedRequestId:e["x-amz-id-2"],cfId:e["x-amz-cf-id"]}},vu=t=>typeof(t==null?void 0:t.$metadata)=="object",pt=async t=>{if(!t||t.statusCode<300)return;const e=await sn(t),r=(o=>{const[a]=o.toString().split(/[,:]+/);return a.includes("#")?a.split("#")[1]:a})(t.headers["x-amzn-errortype"]??e.code??e.__type??"UnknownError"),i=e.message??e.Message??"Unknown error",s=new Error(i);return Object.assign(s,{name:r,$metadata:Qn(t)})},sn=async t=>{if(!t.body)throw new Error("Missing response payload");const e=await t.body.json();return Object.assign(e,{$metadata:Qn(t)})},Ie=(t,e,n,r)=>async(i,s)=>{const o={...r,...i},a=await o.endpointResolver(o,s),c=await e(s,a),l=await t(c,{...o});return n(l)},ea=5*60*1e3;function ta(t=ea){return r=>{const i=2**r*100+100*Math.random();return i>t?!1:i}}const na=3,as="amz-sdk-invocation-id",Eu="amz-sdk-request",cs=5*60*1e3,ni=t=>{const n=ta(cs)(t);return n===!1?cs:n},wu=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],Su=t=>!!t&&wu.includes(t),ri=t=>async(e,n)=>{const r=n??await t(e)??void 0,i=(r==null?void 0:r.code)||(r==null?void 0:r.name),s=e==null?void 0:e.statusCode;return{retryable:Tu(n)||Au(s,i)||Su(i)||Cu(s,i)}},Iu=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],bu=["TimeoutError","RequestTimeout","RequestTimeoutException"],Au=(t,e)=>t===429||!!e&&Iu.includes(e),Tu=t=>[nt.NetworkError,"ERR_NETWORK"].includes(t==null?void 0:t.name),Cu=(t,e)=>!!t&&[500,502,503,504].includes(t)||!!e&&bu.includes(e),ra="cognito-identity",ia={service:ra,retryDecider:ri(pt),computeDelay:ni,cache:"no-store"},ii=({maxAttempts:t=na,retryDecider:e,computeDelay:n,abortSignal:r})=>{if(t<1)throw new Error("maxAttempts must be greater than 0");return(i,s)=>async function(a){let c,l=s.attemptsCount??0,u;const d=()=>{if(u)return ls(u,l),u;throw ls(c,l),c};for(;!(r!=null&&r.aborted)&&l<t;){try{u=await i(a),c=void 0}catch(p){c=p,u=void 0}l=(s.attemptsCount??0)>l?s.attemptsCount??0:l+1,s.attemptsCount=l;const{isCredentialsExpiredError:h,retryable:f}=await e(u,c,s);if(f){if(s.isCredentialsExpired=!!h,!(r!=null&&r.aborted)&&l<t){const p=n(l);await Lu(p,r)}continue}else return d()}if(r!=null&&r.aborted)throw new Error("Request aborted.");return d()}},Lu=(t,e)=>{if(e!=null&&e.aborted)return Promise.resolve();let n,r;const i=new Promise(s=>{r=s,n=setTimeout(s,t)});return e==null||e.addEventListener("abort",function s(o){clearTimeout(n),e==null||e.removeEventListener("abort",s),r()}),i},ls=(t,e)=>{Object.prototype.toString.call(t)==="[object Object]"&&(t.$metadata={...t.$metadata??{},attempts:e})},Cr=Kc,xu=()=>t=>async function(n){return n.headers[as]||(n.headers[as]=Cr()),t(n)},Nu=({maxAttempts:t=na})=>(e,n)=>async function(i){const s=n.attemptsCount??0;return i.headers[Eu]=`attempt=${s+1}; max=${t}`,e(i)},si=({userAgentHeader:t="x-amz-user-agent",userAgentValue:e=""})=>n=>async function(i){if(e.trim().length===0)return await n(i);{const s=t.toLowerCase();return i.headers[s]=i.headers[s]?`${i.headers[s]} ${e}`:e,await n(i)}},on=(t,e)=>(n,r)=>{const i={};let s=o=>t(o,r);for(let o=e.length-1;o>=0;o--){const a=e[o];s=a(r)(s,i)}return s(n)},fr=t=>{let e;return()=>(e||(e=t()),e)},Pu=t=>!["HEAD","GET","DELETE"].includes(t.toUpperCase()),oi=async({url:t,method:e,headers:n,body:r},{abortSignal:i,cache:s,withCrossDomainCredentials:o})=>{var d;let a;try{a=await fetch(t,{method:e,headers:n,body:Pu(e)?r:void 0,signal:i,cache:s,credentials:o?"include":"same-origin"})}catch(h){throw h instanceof TypeError?new se({name:nt.NetworkError,message:"A network error has occurred.",underlyingError:h}):h}const c={};(d=a.headers)==null||d.forEach((h,f)=>{c[f.toLowerCase()]=h});const l={statusCode:a.status,headers:c,body:null},u=Object.assign(a.body??{},{text:fr(()=>a.text()),blob:fr(()=>a.blob()),json:fr(()=>a.json())});return{...l,body:u}},sa=on(oi,[si,xu,ii,Nu]),ku=()=>t=>async function(n){return n.headers["cache-control"]="no-store",t(n)},oa=on(sa,[ku]),aa=t=>(e,n)=>{const r=Ru(t),i=JSON.stringify(e);return _u(n,r,i)},Ru=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityService.${t}`}),_u=({url:t},e,n)=>({headers:e,url:t,body:n,method:"POST"}),us=t=>Ie(oa,aa("GetCredentialsForIdentity"),Ou,{...ia,...t,userAgentValue:xt()}),Ou=async t=>{if(t.statusCode>=300)throw await pt(t);const e=await sn(t);return{IdentityId:e.IdentityId,Credentials:Mu(e.Credentials),$metadata:Qn(t)}},Mu=({Expiration:t,...e}={})=>({...e,Expiration:t&&new Date(t*1e3)}),Du=t=>Ie(oa,aa("GetId"),Uu,{...ia,...t,userAgentValue:xt()}),Uu=async t=>{if(t.statusCode>=300)throw await pt(t);return{IdentityId:(await sn(t)).IdentityId,$metadata:Qn(t)}},ca={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},Fu={partitions:[ca,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},la=t=>{const{partitions:e}=Fu;for(const{regions:n,outputs:r,regionRegex:i}of e){const s=new RegExp(i);if(n.includes(t)||s.test(t))return r.dnsSuffix}return ca.outputs.dnsSuffix},pe=URL,ua=URLSearchParams,$u=({region:t})=>({url:new pe(`https://${ra}.${t}.${la(t)}`)});class jt extends se{constructor(){super({name:nt.PlatformNotSupported,message:"Function not supported on current platform"})}}class da{constructor(e){this.storage=e}async setItem(e,n){if(!this.storage)throw new jt;this.storage.setItem(e,n)}async getItem(e){if(!this.storage)throw new jt;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new jt;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new jt;this.storage.clear()}}class ha{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,n){this.storage.set(e,n)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}const fa=new Y("CoreStorageUtils"),qu=()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{fa.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new ha},pa=()=>{try{if(typeof window<"u"&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw new Error("sessionStorage is not defined")}catch{return fa.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new ha}};class Bu extends da{constructor(){super(qu())}}class Ku extends da{constructor(){super(pa())}}class Hu{constructor(e){this._storage=e}get storage(){if(!this._storage)throw new jt;return this._storage}setItem(e,n){this.storage.setItem(e,n)}getItem(e){return this.storage.getItem(e)}removeItem(e){this.storage.removeItem(e)}clear(){this.storage.clear()}}class ju extends Hu{constructor(){super(pa())}}/*! js-cookie v3.0.5 | MIT */function mn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}var Vu={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Lr(t,e){function n(i,s,o){if(!(typeof document>"u")){o=mn({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in o)o[c]&&(a+="; "+c,o[c]!==!0&&(a+="="+o[c].split(";")[0]));return document.cookie=i+"="+t.write(s,i)+a}}function r(i){if(!(typeof document>"u"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],o={},a=0;a<s.length;a++){var c=s[a].split("="),l=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(o[u]=t.read(l,u),i===u)break}catch{}}return i?o[i]:o}}return Object.create({set:n,get:r,remove:function(i,s){n(i,"",mn({},s,{expires:-1}))},withAttributes:function(i){return Lr(this.converter,mn({},this.attributes,i))},withConverter:function(i){return Lr(mn({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var yn=Lr(Vu,{path:"/"});class Wu{constructor(e={}){const{path:n,domain:r,expires:i,sameSite:s,secure:o}=e;if(this.domain=r,this.path=n||"/",this.expires=Object.prototype.hasOwnProperty.call(e,"expires")?i:365,this.secure=Object.prototype.hasOwnProperty.call(e,"secure")?o:!0,Object.prototype.hasOwnProperty.call(e,"sameSite")){if(!s||!["strict","lax","none"].includes(s))throw new Error('The sameSite value of cookieStorage must be "lax", "strict" or "none".');if(s==="none"&&!this.secure)throw new Error("sameSite = None requires the Secure attribute in latest browser versions.");this.sameSite=s}}async setItem(e,n){yn.set(e,n,this.getData())}async getItem(e){return yn.get(e)??null}async removeItem(e){yn.remove(e,this.getData())}async clear(){const e=yn.get(),n=Object.keys(e).map(r=>this.removeItem(r));await Promise.all(n)}getData(){return{path:this.path,expires:this.expires,domain:this.domain,secure:this.secure,...this.sameSite&&{sameSite:this.sameSite}}}}const an=new Bu;new Ku;const Be=new ju,ga=t=>Object.keys(t).map(e=>e.toLowerCase()).sort().join(";"),Gu="X-Amz-Date",zu="X-Amz-Security-Token",Ju="authorization",Yu="host",Qu=Gu.toLowerCase(),Xu=zu.toLowerCase(),ma="aws4_request",ya="AWS4-HMAC-SHA256",Zu="AWS4",ed="e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",td="UNSIGNED-PAYLOAD",nd=(t,e,n)=>`${t}/${e}/${n}/${ma}`,rd=t=>{const e=t.toISOString().replace(/[:-]|\.\d{3}/g,"");return{longDate:e,shortDate:e.slice(0,8)}},id=({credentials:t,signingDate:e=new Date,signingRegion:n,signingService:r,uriEscapePath:i=!0})=>{const{accessKeyId:s,secretAccessKey:o,sessionToken:a}=t,{longDate:c,shortDate:l}=rd(e),u=nd(l,n,r);return{accessKeyId:s,credentialScope:u,longDate:c,secretAccessKey:o,sessionToken:a,shortDate:l,signingRegion:n,signingService:r,uriEscapePath:i}},Vt=(t,e)=>{const n=new bt(t??void 0);return n.update(e),n.digestSync()},xr=(t,e)=>{const n=Vt(t,e);return hl(n)},sd=t=>Object.entries(t).map(([e,n])=>({key:e.toLowerCase(),value:(n==null?void 0:n.trim().replace(/\s+/g," "))??""})).sort((e,n)=>e.key<n.key?-1:1).map(e=>`${e.key}:${e.value}
`).join(""),od=t=>Array.from(t).sort(([e,n],[r,i])=>e===r?n<i?-1:1:e<r?-1:1).map(([e,n])=>`${ds(e)}=${ds(n)}`).join("&"),ds=t=>encodeURIComponent(t).replace(/[!'()*]/g,ad),ad=t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`,cd=(t,e=!0)=>t?e?encodeURIComponent(t).replace(/%2F/g,"/"):t:"/",ld=t=>t==null?ed:ud(t)?xr(null,t):td,ud=t=>typeof t=="string"||ArrayBuffer.isView(t)||dd(t),dd=t=>typeof ArrayBuffer=="function"&&t instanceof ArrayBuffer||Object.prototype.toString.call(t)==="[object ArrayBuffer]",hd=({body:t,headers:e,method:n,url:r},i=!0)=>[n,cd(r.pathname,i),od(r.searchParams),sd(e),ga(e),ld(t)].join(`
`),fd=(t,e,n,r)=>{const i=`${Zu}${t}`,s=Vt(i,e),o=Vt(s,n),a=Vt(o,r);return Vt(a,ma)},pd=(t,e,n)=>[ya,t,e,n].join(`
`),gd=(t,{credentialScope:e,longDate:n,secretAccessKey:r,shortDate:i,signingRegion:s,signingService:o,uriEscapePath:a})=>{const c=hd(t,a),l=xr(null,c),u=pd(n,e,l);return xr(fd(r,i,s,o),u)},va=(t,e)=>{const n=id(e),{accessKeyId:r,credentialScope:i,longDate:s,sessionToken:o}=n,a={...t.headers};a[Yu]=t.url.host,a[Qu]=s,o&&(a[Xu]=o);const c={...t,headers:a},l=gd(c,n),u=`Credential=${r}/${i}`,d=`SignedHeaders=${ga(a)}`,h=`Signature=${l}`;return a[Ju]=`${ya} ${u}, ${d}, ${h}`,c},Ea=t=>new Date(Date.now()+t),md=5*60*1e3,yd=(t,e)=>Math.abs(Ea(e).getTime()-t)>=md,vd=(t,e)=>yd(t,e)?t-Date.now():e,Ed=({credentials:t,region:e,service:n,uriEscapePath:r=!0})=>{let i;return(s,o)=>async function(c){i=i??0;const l={credentials:typeof t=="function"?await t({forceRefresh:!!(o!=null&&o.isCredentialsExpired)}):t,signingDate:Ea(i),signingRegion:e,signingService:n,uriEscapePath:r},u=await va(c,l),d=await s(u),h=wd(d);return h&&(i=vd(Date.parse(h),i)),d}},wd=({headers:t}={})=>(t==null?void 0:t.date)??(t==null?void 0:t.Date)??(t==null?void 0:t["x-amz-date"]),Sd=t=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=[],r=new Uint8Array(t);Wr().getRandomValues(r);for(const i of r)n.push(e[i%e.length]);return n.join("")};class Id extends Error{constructor(){super(...arguments),this.nonRetryable=!0}}const bd=(t,e,n=ea,r)=>Rc(t,e,ta(n));function Ad(t){return(t.match(/.{2}/g)||[]).map(n=>String.fromCharCode(parseInt(n,16))).join("")}function Td(t){return t.split("").map(e=>e.charCodeAt(0).toString(16).padStart(2,"0")).join("")}const Cd=t=>{let e;return async(...n)=>e||(e=new Promise((r,i)=>{t(...n).then(s=>{r(s)}).catch(s=>{i(s)}).finally(()=>{e=void 0})}),e)};function hs({expiresAt:t,clockDrift:e,tolerance:n=5e3}){return Date.now()+e+n>t}const Ld=async()=>{const{userAgentData:t}=navigator;if(!t)return navigator.userAgent;const{platform:e="",platformVersion:n="",model:r="",architecture:i="",fullVersionList:s=[]}=await t.getHighEntropyValues(["platform","platformVersion","architecture","model","fullVersionList"]),o=s.map(c=>`${c.brand}/${c.version}`).join(";");return[e,n,i,r,e,o].filter(c=>c).join(" ")||navigator.userAgent};class Fn extends se{get response(){return this._response?xd(this._response):void 0}constructor(e){super(e),this.constructor=Fn,Object.setPrototypeOf(this,Fn.prototype),e.response&&(this._response=e.response)}}const xd=t=>({...t,headers:{...t.headers}});function Nd(t){return Array.from(t,e=>String.fromCodePoint(e)).join("")}const lt={convert(t,e={urlSafe:!1,skipPadding:!1}){const n=typeof t=="string"?t:Nd(t);let r=Nc()(n);return e.urlSafe&&(r=r.replace(/\+/g,"-").replace(/\//g,"_")),e.skipPadding&&(r=r.replace(/=/g,"")),r}};function Pd(){return Wr().getRandomValues(new Uint32Array(1))[0]}function kd(t){const{words:e}=t,{sigBytes:n}=t,r=[];for(let i=0;i<n;i++){const s=e[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((s&15).toString(16))}return r.join("")}class ai{constructor(e,n){this.words=[];let r=e;r=this.words=r||[],n!==void 0?this.sigBytes=n:this.sigBytes=r.length*4}random(e){const n=[];for(let r=0;r<e;r+=4)n.push(Pd());return new ai(n,e)}toString(){return kd(this)}}var R;(function(t){t.EmptySignInUsername="EmptySignInUsername",t.EmptySignInPassword="EmptySignInPassword",t.CustomAuthSignInPassword="CustomAuthSignInPassword",t.EmptySignUpUsername="EmptySignUpUsername",t.EmptySignUpPassword="EmptySignUpPassword",t.EmptyConfirmSignUpUsername="EmptyConfirmSignUpUsername",t.EmptyConfirmSignUpCode="EmptyConfirmSignUpCode",t.EmptyResendSignUpCodeUsername="EmptyresendSignUpCodeUsername",t.EmptyChallengeResponse="EmptyChallengeResponse",t.EmptyConfirmResetPasswordUsername="EmptyConfirmResetPasswordUsername",t.EmptyConfirmResetPasswordNewPassword="EmptyConfirmResetPasswordNewPassword",t.EmptyConfirmResetPasswordConfirmationCode="EmptyConfirmResetPasswordConfirmationCode",t.EmptyResetPasswordUsername="EmptyResetPasswordUsername",t.EmptyVerifyTOTPSetupCode="EmptyVerifyTOTPSetupCode",t.EmptyConfirmUserAttributeCode="EmptyConfirmUserAttributeCode",t.IncorrectMFAMethod="IncorrectMFAMethod",t.EmptyUpdatePassword="EmptyUpdatePassword"})(R||(R={}));const wa={[R.EmptyChallengeResponse]:{message:"challengeResponse is required to confirmSignIn"},[R.EmptyConfirmResetPasswordUsername]:{message:"username is required to confirmResetPassword"},[R.EmptyConfirmSignUpCode]:{message:"code is required to confirmSignUp"},[R.EmptyConfirmSignUpUsername]:{message:"username is required to confirmSignUp"},[R.EmptyConfirmResetPasswordConfirmationCode]:{message:"confirmationCode is required to confirmResetPassword"},[R.EmptyConfirmResetPasswordNewPassword]:{message:"newPassword is required to confirmResetPassword"},[R.EmptyResendSignUpCodeUsername]:{message:"username is required to confirmSignUp"},[R.EmptyResetPasswordUsername]:{message:"username is required to resetPassword"},[R.EmptySignInPassword]:{message:"password is required to signIn"},[R.EmptySignInUsername]:{message:"username is required to signIn"},[R.EmptySignUpPassword]:{message:"password is required to signUp"},[R.EmptySignUpUsername]:{message:"username is required to signUp"},[R.CustomAuthSignInPassword]:{message:"A password is not needed when signing in with CUSTOM_WITHOUT_SRP",recoverySuggestion:"Do not include a password in your signIn call."},[R.IncorrectMFAMethod]:{message:"Incorrect MFA method was chosen. It should be either SMS, TOTP, or EMAIL",recoverySuggestion:"Try to pass SMS, TOTP, or EMAIL as the challengeResponse"},[R.EmptyVerifyTOTPSetupCode]:{message:"code is required to verifyTotpSetup"},[R.EmptyUpdatePassword]:{message:"oldPassword and newPassword are required to changePassword"},[R.EmptyConfirmUserAttributeCode]:{message:"confirmation code is required to confirmUserAttribute"}};var Z;(function(t){t.DEFAULT_MSG="Authentication Error",t.EMPTY_EMAIL="Email cannot be empty",t.EMPTY_PHONE="Phone number cannot be empty",t.EMPTY_USERNAME="Username cannot be empty",t.INVALID_USERNAME="The username should either be a string or one of the sign in types",t.EMPTY_PASSWORD="Password cannot be empty",t.EMPTY_CODE="Confirmation code cannot be empty",t.SIGN_UP_ERROR="Error creating account",t.NO_MFA="No valid MFA method provided",t.INVALID_MFA="Invalid MFA type",t.EMPTY_CHALLENGE="Challenge response cannot be empty",t.NO_USER_SESSION="Failed to get the session because the user is empty",t.NETWORK_ERROR="Network Error",t.DEVICE_CONFIG="Device tracking has not been configured in this User Pool",t.AUTOSIGNIN_ERROR="Please use your credentials to sign in",t.OAUTH_ERROR="Couldn't finish OAuth flow, check your User Pool HostedUI settings"})(Z||(Z={}));var ut;(function(t){t.SignInException="SignInException",t.OAuthSignInError="OAuthSignInException"})(ut||(ut={}));class N extends se{constructor(e){super(e),this.constructor=N,Object.setPrototypeOf(this,N.prototype)}}function Q(t,e){const{message:n,recoverySuggestion:r}=wa[e];if(!t)throw new N({name:e,message:n,recoverySuggestion:r})}function te(t){const e=t==null?void 0:t.split("_")[0];if(!t||t.indexOf("_")<0||!e||typeof e!="string")throw new N({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return e}function Nr(t){if(!t||!t.includes(":"))throw new N({name:"InvalidIdentityPoolIdException",message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."});return t.split(":")[0]}function fs(t){return Object.entries(t).map(([e,n])=>({Name:e,Value:n}))}function rv(t){const e={};return t==null||t.forEach(n=>{n.Name&&(e[n.Name]=n.Value)}),e}var ps;(function(t){t.ConcurrentModificationException="ConcurrentModificationException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceNotFoundException="ResourceNotFoundException",t.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException"})(ps||(ps={}));var gs;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.InvalidPasswordException="InvalidPasswordException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(gs||(gs={}));var ms;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidPasswordException="InvalidPasswordException",t.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UsernameExistsException="UsernameExistsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(ms||(ms={}));var ys;(function(t){t.CodeMismatchException="CodeMismatchException",t.ExpiredCodeException="ExpiredCodeException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidPasswordException="InvalidPasswordException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyFailedAttemptsException="TooManyFailedAttemptsException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(ys||(ys={}));var vs;(function(t){t.AliasExistsException="AliasExistsException",t.CodeMismatchException="CodeMismatchException",t.ExpiredCodeException="ExpiredCodeException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyFailedAttemptsException="TooManyFailedAttemptsException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotFoundException="UserNotFoundException"})(vs||(vs={}));var Es;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Es||(Es={}));var ws;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(ws||(ws={}));var Ss;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Ss||(Ss={}));var Is;(function(t){t.CodeDeliveryFailureException="CodeDeliveryFailureException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",t.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotFoundException="UserNotFoundException"})(Is||(Is={}));var bs;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(bs||(bs={}));var As;(function(t){t.ExternalServiceException="ExternalServiceException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceConflictException="ResourceConflictException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException"})(As||(As={}));var Ts;(function(t){t.ExternalServiceException="ExternalServiceException",t.InternalErrorException="InternalErrorException",t.InvalidIdentityPoolConfigurationException="InvalidIdentityPoolConfigurationException",t.InvalidParameterException="InvalidParameterException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceConflictException="ResourceConflictException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException"})(Ts||(Ts={}));var Cs;(function(t){t.CodeDeliveryFailureException="CodeDeliveryFailureException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",t.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Cs||(Cs={}));var Ls;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException"})(Ls||(Ls={}));var $n;(function(t){t.PasswordResetRequiredException="PasswordResetRequiredException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",t.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",t.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})($n||($n={}));var xs;(function(t){t.CodeDeliveryFailureException="CodeDeliveryFailureException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",t.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotFoundException="UserNotFoundException"})(xs||(xs={}));var Ns;(function(t){t.AliasExistsException="AliasExistsException",t.CodeMismatchException="CodeMismatchException",t.ExpiredCodeException="ExpiredCodeException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidPasswordException="InvalidPasswordException",t.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",t.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",t.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",t.MFAMethodNotFoundException="MFAMethodNotFoundException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Ns||(Ns={}));var Ps;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Ps||(Ps={}));var Pr;(function(t){t.CodeDeliveryFailureException="CodeDeliveryFailureException",t.InternalErrorException="InternalErrorException",t.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidPasswordException="InvalidPasswordException",t.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",t.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",t.NotAuthorizedException="NotAuthorizedException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UsernameExistsException="UsernameExistsException"})(Pr||(Pr={}));var ks;(function(t){t.AliasExistsException="AliasExistsException",t.CodeDeliveryFailureException="CodeDeliveryFailureException",t.CodeMismatchException="CodeMismatchException",t.ExpiredCodeException="ExpiredCodeException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidEmailRoleAccessPolicyException="InvalidEmailRoleAccessPolicyException",t.InvalidLambdaResponseException="InvalidLambdaResponseException",t.InvalidParameterException="InvalidParameterException",t.InvalidSmsRoleAccessPolicyException="InvalidSmsRoleAccessPolicyException",t.InvalidSmsRoleTrustRelationshipException="InvalidSmsRoleTrustRelationshipException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UnexpectedLambdaException="UnexpectedLambdaException",t.UserLambdaValidationException="UserLambdaValidationException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(ks||(ks={}));var Rs;(function(t){t.CodeMismatchException="CodeMismatchException",t.EnableSoftwareTokenMFAException="EnableSoftwareTokenMFAException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.SoftwareTokenMFANotFoundException="SoftwareTokenMFANotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Rs||(Rs={}));var _s;(function(t){t.AliasExistsException="AliasExistsException",t.CodeMismatchException="CodeMismatchException",t.ExpiredCodeException="ExpiredCodeException",t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.LimitExceededException="LimitExceededException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(_s||(_s={}));var Os;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Os||(Os={}));var Ms;(function(t){t.ForbiddenException="ForbiddenException",t.InternalErrorException="InternalErrorException",t.InvalidParameterException="InvalidParameterException",t.InvalidUserPoolConfigurationException="InvalidUserPoolConfigurationException",t.NotAuthorizedException="NotAuthorizedException",t.PasswordResetRequiredException="PasswordResetRequiredException",t.ResourceNotFoundException="ResourceNotFoundException",t.TooManyRequestsException="TooManyRequestsException",t.UserNotConfirmedException="UserNotConfirmedException",t.UserNotFoundException="UserNotFoundException"})(Ms||(Ms={}));const Xn="UserUnAuthenticatedException",Rd="UserAlreadyAuthenticatedException",_d="DeviceMetadataNotFoundException",Od="InvalidRedirectException",Md="InvalidAppSchemeException",Dd="InvalidPreferredRedirectUrlException",Ud=new N({name:Od,message:"signInRedirect or signOutRedirect had an invalid format or was not found.",recoverySuggestion:"Please make sure the signIn/Out redirect in your oauth config is valid."});new N({name:Md,message:"A valid non-http app scheme was not found in the config.",recoverySuggestion:"Please make sure a valid custom app scheme is present in the config."});new N({name:Dd,message:"The given preferredRedirectUrl does not match any items in the redirectSignOutUrls array from the config.",recoverySuggestion:"Please make sure a matching preferredRedirectUrl is provided."});const Fd="InvalidOriginException",$d=new N({name:Fd,message:"redirect is coming from a different origin. The oauth flow needs to be initiated from the same origin",recoverySuggestion:"Please call signInWithRedirect from the same origin."}),qd="OAuthSignOutException",Bd="TokenRefreshException",Kd="UnexpectedSignInInterruptionException";function Hd(t){if(!t||!t.accessToken)throw new N({name:Xn,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}function jd(t){if(!t||!t.idToken)throw new N({name:Xn,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}const Vd=new N({name:Bd,message:`Token refresh is not supported when authenticated with the 'implicit grant' (token) oauth flow. 
	Please change your oauth configuration to use 'code grant' flow.`,recoverySuggestion:`Please logout and change your Amplify configuration to use "code grant" flow. 
	E.g { responseType: 'code' }`}),Wd=new N({name:Xn,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."});function Sa(t){if(Jd(t))throw Vd;if(!zd(t))throw Wd}function Ia(t){if(!t||!t.deviceKey||!t.deviceGroupKey||!t.randomPassword)throw new N({name:_d,message:"Either deviceKey, deviceGroupKey or secretPassword were not found during the sign-in process.",recoverySuggestion:"Make sure to not clear storage after calling the signIn API."})}const Gd={inflightOAuth:"inflightOAuth",oauthSignIn:"oauthSignIn",oauthPKCE:"oauthPKCE",oauthState:"oauthState"};function ba(t){return(t==null?void 0:t.accessToken)||(t==null?void 0:t.idToken)}function zd(t){return ba(t)&&(t==null?void 0:t.refreshToken)}function Jd(t){return ba(t)&&!(t!=null&&t.refreshToken)}const Yd=async t=>{var a,c;const e=(a=t.getConfig().Auth)==null?void 0:a.Cognito;U(e);const n=await t.Auth.getTokens({forceRefresh:!1});Hd(n);const{"cognito:username":r,sub:i}=((c=n.idToken)==null?void 0:c.payload)??{},s={username:r,userId:i},o=Qd(n);return o&&(s.signInDetails=o),s};function Qd(t){return t==null?void 0:t.signInDetails}const mt=async()=>Yd(B),de=(t,e)=>xt({category:Dn.Auth,action:t,...e}),De=t=>(e,n)=>{const r=Xd(t),i=JSON.stringify(e);return Zd(n,r,i)},Xd=t=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${t}`}),Zd=({url:t},e,n)=>({headers:e,url:t,body:n,method:"POST"});function Ne(t){if(!t||t.name==="Error"||t instanceof TypeError)throw new N({name:nt.Unknown,message:"An unknown error has occurred.",underlyingError:t})}const Je=()=>async t=>{if(t.statusCode>=300){const e=await pt(t);throw Ne(e),new N({name:e.name,message:e.message,metadata:e.$metadata})}return sn(t)},eh=()=>(t,e)=>async function(r){return r.headers["cache-control"]="no-store",t(r)},Ue=on(sa,[eh]),Aa="cognito-idp",Fe={service:Aa,retryDecider:ri(pt),computeDelay:ni,userAgentValue:xt(),cache:"no-store"},Nt=t=>Ie(Ue,De("InitiateAuth"),Je(),{...Fe,...t}),Zn=t=>Ie(Ue,De("RespondToAuthChallenge"),Je(),{...Fe,...t}),th=t=>Ie(Ue,De("AssociateSoftwareToken"),Je(),{...Fe,...t}),nh=({region:t})=>({url:new pe(`https://${Aa}.${t}.${la(t)}`)}),ne=({endpointOverride:t})=>e=>t?{url:new pe(t)}:nh(e);function me({username:t,userPoolId:e,userPoolClientId:n}){if(typeof window>"u")return;const r=window.AmazonCognitoAdvancedSecurityData;if(typeof r>"u")return;const i=r.getData(t,e,n);return i?{EncodedData:i}:{}}const rh=async({tokens:t,authConfig:e,username:n})=>{var m;U(e==null?void 0:e.Cognito);const{userPoolId:r,userPoolClientId:i,userPoolEndpoint:s}=e.Cognito,o=te(r);Sa(t);const a=t.refreshToken,c={REFRESH_TOKEN:a};(m=t.deviceMetadata)!=null&&m.deviceKey&&(c.DEVICE_KEY=t.deviceMetadata.deviceKey);const l=me({username:n,userPoolId:r,userPoolClientId:i}),u=Nt({endpointResolver:ne({endpointOverride:s})}),{AuthenticationResult:d}=await u({region:o},{ClientId:i,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:c,UserContextData:l}),h=Ve((d==null?void 0:d.AccessToken)??""),f=d!=null&&d.IdToken?Ve(d.IdToken):void 0,{iat:p}=h.payload;if(!p)throw new N({name:"iatNotFoundException",message:"iat not found in access token"});const g=p*1e3-new Date().getTime();return{accessToken:h,idToken:f,clockDrift:g,refreshToken:a,username:n}},ih=Cd(rh),sh={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails",oauthMetadata:"oauthMetadata"};var qn;(function(t){t.InvalidAuthTokens="InvalidAuthTokens"})(qn||(qn={}));const oh={[qn.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}},ah=Vr(oh),Ds="CognitoIdentityServiceProvider";class ch{getKeyValueStorage(){if(!this.keyValueStorage)throw new N({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(e){this.keyValueStorage=e}setAuthConfig(e){this.authConfig=e}async loadTokens(){try{const e=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(e.accessToken);if(!n)throw new N({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});const r=Ve(n),i=await this.getKeyValueStorage().getItem(e.idToken),s=i?Ve(i):void 0,o=await this.getKeyValueStorage().getItem(e.refreshToken)??void 0,a=await this.getKeyValueStorage().getItem(e.clockDrift)??"0",c=Number.parseInt(a),l=await this.getKeyValueStorage().getItem(e.signInDetails),u={accessToken:r,idToken:s,refreshToken:o,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:c,username:await this.getLastAuthUser()};return l&&(u.signInDetails=JSON.parse(l)),u}catch{return null}}async storeTokens(e){ah(e!==void 0,qn.InvalidAuthTokens);const n=e.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),n);const r=await this.getAuthKeys();await this.getKeyValueStorage().setItem(r.accessToken,e.accessToken.toString()),e.idToken?await this.getKeyValueStorage().setItem(r.idToken,e.idToken.toString()):await this.getKeyValueStorage().removeItem(r.idToken),e.refreshToken?await this.getKeyValueStorage().setItem(r.refreshToken,e.refreshToken):await this.getKeyValueStorage().removeItem(r.refreshToken),e.deviceMetadata&&(e.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(r.deviceKey,e.deviceMetadata.deviceKey),e.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(r.deviceGroupKey,e.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(r.randomPasswordKey,e.deviceMetadata.randomPassword)),e.signInDetails?await this.getKeyValueStorage().setItem(r.signInDetails,JSON.stringify(e.signInDetails)):await this.getKeyValueStorage().removeItem(r.signInDetails),await this.getKeyValueStorage().setItem(r.clockDrift,`${e.clockDrift}`)}async clearTokens(){const e=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(e.accessToken),this.getKeyValueStorage().removeItem(e.idToken),this.getKeyValueStorage().removeItem(e.clockDrift),this.getKeyValueStorage().removeItem(e.refreshToken),this.getKeyValueStorage().removeItem(e.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey()),this.getKeyValueStorage().removeItem(e.oauthMetadata)])}async getDeviceMetadata(e){const n=await this.getAuthKeys(e),r=await this.getKeyValueStorage().getItem(n.deviceKey),i=await this.getKeyValueStorage().getItem(n.deviceGroupKey),s=await this.getKeyValueStorage().getItem(n.randomPasswordKey);return s&&i&&r?{deviceKey:r,deviceGroupKey:i,randomPassword:s}:null}async clearDeviceMetadata(e){const n=await this.getAuthKeys(e);await Promise.all([this.getKeyValueStorage().removeItem(n.deviceKey),this.getKeyValueStorage().removeItem(n.deviceGroupKey),this.getKeyValueStorage().removeItem(n.randomPasswordKey)])}async getAuthKeys(e){var r;U((r=this.authConfig)==null?void 0:r.Cognito);const n=e??await this.getLastAuthUser();return lh(Ds,`${this.authConfig.Cognito.userPoolClientId}.${n}`)}getLastAuthUserKey(){var n;U((n=this.authConfig)==null?void 0:n.Cognito);const e=this.authConfig.Cognito.userPoolClientId;return`${Ds}.${e}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}async setOAuthMetadata(e){const{oauthMetadata:n}=await this.getAuthKeys();await this.getKeyValueStorage().setItem(n,JSON.stringify(e))}async getOAuthMetadata(){const{oauthMetadata:e}=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(e);return n&&JSON.parse(n)}}const lh=(t,e)=>ci(sh)(`${t}`,e);function ci(t){const e=Object.values({...t});return(n,r)=>e.reduce((i,s)=>({...i,[s]:`${n}.${r}.${s}`}),{})}const Us="amplify-signin-with-hostedUI",ke="CognitoIdentityServiceProvider";class Ta{constructor(e){this.keyValueStorage=e}async clearOAuthInflightData(){U(this.cognitoConfig);const e=Re(ke,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(e.inflightOAuth),this.keyValueStorage.removeItem(e.oauthPKCE),this.keyValueStorage.removeItem(e.oauthState)])}async clearOAuthData(){U(this.cognitoConfig);const e=Re(ke,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(Us),this.keyValueStorage.removeItem(e.oauthSignIn)}loadOAuthState(){U(this.cognitoConfig);const e=Re(ke,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthState)}storeOAuthState(e){U(this.cognitoConfig);const n=Re(ke,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthState,e)}loadPKCE(){U(this.cognitoConfig);const e=Re(ke,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(e.oauthPKCE)}storePKCE(e){U(this.cognitoConfig);const n=Re(ke,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthPKCE,e)}setAuthConfig(e){this.cognitoConfig=e}async loadOAuthInFlight(){U(this.cognitoConfig);const e=Re(ke,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.getItem(e.inflightOAuth)==="true"}async storeOAuthInFlight(e){U(this.cognitoConfig);const n=Re(ke,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(n.inflightOAuth,`${e}`)}async loadOAuthSignIn(){var s;U(this.cognitoConfig);const e=Re(ke,this.cognitoConfig.userPoolClientId),n=await this.keyValueStorage.getItem(Us),[r,i]=((s=await this.keyValueStorage.getItem(e.oauthSignIn))==null?void 0:s.split(","))??[];return{isOAuthSignIn:r==="true"||n==="true",preferPrivateSession:i==="true"}}async storeOAuthSignIn(e,n=!1){U(this.cognitoConfig);const r=Re(ke,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(r.oauthSignIn,`${e},${n}`)}}const Re=(t,e)=>ci(Gd)(t,e),le=new Ta(an),kr=[],uh=t=>{kr.push(t)},Ca=()=>{var t;for(;kr.length;)(t=kr.pop())==null||t()};class dh{constructor(){this.waitForInflightOAuth=Yn()?async()=>{if(await le.loadOAuthInFlight())return this.inflightPromise?this.inflightPromise:(this.inflightPromise=new Promise((e,n)=>{uh(e)}),this.inflightPromise)}:async()=>{}}setAuthConfig(e){le.setAuthConfig(e.Cognito),this.authConfig=e}setTokenRefresher(e){this.tokenRefresher=e}setAuthTokenStore(e){this.tokenStore=e}getTokenStore(){if(!this.tokenStore)throw new N({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new N({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}async getTokens(e){var o,a,c,l,u;let n;try{U((o=this.authConfig)==null?void 0:o.Cognito)}catch{return null}await this.waitForInflightOAuth(),this.inflightPromise=void 0,n=await this.getTokenStore().loadTokens();const r=await this.getTokenStore().getLastAuthUser();if(n===null)return null;const i=!!(n!=null&&n.idToken)&&hs({expiresAt:(((c=(a=n.idToken)==null?void 0:a.payload)==null?void 0:c.exp)??0)*1e3,clockDrift:n.clockDrift??0}),s=hs({expiresAt:(((u=(l=n.accessToken)==null?void 0:l.payload)==null?void 0:u.exp)??0)*1e3,clockDrift:n.clockDrift??0});return(e!=null&&e.forceRefresh||i||s)&&(n=await this.refreshTokens({tokens:n,username:r}),n===null)?null:{accessToken:n==null?void 0:n.accessToken,idToken:n==null?void 0:n.idToken,signInDetails:n==null?void 0:n.signInDetails}}async refreshTokens({tokens:e,username:n}){try{const{signInDetails:r}=e,i=await this.getTokenRefresher()({tokens:e,authConfig:this.authConfig,username:n});return i.signInDetails=r,await this.setTokens({tokens:i}),xe.dispatch("auth",{event:"tokenRefresh"},"Auth",Le),i}catch(r){return this.handleErrors(r)}}handleErrors(e){if(Ne(e),e.name!==nt.NetworkError&&this.clearTokens(),xe.dispatch("auth",{event:"tokenRefresh_failure",data:{error:e}},"Auth",Le),e.name.startsWith("NotAuthorizedException"))return null;throw e}async setTokens({tokens:e}){return this.getTokenStore().storeTokens(e)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(e){return this.getTokenStore().getDeviceMetadata(e)}clearDeviceMetadata(e){return this.getTokenStore().clearDeviceMetadata(e)}setOAuthMetadata(e){return this.getTokenStore().setOAuthMetadata(e)}getOAuthMetadata(){return this.getTokenStore().getOAuthMetadata()}}class hh{constructor(){this.authTokenStore=new ch,this.authTokenStore.setKeyValueStorage(an),this.tokenOrchestrator=new dh,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(ih)}getTokens({forceRefresh:e}={forceRefresh:!1}){return this.tokenOrchestrator.getTokens({forceRefresh:e})}setKeyValueStorage(e){this.authTokenStore.setKeyValueStorage(e)}setAuthConfig(e){this.authTokenStore.setAuthConfig(e),this.tokenOrchestrator.setAuthConfig(e)}}const Wt=new hh,{tokenOrchestrator:ge}=Wt;async function st(t){if(t.AccessToken){const e=Ve(t.AccessToken),n=(e.payload.iat||0)*1e3,r=new Date().getTime(),i=n>0?n-r:0;let s,o,a;t.RefreshToken&&(o=t.RefreshToken),t.IdToken&&(s=Ve(t.IdToken)),t!=null&&t.NewDeviceMetadata&&(a=t.NewDeviceMetadata);const c={accessToken:e,idToken:s,refreshToken:o,clockDrift:i,deviceMetadata:a,username:t.username};t!=null&&t.signInDetails&&(c.signInDetails=t.signInDetails),await ge.setTokens({tokens:c})}else throw new se({message:"Invalid tokens",name:"InvalidTokens",recoverySuggestion:"Check Cognito UserPool settings"})}const fh="Unable to get user session following successful sign-in.",gt=async()=>{try{xe.dispatch("auth",{event:"signedIn",data:await mt()},"Auth",Le)}catch(t){throw t.name===Xn?new N({name:Kd,message:fh,recoverySuggestion:"This most likely is due to auth tokens not being persisted. If you are using cookie store, please ensure cookies can be correctly set from your server."}):t}};function La(){return{active:!1}}const ph=(t,e)=>{switch(e.type){case"SET_USERNAME":return{...t,username:e.value};case"SET_SESSION":return{...t,session:e.value};case"START":return{...t,active:!0};case"RESET":return La();default:return t}},gh=t=>{let e=t(La(),{type:"RESET"});return{getState:()=>e,dispatch:n=>{e=t(e,n)}}},Xe=gh(ph),mh=3*60*1e3,vn="CognitoSignInState",Ke={username:`${vn}.username`,challengeName:`${vn}.challengeName`,signInSession:`${vn}.signInSession`,expiry:`${vn}.expiry`},yh=(t,e)=>{switch(e.type){case"SET_SIGN_IN_SESSION":return En({signInSession:e.value}),{...t,signInSession:e.value};case"SET_SIGN_IN_STATE":return En(e.value),{...e.value};case"SET_CHALLENGE_NAME":return En({challengeName:e.value}),{...t,challengeName:e.value};case"SET_USERNAME":return En({username:e.value}),{...t,username:e.value};case"SET_INITIAL_STATE":return Eh();case"RESET_STATE":return xa(),li();default:return t}},vh=t=>{const e=Number(t),n=Date.now();return e<=n},Me=()=>{rt.dispatch({type:"RESET_STATE"})},xa=()=>{for(const t of Object.values(Ke))Be.removeItem(t)},li=()=>({username:void 0,challengeName:void 0,signInSession:void 0}),Eh=()=>{const t=Be.getItem(Ke.expiry);if(!t||vh(t))return xa(),li();const e=Be.getItem(Ke.username)??void 0,n=Be.getItem(Ke.challengeName)??void 0,r=Be.getItem(Ke.signInSession)??void 0;return{username:e,challengeName:n,signInSession:r}},wh=t=>{let e=t(li(),{type:"SET_INITIAL_STATE"});return{getState:()=>e,dispatch:n=>{e=t(e,n)}}},rt=wh(yh);function Pt(t){rt.dispatch({type:"SET_SIGN_IN_STATE",value:t})}const En=({challengeName:t,signInSession:e,username:n})=>{n&&Be.setItem(Ke.username,n),t&&Be.setItem(Ke.challengeName,t),e&&(Be.setItem(Ke.signInSession,e),Be.setItem(Ke.expiry,String(Date.now()+mh)))};class je extends se{constructor(e){super(e),this.constructor=je,Object.setPrototypeOf(this,je.prototype)}}var z;(function(t){t.PasskeyNotSupported="PasskeyNotSupported",t.PasskeyAlreadyExists="PasskeyAlreadyExists",t.InvalidPasskeyRegistrationOptions="InvalidPasskeyRegistrationOptions",t.InvalidPasskeyAuthenticationOptions="InvalidPasskeyAuthenticationOptions",t.RelyingPartyMismatch="RelyingPartyMismatch",t.PasskeyRegistrationFailed="PasskeyRegistrationFailed",t.PasskeyRetrievalFailed="PasskeyRetrievalFailed",t.PasskeyRegistrationCanceled="PasskeyRegistrationCanceled",t.PasskeyAuthenticationCanceled="PasskeyAuthenticationCanceled",t.PasskeyOperationAborted="PasskeyOperationAborted"})(z||(z={}));const Fs="Passkeys may not be supported on this device. Ensure your application is running in a secure context (HTTPS) and Web Authentication API is supported.",pr="User may have canceled the ceremony or another interruption has occurred. Check underlying error for details.",$s="Ensure your user pool is configured to support the WEB_AUTHN as an authentication factor.",Bn={[z.PasskeyNotSupported]:{message:"Passkeys may not be supported on this device.",recoverySuggestion:Fs},[z.InvalidPasskeyRegistrationOptions]:{message:"Invalid passkey registration options.",recoverySuggestion:$s},[z.InvalidPasskeyAuthenticationOptions]:{message:"Invalid passkey authentication options.",recoverySuggestion:$s},[z.PasskeyRegistrationFailed]:{message:"Device failed to create passkey.",recoverySuggestion:Fs},[z.PasskeyRetrievalFailed]:{message:"Device failed to retrieve passkey.",recoverySuggestion:"Passkeys may not be available on this device. Try an alternative authentication factor like PASSWORD, EMAIL_OTP, or SMS_OTP."},[z.PasskeyAlreadyExists]:{message:"Passkey already exists in authenticator.",recoverySuggestion:"Proceed with existing passkey or try again after deleting the credential."},[z.PasskeyRegistrationCanceled]:{message:"Passkey registration ceremony has been canceled.",recoverySuggestion:pr},[z.PasskeyAuthenticationCanceled]:{message:"Passkey authentication ceremony has been canceled.",recoverySuggestion:pr},[z.PasskeyOperationAborted]:{message:"Passkey operation has been aborted.",recoverySuggestion:pr},[z.RelyingPartyMismatch]:{message:"Relying party does not match current domain.",recoverySuggestion:"Ensure relying party identifier matches current domain."}},ui=Vr(Bn,je),Sh=t=>{if(t instanceof je)return t;if(t instanceof Error&&t.name==="NotAllowedError"){const{message:e,recoverySuggestion:n}=Bn[z.PasskeyAuthenticationCanceled];return new je({name:z.PasskeyAuthenticationCanceled,message:e,recoverySuggestion:n,underlyingError:t})}return Ih(t)},Ih=t=>{if(t instanceof Error){if(t.name==="AbortError"){const{message:e,recoverySuggestion:n}=Bn[z.PasskeyOperationAborted];return new je({name:z.PasskeyOperationAborted,message:e,recoverySuggestion:n,underlyingError:t})}if(t.name==="SecurityError"){const{message:e,recoverySuggestion:n}=Bn[z.RelyingPartyMismatch];return new je({name:z.RelyingPartyMismatch,message:e,recoverySuggestion:n,underlyingError:t})}}return new je({name:nt.Unknown,message:"An unknown error has occurred.",underlyingError:t})},bh=()=>Yn()&&window.isSecureContext&&"credentials"in navigator&&typeof window.PublicKeyCredential=="function",Bt=t=>lt.convert(new Uint8Array(t),{urlSafe:!0,skipPadding:!0}),qs=t=>Uint8Array.from(Gr.convert(t,{urlSafe:!0}),e=>e.charCodeAt(0)).buffer,Ah=t=>{const e=qs(t.challenge),n=(t.allowCredentials||[]).map(r=>({...r,id:qs(r.id)}));return{...t,challenge:e,allowCredentials:n}},Th=t=>{const e={clientDataJSON:Bt(t.response.clientDataJSON),authenticatorData:Bt(t.response.authenticatorData),signature:Bt(t.response.signature)};t.response.userHandle&&(e.userHandle=Bt(t.response.userHandle));const n={id:t.id,rawId:Bt(t.rawId),type:t.type,clientExtensionResults:t.getClientExtensionResults(),response:e};return t.authenticatorAttachment&&(n.authenticatorAttachment=t.authenticatorAttachment),n};function Ch(t){ui(t&&t instanceof PublicKeyCredential&&t.response instanceof AuthenticatorAssertionResponse,z.PasskeyRetrievalFailed)}const Lh=async t=>{try{const e=bh();ui(e,z.PasskeyNotSupported);const n=Ah(t),r=await navigator.credentials.get({publicKey:n});return Ch(r),Th(r)}catch(e){throw Sh(e)}},xh=t=>Ie(Ue,De("ConfirmDevice"),Je(),{...Fe,...t}),An={convert(t){return new TextEncoder().encode(t)}};function T(t,e){t!=null&&this.fromString(t,e)}function ce(){return new T(null,null)}let tt;const Nh=0xdeadbeefcafe,Bs=(Nh&16777215)===15715070;function Ph(t,e,n,r,i,s){for(;--s>=0;){const o=e*this[t++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function kh(t,e,n,r,i,s){const o=e&32767,a=e>>15;for(;--s>=0;){let c=this[t]&32767;const l=this[t++]>>15,u=a*c+l*o;c=o*c+((u&32767)<<15)+n[r]+(i&1073741823),i=(c>>>30)+(u>>>15)+a*l+(i>>>30),n[r++]=c&1073741823}return i}function Rh(t,e,n,r,i,s){const o=e&16383,a=e>>14;for(;--s>=0;){let c=this[t]&16383;const l=this[t++]>>14,u=a*c+l*o;c=o*c+((u&16383)<<14)+n[r]+i,i=(c>>28)+(u>>14)+a*l,n[r++]=c&268435455}return i}const Ks=typeof navigator<"u";Ks&&Bs&&navigator.appName==="Microsoft Internet Explorer"?(T.prototype.am=kh,tt=30):Ks&&Bs&&navigator.appName!=="Netscape"?(T.prototype.am=Ph,tt=26):(T.prototype.am=Rh,tt=28);T.prototype.DB=tt;T.prototype.DM=(1<<tt)-1;T.prototype.DV=1<<tt;const di=52;T.prototype.FV=Math.pow(2,di);T.prototype.F1=di-tt;T.prototype.F2=2*tt-di;const _h="0123456789abcdefghijklmnopqrstuvwxyz",er=[];let kt,Se;kt=48;for(Se=0;Se<=9;++Se)er[kt++]=Se;kt=97;for(Se=10;Se<36;++Se)er[kt++]=Se;kt=65;for(Se=10;Se<36;++Se)er[kt++]=Se;function Hs(t){return _h.charAt(t)}function Oh(t,e){const n=er[t.charCodeAt(e)];return n??-1}function Mh(t){for(let e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function Dh(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function hi(t){const e=ce();return e.fromInt(t),e}function Uh(t,e){let n;if(e===16)n=4;else if(e===8)n=3;else if(e===2)n=1;else if(e===32)n=5;else if(e===4)n=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;let r=t.length,i=!1,s=0;for(;--r>=0;){const o=Oh(t,r);if(o<0){t.charAt(r)==="-"&&(i=!0);continue}i=!1,s===0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB)}this.clamp(),i&&T.ZERO.subTo(this,this)}function Fh(){const t=this.s&this.DM;for(;this.t>0&&this[this.t-1]==t;)--this.t}function $h(t){if(this.s<0)return"-"+this.negate().toString(t);let e;if(t==16)e=4;else if(t===8)e=3;else if(t===2)e=1;else if(t===32)e=5;else if(t===4)e=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");const n=(1<<e)-1;let r,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(r=this[o]>>a)>0&&(i=!0,s=Hs(r));o>=0;)a<e?(r=(this[o]&(1<<a)-1)<<e-a,r|=this[--o]>>(a+=this.DB-e)):(r=this[o]>>(a-=e)&n,a<=0&&(a+=this.DB,--o)),r>0&&(i=!0),i&&(s+=Hs(r));return i?s:"0"}function qh(){const t=ce();return T.ZERO.subTo(this,t),t}function Bh(){return this.s<0?this.negate():this}function Kh(t){let e=this.s-t.s;if(e!=0)return e;let n=this.t;if(e=n-t.t,e!=0)return this.s<0?-e:e;for(;--n>=0;)if((e=this[n]-t[n])!=0)return e;return 0}function fi(t){let e=1,n;return(n=t>>>16)!==0&&(t=n,e+=16),(n=t>>8)!==0&&(t=n,e+=8),(n=t>>4)!==0&&(t=n,e+=4),(n=t>>2)!==0&&(t=n,e+=2),(n=t>>1)!==0&&(t=n,e+=1),e}function Hh(){return this.t<=0?0:this.DB*(this.t-1)+fi(this[this.t-1]^this.s&this.DM)}function jh(t,e){let n;for(n=this.t-1;n>=0;--n)e[n+t]=this[n];for(n=t-1;n>=0;--n)e[n]=0;e.t=this.t+t,e.s=this.s}function Vh(t,e){for(let n=t;n<this.t;++n)e[n-t]=this[n];e.t=Math.max(this.t-t,0),e.s=this.s}function Wh(t,e){const n=t%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(t/this.DB);let o=this.s<<n&this.DM,a;for(a=this.t-1;a>=0;--a)e[a+s+1]=this[a]>>r|o,o=(this[a]&i)<<n;for(a=s-1;a>=0;--a)e[a]=0;e[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function Gh(t,e){e.s=this.s;const n=Math.floor(t/this.DB);if(n>=this.t){e.t=0;return}const r=t%this.DB,i=this.DB-r,s=(1<<r)-1;e[0]=this[n]>>r;for(let o=n+1;o<this.t;++o)e[o-n-1]|=(this[o]&s)<<i,e[o-n]=this[o]>>r;r>0&&(e[this.t-n-1]|=(this.s&s)<<i),e.t=this.t-n,e.clamp()}function zh(t,e){let n=0,r=0;const i=Math.min(t.t,this.t);for(;n<i;)r+=this[n]-t[n],e[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;n<this.t;)r+=this[n],e[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<t.t;)r-=t[n],e[n++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e[n++]=this.DV+r:r>0&&(e[n++]=r),e.t=n,e.clamp()}function Jh(t,e){const n=this.abs(),r=t.abs();let i=n.t;for(e.t=i+r.t;--i>=0;)e[i]=0;for(i=0;i<r.t;++i)e[i+n.t]=n.am(0,r[i],e,i,0,n.t);e.s=0,e.clamp(),this.s!==t.s&&T.ZERO.subTo(e,e)}function Yh(t){const e=this.abs();let n=t.t=2*e.t;for(;--n>=0;)t[n]=0;for(n=0;n<e.t-1;++n){const r=e.am(n,e[n],t,2*n,0,1);(t[n+e.t]+=e.am(n+1,2*e[n],t,2*n+1,r,e.t-n-1))>=e.DV&&(t[n+e.t]-=e.DV,t[n+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(n,e[n],t,2*n,0,1)),t.s=0,t.clamp()}function Qh(t,e,n){const r=t.abs();if(r.t<=0)return;const i=this.abs();if(i.t<r.t){e!=null&&e.fromInt(0),n!=null&&this.copyTo(n);return}n===null&&(n=ce());const s=ce(),o=this.s,a=t.s,c=this.DB-fi(r[r.t-1]);c>0?(r.lShiftTo(c,s),i.lShiftTo(c,n)):(r.copyTo(s),i.copyTo(n));const l=s.t,u=s[l-1];if(u===0)return;const d=u*(1<<this.F1)+(l>1?s[l-2]>>this.F2:0),h=this.FV/d,f=(1<<this.F1)/d,p=1<<this.F2;let g=n.t,m=g-l;const v=e===null?ce():e;for(s.dlShiftTo(m,v),n.compareTo(v)>=0&&(n[n.t++]=1,n.subTo(v,n)),T.ONE.dlShiftTo(l,v),v.subTo(s,s);s.t<l;)s[s.t++]=0;for(;--m>=0;){let E=n[--g]===u?this.DM:Math.floor(n[g]*h+(n[g-1]+p)*f);if((n[g]+=s.am(0,E,n,m,0,l))<E)for(s.dlShiftTo(m,v),n.subTo(v,n);n[g]<--E;)n.subTo(v,n)}e!==null&&(n.drShiftTo(l,e),o!==a&&T.ZERO.subTo(e,e)),n.t=l,n.clamp(),c>0&&n.rShiftTo(c,n),o<0&&T.ZERO.subTo(n,n)}function Xh(t){const e=ce();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(T.ZERO)>0&&t.subTo(e,e),e}function Zh(){if(this.t<1)return 0;const t=this[0];if((t&1)===0)return 0;let e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function ef(t){return this.compareTo(t)===0}function tf(t,e){let n=0,r=0;const i=Math.min(t.t,this.t);for(;n<i;)r+=this[n]+t[n],e[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;n<this.t;)r+=this[n],e[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<t.t;)r+=t[n],e[n++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e[n++]=r:r<-1&&(e[n++]=this.DV+r),e.t=n,e.clamp()}function nf(t){const e=ce();return this.addTo(t,e),e}function rf(t){const e=ce();return this.subTo(t,e),e}function sf(t){const e=ce();return this.multiplyTo(t,e),e}function of(t){const e=ce();return this.divRemTo(t,e,null),e}function Rt(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function af(t){const e=ce();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(T.ZERO)>0&&this.m.subTo(e,e),e}function cf(t){const e=ce();return t.copyTo(e),this.reduce(e),e}function lf(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(let e=0;e<this.m.t;++e){let n=t[e]&32767;const r=n*this.mpl+((n*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(n=e+this.m.t,t[n]+=this.m.am(0,r,t,e,0,this.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function uf(t,e){t.squareTo(e),this.reduce(e)}function df(t,e,n){t.multiplyTo(e,n),this.reduce(n)}Rt.prototype.convert=af;Rt.prototype.revert=cf;Rt.prototype.reduce=lf;Rt.prototype.mulTo=df;Rt.prototype.sqrTo=uf;function hf(t,e,n){let r=t.bitLength(),i,s=hi(1);const o=new Rt(e);if(r<=0)return s;r<18?i=1:r<48?i=3:r<144?i=4:r<768?i=5:i=6;const a=[];let c=3;const l=i-1,u=(1<<i)-1;if(a[1]=o.convert(this),i>1){const v=ce();for(o.sqrTo(a[1],v);c<=u;)a[c]=ce(),o.mulTo(v,a[c-2],a[c]),c+=2}let d=t.t-1,h,f=!0,p=ce(),g;for(r=fi(t[d])-1;d>=0;){for(r>=l?h=t[d]>>r-l&u:(h=(t[d]&(1<<r+1)-1)<<l-r,d>0&&(h|=t[d-1]>>this.DB+r-l)),c=i;(h&1)===0;)h>>=1,--c;if((r-=c)<0&&(r+=this.DB,--d),f)a[h].copyTo(s),f=!1;else{for(;c>1;)o.sqrTo(s,p),o.sqrTo(p,s),c-=2;c>0?o.sqrTo(s,p):(g=s,s=p,p=g),o.mulTo(p,a[h],s)}for(;d>=0&&(t[d]&1<<r)===0;)o.sqrTo(s,p),g=s,s=p,p=g,--r<0&&(r=this.DB-1,--d)}const m=o.revert(s);return n(null,m),m}T.prototype.copyTo=Mh;T.prototype.fromInt=Dh;T.prototype.fromString=Uh;T.prototype.clamp=Fh;T.prototype.dlShiftTo=jh;T.prototype.drShiftTo=Vh;T.prototype.lShiftTo=Wh;T.prototype.rShiftTo=Gh;T.prototype.subTo=zh;T.prototype.multiplyTo=Jh;T.prototype.squareTo=Yh;T.prototype.divRemTo=Qh;T.prototype.invDigit=Zh;T.prototype.addTo=tf;T.prototype.toString=$h;T.prototype.negate=qh;T.prototype.abs=Bh;T.prototype.compareTo=Kh;T.prototype.bitLength=Hh;T.prototype.mod=Xh;T.prototype.equals=ef;T.prototype.add=nf;T.prototype.subtract=rf;T.prototype.multiply=sf;T.prototype.divide=of;T.prototype.modPow=hf;T.ZERO=hi(0);T.ONE=hi(1);const ff=async({a:t,g:e,k:n,x:r,B:i,N:s,U:o})=>new Promise((a,c)=>{e.modPow(r,s,(l,u)=>{if(l){c(l);return}i.subtract(n.multiply(u)).modPow(t.add(o.multiply(r)),s,(d,h)=>{if(d){c(d);return}a(h.mod(s))})})}),pf="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",Na={},Rr={};for(let t=0;t<256;t++){let e=t.toString(16).toLowerCase();e.length===1&&(e=`0${e}`),Na[t]=e,Rr[e]=t}const At=t=>{if(t.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const e=new Uint8Array(t.length/2);for(let n=0;n<t.length;n+=2){const r=t.slice(n,n+2).toLowerCase();if(r in Rr)e[n/2]=Rr[r];else throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`)}return e},pi=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=Na[t[n]];return e},_r=t=>{const e=new bt;e.update(t);const n=e.digestSync(),r=pi(n);return new Array(64-r.length).join("0")+r},Tn=t=>_r(At(t)),gf=/^[89a-f]/i,$e=t=>{if(!(t instanceof T))throw new Error("Not a BigInteger");const e=t.compareTo(T.ZERO)<0;let n=t.abs().toString(16);if(n=n.length%2!==0?`0${n}`:n,n=gf.test(n)?`00${n}`:n,e){const r=n.split("").map(s=>{const o=~parseInt(s,16)&15;return"0123456789ABCDEF".charAt(o)}).join("");n=new T(r,16).add(T.ONE).toString(16),n.toUpperCase().startsWith("FF8")&&(n=n.substring(2))}return n},mf=({A:t,B:e})=>{const n=new T(Tn($e(t)+$e(e)),16);if(n.equals(T.ZERO))throw new Error("U cannot be zero.");return n},yf=(t,e,n)=>{const r=new bt(e);r.update(t);const i=r.digestSync(),s=new bt(i);return s.update(n),s.digestSync().slice(0,16)},gi=t=>{const e=new ai().random(t).toString();return At(e)},vf=()=>lt.convert(gi(40));class Ef{constructor({userPoolName:e,a:n,g:r,A:i,N:s}){this.encoder=An,this.userPoolName=e,this.a=n,this.g=r,this.A=i,this.N=s,this.k=new T(Tn(`${$e(s)}${$e(r)}`),16)}getRandomPassword(){if(!this.randomPassword)throw new N({name:"EmptyBigIntegerRandomPassword",message:"random password is empty"});return this.randomPassword}getSaltToHashDevices(){if(!this.saltToHashDevices)throw new N({name:"EmptyBigIntegersaltToHashDevices",message:"saltToHashDevices is empty"});return this.saltToHashDevices}getVerifierDevices(){if(!this.verifierDevices)throw new N({name:"EmptyBigIntegerVerifierDevices",message:"verifyDevices is empty"});return this.verifierDevices}async generateHashDevice(e,n){this.randomPassword=vf();const r=`${e}${n}:${this.randomPassword}`,i=_r(r),s=pi(gi(16));return this.saltToHashDevices=$e(new T(s,16)),new Promise((o,a)=>{this.g.modPow(new T(Tn(this.saltToHashDevices+i),16),this.N,(c,l)=>{if(c){a(c);return}this.verifierDevices=$e(l),o()})})}async getPasswordAuthenticationKey({username:e,password:n,serverBValue:r,salt:i}){if(r.mod(this.N).equals(T.ZERO))throw new Error("B cannot be zero.");const s=mf({A:this.A,B:r}),o=`${this.userPoolName}${e}:${n}`,a=_r(o),c=new T(Tn($e(i)+a),16),l=await ff({a:this.a,g:this.g,k:this.k,x:c,B:r,N:this.N,U:s}),u=this.encoder.convert("Caldera Derived Key"),d=this.encoder.convert(""),h=new Uint8Array(u.byteLength+d.byteLength);return h.set(u,0),h.set(d,u.byteLength),yf(At($e(l)),At($e(s)),h)}}const wf=async({a:t,g:e,N:n})=>new Promise((r,i)=>{e.modPow(t,n,(s,o)=>{if(s){i(s);return}if(o.mod(n).equals(T.ZERO)){i(new Error("Illegal parameter. A mod N cannot be 0."));return}r(o)})}),tr=async t=>{const e=new T(pf,16),n=new T("2",16),r=Sf(),i=await wf({a:r,g:n,N:e});return new Ef({userPoolName:t,a:r,g:n,A:i,N:e})},Sf=()=>{const t=pi(gi(128));return new T(t,16)};async function _t({userPoolId:t,userPoolEndpoint:e,newDeviceMetadata:n,accessToken:r}){if(!n)return;const i=t.split("_")[1]||"",s=await tr(i),o=n==null?void 0:n.DeviceKey,a=n==null?void 0:n.DeviceGroupKey;try{await s.generateHashDevice(a??"",o??"")}catch{return}const c={Salt:lt.convert(At(s.getSaltToHashDevices())),PasswordVerifier:lt.convert(At(s.getVerifierDevices()))},l=s.getRandomPassword();try{return await xh({endpointResolver:ne({endpointOverride:e})})({region:te(t)},{AccessToken:r,DeviceName:await Ld(),DeviceKey:n==null?void 0:n.DeviceKey,DeviceSecretVerifierConfig:c}),{deviceKey:o,deviceGroupKey:a,randomPassword:l}}catch{return}}async function If(t){var f;const e=(f=B.getConfig().Auth)==null?void 0:f.Cognito;U(e);const{username:n,signInSession:r,signInDetails:i,challengeName:s}=rt.getState();if(s!=="WEB_AUTHN"||!n)throw new N({name:ut.SignInException,message:"Unable to proceed due to invalid sign in state."});const{CREDENTIAL_REQUEST_OPTIONS:o}=t;ui(!!o,z.InvalidPasskeyAuthenticationOptions);const a=await Lh(JSON.parse(o)),c=Zn({endpointResolver:ne({endpointOverride:e.userPoolEndpoint})}),{ChallengeName:l,ChallengeParameters:u,AuthenticationResult:d,Session:h}=await c({region:te(e.userPoolId),userAgentValue:de(oe.ConfirmSignIn)},{ChallengeName:"WEB_AUTHN",ChallengeResponses:{USERNAME:n,CREDENTIAL:JSON.stringify(a)},ClientId:e.userPoolClientId,Session:r});if(Pt({signInSession:h,username:n,challengeName:l,signInDetails:i}),d)return await st({...d,username:n,NewDeviceMetadata:await _t({userPoolId:e.userPoolId,userPoolEndpoint:e.userPoolEndpoint,newDeviceMetadata:d.NewDeviceMetadata,accessToken:d.AccessToken}),signInDetails:i}),rt.dispatch({type:"RESET_STATE"}),await gt(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}};if(l==="WEB_AUTHN")throw new N({name:ut.SignInException,message:"Sequential WEB_AUTHN challenges returned from underlying service cannot be handled."});return{challengeName:l,challengeParameters:u}}const bf=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Af=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Pa=()=>{const t=new Date,e=Af[t.getUTCDay()],n=bf[t.getUTCMonth()],r=t.getUTCDate();let i=t.getUTCHours();i<10&&(i=`0${i}`);let s=t.getUTCMinutes();s<10&&(s=`0${s}`);let o=t.getUTCSeconds();o<10&&(o=`0${o}`);const a=t.getUTCFullYear();return`${e} ${n} ${r} ${i}:${s}:${o} UTC ${a}`},ka=({userPoolName:t,username:e,challengeParameters:n,dateNow:r,hkdf:i})=>{const s=An.convert(t),o=An.convert(e),a=Tf(n.SECRET_BLOCK),c=An.convert(r),l=new Uint8Array(s.byteLength+o.byteLength+a.byteLength+c.byteLength);l.set(s,0),l.set(o,s.byteLength),l.set(a,s.byteLength+o.byteLength),l.set(c,s.byteLength+o.byteLength+a.byteLength);const u=new bt(i);u.update(l);const d=u.digestSync();return lt.convert(d)},Tf=t=>{const e="=".repeat((4-t.length%4)%4),n=(t+e).replace(/-/g,"+").replace(/_/g,"/"),r=Gr.convert(n),i=new Uint8Array(r.length);for(let s=0;s<r.length;++s)i[s]=r.charCodeAt(s);return i};async function mi({username:t,config:e,clientMetadata:n,session:r,tokenOrchestrator:i}){const{userPoolId:s,userPoolEndpoint:o}=e,a=e.userPoolClientId,c=await(i==null?void 0:i.getDeviceMetadata(t));Ia(c);const l=await tr(c.deviceGroupKey),u={USERNAME:t,SRP_A:l.A.toString(16),DEVICE_KEY:c.deviceKey},d={ChallengeName:"DEVICE_SRP_AUTH",ClientId:a,ChallengeResponses:u,ClientMetadata:n,Session:r},h=Zn({endpointResolver:ne({endpointOverride:o})}),{ChallengeParameters:f,Session:p}=await h({region:te(s)},d);return Cf(t,f,n,p,l,e,i)}async function Cf(t,e,n,r,i,{userPoolId:s,userPoolClientId:o,userPoolEndpoint:a},c){const l=await(c==null?void 0:c.getDeviceMetadata(t));Ia(l);const u=new T(e==null?void 0:e.SRP_B,16),d=new T(e==null?void 0:e.SALT,16),{deviceKey:h}=l,{deviceGroupKey:f}=l,p=await i.getPasswordAuthenticationKey({username:l.deviceKey,password:l.randomPassword,serverBValue:u,salt:d}),g=Pa(),m={USERNAME:(e==null?void 0:e.USERNAME)??t,PASSWORD_CLAIM_SECRET_BLOCK:e==null?void 0:e.SECRET_BLOCK,TIMESTAMP:g,PASSWORD_CLAIM_SIGNATURE:ka({username:h,userPoolName:f,challengeParameters:e,dateNow:g,hkdf:p}),DEVICE_KEY:h},v=me({username:t,userPoolId:s,userPoolClientId:o}),E={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:o,ChallengeResponses:m,Session:r,ClientMetadata:n,UserContextData:v};return Zn({endpointResolver:ne({endpointOverride:a})})({region:te(s)},E)}async function Ra(t,e,n,r,i,s,o){const{userPoolId:a,userPoolClientId:c,userPoolEndpoint:l}=s,u=(a==null?void 0:a.split("_")[1])||"",d=new T(e==null?void 0:e.SRP_B,16),h=new T(e==null?void 0:e.SALT,16),f=e==null?void 0:e.USER_ID_FOR_SRP;if(!f)throw new N({name:"EmptyUserIdForSRPException",message:"USER_ID_FOR_SRP was not found in challengeParameters"});const p=await i.getPasswordAuthenticationKey({username:f,password:t,serverBValue:d,salt:h}),g=Pa(),m={USERNAME:f,PASSWORD_CLAIM_SECRET_BLOCK:e==null?void 0:e.SECRET_BLOCK,TIMESTAMP:g,PASSWORD_CLAIM_SIGNATURE:ka({username:f,userPoolName:u,challengeParameters:e,dateNow:g,hkdf:p})},v=await o.getDeviceMetadata(f);v&&v.deviceKey&&(m.DEVICE_KEY=v.deviceKey);const E=me({username:f,userPoolId:a,userPoolClientId:c}),I={ChallengeName:"PASSWORD_VERIFIER",ChallengeResponses:m,ClientMetadata:n,Session:r,ClientId:c,UserContextData:E},w=await Zn({endpointResolver:ne({endpointOverride:l})})({region:te(a)},I);return w.ChallengeName==="DEVICE_SRP_AUTH"?mi({username:f,config:s,clientMetadata:n,session:w.Session,tokenOrchestrator:o}):w}async function nr(t,e,n,r){try{return await t(...e)}catch(i){if(i instanceof N&&i.name==="ResourceNotFoundException"&&i.message.includes("Device does not exist."))return await r.clearDeviceMetadata(n),t(...e);throw i}}function cn(t){const{dispatch:e}=rt;e({type:"SET_USERNAME",value:t})}async function _a({username:t,password:e,clientMetadata:n,config:r,tokenOrchestrator:i,authFlow:s,preferredChallenge:o}){const{userPoolId:a,userPoolClientId:c,userPoolEndpoint:l}=r,u=(a==null?void 0:a.split("_")[1])||"",d=await tr(u),h={USERNAME:t,SRP_A:d.A.toString(16)};s==="USER_AUTH"&&o&&(h.PREFERRED_CHALLENGE=o);const f=me({username:t,userPoolId:a,userPoolClientId:c}),p={AuthFlow:s,AuthParameters:h,ClientMetadata:n,ClientId:c,UserContextData:f},m=await Nt({endpointResolver:ne({endpointOverride:l})})({region:te(a),userAgentValue:de(oe.SignIn)},p),{ChallengeParameters:v,Session:E}=m,I=(v==null?void 0:v.USERNAME)??t;return cn(I),m.ChallengeName==="PASSWORD_VERIFIER"?nr(Ra,[e,v,n,E,d,r,i],I,i):m}const js="userAttributes.";function Lf(t){return"isSignedIn"in t&&"nextStep"in t}async function xf(t,e,n,r,i){var g,m;const{userPoolClientId:s,userPoolId:o,userPoolEndpoint:a}=r,c={USERNAME:t,PASSWORD:e},l=await i.getDeviceMetadata(t);l&&l.deviceKey&&(c.DEVICE_KEY=l.deviceKey);const u=me({username:t,userPoolId:o,userPoolClientId:s}),d={AuthFlow:"USER_PASSWORD_AUTH",AuthParameters:c,ClientMetadata:n,ClientId:s,UserContextData:u},f=await Nt({endpointResolver:ne({endpointOverride:a})})({region:te(o),userAgentValue:de(oe.SignIn)},d),p=((g=f.ChallengeParameters)==null?void 0:g.USERNAME)??((m=f.ChallengeParameters)==null?void 0:m.USER_ID_FOR_SRP)??t;return cn(p),f.ChallengeName==="DEVICE_SRP_AUTH"?mi({username:p,config:r,clientMetadata:n,session:f.Session,tokenOrchestrator:i}):f}async function Nf(t,e,n,r,i){return _a({username:t,password:e,clientMetadata:n,config:r,tokenOrchestrator:i,authFlow:"USER_SRP_AUTH"})}async function Pf(t,e,n,r){var p;const{userPoolClientId:i,userPoolId:s,userPoolEndpoint:o}=n,a={USERNAME:t},c=await r.getDeviceMetadata(t);c&&c.deviceKey&&(a.DEVICE_KEY=c.deviceKey);const l=me({username:t,userPoolId:s,userPoolClientId:i}),u={AuthFlow:"CUSTOM_AUTH",AuthParameters:a,ClientMetadata:e,ClientId:i,UserContextData:l},h=await Nt({endpointResolver:ne({endpointOverride:o})})({region:te(s),userAgentValue:de(oe.SignIn)},u),f=((p=h.ChallengeParameters)==null?void 0:p.USERNAME)??t;return cn(f),h.ChallengeName==="DEVICE_SRP_AUTH"?mi({username:f,config:n,clientMetadata:e,session:h.Session,tokenOrchestrator:r}):h}async function kf(t,e,n,r,i){U(r);const{userPoolId:s,userPoolClientId:o,userPoolEndpoint:a}=r,c=(s==null?void 0:s.split("_")[1])||"",l=await tr(c),u={USERNAME:t,SRP_A:l.A.toString(16),CHALLENGE_NAME:"SRP_A"},d=me({username:t,userPoolId:s,userPoolClientId:o}),h={AuthFlow:"CUSTOM_AUTH",AuthParameters:u,ClientMetadata:n,ClientId:o,UserContextData:d},f=Nt({endpointResolver:ne({endpointOverride:a})}),{ChallengeParameters:p,Session:g}=await f({region:te(s),userAgentValue:de(oe.SignIn)},h),m=(p==null?void 0:p.USERNAME)??t;return cn(m),nr(Ra,[e,p,n,g,l,r,i],m,i)}async function Ot(t){var s;const{challengeName:e,challengeParameters:n,availableChallenges:r}=t,i=(s=B.getConfig().Auth)==null?void 0:s.Cognito;switch(U(i),e){case"CUSTOM_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_CUSTOM_CHALLENGE",additionalInfo:n}};case"MFA_SETUP":{const{signInSession:o,username:a}=rt.getState(),c=Vs(Ws(n.MFAS_CAN_SETUP))||[],l=Mf(c),u=l.includes("TOTP"),d=l.includes("EMAIL");if(u&&d)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SETUP_SELECTION",allowedMFATypes:l}};if(d)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_EMAIL_SETUP"}};if(u){const h=th({endpointResolver:ne({endpointOverride:i.userPoolEndpoint})}),{Session:f,SecretCode:p}=await h({region:te(i.userPoolId)},{Session:o});return rt.dispatch({type:"SET_SIGN_IN_SESSION",value:f}),{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_TOTP_SETUP",totpSetupDetails:Rf(p,a)}}}throw new N({name:ut.SignInException,message:`Cannot initiate MFA setup from available types: ${c}`})}case"NEW_PASSWORD_REQUIRED":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED",missingAttributes:_f(n.requiredAttributes)}};case"SELECT_MFA_TYPE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SELECTION",allowedMFATypes:Vs(Ws(n.MFAS_CAN_CHOOSE))}};case"SMS_OTP":case"SMS_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_SMS_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"SOFTWARE_TOKEN_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_TOTP_CODE"}};case"EMAIL_OTP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_EMAIL_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"WEB_AUTHN":{const o=await If(n);return Lf(o)?o:Ot(o)}case"PASSWORD":case"PASSWORD_SRP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_PASSWORD"}};case"SELECT_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_FIRST_FACTOR_SELECTION",availableChallenges:r}}}throw new N({name:ut.SignInException,message:`An error occurred during the sign in process. ${e} challengeName returned by the underlying service was not addressed.`})}function Rf(t,e){return{sharedSecret:t,getSetupUri:(n,r)=>{const i=`otpauth://totp/${n}:${r??e}?secret=${t}&issuer=${n}`;return new pe(i)}}}function ln(t){if(t===$n.PasswordResetRequiredException)return{isSignedIn:!1,nextStep:{signInStep:"RESET_PASSWORD"}};if(t===$n.UserNotConfirmedException)return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_UP"}}}function _f(t){return t?JSON.parse(t).map(n=>n.includes(js)?n.replace(js,""):n):[]}function Of(t){if(t==="SMS_MFA")return"SMS";if(t==="SOFTWARE_TOKEN_MFA")return"TOTP";if(t==="EMAIL_OTP")return"EMAIL"}function Vs(t){if(t)return t.map(Of).filter(Boolean)}function Ws(t){return t?JSON.parse(t):[]}function Mf(t){return t.filter(e=>e==="EMAIL"||e==="TOTP")}async function Oa(){let t;try{t=await mt()}catch{}if(t&&t.userId&&t.username)throw new N({name:Rd,message:"There is already a signed in user.",recoverySuggestion:"Call signOut before calling signIn again."})}function un(t){return rt.getState().username??t}async function Df(t){var a;const e=(a=B.getConfig().Auth)==null?void 0:a.Cognito;U(e);const{username:n,password:r,options:i}=t,s={loginId:n,authFlowType:"CUSTOM_WITHOUT_SRP"},o=i==null?void 0:i.clientMetadata;Q(!!n,R.EmptySignInUsername),Q(!r,R.CustomAuthSignInPassword);try{const{ChallengeName:c,ChallengeParameters:l,AuthenticationResult:u,Session:d}=await nr(Pf,[n,o,e,ge],n,ge),h=un(n);return Pt({signInSession:d,username:h,challengeName:c,signInDetails:s}),u?(await st({username:h,...u,NewDeviceMetadata:await _t({userPoolId:e.userPoolId,userPoolEndpoint:e.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:s}),Me(),await gt(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Ot({challengeName:c,challengeParameters:l})}catch(c){Me(),Ne(c);const l=ln(c.name);if(l)return l;throw c}}async function Uf(t){var a;const{username:e,password:n,options:r}=t,i={loginId:e,authFlowType:"CUSTOM_WITH_SRP"},s=(a=B.getConfig().Auth)==null?void 0:a.Cognito;U(s);const o=r==null?void 0:r.clientMetadata;Q(!!e,R.EmptySignInUsername),Q(!!n,R.EmptySignInPassword);try{const{ChallengeName:c,ChallengeParameters:l,AuthenticationResult:u,Session:d}=await kf(e,n,o,s,ge),h=un(e);return Pt({signInSession:d,username:h,challengeName:c,signInDetails:i}),u?(await st({username:h,...u,NewDeviceMetadata:await _t({userPoolId:s.userPoolId,userPoolEndpoint:s.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:i}),Me(),await gt(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Ot({challengeName:c,challengeParameters:l})}catch(c){Me(),Ne(c);const l=ln(c.name);if(l)return l;throw c}}function We(t=!0){Xe.dispatch({type:"RESET"})}async function Gs(t){var o,a;const{username:e,password:n}=t,r=(o=B.getConfig().Auth)==null?void 0:o.Cognito,i={loginId:e,authFlowType:"USER_SRP_AUTH"};U(r);const s=(a=t.options)==null?void 0:a.clientMetadata;Q(!!e,R.EmptySignInUsername),Q(!!n,R.EmptySignInPassword);try{const{ChallengeName:c,ChallengeParameters:l,AuthenticationResult:u,Session:d}=await Nf(e,n,s,r,ge),h=un(e);return Pt({signInSession:d,username:h,challengeName:c,signInDetails:i}),u?(await st({username:h,...u,NewDeviceMetadata:await _t({userPoolId:r.userPoolId,userPoolEndpoint:r.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:i}),Me(),await gt(),We(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Ot({challengeName:c,challengeParameters:l})}catch(c){Me(),We(),Ne(c);const l=ln(c.name);if(l)return l;throw c}}async function Ff(t){var a;const{username:e,password:n,options:r}=t,i=(a=B.getConfig().Auth)==null?void 0:a.Cognito,s={loginId:e,authFlowType:"USER_PASSWORD_AUTH"};U(i);const o=r==null?void 0:r.clientMetadata;Q(!!e,R.EmptySignInUsername),Q(!!n,R.EmptySignInPassword);try{const{ChallengeName:c,ChallengeParameters:l,AuthenticationResult:u,Session:d}=await nr(xf,[e,n,o,i,ge],e,ge),h=un(e);return Pt({signInSession:d,username:h,challengeName:c,signInDetails:s}),u?(await st({...u,username:h,NewDeviceMetadata:await _t({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:u.NewDeviceMetadata,accessToken:u.AccessToken}),signInDetails:s}),Me(),await gt(),We(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Ot({challengeName:c,challengeParameters:l})}catch(c){Me(),We(),Ne(c);const l=ln(c.name);if(l)return l;throw c}}async function $f({username:t,clientMetadata:e,config:n,tokenOrchestrator:r,preferredChallenge:i,password:s,session:o}){const{userPoolId:a,userPoolClientId:c,userPoolEndpoint:l}=n,u=me({username:t,userPoolId:a,userPoolClientId:c}),d={USERNAME:t};if(i){if(i==="PASSWORD_SRP")return Q(!!s,R.EmptySignInPassword),_a({username:t,password:s,clientMetadata:e,config:n,tokenOrchestrator:r,authFlow:"USER_AUTH",preferredChallenge:i});i==="PASSWORD"&&(Q(!!s,R.EmptySignInPassword),d.PASSWORD=s),d.PREFERRED_CHALLENGE=i}const h={AuthFlow:"USER_AUTH",AuthParameters:d,ClientMetadata:e,ClientId:c,UserContextData:u};o&&(h.Session=o);const p=await Nt({endpointResolver:ne({endpointOverride:l})})({region:te(a),userAgentValue:de(oe.SignIn)},h);return cn(t),p}async function qf(t){var c;const{username:e,password:n,options:r}=t,i=(c=B.getConfig().Auth)==null?void 0:c.Cognito,s={loginId:e,authFlowType:"USER_AUTH"};U(i);const o=r==null?void 0:r.clientMetadata,a=r==null?void 0:r.preferredChallenge;Q(!!e,R.EmptySignInUsername);try{const l={username:e,config:i,tokenOrchestrator:ge,clientMetadata:o,preferredChallenge:a,password:n},u=Xe.getState();u.active&&u.username===e&&(l.session=u.session);const d=await $f(l),h=un(e);return Pt({signInSession:d.Session,username:h,challengeName:d.ChallengeName,signInDetails:s}),d.AuthenticationResult?(await st({username:h,...d.AuthenticationResult,NewDeviceMetadata:await _t({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:d.AuthenticationResult.NewDeviceMetadata,accessToken:d.AuthenticationResult.AccessToken}),signInDetails:s}),Me(),await gt(),We(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Ot({challengeName:d.ChallengeName,challengeParameters:d.ChallengeParameters,availableChallenges:"AvailableChallenges"in d?d.AvailableChallenges:void 0})}catch(l){Me(),We(),Ne(l);const u=ln(l.name);if(u)return u;throw l}}async function Bf(t){var n;We(!1);const e=(n=t.options)==null?void 0:n.authFlowType;switch(await Oa(),e){case"USER_SRP_AUTH":return Gs(t);case"USER_PASSWORD_AUTH":return Ff(t);case"CUSTOM_WITHOUT_SRP":return Df(t);case"CUSTOM_WITH_SRP":return Uf(t);case"USER_AUTH":return qf(t);default:return Gs(t)}}const Kf=3*60*1e3;function Hf(t){const e=Mn.listen("auth-internal",async({payload:r})=>{switch(r.event){case"confirmSignUp":{const i=r.data;i!=null&&i.isSignUpComplete&&(Mn.dispatch("auth-internal",{event:"autoSignIn"}),e())}}}),n=setTimeout(()=>{e(),clearTimeout(n),We()},Kf)}const jf=()=>async t=>{if(t.statusCode>=300){const e=await pt(t);if(Ne(e),e.name===Pr.InvalidParameterException&&/'password'/.test(e.message)&&/Member must not be null/.test(e.message)){const n=R.EmptySignUpPassword,{message:r,recoverySuggestion:i}=wa[n];throw new N({name:n,message:r,recoverySuggestion:i})}throw new N({name:e.name,message:e.message})}return sn(t)},Vf=t=>Ie(Ue,De("SignUp"),jf(),{...Fe,...t});async function Wf(t){var A;const{username:e,password:n,options:r}=t,i=(A=B.getConfig().Auth)==null?void 0:A.Cognito,s=(i==null?void 0:i.signUpVerificationMethod)??"code",{clientMetadata:o,validationData:a,autoSignIn:c}=t.options??{};U(i),Q(!!e,R.EmptySignUpUsername);const l=typeof c!="boolean"?c:void 0;l==null||l.authFlowType;const{userPoolId:u,userPoolClientId:d,userPoolEndpoint:h}=i,f=Vf({endpointResolver:ne({endpointOverride:h})}),p={Username:e,Password:void 0,UserAttributes:(r==null?void 0:r.userAttributes)&&fs(r==null?void 0:r.userAttributes),ClientMetadata:o,ValidationData:a&&fs(a),ClientId:d,UserContextData:me({username:e,userPoolId:u,userPoolClientId:d})};n&&(p.Password=n);const{UserSub:g,CodeDeliveryDetails:m,UserConfirmed:v,Session:E}=await f({region:te(u),userAgentValue:de(oe.SignUp)},p);(l||c===!0)&&(Xe.dispatch({type:"START"}),Xe.dispatch({type:"SET_USERNAME",value:e}),Xe.dispatch({type:"SET_SESSION",value:E}));const I={destination:m==null?void 0:m.Destination,deliveryMedium:m==null?void 0:m.DeliveryMedium,attributeName:m==null?void 0:m.AttributeName},S=!!v,w=Xe.getState().active;if(S)return w?{isSignUpComplete:!0,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN"},userId:g}:{isSignUpComplete:!0,nextStep:{signUpStep:"DONE"},userId:g};if(w){if(s==="link")return{isSignUpComplete:!1,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN",codeDeliveryDetails:I},userId:g};Hf()}return{isSignUpComplete:!1,nextStep:{signUpStep:"CONFIRM_SIGN_UP",codeDeliveryDetails:I},userId:g}}const Gf=t=>Ie(Ue,De("ForgotPassword"),Je(),{...Fe,...t});async function zf(t){var d,h;const{username:e}=t;Q(!!e,R.EmptyResetPasswordUsername);const n=(d=B.getConfig().Auth)==null?void 0:d.Cognito;U(n);const{userPoolClientId:r,userPoolId:i,userPoolEndpoint:s}=n,o=(h=t.options)==null?void 0:h.clientMetadata,a=me({username:e,userPoolId:i,userPoolClientId:r}),u=(await Gf({endpointResolver:ne({endpointOverride:s})})({region:te(i),userAgentValue:de(oe.ResetPassword)},{Username:e,ClientMetadata:o,ClientId:r,UserContextData:a})).CodeDeliveryDetails;return{isPasswordReset:!1,nextStep:{resetPasswordStep:"CONFIRM_RESET_PASSWORD_WITH_CODE",codeDeliveryDetails:{deliveryMedium:u==null?void 0:u.DeliveryMedium,destination:u==null?void 0:u.Destination,attributeName:u==null?void 0:u.AttributeName}}}}const Jf=t=>Ie(Ue,De("ConfirmForgotPassword"),Je(),{...Fe,...t});async function Yf(t){var d,h;const e=(d=B.getConfig().Auth)==null?void 0:d.Cognito;U(e);const{userPoolClientId:n,userPoolId:r,userPoolEndpoint:i}=e,{username:s,newPassword:o}=t;Q(!!s,R.EmptyConfirmResetPasswordUsername),Q(!!o,R.EmptyConfirmResetPasswordNewPassword);const a=t.confirmationCode;Q(!!a,R.EmptyConfirmResetPasswordConfirmationCode);const c=(h=t.options)==null?void 0:h.clientMetadata,l=me({username:s,userPoolId:r,userPoolClientId:n});await Jf({endpointResolver:ne({endpointOverride:i})})({region:te(e.userPoolId),userAgentValue:de(oe.ConfirmResetPassword)},{Username:s,ConfirmationCode:a,Password:o,ClientMetadata:c,ClientId:e.userPoolClientId,UserContextData:l})}const Qf=t=>Ie(Ue,De("ResendConfirmationCode"),Je(),{...Fe,...t});async function Xf(t){var f,p;const{username:e}=t;Q(!!e,R.EmptySignUpUsername);const n=(f=B.getConfig().Auth)==null?void 0:f.Cognito;U(n);const{userPoolClientId:r,userPoolId:i,userPoolEndpoint:s}=n,o=(p=t.options)==null?void 0:p.clientMetadata,a=me({username:e,userPoolId:i,userPoolClientId:r}),c=Qf({endpointResolver:ne({endpointOverride:s})}),{CodeDeliveryDetails:l}=await c({region:te(n.userPoolId),userAgentValue:de(oe.ResendSignUpCode)},{Username:e,ClientMetadata:o,ClientId:n.userPoolClientId,UserContextData:a}),{DeliveryMedium:u,AttributeName:d,Destination:h}={...l};return{destination:h,deliveryMedium:u,attributeName:d||void 0}}const Zf=t=>Ie(Ue,De("ConfirmSignUp"),Je(),{...Fe,...t});async function ep(t){var h;const{username:e,confirmationCode:n,options:r}=t,i=(h=B.getConfig().Auth)==null?void 0:h.Cognito;U(i);const{userPoolId:s,userPoolClientId:o,userPoolEndpoint:a}=i,c=r==null?void 0:r.clientMetadata;Q(!!e,R.EmptyConfirmSignUpUsername),Q(!!n,R.EmptyConfirmSignUpCode);const l=me({username:e,userPoolId:s,userPoolClientId:o}),u=Zf({endpointResolver:ne({endpointOverride:a})}),{Session:d}=await u({region:te(i.userPoolId),userAgentValue:de(oe.ConfirmSignUp)},{Username:e,ConfirmationCode:n,ClientMetadata:c,ForceAliasCreation:r==null?void 0:r.forceAliasCreation,ClientId:i.userPoolClientId,UserContextData:l});return new Promise((f,p)=>{try{const g={isSignUpComplete:!0,nextStep:{signUpStep:"DONE"}},m=Xe.getState();if(!m.active||m.username!==e){f(g),We();return}Xe.dispatch({type:"SET_SESSION",value:d});const v=Mn.listen("auth-internal",({payload:E})=>{switch(E.event){case"autoSignIn":f({isSignUpComplete:!0,nextStep:{signUpStep:"COMPLETE_AUTO_SIGN_IN"}}),v()}});Mn.dispatch("auth-internal",{event:"confirmSignUp",data:g})}catch(g){p(g)}})}new Y("AuthError");const tp={oauthSignInError:{message:Z.OAUTH_ERROR,log:"Make sure Cognito Hosted UI has been configured correctly"},noConfig:{message:Z.DEFAULT_MSG},missingAuthConfig:{message:Z.DEFAULT_MSG},emptyUsername:{message:Z.EMPTY_USERNAME},invalidUsername:{message:Z.INVALID_USERNAME},emptyPassword:{message:Z.EMPTY_PASSWORD},emptyCode:{message:Z.EMPTY_CODE},signUpError:{message:Z.SIGN_UP_ERROR},noMFA:{message:Z.NO_MFA},invalidMFA:{message:Z.INVALID_MFA},emptyChallengeResponse:{message:Z.EMPTY_CHALLENGE},noUserSession:{message:Z.NO_USER_SESSION},deviceConfig:{message:Z.DEVICE_CONFIG},networkError:{message:Z.NETWORK_ERROR},autoSignInError:{message:Z.AUTOSIGNIN_ERROR},default:{message:Z.DEFAULT_MSG}},dt=(t,e)=>new N({message:t??"An error has occurred during the oauth process.",name:ut.OAuthSignInError,recoverySuggestion:tp.oauthSignInError.log});var Or;(function(t){t.NoConfig="noConfig",t.MissingAuthConfig="missingAuthConfig",t.EmptyUsername="emptyUsername",t.InvalidUsername="invalidUsername",t.EmptyPassword="emptyPassword",t.EmptyCode="emptyCode",t.SignUpError="signUpError",t.NoMFA="noMFA",t.InvalidMFA="invalidMFA",t.EmptyChallengeResponse="emptyChallengeResponse",t.NoUserSession="noUserSession",t.Default="default",t.DeviceConfig="deviceConfig",t.NetworkError="networkError",t.AutoSignInError="autoSignInError",t.OAuthSignInError="oauthSignInError"})(Or||(Or={}));const np="`signInWithRedirect` has been canceled.",rp="An error occurred while validating the state.",ip="Try to initiate an OAuth flow from Amplify",Ma=async t=>{const e=await le.loadOAuthState(),n=t===e?e:void 0;if(!n)throw new N({name:Or.OAuthSignInError,message:t===null?np:rp,recoverySuggestion:t===null?void 0:ip});return n},Da=async({currentUrl:t,userAgentValue:e,clientId:n,redirectUri:r,responseType:i,domain:s,preferPrivateSession:o})=>{const a=new pe(t),c=a.searchParams.get("error"),l=a.searchParams.get("error_description");if(c)throw dt(l??c);return i==="code"?sp({currentUrl:t,userAgentValue:e,clientId:n,redirectUri:r,domain:s,preferPrivateSession:o}):op({currentUrl:t,redirectUri:r,preferPrivateSession:o})},sp=async({currentUrl:t,userAgentValue:e,clientId:n,redirectUri:r,domain:i,preferPrivateSession:s})=>{const o=new pe(t),a=o.searchParams.get("code"),c=o.searchParams.get("state");if(!a||!c)throw dt("User cancelled OAuth flow.");const l=await Ma(c),u="https://"+i+"/oauth2/token",d=await le.loadPKCE(),h={grant_type:"authorization_code",code:a,client_id:n,redirect_uri:r,...d?{code_verifier:d}:{}},f=Object.entries(h).map(([A,P])=>`${encodeURIComponent(A)}=${encodeURIComponent(P)}`).join("&"),{access_token:p,refresh_token:g,id_token:m,error:v,error_message:E,token_type:I,expires_in:S}=await(await fetch(u,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",[To]:e},body:f})).json();if(v)throw dt(E??v);const w=(p&&Ve(p).payload.username)??"username";return await st({username:w,AccessToken:p,IdToken:m,RefreshToken:g}),Ua({redirectUri:r,state:l,preferPrivateSession:s})},op=async({currentUrl:t,redirectUri:e,preferPrivateSession:n})=>{const r=new pe(t),{id_token:i,access_token:s,state:o,token_type:a,expires_in:c,error_description:l,error:u}=(r.hash??"#").substring(1).split("&").map(f=>f.split("=")).reduce((f,[p,g])=>({...f,[p]:g}),{id_token:void 0,access_token:void 0,state:void 0,token_type:void 0,expires_in:void 0,error_description:void 0,error:void 0});if(u)throw dt(l??u);if(!s)throw dt("No access token returned from OAuth flow.");const d=await Ma(o),h=(s&&Ve(s).payload.username)??"username";return await st({username:h,AccessToken:s,IdToken:i}),Ua({redirectUri:e,state:d,preferPrivateSession:n})},Ua=async({redirectUri:t,state:e,preferPrivateSession:n})=>{await ge.setOAuthMetadata({oauthSignIn:!0}),await le.clearOAuthData(),await le.storeOAuthSignIn(!0,n),Ca(),lp(t),ap(e)&&xe.dispatch("auth",{event:"customOAuthState",data:Ad(cp(e))},"Auth",Le),xe.dispatch("auth",{event:"signInWithRedirect"},"Auth",Le),await gt()},ap=t=>/-/.test(t),cp=t=>t.split("-").splice(1).join("-"),lp=t=>{typeof window<"u"&&typeof window.history<"u"&&window.history.replaceState(window.history.state,"",t)};function yi(t,e){{const n=(t==null?void 0:t.find(up))??(t==null?void 0:t.find(dp)),r=(t==null?void 0:t.find(fp))??(t==null?void 0:t.find(hp));if(n)return n;throw r?$d:Ud}}const up=t=>t.startsWith(String(window.location.origin+(window.location.pathname||"/"))),dp=t=>t.includes(String(window.location.hostname)),hp=t=>t.startsWith("http://"),fp=t=>t.startsWith("https://"),vi=async t=>{Ca(),await le.clearOAuthInflightData(),xe.dispatch("auth",{event:"signInWithRedirect_failure",data:{error:t}},"Auth",Le)},pp=async t=>{try{U(t),Wn(t),le.setAuthConfig(t)}catch{return}if(await le.loadOAuthInFlight())try{const e=window.location.href,{loginWith:n,userPoolClientId:r}=t,{domain:i,redirectSignIn:s,responseType:o}=n.oauth,a=yi(s);await Da({currentUrl:e,clientId:r,domain:i,redirectUri:a,responseType:o,userAgentValue:de(oe.SignInWithRedirect)})}catch(e){await vi(e)}};Yn()&&B[No](pp);const gp={Google:"Google",Facebook:"Facebook",Amazon:"LoginWithAmazon",Apple:"SignInWithApple"},Fa=async t=>{window!=null&&window.location&&(window.location.href=t.replace("http://","https://"))},zs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",mp=t=>{const e=new Uint8Array(t);Wr().getRandomValues(e);let n="",r;for(const i of e)n+=zs.charAt(i%zs.length);return{value:n,method:"S256",toCodeChallenge(){return r||(r=yp(n),r)}}};function yp(t){const e=new bt;return e.update(t),vp(lt.convert(e.digestSync(),{urlSafe:!0}))}function vp(t){return t.replace(/=/g,"")}const Ep=()=>Sd(32),wp=t=>{async function e(n){if(n.persisted&&await t.loadOAuthInFlight()){const i=dt("User cancelled OAuth flow.");await vi(i)}window.removeEventListener("pageshow",e)}window.addEventListener("pageshow",e)};async function Sp(t){var r,i,s,o,a;const e=(r=B.getConfig().Auth)==null?void 0:r.Cognito;U(e),Wn(e),le.setAuthConfig(e),await Oa();let n="COGNITO";return n=gp[t.provider],Ip({oauthConfig:e.loginWith.oauth,clientId:e.userPoolClientId,provider:n,customState:t==null?void 0:t.customState,preferPrivateSession:(i=t==null?void 0:t.options)==null?void 0:i.preferPrivateSession,options:{loginHint:(s=t==null?void 0:t.options)==null?void 0:s.loginHint,lang:(o=t==null?void 0:t.options)==null?void 0:o.lang,nonce:(a=t==null?void 0:t.options)==null?void 0:a.nonce}})}const Ip=async({oauthConfig:t,provider:e,clientId:n,customState:r,preferPrivateSession:i,options:s})=>{const{domain:o,redirectSignIn:a,responseType:c,scopes:l}=t,{loginHint:u,lang:d,nonce:h}=s??{},p=`${Ep()}-${Td(r)}`,{value:g,method:m,toCodeChallenge:v}=mp(128),E=yi(t.redirectSignIn);Yn()&&le.storeOAuthInFlight(!0),le.storeOAuthState(p),le.storePKCE(g);const I=Object.entries({redirect_uri:E,response_type:c,client_id:n,identity_provider:e,scope:l.join(" "),...u&&{login_hint:u},...d&&{lang:d},...h&&{nonce:h},state:p,...c==="code"&&{code_challenge:v(),code_challenge_method:m}}).map(([_,M])=>`${encodeURIComponent(_)}=${encodeURIComponent(M)}`).join("&"),S=`https://${o}/oauth2/authorize?${I}`;wp(le);const{type:w,error:A,url:P}=await Fa(S)??{};try{if(w==="error")throw dt(String(A));w==="success"&&P&&await Da({currentUrl:P,clientId:n,domain:o,redirectUri:E,responseType:c,userAgentValue:de(oe.SignInWithRedirect),preferPrivateSession:i})}catch(_){throw await vi(_),_}},bp=async t=>{await t.clearOAuthData(),ge.clearTokens(),await Zo(),xe.dispatch("auth",{event:"signedOut"},"Auth",Le)},Ap=async(t,e=!1,n)=>{Wn(t);const{loginWith:r,userPoolClientId:i}=t,{domain:s,redirectSignOut:o}=r.oauth,a=yi(o),c=`https://${s}/logout?${Object.entries({client_id:i,logout_uri:encodeURIComponent(a)}).map(([l,u])=>`${l}=${u}`).join("&")}`;return Fa(c)},Tp=async(t,e,n,r)=>{const{isOAuthSignIn:i}=await e.loadOAuthSignIn(),s=await n.getOAuthMetadata();if(await bp(e),i||s!=null&&s.oauthSignIn)return Ap(t,!1)},Cp=t=>Ie(Ue,De("RevokeToken"),Je(),{...Fe,...t}),Lp=new Y("Auth");async function xp(t){var r;const e=(r=B.getConfig().Auth)==null?void 0:r.Cognito;U(e),await Np(e);let n;try{Wn(e),n=!0}catch{n=!1}if(n){const i=new Ta(an);i.setAuthConfig(e);const{type:s}=await Tp(e,i,ge)??{};if(s==="error")throw new N({name:qd,message:"An error occurred when attempting to log out from OAuth provider."})}else ge.clearTokens(),await Zo(),xe.dispatch("auth",{event:"signedOut"},"Auth",Le)}async function Np(t){try{const{userPoolEndpoint:e,userPoolId:n,userPoolClientId:r}=t,i=await ge.getTokenStore().loadTokens();Sa(i),Pp(i.accessToken)&&await Cp({endpointResolver:ne({endpointOverride:e})})({region:te(n),userAgentValue:de(oe.SignOut)},{ClientId:r,Token:i.refreshToken})}catch{Lp.debug("Client signOut error caught but will proceed with token removal")}}const Pp=t=>{var e;return!!((e=t==null?void 0:t.payload)!=null&&e.origin_jti)},kp={identityId:"identityId"},Rp=new Y("DefaultIdentityIdStore");class $a{setAuthConfig(e){In(e.Cognito),this.authConfig=e,this._authKeys=_p("Cognito",e.Cognito.identityPoolId)}constructor(e){this._authKeys={},this._hasGuestIdentityId=!1,this.keyValueStorage=e}async loadIdentityId(){var e;In((e=this.authConfig)==null?void 0:e.Cognito);try{if(this._primaryIdentityId)return{id:this._primaryIdentityId,type:"primary"};{const n=await this.keyValueStorage.getItem(this._authKeys.identityId);return n?(this._hasGuestIdentityId=!0,{id:n,type:"guest"}):null}}catch(n){return Rp.log("Error getting stored IdentityId.",n),null}}async storeIdentityId(e){var n;In((n=this.authConfig)==null?void 0:n.Cognito),e.type==="guest"?(this.keyValueStorage.setItem(this._authKeys.identityId,e.id),this._primaryIdentityId=void 0,this._hasGuestIdentityId=!0):(this._primaryIdentityId=e.id,this._hasGuestIdentityId&&(this.keyValueStorage.removeItem(this._authKeys.identityId),this._hasGuestIdentityId=!1))}async clearIdentityId(){this._primaryIdentityId=void 0,await this.keyValueStorage.removeItem(this._authKeys.identityId)}}const _p=(t,e)=>ci(kp)(`com.amplify.${t}`,e),Mr=({endpointOverride:t})=>e=>t?{url:new pe(t)}:$u(e);function qa(t){const e=Ve(t).payload.iss,n={};if(!e)throw new N({name:"InvalidIdTokenException",message:"Invalid Idtoken."});const r=e.replace(/(^\w+:|^)\/\//,"");return n[r]=t,n}async function Op({tokens:t,authConfig:e,identityIdStore:n}){n.setAuthConfig({Cognito:e});const r=await n.loadIdentityId();if(r)return r.id;const i=t!=null&&t.idToken?qa(t.idToken.toString()):{},s=await Mp(i,e);return n.storeIdentityId({id:s,type:t?"primary":"guest"}),s}async function Mp(t,e){const n=e==null?void 0:e.identityPoolId,r=Nr(n),i=Du({endpointResolver:Mr({endpointOverride:e.identityPoolEndpoint})});let s;try{s=(await i({region:r},{IdentityPoolId:n,Logins:t})).IdentityId}catch(o){throw Ne(o),new N(o)}if(!s)throw new N({name:"GetIdResponseException",message:"Received undefined response from getId operation",recoverySuggestion:"Make sure to pass a valid identityPoolId in the configuration."});return s}const wn=new Y("CognitoCredentialsProvider"),Js=50*60*1e3;class Ba{constructor(e){this._nextCredentialsRefresh=0,this._identityIdStore=e}async clearCredentialsAndIdentityId(){wn.debug("Clearing out credentials and identityId"),this._credentialsAndIdentityId=void 0,await this._identityIdStore.clearIdentityId()}async clearCredentials(){wn.debug("Clearing out in-memory credentials"),this._credentialsAndIdentityId=void 0}async getCredentialsAndIdentityId(e){const n=e.authenticated,{tokens:r}=e,{authConfig:i}=e;try{In(i==null?void 0:i.Cognito)}catch{return}if(!n&&!i.Cognito.allowGuestAccess)return;const{forceRefresh:s}=e,o=this.hasTokenChanged(r),a=await Op({tokens:r,authConfig:i.Cognito,identityIdStore:this._identityIdStore});return(s||o)&&this.clearCredentials(),n?(jd(r),this.credsForOIDCTokens(i.Cognito,r,a)):this.getGuestCredentials(a,i.Cognito)}async getGuestCredentials(e,n){var o,a;if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!1)return wn.info("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const r=Nr(n.identityPoolId),i=us({endpointResolver:Mr({endpointOverride:n.identityPoolEndpoint})});let s;try{s=await i({region:r},{IdentityId:e})}catch(c){throw Ne(c),new N(c)}if((o=s==null?void 0:s.Credentials)!=null&&o.AccessKeyId&&((a=s==null?void 0:s.Credentials)!=null&&a.SecretKey)){this._nextCredentialsRefresh=new Date().getTime()+Js;const c={credentials:{accessKeyId:s.Credentials.AccessKeyId,secretAccessKey:s.Credentials.SecretKey,sessionToken:s.Credentials.SessionToken,expiration:s.Credentials.Expiration},identityId:e};return s.IdentityId&&(c.identityId=s.IdentityId,this._identityIdStore.storeIdentityId({id:s.IdentityId,type:"guest"})),this._credentialsAndIdentityId={...c,isAuthenticatedCreds:!1},c}else throw new N({name:"CredentialsNotFoundException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}async credsForOIDCTokens(e,n,r){var c,l,u;if(this._credentialsAndIdentityId&&!this.isPastTTL()&&this._credentialsAndIdentityId.isAuthenticatedCreds===!0)return wn.debug("returning stored credentials as they neither past TTL nor expired."),this._credentialsAndIdentityId;this.clearCredentials();const i=n.idToken?qa(n.idToken.toString()):{},s=Nr(e.identityPoolId),o=us({endpointResolver:Mr({endpointOverride:e.identityPoolEndpoint})});let a;try{a=await o({region:s},{IdentityId:r,Logins:i})}catch(d){throw Ne(d),new N(d)}if((c=a==null?void 0:a.Credentials)!=null&&c.AccessKeyId&&((l=a==null?void 0:a.Credentials)!=null&&l.SecretKey)){this._nextCredentialsRefresh=new Date().getTime()+Js;const d={credentials:{accessKeyId:a.Credentials.AccessKeyId,secretAccessKey:a.Credentials.SecretKey,sessionToken:a.Credentials.SessionToken,expiration:a.Credentials.Expiration},identityId:r};return a.IdentityId&&(d.identityId=a.IdentityId,this._identityIdStore.storeIdentityId({id:a.IdentityId,type:"primary"})),this._credentialsAndIdentityId={...d,isAuthenticatedCreds:!0,associatedIdToken:(u=n.idToken)==null?void 0:u.toString()},d}else throw new N({name:"CredentialsException",message:"Cognito did not respond with either Credentials, AccessKeyId or SecretKey."})}isPastTTL(){return this._nextCredentialsRefresh===void 0?!0:this._nextCredentialsRefresh<=Date.now()}hasTokenChanged(e){var n,r;return!!e&&!!((n=this._credentialsAndIdentityId)!=null&&n.associatedIdToken)&&((r=e.idToken)==null?void 0:r.toString())!==this._credentialsAndIdentityId.associatedIdToken}}const Dp=new Ba(new $a(an)),Up={configure(t,e){const n=ko(t),r=new Wu({sameSite:"lax"}),i=e!=null&&e.ssr?r:an,s=e!=null&&e.ssr?new Ba(new $a(r)):Dp;if(!n.Auth){B.configure(n,e);return}if(e!=null&&e.Auth){B.configure(n,e);return}if(!B.libraryOptions.Auth){Wt.setAuthConfig(n.Auth),Wt.setKeyValueStorage(i),B.configure(n,{...e,Auth:{tokenProvider:Wt,credentialsProvider:s}});return}if(e){const o=B.libraryOptions.Auth;e.ssr!==void 0&&(Wt.setKeyValueStorage(i),o.credentialsProvider=s),B.configure(n,{Auth:o,...e});return}B.configure(n)},getConfig(){return B.getConfig()}};function Cn(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cn=function(n){return typeof n}:Cn=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cn(t)}function Fp(t){return Cn(t)=="object"&&t!==null}var Ka=typeof Symbol=="function"&&Symbol.toStringTag!=null?Symbol.toStringTag:"@@toStringTag";function Dr(t,e){for(var n=/\r\n|[\n\r]/g,r=1,i=e+1,s;(s=n.exec(t.body))&&s.index<e;)r+=1,i=e+1-(s.index+s[0].length);return{line:r,column:i}}function $p(t){return Ha(t.source,Dr(t.source,t.start))}function Ha(t,e){var n=t.locationOffset.column-1,r=Ln(n)+t.body,i=e.line-1,s=t.locationOffset.line-1,o=e.line+s,a=e.line===1?n:0,c=e.column+a,l="".concat(t.name,":").concat(o,":").concat(c,`
`),u=r.split(/\r\n|[\n\r]/g),d=u[i];if(d.length>120){for(var h=Math.floor(c/80),f=c%80,p=[],g=0;g<d.length;g+=80)p.push(d.slice(g,g+80));return l+Ys([["".concat(o),p[0]]].concat(p.slice(1,h+1).map(function(m){return["",m]}),[[" ",Ln(f-1)+"^"],["",p[h+1]]]))}return l+Ys([["".concat(o-1),u[i-1]],["".concat(o),d],["",Ln(c-1)+"^"],["".concat(o+1),u[i+1]]])}function Ys(t){var e=t.filter(function(r){r[0];var i=r[1];return i!==void 0}),n=Math.max.apply(Math,e.map(function(r){var i=r[0];return i.length}));return e.map(function(r){var i=r[0],s=r[1];return qp(n,i)+(s?" | "+s:" |")}).join(`
`)}function Ln(t){return Array(t+1).join(" ")}function qp(t,e){return Ln(t-e.length)+e}function xn(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?xn=function(n){return typeof n}:xn=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xn(t)}function Qs(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Bp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Qs(Object(n),!0).forEach(function(r){Kp(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Qs(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Kp(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Hp(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jp(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vp(t,e,n){return e&&jp(t.prototype,e),t}function Wp(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zt(t,e)}function Gp(t){var e=Va();return function(){var r=en(t),i;if(e){var s=en(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return ja(this,i)}}function ja(t,e){return e&&(xn(e)==="object"||typeof e=="function")?e:Gt(t)}function Gt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ur(t){var e=typeof Map=="function"?new Map:void 0;return Ur=function(r){if(r===null||!zp(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return Nn(r,arguments,en(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Zt(i,r)},Ur(t)}function Nn(t,e,n){return Va()?Nn=Reflect.construct:Nn=function(i,s,o){var a=[null];a.push.apply(a,s);var c=Function.bind.apply(i,a),l=new c;return o&&Zt(l,o.prototype),l},Nn.apply(null,arguments)}function Va(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function zp(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function Zt(t,e){return Zt=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Zt(t,e)}function en(t){return en=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},en(t)}var Jt=function(t){Wp(n,t);var e=Gp(n);function n(r,i,s,o,a,c,l){var u,d,h,f;Hp(this,n),f=e.call(this,r),f.name="GraphQLError",f.originalError=c??void 0,f.nodes=Xs(Array.isArray(i)?i:i?[i]:void 0);for(var p=[],g=0,m=(v=f.nodes)!==null&&v!==void 0?v:[];g<m.length;g++){var v,E=m[g],I=E.loc;I!=null&&p.push(I)}p=Xs(p),f.source=s??((u=p)===null||u===void 0?void 0:u[0].source),f.positions=o??((d=p)===null||d===void 0?void 0:d.map(function(w){return w.start})),f.locations=o&&s?o.map(function(w){return Dr(s,w)}):(h=p)===null||h===void 0?void 0:h.map(function(w){return Dr(w.source,w.start)}),f.path=a??void 0;var S=c==null?void 0:c.extensions;return l==null&&Fp(S)?f.extensions=Bp({},S):f.extensions=l??{},Object.defineProperties(Gt(f),{message:{enumerable:!0},locations:{enumerable:f.locations!=null},path:{enumerable:f.path!=null},extensions:{enumerable:f.extensions!=null&&Object.keys(f.extensions).length>0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),c!=null&&c.stack?(Object.defineProperty(Gt(f),"stack",{value:c.stack,writable:!0,configurable:!0}),ja(f)):(Error.captureStackTrace?Error.captureStackTrace(Gt(f),n):Object.defineProperty(Gt(f),"stack",{value:Error().stack,writable:!0,configurable:!0}),f)}return Vp(n,[{key:"toString",value:function(){return Jp(this)}},{key:Ka,get:function(){return"Object"}}]),n}(Ur(Error));function Xs(t){return t===void 0||t.length===0?void 0:t}function Jp(t){var e=t.message;if(t.nodes)for(var n=0,r=t.nodes;n<r.length;n++){var i=r[n];i.loc&&(e+=`

`+$p(i.loc))}else if(t.source&&t.locations)for(var s=0,o=t.locations;s<o.length;s++){var a=o[s];e+=`

`+Ha(t.source,a)}return e}function fe(t,e,n){return new Jt("Syntax Error: ".concat(n),void 0,t,[e])}var x=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"});function Yp(t,e){var n=!!t;if(!n)throw new Error("Unexpected invariant triggered.")}var Fr=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):void 0;function Wa(t){var e=t.prototype.toJSON;typeof e=="function"||Yp(0),t.prototype.inspect=e,Fr&&(t.prototype[Fr]=e)}var Ga=function(){function t(n,r,i){this.start=n.start,this.end=r.end,this.startToken=n,this.endToken=r,this.source=i}var e=t.prototype;return e.toJSON=function(){return{start:this.start,end:this.end}},t}();Wa(Ga);var W=function(){function t(n,r,i,s,o,a,c){this.kind=n,this.start=r,this.end=i,this.line=s,this.column=o,this.value=c,this.prev=a,this.next=null}var e=t.prototype;return e.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},t}();Wa(W);function Zs(t){return t!=null&&typeof t.kind=="string"}var y=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"});function Pn(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Pn=function(n){return typeof n}:Pn=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Pn(t)}var Qp=10,za=2;function Ja(t){return rr(t,[])}function rr(t,e){switch(Pn(t)){case"string":return JSON.stringify(t);case"function":return t.name?"[function ".concat(t.name,"]"):"[function]";case"object":return t===null?"null":Xp(t,e);default:return String(t)}}function Xp(t,e){if(e.indexOf(t)!==-1)return"[Circular]";var n=[].concat(e,[t]),r=tg(t);if(r!==void 0){var i=r.call(t);if(i!==t)return typeof i=="string"?i:rr(i,n)}else if(Array.isArray(t))return eg(t,n);return Zp(t,n)}function Zp(t,e){var n=Object.keys(t);if(n.length===0)return"{}";if(e.length>za)return"["+ng(t)+"]";var r=n.map(function(i){var s=rr(t[i],e);return i+": "+s});return"{ "+r.join(", ")+" }"}function eg(t,e){if(t.length===0)return"[]";if(e.length>za)return"[Array]";for(var n=Math.min(Qp,t.length),r=t.length-n,i=[],s=0;s<n;++s)i.push(rr(t[s],e));return r===1?i.push("... 1 more item"):r>1&&i.push("... ".concat(r," more items")),"["+i.join(", ")+"]"}function tg(t){var e=t[String(Fr)];if(typeof e=="function")return e;if(typeof t.inspect=="function")return t.inspect}function ng(t){var e=Object.prototype.toString.call(t).replace(/^\[object /,"").replace(/]$/,"");if(e==="Object"&&typeof t.constructor=="function"){var n=t.constructor.name;if(typeof n=="string"&&n!=="")return n}return e}function gr(t,e){var n=!!t;if(!n)throw new Error(e)}const rg=function(e,n){return e instanceof n};function ig(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function sg(t,e,n){return e&&ig(t.prototype,e),t}var Ya=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"GraphQL request",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{line:1,column:1};typeof e=="string"||gr(0,"Body must be a string. Received: ".concat(Ja(e),".")),this.body=e,this.name=n,this.locationOffset=r,this.locationOffset.line>0||gr(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||gr(0,"column in locationOffset is 1-indexed and must be positive.")}return sg(t,[{key:Ka,get:function(){return"Source"}}]),t}();function og(t){return rg(t,Ya)}var ag=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"});function cg(t){var e=t.split(/\r\n|[\n\r]/g),n=lg(t);if(n!==0)for(var r=1;r<e.length;r++)e[r]=e[r].slice(n);for(var i=0;i<e.length&&eo(e[i]);)++i;for(var s=e.length;s>i&&eo(e[s-1]);)--s;return e.slice(i,s).join(`
`)}function eo(t){for(var e=0;e<t.length;++e)if(t[e]!==" "&&t[e]!=="	")return!1;return!0}function lg(t){for(var e,n=!0,r=!0,i=0,s=null,o=0;o<t.length;++o)switch(t.charCodeAt(o)){case 13:t.charCodeAt(o+1)===10&&++o;case 10:n=!1,r=!0,i=0;break;case 9:case 32:++i;break;default:r&&!n&&(s===null||i<s)&&(s=i),r=!1}return(e=s)!==null&&e!==void 0?e:0}function ug(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=t.indexOf(`
`)===-1,i=t[0]===" "||t[0]==="	",s=t[t.length-1]==='"',o=t[t.length-1]==="\\",a=!r||s||o||n,c="";return a&&!(r&&i)&&(c+=`
`+e),c+=e?t.replace(/\n/g,`
`+e):t,a&&(c+=`
`),'"""'+c.replace(/"""/g,'\\"""')+'"""'}var dg=function(){function t(n){var r=new W(y.SOF,0,0,0,0,null);this.source=n,this.lastToken=r,this.token=r,this.line=1,this.lineStart=0}var e=t.prototype;return e.advance=function(){this.lastToken=this.token;var r=this.token=this.lookahead();return r},e.lookahead=function(){var r=this.token;if(r.kind!==y.EOF)do{var i;r=(i=r.next)!==null&&i!==void 0?i:r.next=fg(this,r)}while(r.kind===y.COMMENT);return r},t}();function hg(t){return t===y.BANG||t===y.DOLLAR||t===y.AMP||t===y.PAREN_L||t===y.PAREN_R||t===y.SPREAD||t===y.COLON||t===y.EQUALS||t===y.AT||t===y.BRACKET_L||t===y.BRACKET_R||t===y.BRACE_L||t===y.PIPE||t===y.BRACE_R}function ht(t){return isNaN(t)?y.EOF:t<127?JSON.stringify(String.fromCharCode(t)):'"\\u'.concat(("00"+t.toString(16).toUpperCase()).slice(-4),'"')}function fg(t,e){for(var n=t.source,r=n.body,i=r.length,s=e.end;s<i;){var o=r.charCodeAt(s),a=t.line,c=1+s-t.lineStart;switch(o){case 65279:case 9:case 32:case 44:++s;continue;case 10:++s,++t.line,t.lineStart=s;continue;case 13:r.charCodeAt(s+1)===10?s+=2:++s,++t.line,t.lineStart=s;continue;case 33:return new W(y.BANG,s,s+1,a,c,e);case 35:return gg(n,s,a,c,e);case 36:return new W(y.DOLLAR,s,s+1,a,c,e);case 38:return new W(y.AMP,s,s+1,a,c,e);case 40:return new W(y.PAREN_L,s,s+1,a,c,e);case 41:return new W(y.PAREN_R,s,s+1,a,c,e);case 46:if(r.charCodeAt(s+1)===46&&r.charCodeAt(s+2)===46)return new W(y.SPREAD,s,s+3,a,c,e);break;case 58:return new W(y.COLON,s,s+1,a,c,e);case 61:return new W(y.EQUALS,s,s+1,a,c,e);case 64:return new W(y.AT,s,s+1,a,c,e);case 91:return new W(y.BRACKET_L,s,s+1,a,c,e);case 93:return new W(y.BRACKET_R,s,s+1,a,c,e);case 123:return new W(y.BRACE_L,s,s+1,a,c,e);case 124:return new W(y.PIPE,s,s+1,a,c,e);case 125:return new W(y.BRACE_R,s,s+1,a,c,e);case 34:return r.charCodeAt(s+1)===34&&r.charCodeAt(s+2)===34?vg(n,s,a,c,e,t):yg(n,s,a,c,e);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return mg(n,s,o,a,c,e);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return wg(n,s,a,c,e)}throw fe(n,s,pg(o))}var l=t.line,u=1+s-t.lineStart;return new W(y.EOF,i,i,l,u,e)}function pg(t){return t<32&&t!==9&&t!==10&&t!==13?"Cannot contain the invalid character ".concat(ht(t),"."):t===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:"Cannot parse the unexpected character ".concat(ht(t),".")}function gg(t,e,n,r,i){var s=t.body,o,a=e;do o=s.charCodeAt(++a);while(!isNaN(o)&&(o>31||o===9));return new W(y.COMMENT,e,a,n,r,i,s.slice(e+1,a))}function mg(t,e,n,r,i,s){var o=t.body,a=n,c=e,l=!1;if(a===45&&(a=o.charCodeAt(++c)),a===48){if(a=o.charCodeAt(++c),a>=48&&a<=57)throw fe(t,c,"Invalid number, unexpected digit after 0: ".concat(ht(a),"."))}else c=mr(t,c,a),a=o.charCodeAt(c);if(a===46&&(l=!0,a=o.charCodeAt(++c),c=mr(t,c,a),a=o.charCodeAt(c)),(a===69||a===101)&&(l=!0,a=o.charCodeAt(++c),(a===43||a===45)&&(a=o.charCodeAt(++c)),c=mr(t,c,a),a=o.charCodeAt(c)),a===46||Sg(a))throw fe(t,c,"Invalid number, expected digit but got: ".concat(ht(a),"."));return new W(l?y.FLOAT:y.INT,e,c,r,i,s,o.slice(e,c))}function mr(t,e,n){var r=t.body,i=e,s=n;if(s>=48&&s<=57){do s=r.charCodeAt(++i);while(s>=48&&s<=57);return i}throw fe(t,i,"Invalid number, expected digit but got: ".concat(ht(s),"."))}function yg(t,e,n,r,i){for(var s=t.body,o=e+1,a=o,c=0,l="";o<s.length&&!isNaN(c=s.charCodeAt(o))&&c!==10&&c!==13;){if(c===34)return l+=s.slice(a,o),new W(y.STRING,e,o+1,n,r,i,l);if(c<32&&c!==9)throw fe(t,o,"Invalid character within String: ".concat(ht(c),"."));if(++o,c===92){switch(l+=s.slice(a,o-1),c=s.charCodeAt(o),c){case 34:l+='"';break;case 47:l+="/";break;case 92:l+="\\";break;case 98:l+="\b";break;case 102:l+="\f";break;case 110:l+=`
`;break;case 114:l+="\r";break;case 116:l+="	";break;case 117:{var u=Eg(s.charCodeAt(o+1),s.charCodeAt(o+2),s.charCodeAt(o+3),s.charCodeAt(o+4));if(u<0){var d=s.slice(o+1,o+5);throw fe(t,o,"Invalid character escape sequence: \\u".concat(d,"."))}l+=String.fromCharCode(u),o+=4;break}default:throw fe(t,o,"Invalid character escape sequence: \\".concat(String.fromCharCode(c),"."))}++o,a=o}}throw fe(t,o,"Unterminated string.")}function vg(t,e,n,r,i,s){for(var o=t.body,a=e+3,c=a,l=0,u="";a<o.length&&!isNaN(l=o.charCodeAt(a));){if(l===34&&o.charCodeAt(a+1)===34&&o.charCodeAt(a+2)===34)return u+=o.slice(c,a),new W(y.BLOCK_STRING,e,a+3,n,r,i,cg(u));if(l<32&&l!==9&&l!==10&&l!==13)throw fe(t,a,"Invalid character within String: ".concat(ht(l),"."));l===10?(++a,++s.line,s.lineStart=a):l===13?(o.charCodeAt(a+1)===10?a+=2:++a,++s.line,s.lineStart=a):l===92&&o.charCodeAt(a+1)===34&&o.charCodeAt(a+2)===34&&o.charCodeAt(a+3)===34?(u+=o.slice(c,a)+'"""',a+=4,c=a):++a}throw fe(t,a,"Unterminated string.")}function Eg(t,e,n,r){return Sn(t)<<12|Sn(e)<<8|Sn(n)<<4|Sn(r)}function Sn(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:-1}function wg(t,e,n,r,i){for(var s=t.body,o=s.length,a=e+1,c=0;a!==o&&!isNaN(c=s.charCodeAt(a))&&(c===95||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122);)++a;return new W(y.NAME,e,a,n,r,i,s.slice(e,a))}function Sg(t){return t===95||t>=65&&t<=90||t>=97&&t<=122}function yr(t,e){var n=new Ig(t,e);return n.parseDocument()}var Ig=function(){function t(n,r){var i=og(n)?n:new Ya(n);this._lexer=new dg(i),this._options=r}var e=t.prototype;return e.parseName=function(){var r=this.expectToken(y.NAME);return{kind:x.NAME,value:r.value,loc:this.loc(r)}},e.parseDocument=function(){var r=this._lexer.token;return{kind:x.DOCUMENT,definitions:this.many(y.SOF,this.parseDefinition,y.EOF),loc:this.loc(r)}},e.parseDefinition=function(){if(this.peek(y.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(y.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},e.parseOperationDefinition=function(){var r=this._lexer.token;if(this.peek(y.BRACE_L))return{kind:x.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(r)};var i=this.parseOperationType(),s;return this.peek(y.NAME)&&(s=this.parseName()),{kind:x.OPERATION_DEFINITION,operation:i,name:s,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(r)}},e.parseOperationType=function(){var r=this.expectToken(y.NAME);switch(r.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(r)},e.parseVariableDefinitions=function(){return this.optionalMany(y.PAREN_L,this.parseVariableDefinition,y.PAREN_R)},e.parseVariableDefinition=function(){var r=this._lexer.token;return{kind:x.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(y.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(y.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(r)}},e.parseVariable=function(){var r=this._lexer.token;return this.expectToken(y.DOLLAR),{kind:x.VARIABLE,name:this.parseName(),loc:this.loc(r)}},e.parseSelectionSet=function(){var r=this._lexer.token;return{kind:x.SELECTION_SET,selections:this.many(y.BRACE_L,this.parseSelection,y.BRACE_R),loc:this.loc(r)}},e.parseSelection=function(){return this.peek(y.SPREAD)?this.parseFragment():this.parseField()},e.parseField=function(){var r=this._lexer.token,i=this.parseName(),s,o;return this.expectOptionalToken(y.COLON)?(s=i,o=this.parseName()):o=i,{kind:x.FIELD,alias:s,name:o,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(y.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(r)}},e.parseArguments=function(r){var i=r?this.parseConstArgument:this.parseArgument;return this.optionalMany(y.PAREN_L,i,y.PAREN_R)},e.parseArgument=function(){var r=this._lexer.token,i=this.parseName();return this.expectToken(y.COLON),{kind:x.ARGUMENT,name:i,value:this.parseValueLiteral(!1),loc:this.loc(r)}},e.parseConstArgument=function(){var r=this._lexer.token;return{kind:x.ARGUMENT,name:this.parseName(),value:(this.expectToken(y.COLON),this.parseValueLiteral(!0)),loc:this.loc(r)}},e.parseFragment=function(){var r=this._lexer.token;this.expectToken(y.SPREAD);var i=this.expectOptionalKeyword("on");return!i&&this.peek(y.NAME)?{kind:x.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(r)}:{kind:x.INLINE_FRAGMENT,typeCondition:i?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(r)}},e.parseFragmentDefinition=function(){var r,i=this._lexer.token;return this.expectKeyword("fragment"),((r=this._options)===null||r===void 0?void 0:r.experimentalFragmentVariables)===!0?{kind:x.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(i)}:{kind:x.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(i)}},e.parseFragmentName=function(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()},e.parseValueLiteral=function(r){var i=this._lexer.token;switch(i.kind){case y.BRACKET_L:return this.parseList(r);case y.BRACE_L:return this.parseObject(r);case y.INT:return this._lexer.advance(),{kind:x.INT,value:i.value,loc:this.loc(i)};case y.FLOAT:return this._lexer.advance(),{kind:x.FLOAT,value:i.value,loc:this.loc(i)};case y.STRING:case y.BLOCK_STRING:return this.parseStringLiteral();case y.NAME:switch(this._lexer.advance(),i.value){case"true":return{kind:x.BOOLEAN,value:!0,loc:this.loc(i)};case"false":return{kind:x.BOOLEAN,value:!1,loc:this.loc(i)};case"null":return{kind:x.NULL,loc:this.loc(i)};default:return{kind:x.ENUM,value:i.value,loc:this.loc(i)}}case y.DOLLAR:if(!r)return this.parseVariable();break}throw this.unexpected()},e.parseStringLiteral=function(){var r=this._lexer.token;return this._lexer.advance(),{kind:x.STRING,value:r.value,block:r.kind===y.BLOCK_STRING,loc:this.loc(r)}},e.parseList=function(r){var i=this,s=this._lexer.token,o=function(){return i.parseValueLiteral(r)};return{kind:x.LIST,values:this.any(y.BRACKET_L,o,y.BRACKET_R),loc:this.loc(s)}},e.parseObject=function(r){var i=this,s=this._lexer.token,o=function(){return i.parseObjectField(r)};return{kind:x.OBJECT,fields:this.any(y.BRACE_L,o,y.BRACE_R),loc:this.loc(s)}},e.parseObjectField=function(r){var i=this._lexer.token,s=this.parseName();return this.expectToken(y.COLON),{kind:x.OBJECT_FIELD,name:s,value:this.parseValueLiteral(r),loc:this.loc(i)}},e.parseDirectives=function(r){for(var i=[];this.peek(y.AT);)i.push(this.parseDirective(r));return i},e.parseDirective=function(r){var i=this._lexer.token;return this.expectToken(y.AT),{kind:x.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(r),loc:this.loc(i)}},e.parseTypeReference=function(){var r=this._lexer.token,i;return this.expectOptionalToken(y.BRACKET_L)?(i=this.parseTypeReference(),this.expectToken(y.BRACKET_R),i={kind:x.LIST_TYPE,type:i,loc:this.loc(r)}):i=this.parseNamedType(),this.expectOptionalToken(y.BANG)?{kind:x.NON_NULL_TYPE,type:i,loc:this.loc(r)}:i},e.parseNamedType=function(){var r=this._lexer.token;return{kind:x.NAMED_TYPE,name:this.parseName(),loc:this.loc(r)}},e.parseTypeSystemDefinition=function(){var r=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(r.kind===y.NAME)switch(r.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(r)},e.peekDescription=function(){return this.peek(y.STRING)||this.peek(y.BLOCK_STRING)},e.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},e.parseSchemaDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("schema");var s=this.parseDirectives(!0),o=this.many(y.BRACE_L,this.parseOperationTypeDefinition,y.BRACE_R);return{kind:x.SCHEMA_DEFINITION,description:i,directives:s,operationTypes:o,loc:this.loc(r)}},e.parseOperationTypeDefinition=function(){var r=this._lexer.token,i=this.parseOperationType();this.expectToken(y.COLON);var s=this.parseNamedType();return{kind:x.OPERATION_TYPE_DEFINITION,operation:i,type:s,loc:this.loc(r)}},e.parseScalarTypeDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("scalar");var s=this.parseName(),o=this.parseDirectives(!0);return{kind:x.SCALAR_TYPE_DEFINITION,description:i,name:s,directives:o,loc:this.loc(r)}},e.parseObjectTypeDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("type");var s=this.parseName(),o=this.parseImplementsInterfaces(),a=this.parseDirectives(!0),c=this.parseFieldsDefinition();return{kind:x.OBJECT_TYPE_DEFINITION,description:i,name:s,interfaces:o,directives:a,fields:c,loc:this.loc(r)}},e.parseImplementsInterfaces=function(){var r;if(!this.expectOptionalKeyword("implements"))return[];if(((r=this._options)===null||r===void 0?void 0:r.allowLegacySDLImplementsInterfaces)===!0){var i=[];this.expectOptionalToken(y.AMP);do i.push(this.parseNamedType());while(this.expectOptionalToken(y.AMP)||this.peek(y.NAME));return i}return this.delimitedMany(y.AMP,this.parseNamedType)},e.parseFieldsDefinition=function(){var r;return((r=this._options)===null||r===void 0?void 0:r.allowLegacySDLEmptyFields)===!0&&this.peek(y.BRACE_L)&&this._lexer.lookahead().kind===y.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(y.BRACE_L,this.parseFieldDefinition,y.BRACE_R)},e.parseFieldDefinition=function(){var r=this._lexer.token,i=this.parseDescription(),s=this.parseName(),o=this.parseArgumentDefs();this.expectToken(y.COLON);var a=this.parseTypeReference(),c=this.parseDirectives(!0);return{kind:x.FIELD_DEFINITION,description:i,name:s,arguments:o,type:a,directives:c,loc:this.loc(r)}},e.parseArgumentDefs=function(){return this.optionalMany(y.PAREN_L,this.parseInputValueDef,y.PAREN_R)},e.parseInputValueDef=function(){var r=this._lexer.token,i=this.parseDescription(),s=this.parseName();this.expectToken(y.COLON);var o=this.parseTypeReference(),a;this.expectOptionalToken(y.EQUALS)&&(a=this.parseValueLiteral(!0));var c=this.parseDirectives(!0);return{kind:x.INPUT_VALUE_DEFINITION,description:i,name:s,type:o,defaultValue:a,directives:c,loc:this.loc(r)}},e.parseInterfaceTypeDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("interface");var s=this.parseName(),o=this.parseImplementsInterfaces(),a=this.parseDirectives(!0),c=this.parseFieldsDefinition();return{kind:x.INTERFACE_TYPE_DEFINITION,description:i,name:s,interfaces:o,directives:a,fields:c,loc:this.loc(r)}},e.parseUnionTypeDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("union");var s=this.parseName(),o=this.parseDirectives(!0),a=this.parseUnionMemberTypes();return{kind:x.UNION_TYPE_DEFINITION,description:i,name:s,directives:o,types:a,loc:this.loc(r)}},e.parseUnionMemberTypes=function(){return this.expectOptionalToken(y.EQUALS)?this.delimitedMany(y.PIPE,this.parseNamedType):[]},e.parseEnumTypeDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("enum");var s=this.parseName(),o=this.parseDirectives(!0),a=this.parseEnumValuesDefinition();return{kind:x.ENUM_TYPE_DEFINITION,description:i,name:s,directives:o,values:a,loc:this.loc(r)}},e.parseEnumValuesDefinition=function(){return this.optionalMany(y.BRACE_L,this.parseEnumValueDefinition,y.BRACE_R)},e.parseEnumValueDefinition=function(){var r=this._lexer.token,i=this.parseDescription(),s=this.parseName(),o=this.parseDirectives(!0);return{kind:x.ENUM_VALUE_DEFINITION,description:i,name:s,directives:o,loc:this.loc(r)}},e.parseInputObjectTypeDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("input");var s=this.parseName(),o=this.parseDirectives(!0),a=this.parseInputFieldsDefinition();return{kind:x.INPUT_OBJECT_TYPE_DEFINITION,description:i,name:s,directives:o,fields:a,loc:this.loc(r)}},e.parseInputFieldsDefinition=function(){return this.optionalMany(y.BRACE_L,this.parseInputValueDef,y.BRACE_R)},e.parseTypeSystemExtension=function(){var r=this._lexer.lookahead();if(r.kind===y.NAME)switch(r.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(r)},e.parseSchemaExtension=function(){var r=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var i=this.parseDirectives(!0),s=this.optionalMany(y.BRACE_L,this.parseOperationTypeDefinition,y.BRACE_R);if(i.length===0&&s.length===0)throw this.unexpected();return{kind:x.SCHEMA_EXTENSION,directives:i,operationTypes:s,loc:this.loc(r)}},e.parseScalarTypeExtension=function(){var r=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var i=this.parseName(),s=this.parseDirectives(!0);if(s.length===0)throw this.unexpected();return{kind:x.SCALAR_TYPE_EXTENSION,name:i,directives:s,loc:this.loc(r)}},e.parseObjectTypeExtension=function(){var r=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var i=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseDirectives(!0),a=this.parseFieldsDefinition();if(s.length===0&&o.length===0&&a.length===0)throw this.unexpected();return{kind:x.OBJECT_TYPE_EXTENSION,name:i,interfaces:s,directives:o,fields:a,loc:this.loc(r)}},e.parseInterfaceTypeExtension=function(){var r=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var i=this.parseName(),s=this.parseImplementsInterfaces(),o=this.parseDirectives(!0),a=this.parseFieldsDefinition();if(s.length===0&&o.length===0&&a.length===0)throw this.unexpected();return{kind:x.INTERFACE_TYPE_EXTENSION,name:i,interfaces:s,directives:o,fields:a,loc:this.loc(r)}},e.parseUnionTypeExtension=function(){var r=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var i=this.parseName(),s=this.parseDirectives(!0),o=this.parseUnionMemberTypes();if(s.length===0&&o.length===0)throw this.unexpected();return{kind:x.UNION_TYPE_EXTENSION,name:i,directives:s,types:o,loc:this.loc(r)}},e.parseEnumTypeExtension=function(){var r=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var i=this.parseName(),s=this.parseDirectives(!0),o=this.parseEnumValuesDefinition();if(s.length===0&&o.length===0)throw this.unexpected();return{kind:x.ENUM_TYPE_EXTENSION,name:i,directives:s,values:o,loc:this.loc(r)}},e.parseInputObjectTypeExtension=function(){var r=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var i=this.parseName(),s=this.parseDirectives(!0),o=this.parseInputFieldsDefinition();if(s.length===0&&o.length===0)throw this.unexpected();return{kind:x.INPUT_OBJECT_TYPE_EXTENSION,name:i,directives:s,fields:o,loc:this.loc(r)}},e.parseDirectiveDefinition=function(){var r=this._lexer.token,i=this.parseDescription();this.expectKeyword("directive"),this.expectToken(y.AT);var s=this.parseName(),o=this.parseArgumentDefs(),a=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var c=this.parseDirectiveLocations();return{kind:x.DIRECTIVE_DEFINITION,description:i,name:s,arguments:o,repeatable:a,locations:c,loc:this.loc(r)}},e.parseDirectiveLocations=function(){return this.delimitedMany(y.PIPE,this.parseDirectiveLocation)},e.parseDirectiveLocation=function(){var r=this._lexer.token,i=this.parseName();if(ag[i.value]!==void 0)return i;throw this.unexpected(r)},e.loc=function(r){var i;if(((i=this._options)===null||i===void 0?void 0:i.noLocation)!==!0)return new Ga(r,this._lexer.lastToken,this._lexer.source)},e.peek=function(r){return this._lexer.token.kind===r},e.expectToken=function(r){var i=this._lexer.token;if(i.kind===r)return this._lexer.advance(),i;throw fe(this._lexer.source,i.start,"Expected ".concat(Qa(r),", found ").concat(vr(i),"."))},e.expectOptionalToken=function(r){var i=this._lexer.token;if(i.kind===r)return this._lexer.advance(),i},e.expectKeyword=function(r){var i=this._lexer.token;if(i.kind===y.NAME&&i.value===r)this._lexer.advance();else throw fe(this._lexer.source,i.start,'Expected "'.concat(r,'", found ').concat(vr(i),"."))},e.expectOptionalKeyword=function(r){var i=this._lexer.token;return i.kind===y.NAME&&i.value===r?(this._lexer.advance(),!0):!1},e.unexpected=function(r){var i=r??this._lexer.token;return fe(this._lexer.source,i.start,"Unexpected ".concat(vr(i),"."))},e.any=function(r,i,s){this.expectToken(r);for(var o=[];!this.expectOptionalToken(s);)o.push(i.call(this));return o},e.optionalMany=function(r,i,s){if(this.expectOptionalToken(r)){var o=[];do o.push(i.call(this));while(!this.expectOptionalToken(s));return o}return[]},e.many=function(r,i,s){this.expectToken(r);var o=[];do o.push(i.call(this));while(!this.expectOptionalToken(s));return o},e.delimitedMany=function(r,i){this.expectOptionalToken(r);var s=[];do s.push(i.call(this));while(this.expectOptionalToken(r));return s},t}();function vr(t){var e=t.value;return Qa(t.kind)+(e!=null?' "'.concat(e,'"'):"")}function Qa(t){return hg(t)?'"'.concat(t,'"'):t}var bg={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},Ag=Object.freeze({});function Tg(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bg,r=void 0,i=Array.isArray(t),s=[t],o=-1,a=[],c=void 0,l=void 0,u=void 0,d=[],h=[],f=t;do{o++;var p=o===s.length,g=p&&a.length!==0;if(p){if(l=h.length===0?void 0:d[d.length-1],c=u,u=h.pop(),g){if(i)c=c.slice();else{for(var m={},v=0,E=Object.keys(c);v<E.length;v++){var I=E[v];m[I]=c[I]}c=m}for(var S=0,w=0;w<a.length;w++){var A=a[w][0],P=a[w][1];i&&(A-=S),i&&P===null?(c.splice(A,1),S++):c[A]=P}}o=r.index,s=r.keys,a=r.edits,i=r.inArray,r=r.prev}else{if(l=u?i?o:s[o]:void 0,c=u?u[l]:f,c==null)continue;u&&d.push(l)}var _=void 0;if(!Array.isArray(c)){if(!Zs(c))throw new Error("Invalid AST Node: ".concat(Ja(c),"."));var M=Cg(e,c.kind,p);if(M){if(_=M.call(e,c,l,u,d,h),_===Ag)break;if(_===!1){if(!p){d.pop();continue}}else if(_!==void 0&&(a.push([l,_]),!p))if(Zs(_))c=_;else{d.pop();continue}}}if(_===void 0&&g&&a.push([l,c]),p)d.pop();else{var K;r={inArray:i,index:o,keys:s,edits:a,prev:r},i=Array.isArray(c),s=i?c:(K=n[c.kind])!==null&&K!==void 0?K:[],o=-1,a=[],u&&h.push(u),u=c}}while(r!==void 0);return a.length!==0&&(f=a[a.length-1][1]),f}function Cg(t,e,n){var r=t[e];if(r){if(!n&&typeof r=="function")return r;var i=n?r.leave:r.enter;if(typeof i=="function")return i}else{var s=n?t.leave:t.enter;if(s){if(typeof s=="function")return s;var o=s[e];if(typeof o=="function")return o}}}function Kt(t){return Tg(t,{leave:xg})}var Lg=80,xg={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return C(e.definitions,`

`)+`
`},OperationDefinition:function(e){var n=e.operation,r=e.name,i=j("(",C(e.variableDefinitions,", "),")"),s=C(e.directives," "),o=e.selectionSet;return!r&&!s&&!i&&n==="query"?o:C([n,C([r,i]),s,o]," ")},VariableDefinition:function(e){var n=e.variable,r=e.type,i=e.defaultValue,s=e.directives;return n+": "+r+j(" = ",i)+j(" ",C(s," "))},SelectionSet:function(e){var n=e.selections;return Ae(n)},Field:function(e){var n=e.alias,r=e.name,i=e.arguments,s=e.directives,o=e.selectionSet,a=j("",n,": ")+r,c=a+j("(",C(i,", "),")");return c.length>Lg&&(c=a+j(`(
`,kn(C(i,`
`)),`
)`)),C([c,C(s," "),o]," ")},Argument:function(e){var n=e.name,r=e.value;return n+": "+r},FragmentSpread:function(e){var n=e.name,r=e.directives;return"..."+n+j(" ",C(r," "))},InlineFragment:function(e){var n=e.typeCondition,r=e.directives,i=e.selectionSet;return C(["...",j("on ",n),C(r," "),i]," ")},FragmentDefinition:function(e){var n=e.name,r=e.typeCondition,i=e.variableDefinitions,s=e.directives,o=e.selectionSet;return"fragment ".concat(n).concat(j("(",C(i,", "),")")," ")+"on ".concat(r," ").concat(j("",C(s," ")," "))+o},IntValue:function(e){var n=e.value;return n},FloatValue:function(e){var n=e.value;return n},StringValue:function(e,n){var r=e.value,i=e.block;return i?ug(r,n==="description"?"":"  "):JSON.stringify(r)},BooleanValue:function(e){var n=e.value;return n?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){var n=e.value;return n},ListValue:function(e){var n=e.values;return"["+C(n,", ")+"]"},ObjectValue:function(e){var n=e.fields;return"{"+C(n,", ")+"}"},ObjectField:function(e){var n=e.name,r=e.value;return n+": "+r},Directive:function(e){var n=e.name,r=e.arguments;return"@"+n+j("(",C(r,", "),")")},NamedType:function(e){var n=e.name;return n},ListType:function(e){var n=e.type;return"["+n+"]"},NonNullType:function(e){var n=e.type;return n+"!"},SchemaDefinition:be(function(t){var e=t.directives,n=t.operationTypes;return C(["schema",C(e," "),Ae(n)]," ")}),OperationTypeDefinition:function(e){var n=e.operation,r=e.type;return n+": "+r},ScalarTypeDefinition:be(function(t){var e=t.name,n=t.directives;return C(["scalar",e,C(n," ")]," ")}),ObjectTypeDefinition:be(function(t){var e=t.name,n=t.interfaces,r=t.directives,i=t.fields;return C(["type",e,j("implements ",C(n," & ")),C(r," "),Ae(i)]," ")}),FieldDefinition:be(function(t){var e=t.name,n=t.arguments,r=t.type,i=t.directives;return e+(to(n)?j(`(
`,kn(C(n,`
`)),`
)`):j("(",C(n,", "),")"))+": "+r+j(" ",C(i," "))}),InputValueDefinition:be(function(t){var e=t.name,n=t.type,r=t.defaultValue,i=t.directives;return C([e+": "+n,j("= ",r),C(i," ")]," ")}),InterfaceTypeDefinition:be(function(t){var e=t.name,n=t.interfaces,r=t.directives,i=t.fields;return C(["interface",e,j("implements ",C(n," & ")),C(r," "),Ae(i)]," ")}),UnionTypeDefinition:be(function(t){var e=t.name,n=t.directives,r=t.types;return C(["union",e,C(n," "),r&&r.length!==0?"= "+C(r," | "):""]," ")}),EnumTypeDefinition:be(function(t){var e=t.name,n=t.directives,r=t.values;return C(["enum",e,C(n," "),Ae(r)]," ")}),EnumValueDefinition:be(function(t){var e=t.name,n=t.directives;return C([e,C(n," ")]," ")}),InputObjectTypeDefinition:be(function(t){var e=t.name,n=t.directives,r=t.fields;return C(["input",e,C(n," "),Ae(r)]," ")}),DirectiveDefinition:be(function(t){var e=t.name,n=t.arguments,r=t.repeatable,i=t.locations;return"directive @"+e+(to(n)?j(`(
`,kn(C(n,`
`)),`
)`):j("(",C(n,", "),")"))+(r?" repeatable":"")+" on "+C(i," | ")}),SchemaExtension:function(e){var n=e.directives,r=e.operationTypes;return C(["extend schema",C(n," "),Ae(r)]," ")},ScalarTypeExtension:function(e){var n=e.name,r=e.directives;return C(["extend scalar",n,C(r," ")]," ")},ObjectTypeExtension:function(e){var n=e.name,r=e.interfaces,i=e.directives,s=e.fields;return C(["extend type",n,j("implements ",C(r," & ")),C(i," "),Ae(s)]," ")},InterfaceTypeExtension:function(e){var n=e.name,r=e.interfaces,i=e.directives,s=e.fields;return C(["extend interface",n,j("implements ",C(r," & ")),C(i," "),Ae(s)]," ")},UnionTypeExtension:function(e){var n=e.name,r=e.directives,i=e.types;return C(["extend union",n,C(r," "),i&&i.length!==0?"= "+C(i," | "):""]," ")},EnumTypeExtension:function(e){var n=e.name,r=e.directives,i=e.values;return C(["extend enum",n,C(r," "),Ae(i)]," ")},InputObjectTypeExtension:function(e){var n=e.name,r=e.directives,i=e.fields;return C(["extend input",n,C(r," "),Ae(i)]," ")}};function be(t){return function(e){return C([e.description,t(e)],`
`)}}function C(t){var e,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return(e=t==null?void 0:t.filter(function(r){return r}).join(n))!==null&&e!==void 0?e:""}function Ae(t){return j(`{
`,kn(C(t,`
`)),`
}`)}function j(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";return e!=null&&e!==""?t+e+n:""}function kn(t){return j("  ",t.replace(/\n/g,`
  `))}function Ng(t){return t.indexOf(`
`)!==-1}function to(t){return t!=null&&t.some(Ng)}class tn extends Fn{constructor(e){super(e),this.constructor=tn,Object.setPrototypeOf(this,tn.prototype)}}class nn extends tn{constructor(e={}){super({name:"CanceledError",message:"Request is canceled by user",...e}),this.constructor=nn,Object.setPrototypeOf(this,nn.prototype)}}const Pg=t=>!!t&&t instanceof nn;var $r;(function(t){t.InvalidApiName="InvalidApiName"})($r||($r={}));$r.InvalidApiName+"";const Xa=async t=>{var n;if(!t)return;const e=await pt(kg(t));if(e){const r=await((n=t.body)==null?void 0:n.text());return Rg(e,{statusCode:t.statusCode,headers:t.headers,body:r})}},kg=t=>{let e;const n=new Proxy(t.body,{get(i,s,o){return s==="json"?async()=>{e||(e=i.text());try{return JSON.parse(await e)}catch{return{}}}:s==="text"?async()=>(e||(e=i.text()),e):Reflect.get(i,s,o)}});return new Proxy(t,{get(i,s,o){return s==="body"?n:Reflect.get(i,s,o)}})},Rg=(t,e)=>{const n=new tn({name:t==null?void 0:t.name,message:t.message,underlyingError:t,response:e});return Object.assign(n,{$metadata:t.$metadata})},qr=new Y("RestApis");function _g(t,e){const n=c=>!!e,r=new AbortController,i=r.signal,s=e==null?void 0:e.signal;let o;const a=async()=>{try{const c=await(n(t)?t():t(i));if(c.statusCode>=300)throw await Xa(c);return c}catch(c){const l=s??i,u=o??l.reason;if(c.name==="AbortError"||(l==null?void 0:l.aborted)===!0){const d=new nn({...u&&{message:u},underlyingError:c,recoverySuggestion:"The API request was explicitly canceled. If this is not intended, validate if you called the `cancel()` function on the API request erroneously."});throw qr.debug(c),d}throw qr.debug(c),c}};if(n())return a();{const c=l=>{i.aborted!==!0&&(r.abort(l),l&&i.reason!==l&&(o=l))};return{response:a(),cancel:c}}}const no="execute-api",Og="us-east-1",Mg=/^.+\.([a-z0-9-]+)\.([a-z0-9-]+)\.amazonaws\.com/,Dg=(t,e)=>{const{service:n=no,region:r=Og}={},{hostname:i}=t,[,s,o]=Mg.exec(i)??[];return s===no?{service:s,region:o??r}:s==="appsync-api"?{service:"appsync",region:o??r}:{service:n,region:r}},Ug=({headers:t},e)=>!t.authorization&&!t["x-api-key"]&&!!e,Fg=(t,e)=>{const n={};for(const r in t)n[r.toLowerCase()]=t[r];return e&&(n["content-type"]="application/json; charset=UTF-8",e instanceof FormData&&delete n["content-type"]),n},$g=on(oi,[si,ii,Ed]),qg=on(oi,[si,ii]),Bg=async(t,e,n,r)=>{var E,I,S;const{url:i,method:s,headers:o,body:a,withCredentials:c,abortSignal:l,retryStrategy:u}=e,d=a?a instanceof FormData?a:JSON.stringify(a??""):void 0,h=Fg(o,a),f={url:i,headers:h,method:s,body:d},p={retryDecider:Kg(u??((S=(I=(E=t==null?void 0:t.libraryOptions)==null?void 0:E.API)==null?void 0:I.REST)==null?void 0:S.retryStrategy)),computeDelay:ni,withCrossDomainCredentials:c,abortSignal:l},g=n(f,r);let m;const v=await Hg(t);if(g&&v){const w=Dg(i),A=(r==null?void 0:r.service)??w.service,P=(r==null?void 0:r.region)??w.region;m=await $g(f,{...p,credentials:v,region:P,service:A})}else m=await qg(f,{...p});return{statusCode:m.statusCode,headers:m.headers,body:m.body}},Kg=t=>(t==null?void 0:t.strategy)==="no-retry"?()=>Promise.resolve({retryable:!1}):ri(Xa),Hg=async t=>{try{const{credentials:e}=await t.Auth.fetchAuthSession();if(e)return e}catch{qr.debug("No credentials available, the request will be unsigned.")}return null},Ei=new WeakMap,jg=(t,{url:e,options:n,abortController:r})=>{const i=r??new AbortController,o=_g(async()=>Bg(t,{url:e,method:"POST",...n,abortSignal:i.signal,retryStrategy:{strategy:"jittered-exponential-backoff"}},Ug,n==null?void 0:n.signingServiceInfo),i).finally(()=>{Ei.delete(o)});return o},Vg=(t,e)=>{const n=Ei.get(t);return n?(n.abort(e),e&&n.signal.reason!==e&&(n.signal.reason=e),!0):!1},Wg=(t,e)=>{Ei.set(t,e)},Gg=5e3,zg=[400,401,403],Jg=["BadRequestException","UnauthorizedException"],Yg="ConnectionStateChange";var we;(function(t){t.GQL_CONNECTION_INIT="connection_init",t.GQL_CONNECTION_ERROR="connection_error",t.GQL_CONNECTION_ACK="connection_ack",t.GQL_START="start",t.GQL_START_ACK="start_ack",t.DATA="data",t.GQL_CONNECTION_KEEP_ALIVE="ka",t.GQL_STOP="stop",t.GQL_COMPLETE="complete",t.GQL_ERROR="error",t.EVENT_SUBSCRIBE="subscribe",t.EVENT_PUBLISH="publish",t.EVENT_SUBSCRIBE_ACK="subscribe_success",t.EVENT_PUBLISH_ACK="publish_success",t.EVENT_STOP="unsubscribe",t.EVENT_COMPLETE="unsubscribe_success"})(we||(we={}));var qe;(function(t){t[t.PENDING=0]="PENDING",t[t.CONNECTED=1]="CONNECTED",t[t.FAILED=2]="FAILED"})(qe||(qe={}));var ae;(function(t){t[t.CLOSED=0]="CLOSED",t[t.READY=1]="READY",t[t.CONNECTING=2]="CONNECTING"})(ae||(ae={}));const Qg={accept:"application/json, text/javascript","content-encoding":"amz-1.0","content-type":"application/json; charset=UTF-8"},ro=15e3,Xg=15e3,Zg=5*60*1e3,em=5*1e3,tm=65*1e3,nm=5*1e3,rm=60*1e3;var Te;(function(t){t.CONNECTION_CLOSED="Connection closed",t.CONNECTION_FAILED="Connection failed",t.REALTIME_SUBSCRIPTION_INIT_ERROR="AppSync Realtime subscription init error",t.SUBSCRIPTION_ACK="Subscription ack",t.TIMEOUT_DISCONNECT="Timeout disconnect"})(Te||(Te={}));var ee;(function(t){t.Connected="Connected",t.ConnectedPendingNetwork="ConnectedPendingNetwork",t.ConnectionDisrupted="ConnectionDisrupted",t.ConnectionDisruptedPendingNetwork="ConnectionDisruptedPendingNetwork",t.Connecting="Connecting",t.ConnectedPendingDisconnect="ConnectedPendingDisconnect",t.Disconnected="Disconnected",t.ConnectedPendingKeepAlive="ConnectedPendingKeepAlive"})(ee||(ee={}));const io=()=>new wt().networkMonitor(),Ee={KEEP_ALIVE_MISSED:{keepAliveState:"unhealthy"},KEEP_ALIVE:{keepAliveState:"healthy"},CONNECTION_ESTABLISHED:{connectionState:"connected"},CONNECTION_FAILED:{intendedConnectionState:"disconnected",connectionState:"disconnected"},CLOSING_CONNECTION:{intendedConnectionState:"disconnected"},OPENING_CONNECTION:{intendedConnectionState:"connected",connectionState:"connecting"},CLOSED:{connectionState:"disconnected"},ONLINE:{networkState:"connected"},OFFLINE:{networkState:"disconnected"}};class im{constructor(){this._networkMonitoringSubscription=void 0,this._linkedConnectionState={networkState:"connected",connectionState:"disconnected",intendedConnectionState:"disconnected",keepAliveState:"healthy"},this._initialNetworkStateSubscription=io().subscribe(({online:e})=>{var n;this.record(e?Ee.ONLINE:Ee.OFFLINE),(n=this._initialNetworkStateSubscription)==null||n.unsubscribe()}),this._linkedConnectionStateObservable=new ue(e=>{e.next(this._linkedConnectionState),this._linkedConnectionStateObserver=e})}enableNetworkMonitoring(){var e;(e=this._initialNetworkStateSubscription)==null||e.unsubscribe(),this._networkMonitoringSubscription===void 0&&(this._networkMonitoringSubscription=io().subscribe(({online:n})=>{this.record(n?Ee.ONLINE:Ee.OFFLINE)}))}disableNetworkMonitoring(){var e;(e=this._networkMonitoringSubscription)==null||e.unsubscribe(),this._networkMonitoringSubscription=void 0}get connectionStateObservable(){let e;return this._linkedConnectionStateObservable.pipe(ti(n=>this.connectionStatesTranslator(n))).pipe(fu(n=>{const r=n!==e;return e=n,r}))}record(e){var r;e.intendedConnectionState==="connected"?this.enableNetworkMonitoring():e.intendedConnectionState==="disconnected"&&this.disableNetworkMonitoring();const n={...this._linkedConnectionState,...e};this._linkedConnectionState={...n},(r=this._linkedConnectionStateObserver)==null||r.next(this._linkedConnectionState)}connectionStatesTranslator({connectionState:e,networkState:n,intendedConnectionState:r,keepAliveState:i}){return e==="connected"&&n==="disconnected"?ee.ConnectedPendingNetwork:e==="connected"&&r==="disconnected"?ee.ConnectedPendingDisconnect:e==="disconnected"&&r==="connected"&&n==="disconnected"?ee.ConnectionDisruptedPendingNetwork:e==="disconnected"&&r==="connected"?ee.ConnectionDisrupted:e==="connected"&&i==="unhealthy"?ee.ConnectedPendingKeepAlive:e==="connecting"?ee.Connecting:e==="disconnected"?ee.Disconnected:ee.Connected}}var Tt;(function(t){t.START_RECONNECT="START_RECONNECT",t.HALT_RECONNECT="HALT_RECONNECT"})(Tt||(Tt={}));class sm{constructor(){this.reconnectObservers=[]}addObserver(e){this.reconnectObservers.push(e)}record(e){e===Tt.START_RECONNECT&&this.reconnectSetTimeoutId===void 0&&this.reconnectIntervalId===void 0&&(this.reconnectSetTimeoutId=setTimeout(()=>{this._triggerReconnect(),this.reconnectIntervalId=setInterval(()=>{this._triggerReconnect()},rm)},nm)),e===Tt.HALT_RECONNECT&&(this.reconnectIntervalId&&(clearInterval(this.reconnectIntervalId),this.reconnectIntervalId=void 0),this.reconnectSetTimeoutId&&(clearTimeout(this.reconnectSetTimeoutId),this.reconnectSetTimeoutId=void 0))}close(){this.reconnectObservers.forEach(e=>{var n;(n=e.complete)==null||n.call(e)})}_triggerReconnect(){this.reconnectObservers.forEach(e=>{var n;(n=e.next)==null||n.call(e)})}}const so="wss://",om=/^https:\/\/\w{26}\.appsync-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/graphql$/i,am=/^https:\/\/\w{26}\.\w+-api\.\w{2}(?:(?:-\w{2,})+)-\d\.amazonaws.com(?:\.cn)?\/event$/i,oo="/realtime",cm=t=>t.match(om)===null,lm=t=>t.match(am)!==null,um=t=>{let e=t??"";return lm(e)?e=e.concat(oo).replace("ddpg-api","grt-gamma").replace("appsync-api","appsync-realtime-api"):cm(e)?e=e.concat(oo):e=e.replace("appsync-api","appsync-realtime-api").replace("gogi-beta","grt-beta").replace("ddpg-api","grt-gamma"),e=e.replace("https://",so).replace("http://",so),new pe(e)},dm=t=>{if(!t)return{};if("Authorization"in t){const{Authorization:e,...n}=t;return n}return t},hm=t=>{const e=dm(t),n=new ua;return Object.entries(e).forEach(([r,i])=>{n.append(r,i)}),n},fm=(t,e)=>{const n=um(t),r=new ua(n.search);for(const[i,s]of e.entries())r.append(i,s);return n.search=r.toString(),n.toString()},Er=async t=>{const{appSyncGraphqlEndpoint:e,query:n,libraryConfigHeaders:r=()=>({}),additionalHeaders:i={},authToken:s}=t;let o={};const a=await r();return typeof i=="function"?o=await i({url:e||"",queryString:n||""}):o=i,s&&(o={...o,Authorization:s}),{additionalCustomHeaders:o,libraryConfigHeaders:a}},ao=new Y("AWSAppSyncRealTimeProvider Auth"),co=async({host:t})=>{var n,r;const e=await Un();return{Authorization:(r=(n=e==null?void 0:e.tokens)==null?void 0:n.accessToken)==null?void 0:r.toString(),host:t}},pm=async({apiKey:t,host:e})=>{const r=new Date().toISOString().replace(/[:-]|\.\d{3}/g,"");return{host:e,"x-amz-date":r,"x-api-key":t}},gm=async({payload:t,canonicalUri:e,appSyncGraphqlEndpoint:n,region:r})=>{const i={region:r,service:"appsync"},s=(await Un()).credentials,o={url:`${n}${e}`,data:t,method:"POST",headers:{...Qg}};return va({headers:o.headers,method:o.method,url:new pe(o.url),body:o.data},{credentials:s,signingRegion:i.region,signingService:i.service}).headers},lo=async({host:t,additionalCustomHeaders:e})=>{if(!(e!=null&&e.Authorization))throw new Error("No auth token specified");return{Authorization:e.Authorization,host:t}},Za=async({apiKey:t,authenticationType:e,canonicalUri:n,appSyncGraphqlEndpoint:r,region:i,additionalCustomHeaders:s,payload:o})=>{const a={apiKey:pm,iam:gm,oidc:co,userPool:co,lambda:lo,none:lo};if(!e||!a[e]){ao.debug(`Authentication type ${e} not supported`);return}else{const c=a[e],l=r?new pe(r).host:void 0,u=e==="apiKey"?t:void 0;return ao.debug(`Authenticating with ${JSON.stringify(e)}`),await c({payload:o,canonicalUri:n,appSyncGraphqlEndpoint:r,apiKey:u,region:i,host:l,additionalCustomHeaders:s})}},uo=t=>{xe.dispatch("api",t,"PubSub",Le)};class mm{constructor(e){this.subscriptionObserverMap=new Map,this.allowNoSubscriptions=!1,this.socketStatus=ae.CLOSED,this.keepAliveTimestamp=Date.now(),this.promiseArray=[],this.connectionStateMonitor=new im,this.reconnectionMonitor=new sm,this._establishConnection=async(n,r)=>{this.logger.debug(`Establishing WebSocket connection to ${n}`);try{await this._openConnection(n,r),await this._initiateHandshake()}catch(i){const{errorType:s,errorCode:o}=i;throw zg.includes(o)||Jg.includes(s)?new Id(s):s?new Error(s):i}},this.logger=new Y(e.providerName),this.wsProtocolName=e.wsProtocolName,this.wsConnectUri=e.connectUri,this.connectionStateMonitorSubscription=this._startConnectionStateMonitoring()}close(){return this.socketStatus=ae.CLOSED,this.connectionStateMonitor.record(Ee.CONNECTION_FAILED),this.connectionStateMonitorSubscription.unsubscribe(),this.reconnectionMonitor.close(),new Promise((e,n)=>{this.awsRealTimeSocket?(this.awsRealTimeSocket.onclose=r=>{this._closeSocket(),this.subscriptionObserverMap=new Map,this.awsRealTimeSocket=void 0,e()},this.awsRealTimeSocket.onerror=r=>{n(r)},this.awsRealTimeSocket.close()):e()})}subscribe(e,n){return new ue(r=>{if(!(e!=null&&e.appSyncGraphqlEndpoint)){r.error({errors:[{...new Jt("Subscribe only available for AWS AppSync endpoint")}]}),r.complete();return}let i=!1;const s=Cr(),o=()=>{i||(i=!0,this._startSubscriptionWithAWSAppSyncRealTime({options:e,observer:r,subscriptionId:s,customUserAgentDetails:n}).catch(c=>{this.logger.debug(`${Te.REALTIME_SUBSCRIPTION_INIT_ERROR}: ${c}`),this._closeSocket()}).finally(()=>{i=!1}))},a=new ue(c=>{this.reconnectionMonitor.addObserver(c)}).subscribe(()=>{o()});return o(),async()=>{await this._cleanupSubscription(s,a)}})}async connect(e){this.socketStatus!==ae.READY&&await this._connectWebSocket(e)}async publish(e,n){if(this.socketStatus!==ae.READY)throw new Error("Subscription has not been initialized");return this._publishMessage(e,n)}async _connectWebSocket(e){const{apiKey:n,appSyncGraphqlEndpoint:r,authenticationType:i,region:s}=e,{additionalCustomHeaders:o}=await Er(e);this.connectionStateMonitor.record(Ee.OPENING_CONNECTION),await this._initializeWebSocketConnection({apiKey:n,appSyncGraphqlEndpoint:r,authenticationType:i,region:s,additionalCustomHeaders:o})}async _publishMessage(e,n){const r=Cr(),{additionalCustomHeaders:i,libraryConfigHeaders:s}=await Er(e),o=await this._prepareSubscriptionPayload({options:e,subscriptionId:r,customUserAgentDetails:n,additionalCustomHeaders:i,libraryConfigHeaders:s,publish:!0});return new Promise((a,c)=>{if(this.awsRealTimeSocket){const l=f=>{const p=JSON.parse(f.data);if(p.id===r&&p.type==="publish_success"&&(this.awsRealTimeSocket&&this.awsRealTimeSocket.removeEventListener("message",l),h(),a()),p.errors&&p.errors.length>0){const g=p.errors.map(m=>m.errorType);h(),c(new Error(`Publish errors: ${g.join(", ")}`))}},u=f=>{h(),c(new Error(`WebSocket error: ${f}`))},d=()=>{h(),c(new Error("WebSocket is closed"))},h=()=>{var f,p,g;(f=this.awsRealTimeSocket)==null||f.removeEventListener("message",l),(p=this.awsRealTimeSocket)==null||p.removeEventListener("error",u),(g=this.awsRealTimeSocket)==null||g.removeEventListener("close",d)};this.awsRealTimeSocket.addEventListener("message",l),this.awsRealTimeSocket.addEventListener("error",u),this.awsRealTimeSocket.addEventListener("close",d),this.awsRealTimeSocket.send(o)}else c(new Error("WebSocket is not connected"))})}async _cleanupSubscription(e,n){n==null||n.unsubscribe();try{await this._waitForSubscriptionToBeConnected(e);const{subscriptionState:r}=this.subscriptionObserverMap.get(e)||{};if(!r)return;if(r===qe.CONNECTED)this._sendUnsubscriptionMessage(e);else throw new Error("Subscription never connected")}catch(r){this.logger.debug(`Error while unsubscribing ${r}`)}finally{this._removeSubscriptionObserver(e)}}_startConnectionStateMonitoring(){return this.connectionStateMonitor.connectionStateObservable.subscribe(e=>{uo({event:Yg,data:{provider:this,connectionState:e},message:`Connection state is ${e}`}),this.connectionState=e,e===ee.ConnectionDisrupted&&this.reconnectionMonitor.record(Tt.START_RECONNECT),[ee.Connected,ee.ConnectedPendingDisconnect,ee.ConnectedPendingKeepAlive,ee.ConnectedPendingNetwork,ee.ConnectionDisruptedPendingNetwork,ee.Disconnected].includes(e)&&this.reconnectionMonitor.record(Tt.HALT_RECONNECT)})}async _startSubscriptionWithAWSAppSyncRealTime({options:e,observer:n,subscriptionId:r,customUserAgentDetails:i}){const{query:s,variables:o}=e;this.subscriptionObserverMap.set(r,{observer:n,query:s??"",variables:o??{},subscriptionState:qe.PENDING,startAckTimeoutId:void 0});const{additionalCustomHeaders:a,libraryConfigHeaders:c}=await Er(e),l=await this._prepareSubscriptionPayload({options:e,subscriptionId:r,customUserAgentDetails:i,additionalCustomHeaders:a,libraryConfigHeaders:c});try{await this._connectWebSocket(e)}catch(h){this._logStartSubscriptionError(r,n,h);return}const{subscriptionFailedCallback:u,subscriptionReadyCallback:d}=this.subscriptionObserverMap.get(r)??{};this.subscriptionObserverMap.set(r,{observer:n,subscriptionState:qe.PENDING,query:s??"",variables:o??{},subscriptionReadyCallback:d,subscriptionFailedCallback:u,startAckTimeoutId:setTimeout(()=>{this._timeoutStartSubscriptionAck(r)},Xg)}),this.awsRealTimeSocket&&this.awsRealTimeSocket.send(l)}_logStartSubscriptionError(e,n,r){this.logger.debug({err:r});const i=String(r.message??"");if(this._closeSocket(),this.connectionState!==ee.ConnectionDisruptedPendingNetwork){Lo(r)?n.error({errors:[{...new Jt(`${Te.CONNECTION_FAILED}: ${i}`)}]}):this.logger.debug(`${Te.CONNECTION_FAILED}: ${i}`);const{subscriptionFailedCallback:s}=this.subscriptionObserverMap.get(e)||{};typeof s=="function"&&s()}}async _waitForSubscriptionToBeConnected(e){const n=this.subscriptionObserverMap.get(e);if(n){const{subscriptionState:r}=n;if(r===qe.PENDING)return new Promise((i,s)=>{const{observer:o,subscriptionState:a,variables:c,query:l}=n;this.subscriptionObserverMap.set(e,{observer:o,subscriptionState:a,variables:c,query:l,subscriptionReadyCallback:i,subscriptionFailedCallback:s})})}}_sendUnsubscriptionMessage(e){try{if(this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.socketStatus===ae.READY){const n=this._unsubscribeMessage(e),r=JSON.stringify(n);this.awsRealTimeSocket.send(r)}}catch(n){this.logger.debug({err:n})}}_removeSubscriptionObserver(e){this.subscriptionObserverMap.delete(e),this.allowNoSubscriptions||setTimeout(this._closeSocketIfRequired.bind(this),1e3)}_closeSocketIfRequired(){if(!(this.subscriptionObserverMap.size>0)){if(!this.awsRealTimeSocket){this.socketStatus=ae.CLOSED;return}if(this.connectionStateMonitor.record(Ee.CLOSING_CONNECTION),this.awsRealTimeSocket.bufferedAmount>0)setTimeout(this._closeSocketIfRequired.bind(this),1e3);else{this.logger.debug("closing WebSocket...");const e=this.awsRealTimeSocket;e.onclose=null,e.onerror=null,e.close(1e3),this.awsRealTimeSocket=void 0,this.socketStatus=ae.CLOSED,this._closeSocket()}}}maintainKeepAlive(){this.keepAliveTimestamp=Date.now()}keepAliveHeartbeat(e){const n=Date.now();n-this.keepAliveTimestamp>tm?this.connectionStateMonitor.record(Ee.KEEP_ALIVE_MISSED):this.connectionStateMonitor.record(Ee.KEEP_ALIVE),n-this.keepAliveTimestamp>e&&this._errorDisconnect(Te.TIMEOUT_DISCONNECT)}_handleIncomingSubscriptionMessage(e){if(typeof e.data!="string")return;const[n,r]=this._handleSubscriptionData(e);if(n){this.maintainKeepAlive();return}const{type:i,id:s,payload:o}=r,{observer:a=null,query:c="",variables:l={},startAckTimeoutId:u,subscriptionReadyCallback:d,subscriptionFailedCallback:h}=this.subscriptionObserverMap.get(s)||{};if(i===we.GQL_START_ACK||i===we.EVENT_SUBSCRIBE_ACK){this.logger.debug(`subscription ready for ${JSON.stringify({query:c,variables:l})}`),typeof d=="function"&&d(),u&&clearTimeout(u),uo({event:Te.SUBSCRIPTION_ACK,data:{query:c,variables:l},message:"Connection established for subscription"});const f=qe.CONNECTED;a&&this.subscriptionObserverMap.set(s,{observer:a,query:c,variables:l,startAckTimeoutId:void 0,subscriptionState:f,subscriptionReadyCallback:d,subscriptionFailedCallback:h}),this.connectionStateMonitor.record(Ee.CONNECTION_ESTABLISHED);return}if(i===we.GQL_CONNECTION_KEEP_ALIVE){this.maintainKeepAlive();return}if(i===we.GQL_ERROR){const f=qe.FAILED;a&&(this.subscriptionObserverMap.set(s,{observer:a,query:c,variables:l,startAckTimeoutId:u,subscriptionReadyCallback:d,subscriptionFailedCallback:h,subscriptionState:f}),this.logger.debug(`${Te.CONNECTION_FAILED}: ${JSON.stringify(o??r)}`),a.error({errors:[{...new Jt(`${Te.CONNECTION_FAILED}: ${JSON.stringify(o??r)}`)}]}),u&&clearTimeout(u),typeof h=="function"&&h())}}_errorDisconnect(e){this.logger.debug(`Disconnect error: ${e}`),this.awsRealTimeSocket&&(this._closeSocket(),this.awsRealTimeSocket.close()),this.socketStatus=ae.CLOSED}_closeSocket(){this.keepAliveHeartbeatIntervalId&&(clearInterval(this.keepAliveHeartbeatIntervalId),this.keepAliveHeartbeatIntervalId=void 0),this.connectionStateMonitor.record(Ee.CLOSED)}_timeoutStartSubscriptionAck(e){const n=this.subscriptionObserverMap.get(e);if(n){const{observer:r,query:i,variables:s}=n;if(!r)return;this.subscriptionObserverMap.set(e,{observer:r,query:i,variables:s,subscriptionState:qe.FAILED}),this._closeSocket(),this.logger.debug("timeoutStartSubscription",JSON.stringify({query:i,variables:s}))}}_initializeWebSocketConnection({appSyncGraphqlEndpoint:e,authenticationType:n,apiKey:r,region:i,additionalCustomHeaders:s}){if(this.socketStatus!==ae.READY)return new Promise(async(o,a)=>{if(this.promiseArray.push({res:o,rej:a}),this.socketStatus===ae.CLOSED)try{this.socketStatus=ae.CONNECTING;const l=await Za({authenticationType:n,payload:"{}",canonicalUri:this.wsConnectUri,apiKey:r,appSyncGraphqlEndpoint:e,region:i,additionalCustomHeaders:s}),u=l?JSON.stringify(l):"",h=`header-${lt.convert(u,{urlSafe:!0,skipPadding:!0})}`,f=hm(s),p=fm(e,f);await this._establishRetryableConnection(p,h),this.promiseArray.forEach(({res:g})=>{this.logger.debug("Notifying connection successful"),g()}),this.socketStatus=ae.READY,this.promiseArray=[]}catch(c){this.logger.debug("Connection exited with",c),this.promiseArray.forEach(({rej:l})=>{l(c)}),this.promiseArray=[],this.awsRealTimeSocket&&this.awsRealTimeSocket.readyState===WebSocket.OPEN&&this.awsRealTimeSocket.close(3001),this.awsRealTimeSocket=void 0,this.socketStatus=ae.CLOSED}})}async _establishRetryableConnection(e,n){this.logger.debug("Establishing retryable connection"),await bd(this._establishConnection.bind(this),[e,n],Gg)}async _openConnection(e,n){return new Promise((r,i)=>{const s=this._getNewWebSocket(e,[this.wsProtocolName,n]);s.onerror=()=>{this.logger.debug("WebSocket connection error")},s.onclose=()=>{this._closeSocket(),i(new Error("Connection handshake error"))},s.onopen=()=>{this.awsRealTimeSocket=s,r()}})}_getNewWebSocket(e,n){return new WebSocket(e,n)}async _initiateHandshake(){return new Promise((e,n)=>{if(!this.awsRealTimeSocket){n(new Error("awsRealTimeSocket undefined"));return}let r=!1;this.awsRealTimeSocket.onerror=o=>{this.logger.debug(`WebSocket error ${JSON.stringify(o)}`)},this.awsRealTimeSocket.onclose=o=>{this.logger.debug(`WebSocket closed ${o.reason}`),this._closeSocket(),n(new Error(JSON.stringify(o)))},this.awsRealTimeSocket.onmessage=o=>{if(typeof o.data!="string")return;this.logger.debug(`subscription message from AWS AppSyncRealTime: ${o.data} `);const a=JSON.parse(o.data),{type:c}=a,l=this._extractConnectionTimeout(a);if(c===we.GQL_CONNECTION_ACK){r=!0,this._registerWebsocketHandlers(l),e("Connected to AWS AppSyncRealTime");return}if(c===we.GQL_CONNECTION_ERROR){const{errorType:u,errorCode:d}=this._extractErrorCodeAndType(a);n({errorType:u,errorCode:d})}};const i={type:we.GQL_CONNECTION_INIT};this.awsRealTimeSocket.send(JSON.stringify(i));const s=o=>{o||(this.connectionStateMonitor.record(Ee.CONNECTION_FAILED),n(new Error(`Connection timeout: ack from AWSAppSyncRealTime was not received after ${ro} ms`)))};setTimeout(()=>{s(r)},ro)})}_registerWebsocketHandlers(e){this.awsRealTimeSocket&&(this.keepAliveHeartbeatIntervalId=setInterval(()=>{this.keepAliveHeartbeat(e)},em),this.awsRealTimeSocket.onmessage=this._handleIncomingSubscriptionMessage.bind(this),this.awsRealTimeSocket.onerror=n=>{this.logger.debug(n),this._errorDisconnect(Te.CONNECTION_CLOSED)},this.awsRealTimeSocket.onclose=n=>{this.logger.debug(`WebSocket closed ${n.reason}`),this._closeSocket(),this._errorDisconnect(Te.CONNECTION_CLOSED)})}}const ho="AWSAppSyncRealTimeProvider",ym="graphql-ws",vm="/connect";class Em extends mm{constructor(){super({providerName:ho,wsProtocolName:ym,connectUri:vm})}getProviderName(){return ho}subscribe(e,n){return super.subscribe(e,n)}async _prepareSubscriptionPayload({options:e,subscriptionId:n,customUserAgentDetails:r,additionalCustomHeaders:i,libraryConfigHeaders:s}){const{appSyncGraphqlEndpoint:o,authenticationType:a,query:c,variables:l,apiKey:u,region:d}=e,f=JSON.stringify({query:c,variables:l}),p={...await Za({apiKey:u,appSyncGraphqlEndpoint:o,authenticationType:a,payload:f,canonicalUri:"",region:d,additionalCustomHeaders:i}),...s,...i,[To]:xt(r)},g={id:n,payload:{data:f,extensions:{authorization:{...p}}},type:we.GQL_START};return JSON.stringify(g)}_handleSubscriptionData(e){this.logger.debug(`subscription message from AWS AppSync RealTime: ${e.data}`);const{id:n="",payload:r,type:i}=JSON.parse(String(e.data)),{observer:s=null,query:o="",variables:a={}}=this.subscriptionObserverMap.get(n)||{};return this.logger.debug({id:n,observer:s,query:o,variables:a}),i===we.DATA&&r&&r.data?(s?s.next(r):this.logger.debug(`observer not found for id: ${n}`),[!0,{id:n,type:i,payload:r}]):[!1,{id:n,type:i,payload:r}]}_unsubscribeMessage(e){return{id:e,type:we.GQL_STOP}}_extractConnectionTimeout(e){const{payload:{connectionTimeoutMs:n=Zg}={}}=e;return n}_extractErrorCodeAndType(e){const{payload:{errors:[{errorType:n="",errorCode:r=0}={}]=[]}={}}=e;return{errorCode:r,errorType:n}}}class Oe extends se{constructor(e){super(e),this.constructor=Oe,Object.setPrototypeOf(this,Oe.prototype)}}var St;(function(t){t.NoAuthSession="NoAuthSession",t.NoRegion="NoRegion",t.NoCustomEndpoint="NoCustomEndpoint"})(St||(St={}));const wm={[St.NoAuthSession]:{message:"Auth session should not be empty."},[St.NoRegion]:{message:"Missing region."},[St.NoCustomEndpoint]:{message:"Custom endpoint region is present without custom endpoint."}};function Sm(t,e){const{message:n,recoverySuggestion:r}=wm[e];if(!t)throw new Oe({name:e,message:n,recoverySuggestion:r})}const Im=new Y("GraphQLAPI resolveConfig"),fo=t=>{var c,l;const e=t.getConfig();(c=e.API)!=null&&c.GraphQL||Im.warn("The API configuration is missing. This is likely due to Amplify.configure() not being called prior to generateClient().");const{apiKey:n,customEndpoint:r,customEndpointRegion:i,defaultAuthMode:s,endpoint:o,region:a}=((l=e.API)==null?void 0:l.GraphQL)??{};return Sm(!(!r&&i),St.NoCustomEndpoint),{apiKey:n,customEndpoint:r,customEndpointRegion:i,defaultAuthMode:s,endpoint:o,region:a}},po=t=>{var r,i,s,o,a,c;const e=(s=(i=(r=t.libraryOptions)==null?void 0:r.API)==null?void 0:i.GraphQL)==null?void 0:s.headers,n=(c=(a=(o=t.libraryOptions)==null?void 0:o.API)==null?void 0:a.GraphQL)==null?void 0:c.withCredentials;return{headers:e,withCredentials:n}};function go(t){return t.errors&&Array.isArray(t.errors)&&t.errors.forEach(e=>{bm(e)&&(e.message="Unauthorized",e.recoverySuggestion=`If you're calling an Amplify-generated API, make sure to set the "authMode" in generateClient({ authMode: '...' }) to the backend authorization rule's auth provider ('apiKey', 'userPool', 'iam', 'oidc', 'lambda')`)}),t}function bm(t){var e,n,r,i;return!!((n=(e=t==null?void 0:t.originalError)==null?void 0:e.name)!=null&&n.startsWith("UnauthorizedException")||(r=t.message)!=null&&r.startsWith("Connection failed:")&&((i=t.message)!=null&&i.includes("Permission denied")))}var ft;(function(t){t.NO_API_KEY="No api-key configured",t.NO_CURRENT_USER="No current user",t.NO_CREDENTIALS="No credentials",t.NO_FEDERATED_JWT="No federated jwt",t.NO_AUTH_TOKEN="No auth token specified"})(ft||(ft={}));const ec=Symbol("amplify"),Rn=Symbol("authMode"),tc=Symbol("authToken"),Br=Symbol("apiKey"),nc=Symbol("headers"),_n=Symbol("endpoint");function wi(t){const e=t;return{amplify:e[ec],apiKey:e[Br],authMode:e[Rn],authToken:e[tc],endpoint:e[_n],headers:e[nc]}}const Am={name:"NoApiKey",message:ft.NO_API_KEY,recoverySuggestion:'The API request was made with `authMode: "apiKey"` but no API Key was passed into `Amplify.configure()`. Review if your API key is passed into the `Amplify.configure()` function.'},Tm={name:"NoCredentials",message:ft.NO_CREDENTIALS,recoverySuggestion:'The API request was made with `authMode: "iam"` but no authentication credentials are available.\n\nIf you intended to make a request using an authenticated role, review if your user is signed in before making the request.\n\nIf you intend to make a request using an unauthenticated role or also known as "guest access", verify if "Auth.Cognito.allowGuestAccess" is set to "true" in the `Amplify.configure()` function.'},Cm={name:"NoValidAuthTokens",message:ft.NO_FEDERATED_JWT,recoverySuggestion:"If you intended to make an authenticated API request, review if the current user is signed in."},Lm={name:"NoSignedUser",message:ft.NO_CURRENT_USER,recoverySuggestion:"Review the underlying exception field for more details. If you intended to make an authenticated API request, review if the current user is signed in."},xm={name:"NoAuthorizationHeader",message:ft.NO_AUTH_TOKEN,recoverySuggestion:'The API request was made with `authMode: "lambda"` but no `authToken` is set. Review if a valid authToken is passed into the request options or in the `Amplify.configure()` function.'},Nm={name:"NoEndpoint",message:"No GraphQL endpoint configured in `Amplify.configure()`.",recoverySuggestion:"Review if the GraphQL API endpoint is set in the `Amplify.configure()` function."},mo=t=>({data:{},errors:[new Jt(t.message,null,null,null,null,t)]});function Pm(t){if(!t)return!1;const e=t;return Array.isArray(e.errors)&&e.errors.length>0}async function km(t,e,n,r={}){var s;let i={};switch(e){case"apiKey":if(!n)throw new Oe(Am);i={"X-Api-Key":n};break;case"iam":{if((await t.Auth.fetchAuthSession()).credentials===void 0)throw new Oe(Tm);break}case"oidc":case"userPool":{let o;try{o=(s=(await t.Auth.fetchAuthSession()).tokens)==null?void 0:s.accessToken.toString()}catch(a){throw new Oe({...Lm,underlyingError:a})}if(!o)throw new Oe(Cm);i={Authorization:o};break}case"lambda":if(typeof r=="object"&&!r.Authorization)throw new Oe(xm);i={Authorization:r.Authorization};break}return i}const Rm="x-amz-user-agent",_m=t=>typeof t!="function";class Om{constructor(){this.appSyncRealTime=new Map,this._api={post:jg,cancelREST:Vg,isCancelErrorREST:Pg,updateRequestToBeCancellable:Wg}}getModuleName(){return"InternalGraphQLAPI"}getGraphqlOperationType(e){const r=yr(e).definitions,[{operation:i}]=r;return i}graphql(e,{query:n,variables:r={},authMode:i,authToken:s,endpoint:o,apiKey:a},c,l){const u=yr(typeof n=="string"?n:Kt(n)),[d={}]=u.definitions.filter(p=>p.kind==="OperationDefinition"),{operation:h}=d,f=c||{};switch(h){case"query":case"mutation":{const p=new AbortController;let g;return _m(e)?g=this._graphql(e,{query:u,variables:r,authMode:i,apiKey:a,endpoint:o},f,p,l,s):g=e(async v=>await this._graphql(v,{query:u,variables:r,authMode:i,apiKey:a,endpoint:o},f,p,l,s)),this._api.updateRequestToBeCancellable(g,p),g}case"subscription":return this._graphqlSubscribe(e,{query:u,variables:r,authMode:i,apiKey:a,endpoint:o},f,l,s);default:throw new Error(`invalid operation type: ${h}`)}}async _graphql(e,{query:n,variables:r,authMode:i,endpoint:s,apiKey:o},a={},c,l,u){const{apiKey:d,region:h,endpoint:f,customEndpoint:p,customEndpointRegion:g,defaultAuthMode:m}=fo(e),v=i||m||"iam",E=v==="identityPool"?"iam":v,{headers:I,withCredentials:S}=po(e);let w;if(typeof a=="function"){const D={method:"POST",url:new pe(s||p||f||"").toString(),queryString:Kt(n)};w=await a(D)}else w=a;u&&(w={...w,Authorization:u});const A=await km(e,E,o??d,w),P={...!p&&A,...p&&(g?A:{})||{},...I&&await I({query:Kt(n),variables:r}),...w,...!p&&{[Rm]:xt(l)}},_={query:Kt(n),variables:r||null};let M;p&&!g||E!=="oidc"&&E!=="userPool"&&E!=="iam"&&E!=="lambda"?M=void 0:M={service:g?"execute-api":"appsync",region:g||h};const K=s||p||f;if(!K)throw mo(new Oe(Nm));let V;try{const{body:D}=await this._api.post(e,{url:new pe(K),options:{headers:P,body:_,signingServiceInfo:M,withCredentials:S},abortController:c});V=await D.json()}catch(D){if(this.isCancelError(D))throw D;V=mo(D)}if(Pm(V))throw go(V);return V}isCancelError(e){return this._api.isCancelErrorREST(e)}cancel(e,n){return this._api.cancelREST(e,n)}_graphqlSubscribe(e,{query:n,variables:r,authMode:i,apiKey:s,endpoint:o},a={},c,l){const u=fo(e),d=i||(u==null?void 0:u.defaultAuthMode)||"iam",h=d==="identityPool"?"iam":d,{headers:f}=po(e),p=o??(u==null?void 0:u.endpoint),g=p??"none",m=this.appSyncRealTime.get(g)??new Em;return this.appSyncRealTime.set(g,m),m.subscribe({query:Kt(n),variables:r,appSyncGraphqlEndpoint:p,region:u==null?void 0:u.region,authenticationType:h,apiKey:s??(u==null?void 0:u.apiKey),additionalHeaders:a,authToken:l,libraryConfigHeaders:f},c).pipe(Xo(v=>{throw v.errors?go(v):v}))}}function ir(t){const e=new Set;for(const n of t.attributes||[])if(Mm(n))for(const r of n.properties.rules)r.allow==="owner"?e.add(r.ownerField||"owner"):r.allow==="groups"&&r.groupsField!==void 0&&e.add(r.groupsField);return Array.from(e)}function Mm(t){var e,n;return(t==null?void 0:t.type)==="auth"&&typeof(t==null?void 0:t.properties)=="object"&&Array.isArray((e=t==null?void 0:t.properties)==null?void 0:e.rules)?((n=t==null?void 0:t.properties)==null?void 0:n.rules).every(r=>!!r.allow):!1}function On(t){return`${t[0].toUpperCase()}${t.slice(1)}`}function Ze(t){let e,n;const r=new Promise((i,s)=>{e=i,n=s});return t(r).then(i=>{e(i)}).catch(i=>{n(i)}),r}const Kn=new WeakMap;function et(t,e){return Kn.set(e,t),t.finally(()=>{Kn.delete(e)})}function Dm(t){const e=t.cancel.bind(t);t.cancel=function(n,r){const i=new Set;let s=n;for(;s&&Kn.has(s);){if(i.has(s))throw new Error("A cycle was detected in the modeled graphql cancellation chain. This is a bug. Please report it!");i.add(s),s=Kn.get(s)}return e(s,r)}}const yt={HAS_ONE:"HAS_ONE",HAS_MANY:"HAS_MANY",BELONGS_TO:"BELONGS_TO"},yo={ID:"ID",String:"String",AWSDate:"String",AWSTime:"String",AWSDateTime:"String",AWSTimestamp:"Int",AWSEmail:"String",AWSPhone:"String",AWSURL:"String",AWSIPAddress:"String",AWSJSON:"String",Boolean:"Boolean",Int:"Int",Float:"Float"},Hn=t=>t.length===1?t[0]:t.reduce((e,n,r)=>r===0?n:e+On(n),""),Ge=(t,e,n)=>{var i;if(!n)return null;const r={};for(const[s,o]of Object.entries(n)){const a=e?(i=t.models[e])==null?void 0:i.fields[s]:void 0,c={fieldDef:a,value:o};Um(c)?r[s]=c.value.items.map(l=>Ge(t,c.fieldDef.type.model,l)):Fm(a)?r[s]=Ge(t,a.type.model,o):r[s]=o}return r};function Um(t){var e,n;return typeof((e=t.fieldDef)==null?void 0:e.type)=="object"&&"model"in t.fieldDef.type&&typeof t.fieldDef.type.model=="string"&&t.fieldDef.isArray&&Array.isArray((n=t.value)==null?void 0:n.items)}function Fm(t){return typeof(t==null?void 0:t.type)=="object"&&"model"in t.type&&typeof t.type.model=="string"}function ze(t,e,n,r,i,s,o=!1){const a=r.models[e],c=a.fields,l=Object.entries(c).filter(([u,d])=>{var h;return((h=d==null?void 0:d.type)==null?void 0:h.model)!==void 0}).map(([u])=>u);return n.map(u=>{var h,f,p,g,m;if(u==null)return u;const d={};for(const v of l){const E=c[v],S=(E==null?void 0:E.type).model,w=r.models[S],A=w.primaryKeyInfo.primaryKeyFieldName,P=w.primaryKeyInfo.sortKeyFieldNames,_=(h=E.association)==null?void 0:h.connectionType;let M=[];E.association&&"associatedWith"in E.association&&(M=E.association.associatedWith);const K=[];switch(E.association&&"targetNames"in E.association&&K.push(...E.association.targetNames),_){case yt.BELONGS_TO:{const V=P.reduce((D,k)=>(u[k]&&(D[k]=u[k]),D),{});if(((f=t.models[S])==null?void 0:f.get)===void 0)break;o?d[v]=(D,k)=>u[K[0]]?t.models[S].get(D,{[A]:u[K[0]],...V},{authMode:(k==null?void 0:k.authMode)||i,authToken:(k==null?void 0:k.authToken)||s}):{data:null}:d[v]=D=>u[K[0]]?t.models[S].get({[A]:u[K[0]],...V},{authMode:(D==null?void 0:D.authMode)||i,authToken:(D==null?void 0:D.authToken)||s}):{data:null};break}case yt.HAS_ONE:case yt.HAS_MANY:{const V=_===yt.HAS_ONE?O=>({data:(O==null?void 0:O.data.shift())||null,errors:O.errors,extensions:O.extensions}):O=>O,D=a.primaryKeyInfo.primaryKeyFieldName,k=a.primaryKeyInfo.sortKeyFieldNames,$=w.fields[M[0]];if($.type.model){let O=[];$.association&&"targetNames"in $.association&&(O=(p=$.association)==null?void 0:p.targetNames);const H=O.map((F,q)=>q===0?{[F]:{eq:u[D]}}:{[F]:{eq:u[k[q-1]]}});if(((g=t.models[S])==null?void 0:g.list)===void 0)break;o?d[v]=(F,q)=>u[D]?Ze(async Qe=>{const $t=t.models[S].list(F,{filter:{and:H},limit:q==null?void 0:q.limit,nextToken:q==null?void 0:q.nextToken,authMode:(q==null?void 0:q.authMode)||i,authToken:(q==null?void 0:q.authToken)||s}),ur=et($t,Qe);return V(await ur)}):[]:d[v]=F=>u[D]?Ze(async q=>{const Qe=t.models[S].list({filter:{and:H},limit:F==null?void 0:F.limit,nextToken:F==null?void 0:F.nextToken,authMode:(F==null?void 0:F.authMode)||i,authToken:(F==null?void 0:F.authToken)||s}),$t=et(Qe,q);return V(await $t)}):[];break}const ye=M.map((O,H)=>H===0?{[O]:{eq:u[D]}}:{[O]:{eq:u[k[H-1]]}});if(((m=t.models[S])==null?void 0:m.list)===void 0)break;o?d[v]=(O,H)=>u[D]?Ze(async F=>{const q=t.models[S].list(O,{filter:{and:ye},limit:H==null?void 0:H.limit,nextToken:H==null?void 0:H.nextToken,authMode:(H==null?void 0:H.authMode)||i,authToken:(H==null?void 0:H.authToken)||s}),Qe=et(q,F);return V(await Qe)}):[]:d[v]=O=>u[D]?Ze(async H=>{const F=t.models[S].list({filter:{and:ye},limit:O==null?void 0:O.limit,nextToken:O==null?void 0:O.nextToken,authMode:(O==null?void 0:O.authMode)||i,authToken:(O==null?void 0:O.authToken)||s}),q=et(F,H);return V(await q)}):[];break}}}return{...u,...d}})}const Kr={CREATE:{operationPrefix:"create",usePlural:!1},GET:{operationPrefix:"get",usePlural:!1},UPDATE:{operationPrefix:"update",usePlural:!1},DELETE:{operationPrefix:"delete",usePlural:!1},LIST:{operationPrefix:"list",usePlural:!0},INDEX_QUERY:{operationPrefix:"",usePlural:!1},ONCREATE:{operationPrefix:"onCreate",usePlural:!1},ONUPDATE:{operationPrefix:"onUpdate",usePlural:!1},ONDELETE:{operationPrefix:"onDelete",usePlural:!1},OBSERVEQUERY:{operationPrefix:"observeQuery",usePlural:!1}},Hr="*",sr=(t,e)=>{const{fields:n}=t,r=Object.values(n).map(({type:i,name:s})=>{if(typeof i.enum=="string")return[s,Ct];if(typeof i.nonModel=="string")return[s,sr(e.nonModels[i.nonModel],e)];if(typeof i=="string")return[s,Ct]}).filter(i=>i!==void 0);return Object.fromEntries(r)},$m=(t,e)=>{const{fields:n}=t,r=Object.values(n).map(({type:s,name:o})=>{if(typeof s.enum=="string"||typeof s=="string")return[o,Ct];if(typeof s.nonModel=="string")return[o,sr(e.nonModels[s.nonModel],e)]}).filter(s=>s!==void 0),i=ir(t).map(s=>[s,Ct]);return Object.fromEntries(r.concat(i))};function qm(t){const{fields:e}=t,n=Object.values(e).map(({type:i,name:s})=>{if(typeof i=="string")return s;if(typeof i=="object"){if(typeof(i==null?void 0:i.enum)=="string")return s;if(typeof(i==null?void 0:i.nonModel)=="string")return`${s}.${Hr}`}}).filter(Boolean),r=ir(t);return Array.from(new Set(n.concat(r)))}const Ct="";function Bm(t,e,n){const r=(i,s)=>{var m,v,E,I,S,w;const[o,...a]=i.split("."),c=a[0],l=t.models[s]??t.nonModels[s],u=l==null?void 0:l.fields,d=(v=(m=u==null?void 0:u[o])==null?void 0:m.type)==null?void 0:v.model,h=t.models[d],f=(I=(E=u==null?void 0:u[o])==null?void 0:E.type)==null?void 0:I.nonModel,p=t.nonModels[f],g=h?"model":p?"nonModel":"field";if(g==="nonModel"){let A={};if(!c)throw Error(`${o} must declare a wildcard (*) or a field of custom type ${f}`);return c===Hr?A={[o]:sr(p,t)}:A={[o]:r(a.join("."),f)},A}else if(g==="model"){let A={};if(!c)throw Error(`${o} must declare a wildcard (*) or a field of model ${d}`);if(c===Hr){const P=t.models[d];A={[o]:$m(P,t)}}else A={[o]:r(a.join("."),d)};return(S=u[o])!=null&&S.isArray&&(A={[o]:{items:A[o]}}),A}else{const A=u==null?void 0:u[o],P=t.nonModels[s],_=(w=P==null?void 0:P.fields)==null?void 0:w[o];if(P){if(!_)throw Error(`${o} is not a field of custom type ${s}`)}else{const M=ir(l).includes(o);if(!A&&!M)throw Error(`${o} is not a field of model ${s}`)}return{[o]:Ct}}};return n.reduce((i,s)=>rc(r(s,e),i),{})}function jn(t){const e=[];return Object.entries(t).forEach(([n,r])=>{r===Ct?e.push(n):typeof r=="object"&&r!==null&&(r!=null&&r.items?e.push(n,"{","items","{",jn(r.items),"}","}"):e.push(n,"{",jn(r),"}"))}),e.join(" ")}function rc(t,e){const n=r=>r&&typeof r=="object";for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)&&n(e[r])?rc(t[r],e[r]):e[r]=t[r]);return e}function ic(t,e,n){const r=t.models[e],i=Bm(t,e,n??qm(r));return jn(i)}function or(t,e,n,r,i){var V,D;const{name:s,pluralName:o,fields:a,primaryKeyInfo:{isCustomPrimaryKey:c,primaryKeyFieldName:l,sortKeyFieldNames:u},attributes:d}=e,h=s.charAt(0).toUpperCase()+s.slice(1),f=o.charAt(0).toUpperCase()+o.slice(1),{operationPrefix:p,usePlural:g}=Kr[n],{selectionSet:m}=r||{};let v,E;if(p)v=`${p}${g?f:h}`;else if(i){const{queryField:k,pk:$,sk:X=[]}=i;v=k;let ye={};if(X.length===1){const[O]=X,H=typeof a[O].type=="string"?a[O].type:"String",F=yo[H];ye={[O]:`Model${F}KeyConditionInput`}}else if(X.length>1){const O=Hn(X),H=(D=(V=d==null?void 0:d.find(F=>{var q;return((q=F==null?void 0:F.properties)==null?void 0:q.queryField)===k}))==null?void 0:V.properties)==null?void 0:D.name;ye={[O]:`Model${On(s)}${On(H)}CompositeKeyConditionInput`}}E={[$]:`${Object.prototype.hasOwnProperty.call(a[$].type,"enum")?a[$].type.enum:a[$].type}!`,...ye}}else throw new Error("Error generating GraphQL Document - invalid operation name");let I,S,w;const A=ic(t,s,m),P={[l]:`${a[l].type}!`},_={},M=k=>{if(u.length===0)return{};if(k==="get")return u.reduce(($,X)=>{const ye=a[X].type;return k==="get"&&($[X]=`${ye}!`),$},{});if(u.length===1){const[$]=u,X=typeof a[$].type=="string"?a[$].type:"String",ye=yo[X];return{[$]:`Model${ye}KeyConditionInput`}}else return{[Hn(u)]:`Model${On(s)}PrimaryCompositeKeyConditionInput`}};switch(c&&(Object.assign(P,M("get")),Object.assign(_,{[l]:`${a[l].type}`,sortDirection:"ModelSortDirection"},M("list"))),n){case"CREATE":case"UPDATE":case"DELETE":w??(w={input:`${p.charAt(0).toLocaleUpperCase()+p.slice(1)}${h}Input!`}),I??(I="mutation");case"GET":w??(w=P),S??(S=A);case"LIST":w??(w={..._,filter:`Model${h}FilterInput`,limit:"Int",nextToken:"String"}),I??(I="query"),S??(S=`items { ${A} } nextToken __typename`);case"INDEX_QUERY":w??(w={...E,filter:`Model${h}FilterInput`,sortDirection:"ModelSortDirection",limit:"Int",nextToken:"String"}),I??(I="query"),S??(S=`items { ${A} } nextToken __typename`);case"ONCREATE":case"ONUPDATE":case"ONDELETE":w??(w={filter:`ModelSubscription${h}FilterInput`}),I??(I="subscription"),S??(S=A);break;case"OBSERVEQUERY":default:throw new Error("Internal error: Attempted to generate graphql document for observeQuery. Please report this error.")}return`${I}${w?`(${Object.entries(w).map(([k,$])=>`$${k}: ${$}`)})`:""} { ${v}${w?`(${Object.keys(w).map(k=>`${k}: $${k}`)})`:""} { ${S} } }`}function ar(t,e,n,r,i){const{fields:s,primaryKeyInfo:{isCustomPrimaryKey:o,primaryKeyFieldName:a,sortKeyFieldNames:c}}=t,l=(c==null?void 0:c.length)&&Hn(c);let u={};switch(e){case"CREATE":u={input:n?vo(n,t,r):{}};break;case"UPDATE":u={input:n?Object.fromEntries(Object.entries(vo(n,t,r)).filter(([d])=>s[d]?!s[d].isReadOnly:!ir(t).includes(d))):{}};break;case"GET":case"DELETE":n&&(u=o?[a,...c].reduce((d,h)=>(d[h]=n[h],d),{}):{[a]:n[a]}),e==="DELETE"&&(u={input:u});break;case"LIST":n!=null&&n.filter&&(u.filter=n.filter),n!=null&&n.sortDirection&&(u.sortDirection=n.sortDirection),n&&n[a]&&(u[a]=n[a]),l&&n&&n[l]&&(u[l]=n[l]),n!=null&&n.nextToken&&(u.nextToken=n.nextToken),n!=null&&n.limit&&(u.limit=n.limit);break;case"INDEX_QUERY":{const{pk:d,sk:h=[]}=i,f=(h==null?void 0:h.length)&&Hn(h);u[d]=n[d],f&&n&&n[f]&&(u[f]=n[f]),n!=null&&n.filter&&(u.filter=n.filter),n!=null&&n.sortDirection&&(u.sortDirection=n.sortDirection),n!=null&&n.nextToken&&(u.nextToken=n.nextToken),n!=null&&n.limit&&(u.limit=n.limit);break}case"ONCREATE":case"ONUPDATE":case"ONDELETE":n!=null&&n.filter&&(u={filter:n.filter});break;case"OBSERVEQUERY":throw new Error("Internal error: Attempted to build variables for observeQuery. Please report this error.");default:{const d=e;throw new Error(`Unhandled operation case: ${d}`)}}return u}function vo(t,e,n){const{fields:r}=e,i={};return Object.entries(t).forEach(([s,o])=>{var l,u;const a=(l=r[s])==null?void 0:l.type,c=a==null?void 0:a.model;if(c){const d=(u=r[s])==null?void 0:u.association,f=n.models[c].primaryKeyInfo;if((d==null?void 0:d.connectionType)===yt.HAS_ONE){const p=d;p.targetNames.forEach((g,m)=>{const v=p.associatedWith[m];i[g]=o[v]})}(d==null?void 0:d.connectionType)===yt.BELONGS_TO&&d.targetNames.forEach((g,m)=>{if(m===0){const v=f.primaryKeyFieldName;i[g]=o[v]}else{const v=f.sortKeyFieldNames[m-1];i[g]=o[v]}})}else i[s]=o}),i}function Mt(t,e,n={}){const r=e(t);return{authMode:n.authMode||r.authMode,authToken:n.authToken||r.authToken}}function Dt(t,e,n){let r=e(t).headers||{};return n&&(r=n),r}function jr(t){if(t!=null&&t.errors)return{...t,data:[]};throw t}function Vn(t){if(t.errors)return{...t,data:null};throw t}const Si=Symbol("INTERNAL_USER_AGENT_OVERRIDE");var Pe;(function(t){t.CreateConversation="1",t.GetConversation="2",t.ListConversations="3",t.DeleteConversation="4",t.SendMessage="5",t.ListMessages="6",t.OnStreamEvent="7",t.Generation="8",t.UpdateConversation="9"})(Pe||(Pe={}));const Ye=t=>({category:"ai",action:t});function cr(t){return t?{[Si]:t}:void 0}const Km=t=>{var e;return typeof((e=t==null?void 0:t.token)==null?void 0:e.value)=="symbol"};function lr(t,e,n,r,i,s,o){const a=r.arguments!==void 0;return(...l)=>{const u=l[l.length-1];let d,h;if(i)if(Km(l[0]))d=l[0];else throw new Error(`Invalid first argument passed to ${r.name}. Expected contextSpec`);return a&&(i?h=l[1]:h=l[0]),n==="subscription"?Gm(t,e,r,s,h,u,o):Wm(t,e,n,r,s,h,u,d,o)}}function vt(t,e){return typeof t[e]=="string"}function Hm(t){return t instanceof Object&&"enum"in t}function jm(t){return t instanceof Object&&"input"in t}function Vm({type:t,isRequired:e}){const n=e?"!":"";return Hm(t)?`${t.enum}${n}`:jm(t)?`${t.input}${n}`:`${t}${n}`}function sc(t){if(t.arguments===void 0)return"";const e=Object.entries(t.arguments).map(([n,r])=>{const i=Vm(r),s=r.isArray?`[${i}]${r.isArrayNullable?"":"!"}`:i;return`$${n}: ${s}`}).join(", ");return e.length>0?`(${e})`:""}function oc(t){if(t.arguments===void 0)return"";const e=Object.keys(t.arguments).map(n=>`${n}: $${n}`).join(", ");return e.length>0?`(${e})`:""}function ac(t,e){if(vt(e,"type")||vt(e.type,"enum"))return"";if(vt(e.type,"nonModel")){const n=t.nonModels[e.type.nonModel];return`{${jn(sr(n,t))}}`}else return vt(e.type,"model")?`{${ic(t,e.type.model)}}`:""}function cc(t,e={}){const n={};if(t.arguments===void 0)return n;for(const r of Object.values(t.arguments))if(typeof e[r.name]<"u")n[r.name]=e[r.name];else if(r.isRequired)throw new Error(`${t.name} requires arguments '${r.name}'`);return n}function Wm(t,e,n,r,i,s,o,a,c){return Ze(async l=>{const{name:u}=r,d=Mt(t,i,o),h=Dt(t,i,o==null?void 0:o.headers),f=sc(r),p=oc(r),g=ac(e,r),m=vt(r.type,"model")?r.type.model:void 0,v=`
    ${n.toLocaleLowerCase()}${f} {
      ${u}${p} ${g}
    }
  `,E=cc(r,s),I=cr(c);try{const S=a?t.graphql(a,{...d,query:v,variables:E},h):t.graphql({...d,query:v,variables:E,...I},h),w=et(S,l),{data:A,extensions:P}=await w;if(A){const[_]=Object.keys(A),M=Array.isArray(A[_]),K=M?A[_].filter(D=>D):A[_],V=m?ze(t,m,M?K:[K],e,d.authMode,d.authToken,!!a):K;return{data:!M&&Array.isArray(V)?V.shift():V,extensions:P}}else return{data:null,extensions:P}}catch(S){const{data:w,errors:A}=S;if(w&&Object.keys(w).length!==0&&A){const[P]=Object.keys(w),_=Array.isArray(w[P]),M=_?w[P].filter(K=>K):w[P];if(M){const K=m?ze(t,m,_?M:[M],e,d.authMode,d.authToken,!!a):M;return{data:!_&&Array.isArray(K)?K.shift():K,errors:A}}else return Vn(S)}else return Vn(S)}})}function Gm(t,e,n,r,i,s,o){const a="subscription",{name:c}=n,l=Mt(t,r,s),u=Dt(t,r,s==null?void 0:s.headers),d=sc(n),h=oc(n),f=ac(e,n),p=vt(n.type,"model")?n.type.model:void 0,g=`
    ${a.toLocaleLowerCase()}${d} {
      ${c}${h} ${f}
    }
  `,m=cc(n,i),v=cr(o);return t.graphql({...l,query:g,variables:m,...v},u).pipe(ti(I=>{const[S]=Object.keys(I.data),w=I.data[S],[A]=p?ze(t,p,[w],e,l.authMode,l.authToken):[w];return A}))}const zm={queries:"query",mutations:"mutation",subscriptions:"subscription"};function Ii(t,e,n,r){if(!e)return{};const i=e.modelIntrospection;if(!i)return{};const s=i[n];if(!s)return{};const o={},a=r(t).amplify===null;for(const c of Object.values(s))o[c.name]=lr(t,i,zm[n],c,a,r);return o}function Jm(t,e,n){return Ii(t,e,"mutations",n)}function Ym(t,e,n){return Ii(t,e,"queries",n)}function Qm(t,e,n){return Ii(t,e,"subscriptions",n)}function dn(t,e,n,r,i,s=!1,o){return s?(l,u,d)=>Eo(t,e,n,u,d,r,i,l,o):(l,u)=>Eo(t,e,n,l,u,r,i,void 0,o)}function Eo(t,e,n,r,i,s,o,a,c){return Ze(async l=>{const{name:u}=n,d=or(e,n,s,i),h=ar(n,s,r,e),f=Mt(t,o,i),p=Dt(t,o,i==null?void 0:i.headers),g=cr(c);try{const m=a?t.graphql(a,{...f,query:d,variables:h},p):t.graphql({...f,query:d,variables:h,...g},p),v=et(m,l),{data:E,extensions:I}=await v;if(E){const[S]=Object.keys(E),w=Ge(e,u,E[S]);if(w===null)return{data:null,extensions:I};if(i!=null&&i.selectionSet)return{data:w,extensions:I};{const[A]=ze(t,u,[w],e,f.authMode,f.authToken,!!a);return{data:A,extensions:I}}}else return{data:null,extensions:I}}catch(m){const{data:v,errors:E}=m;if(v&&Object.keys(v).length!==0&&E){const[I]=Object.keys(v),S=Ge(e,u,v[I]);if(S){if(i!=null&&i.selectionSet)return{data:S,errors:E};{const[w]=ze(t,u,[S],e,f.authMode,f.authToken,!!a);return{data:w,errors:E}}}else return Vn(m)}else return Vn(m)}})}function bi(t,e,n,r,i=!1,s){return i?(c,l)=>wo(t,e,n,r,l,c,s):c=>wo(t,e,n,r,c,void 0,s)}function wo(t,e,n,r,i,s,o){return Ze(async a=>{var p,g,m,v;const{name:c}=n,l=or(e,n,"LIST",i),u=ar(n,"LIST",i,e),d=Mt(t,r,i),h=Dt(t,r,i==null?void 0:i.headers),f=cr(o);try{const E=s?t.graphql(s,{...d,query:l,variables:u},h):t.graphql({...d,query:l,variables:u,...f},h),I=et(E,a),{data:S,extensions:w}=await I;if(S!==void 0){const[A]=Object.keys(S);if(S[A].items){const P=S[A].items.map(_=>Ge(e,c,_));return i!=null&&i.selectionSet?{data:P,nextToken:S[A].nextToken,extensions:w}:{data:ze(t,c,P,e,d.authMode,d.authToken,!!s),nextToken:S[A].nextToken,extensions:w}}return{data:S[A],nextToken:S[A].nextToken,extensions:w}}}catch(E){const{data:I,errors:S}=E;if(I!=null&&Object.keys(I).length!==0&&S){const[w]=Object.keys(I);if((p=I[w])!=null&&p.items){const A=I[w].items.map(P=>Ge(e,c,P));return A?i!=null&&i.selectionSet?{data:A,nextToken:(g=I[w])==null?void 0:g.nextToken,errors:S}:{data:ze(t,c,A,e,d.authMode,d.authToken,!!s),nextToken:(m=I[w])==null?void 0:m.nextToken,errors:S}:{data:I[w],nextToken:(v=I[w])==null?void 0:v.nextToken,errors:S}}else return jr(E)}else return jr(E)}})}const it={},Ut=new Array(64);for(let t=0,e=65,n=90;t+e<=n;t++){const r=String.fromCharCode(t+e);it[r]=t,Ut[t]=r}for(let t=0,e=97,n=122;t+e<=n;t++){const r=String.fromCharCode(t+e),i=t+26;it[r]=i,Ut[i]=r}for(let t=0;t<10;t++){it[t.toString(10)]=t+52;const e=t.toString(10),n=t+52;it[e]=n,Ut[n]=e}it["+"]=62;Ut[62]="+";it["/"]=63;Ut[63]="/";const It=6,Yt=8,Xm=63,lc=t=>{let e=t.length/4*3;t.slice(-2)==="=="?e-=2:t.slice(-1)==="="&&e--;const n=new ArrayBuffer(e),r=new DataView(n);for(let i=0;i<t.length;i+=4){let s=0,o=0;for(let l=i,u=i+3;l<=u;l++)if(t[l]!=="="){if(!(t[l]in it))throw new TypeError(`Invalid character ${t[l]} in base64 string.`);s|=it[t[l]]<<(u-l)*It,o+=It}else s>>=It;const a=i/4*3;s>>=o%Yt;const c=Math.floor(o/Yt);for(let l=0;l<c;l++){const u=(c-l-1)*Yt;r.setUint8(a+l,(s&255<<u)>>u)}}return new Uint8Array(n)},Zm=t=>new TextEncoder().encode(t);function uc(t){let e;typeof t=="string"?e=Zm(t):e=t;const n=typeof e=="object"&&typeof e.length=="number",r=typeof e=="object"&&typeof e.byteOffset=="number"&&typeof e.byteLength=="number";if(!n&&!r)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let i="";for(let s=0;s<e.length;s+=3){let o=0,a=0;for(let l=s,u=Math.min(s+3,e.length);l<u;l++)o|=e[l]<<(u-l-1)*Yt,a+=Yt;const c=Math.ceil(a/It);o<<=c*It-a;for(let l=1;l<=c;l++){const u=(c-l)*It;i+=Ut[(o&Xm<<u)>>u]}i+="==".slice(0,4-c)}return i}const ey=t=>t.map(e=>e.image?dc(e):e.document?ty(e):e.toolUse?ry(e):e.toolResult?iy(e):hc(e)),dc=({image:t})=>({image:{...t,source:{...t.source,bytes:lc(t.source.bytes)}}}),ty=({document:t})=>({document:{...t,source:{...t.source,bytes:lc(t.source.bytes)}}}),ny=({json:t})=>({json:JSON.parse(t)}),ry=({toolUse:t})=>({toolUse:{...t,input:JSON.parse(t.input)}}),iy=({toolResult:t})=>({toolResult:{toolUseId:t.toolUseId,content:t.content.map(e=>e.image?dc(e):e.json?ny(e):hc(e))}}),hc=t=>Object.fromEntries(Object.entries(t).filter(([e,n])=>n!==null)),fc=({content:t,createdAt:e,id:n,conversationId:r,role:i})=>({content:ey(t??[]),conversationId:r,createdAt:e,id:n,role:i}),sy=(t,e,n,r,i)=>async s=>{const o=bi(t,e,r,i,!1,Ye(Pe.ListMessages)),{data:a,nextToken:c,errors:l}=await o({...s,filter:{conversationId:{eq:n}}});return{data:a.map(u=>fc(u)),nextToken:c,errors:l}},oy=({id:t,conversationId:e,associatedUserMessageId:n,contentBlockIndex:r,contentBlockDoneAtIndex:i,contentBlockDeltaIndex:s,contentBlockText:o,contentBlockToolUse:a,stopReason:c,errors:l})=>l?{error:{id:t,conversationId:e,associatedUserMessageId:n,errors:l}}:{next:cy({id:t,conversationId:e,associatedUserMessageId:n,contentBlockIndex:r,contentBlockDoneAtIndex:i,contentBlockDeltaIndex:s,text:o,toolUse:ay(a),stopReason:c})},ay=t=>{if(t)return{...t,input:JSON.parse(t.input)}},cy=t=>Object.fromEntries(Object.entries(t).filter(([e,n])=>n!==null)),ly=(t,e,n,r,i)=>s=>{const{conversations:o}=e;if(!o)return{};const a=o[r].message.subscribe;return lr(t,e,"subscription",a,!1,i,Ye(Pe.OnStreamEvent))({conversationId:n}).subscribe(l=>{const{next:u,error:d}=oy(l);d&&s.error(d),u&&s.next(u)})},uy=t=>JSON.stringify(t),dy=t=>t.map(e=>e.image?pc(e):e.document?fy(e):e.toolResult?gy(e):e),hy=({tools:t})=>({tools:Object.entries(t).map(([e,n])=>({toolSpec:{name:e,description:n.description,inputSchema:{json:JSON.stringify(n.inputSchema.json)}}}))}),pc=({image:t})=>({image:{...t,source:{...t.source,bytes:uc(t.source.bytes)}}}),fy=({document:t})=>({document:{...t,source:{...t.source,bytes:uc(t.source.bytes)}}}),py=({json:t})=>({json:JSON.stringify(t)}),gy=({toolResult:t})=>({toolResult:{...t,content:t.content.map(e=>e.image?pc(e):e.json?py(e):e)}}),my=(t,e,n,r,i)=>async s=>{const{conversations:o}=e;if(!o)return{};const a=typeof s=="string"?{content:[{text:s}]}:s,{content:c,aiContext:l,toolConfiguration:u}=a,d=o[r].message.send,h=lr(t,e,"mutation",d,!1,i,Ye(Pe.SendMessage)),{data:f,errors:p}=await h({conversationId:n,content:dy(c),...l&&{aiContext:uy(l)},...u&&{toolConfiguration:hy(u)}});return{data:f&&fc(f),errors:p}},hn=(t,e,n,r,i,s,o,a,c,l)=>{if(!n)throw new Error(`An error occurred converting a ${s} conversation: Missing ID`);return{id:n,createdAt:r,updatedAt:i,metadata:c,name:l,onStreamEvent:ly(t,e,n,s,a),sendMessage:my(t,e,n,s,a),listMessages:sy(t,e,n,o,a)}},yy=(t,e,n,r,i,s)=>async o=>{const{name:a,metadata:c}=o??{},l=JSON.stringify(c),u=dn(t,e,r,"CREATE",s,!1,Ye(Pe.CreateConversation)),{data:d,errors:h}=await u({name:a,metadata:l});return{data:hn(t,e,d==null?void 0:d.id,d==null?void 0:d.createdAt,d==null?void 0:d.updatedAt,n,i,s,d==null?void 0:d.metadata,d==null?void 0:d.name),errors:h}},vy=(t,e,n,r,i,s)=>async({id:o})=>{const a=dn(t,e,r,"GET",s,!1,Ye(Pe.GetConversation)),{data:c,errors:l}=await a({id:o});return{data:c&&hn(t,e,c.id,c.createdAt,c.updatedAt,n,i,s,c==null?void 0:c.metadata,c==null?void 0:c.name),errors:l}},Ey=(t,e,n,r,i,s)=>async o=>{const a=bi(t,e,r,s,!1,Ye(Pe.ListConversations)),{data:c,nextToken:l,errors:u}=await a(o);return{data:c.map(d=>hn(t,e,d.id,d.createdAt,d.updatedAt,n,i,s,d==null?void 0:d.metadata,d==null?void 0:d.name)),nextToken:l,errors:u}},wy=(t,e,n,r,i,s)=>async({id:o})=>{const a=dn(t,e,r,"DELETE",s,!1,Ye(Pe.DeleteConversation)),{data:c,errors:l}=await a({id:o});return{data:c&&hn(t,e,c==null?void 0:c.id,c==null?void 0:c.createdAt,c==null?void 0:c.updatedAt,n,i,s,c==null?void 0:c.metadata,c==null?void 0:c.name),errors:l}},Sy=(t,e,n,r,i,s)=>async({id:o,metadata:a,name:c})=>{const l=JSON.stringify(a),u=dn(t,e,r,"UPDATE",s,!1,Ye(Pe.UpdateConversation)),{data:d,errors:h}=await u({id:o,metadata:l,name:c});return{data:d&&hn(t,e,d==null?void 0:d.id,d==null?void 0:d.createdAt,d==null?void 0:d.updatedAt,n,i,s,d==null?void 0:d.metadata,d==null?void 0:d.name),errors:h}};function Iy(t,e,n){const r=e==null?void 0:e.modelIntrospection;if(!(r!=null&&r.conversations))return{};const i={};for(const{name:s,conversation:o,message:a,models:c,nonModels:l,enums:u}of Object.values(r.conversations)){const d=c[o.modelName],h=c[a.modelName];if(!d||!h)return{};const f={...r,models:{...r.models,...c},nonModels:{...r.nonModels,...l},enums:{...r.enums,...u}};i[s]={update:Sy(t,f,s,d,h,n),create:yy(t,f,s,d,h,n),get:vy(t,f,s,d,h,n),delete:wy(t,f,s,d,h,n),list:Ey(t,f,s,d,h,n)}}return i}function by(t,e,n){const r=e==null?void 0:e.modelIntrospection;if(!(r!=null&&r.generations))return{};const i={};for(const s of Object.values(r.generations))i[s.name]=lr(t,r,"query",s,!1,n,Ye(Pe.Generation));return i}const Ay=t=>{const e=t.modelIntrospection;if(!e)return{};const n={};for(const[r,i]of Object.entries(e.enums))n[i.name]={values:()=>i.values};return n};function Ty(t,e,n,r,i,s=!1){return s?(c,l,u)=>So(t,e,n,r,i,{...l,...u},c):(c,l)=>So(t,e,n,r,i,{...c,...l})}function Cy(t,e,n,r,i){const{data:s,extensions:o}=n,[a]=Object.keys(s);if(s[a].items){const c=s[a].items.map(l=>Ge(t,e,l));return{data:r?c:i(c),nextToken:s[a].nextToken,extensions:o}}return{data:s[a],nextToken:s[a].nextToken,extensions:o}}function So(t,e,n,r,i,s,o){return Ze(async a=>{var f,p,g,m;const{name:c}=n,l=or(e,n,"INDEX_QUERY",s,r),u=ar(n,"INDEX_QUERY",s,e,r),d=Mt(t,i,s),h=v=>ze(t,c,v,e,d.authMode,d.authToken,!!o);try{const v=Dt(t,i,s==null?void 0:s.headers),I=[{...d,query:l,variables:u},v];o!==void 0&&I.unshift(o);const S=t.graphql(...I),A=await et(S,a);if(A.data!==void 0)return Cy(e,c,A,s==null?void 0:s.selectionSet,h)}catch(v){const{data:E,errors:I}=v;if(E!=null&&Object.keys(E).length!==0&&I){const[S]=Object.keys(E);if((f=E[S])!=null&&f.items){const w=(p=E[S])==null?void 0:p.items.map(A=>Ge(e,c,A));if(w)return{data:s!=null&&s.selectionSet?w:h(w),nextToken:(g=E[S])==null?void 0:g.nextToken}}return{data:E[S],nextToken:(m=E[S])==null?void 0:m.nextToken}}else return jr(v)}})}function Ly(t,e,n,r,i){const{name:s}=n;return a=>{const c=or(e,n,r,a),l=ar(n,r,a,e),u=Mt(t,i,a),d=Dt(t,i,a==null?void 0:a.headers);return t.graphql({...u,query:c,variables:l},d).pipe(ti(f=>{const[p]=Object.keys(f.data),g=f.data[p],m=Ge(e,s,g);if(m===null)return null;if(a!=null&&a.selectionSet)return m;{const[v]=ze(t,s,[m],e,u.authMode,u.authToken);return v}}))}}function xy(t){const{primaryKeyFieldName:e,sortKeyFieldNames:n}=t.primaryKeyInfo;return[e,...n]}function Ny(t,e,n){const r=Object.fromEntries(n.map(i=>[i,t[i]]));for(let i=0;i<e.length;i++)if(Object.keys(r).every(s=>r[s]===e[i][s]))return i;return-1}function Py(t,e){const{name:n}=e;return i=>new ue(s=>{const o=[],a=[];let c=(...p)=>a.push(...p);const l=t[n].onCreate(i).subscribe({next(p){c({item:p,type:"create"})},error(p){s.error({type:"onCreate",error:p})}}),u=t[n].onUpdate(i).subscribe({next(p){c({item:p,type:"update"})},error(p){s.error({type:"onUpdate",error:p})}}),d=t[n].onDelete(i).subscribe({next(p){c({item:p,type:"delete"})},error(p){s.error({type:"onDelete",error:p})}});function h(p){for(const g of p){const m=Ny(g.item,o,f);switch(g.type){case"create":m<0&&o.push(g.item);break;case"update":m>=0&&(o[m]=g.item);break;case"delete":m>=0&&o.splice(m,1);break;default:console.error("Unrecognized message in observeQuery.",g)}}s.next({items:o,isSynced:!0})}const f=xy(e);return(async()=>{let p=!0,g=null;for(;!s.closed&&(p||g);){p=!1;const{data:m,errors:v,nextToken:E}=await t[n].list({...i,nextToken:g});g=E,o.push(...m);const I=a.length===0&&g==null;if(s.next({items:o,isSynced:I}),Array.isArray(v))for(const S of v)s.error(S)}a.length>0&&h(a),c=(...m)=>(h(m),o.length)})(),()=>{l.unsubscribe(),u.unsubscribe(),d.unsubscribe()}})}const ky=t=>{var e,n,r;return t.type==="key"&&((e=t.properties)==null?void 0:e.name)&&((n=t.properties)==null?void 0:n.queryField)&&((r=t.properties)==null?void 0:r.fields.length)>0},Ry=t=>{var n;return((n=t.attributes)==null?void 0:n.filter(ky).map(r=>{const i=r.properties.queryField,[s,...o]=r.properties.fields;return{queryField:i,pk:s,sk:o}}))||[]},_y=(t,e)=>{var a;const n=(a=t.models[e].attributes)==null?void 0:a.find(c=>c.type==="model"),r={queries:["list","get","observeQuery"],mutations:["create","update","delete"],subscriptions:["onCreate","onUpdate","onDelete"]},i=[];if(!n)return Kr;if(n.properties)for(const[c,l]of Object.entries(n.properties))c in r&&(l===null?i.push(...r[c]):l instanceof Object&&i.push(...Object.keys(l)));i.includes("list")&&i.push("observeQuery");const s=i.map(c=>c.toUpperCase());return Object.fromEntries(Object.entries(Kr).filter(([c])=>!s.includes(c)))};function Oy(t,e,n){const r={},i=e.modelIntrospection;if(!i)return{};const s=["ONCREATE","ONUPDATE","ONDELETE"];for(const o of Object.values(i.models)){const{name:a}=o;r[a]={};const c=_y(i,a);Object.entries(c).forEach(([u,{operationPrefix:d}])=>{const h=u;h==="LIST"?r[a][d]=bi(t,i,o,n):s.includes(h)?r[a][d]=Ly(t,i,o,h,n):h==="OBSERVEQUERY"?r[a][d]=Py(r,o):r[a][d]=dn(t,i,o,h,n)});const l=Ry(o);for(const u of l)r[a][u.queryField]=Ty(t,i,o,u,n)}return r}function gc(t,e,n){return Dm(t),t.models=Oy(t,e,n),t.enums=Ay(e),t.queries=Ym(t,e,n),t.mutations=Jm(t,e,n),t.subscriptions=Qm(t,e,n),t.conversations=Iy(t,e,n),t.generations=by(t,e,n),t}function My(t){return Si in t}class Dy extends Om{getModuleName(){return"GraphQLAPI"}graphql(e,n,r){const i={category:Dn.API,action:br.GraphQl};if(My(n)){const{[Si]:s,...o}=n;return super.graphql(e,o,r,{...i,...s})}return super.graphql(e,n,r,{...i})}isCancelError(e){return super.isCancelError(e)}cancel(e,n){return super.cancel(e,n)}}const Ai=new Dy;function Uy(t,e){const n=wi(this),r=n.endpoint,i=n.authMode,s=n.apiKey;if(t.authMode=t.authMode||i,t.apiKey=t.apiKey??s,t.authToken=t.authToken||n.authToken,r&&t.authMode==="apiKey"&&!t.apiKey)throw new Error("graphql() requires an explicit `apiKey` for a custom `endpoint` when `authMode = 'apiKey'`.");const o=e||n.headers;return Ai.graphql(n.amplify,{...t,endpoint:r},o)}function Fy(t,e){return Ai.cancel(t,e)}function $y(t){return Ai.isCancelError(t)}function mc(t){return t!==void 0}function qy(t){return t.event==="configure"}function By(t){var r;const e={[ec]:t.amplify,[Rn]:t.authMode,[tc]:t.authToken,[Br]:"apiKey"in t?t.apiKey:void 0,[_n]:"endpoint"in t?t.endpoint:void 0,[nc]:t.headers,graphql:Uy,cancel:Fy,isCancelError:$y,models:Ht,enums:Ht,queries:Ht,mutations:Ht,subscriptions:Ht},n=(r=t.amplify.getConfig().API)==null?void 0:r.GraphQL;if(e[_n]){if(!e[Rn])throw new Error("generateClient() requires an explicit `authMode` when `endpoint` is provided.");if(e[Rn]==="apiKey"&&!e[Br])throw new Error("generateClient() requires an explicit `apiKey` when `endpoint` is provided and `authMode = 'apiKey'`.")}return e[_n]||(mc(n)?gc(e,n,wi):Ky(e)),e}const Ky=t=>{xe.listen("core",e=>{var r;if(!qy(e.payload))return;const n=(r=e.payload.data.API)==null?void 0:r.GraphQL;mc(n)&&gc(t,n,wi)})},Ht=new Proxy({},{get(){throw new Error("Client could not be generated. This is likely due to `Amplify.configure()` not being called prior to `generateClient()` or because the configuration passed to `Amplify.configure()` is missing GraphQL provider configuration.")}});function yc(t){return By({amplify:B})}class Hy{constructor(){this.client=null,this.currentUser=null,this.authStateListeners=[],this.initializeAmplify()}async initializeAmplify(){try{const e=await Di(()=>import("./amplify_outputs-DrcOrMKU.js"),[],import.meta.url);console.log("Using Amplify configuration"),Up.configure(e.default||e),this.client=yc(),this.initializeAuthState()}catch(e){throw console.error("Failed to load Amplify configuration:",e),new Error("Amplify configuration required")}}async initializeAuthState(){try{const e=await mt();this.currentUser=e,this.notifyAuthStateChange(!0)}catch{this.currentUser=null,this.notifyAuthStateChange(!1)}}async ensureInitialized(){this.client||await this.initializeAmplify()}async signIn(e,n,r=!1){try{console.log("Attempting to sign in:",e);const i=await Bf({username:e,password:n});if(console.log("Sign in result:",i),i.nextStep){if(console.log("Sign in requires additional steps:",i.nextStep),i.nextStep.signInStep==="CONFIRM_SIGN_UP")return{success:!1,error:"Please verify your email first",code:"UserNotConfirmedException",needsVerification:!0,email:e};if(i.nextStep.signInStep==="DONE")console.log("Authentication completed successfully");else return{success:!1,error:"Additional authentication step required: "+i.nextStep.signInStep,nextStep:i.nextStep}}return console.log("Sign in successful, creating user profile..."),this.currentUser=i,await this.createOrUpdateUserProfile(i),this.notifyAuthStateChange(!0),{success:!0,user:i}}catch(i){return console.error("Sign in error:",i),this.handleAuthError(i)}}async signUp(e,n,r={}){try{console.log("Attempting to sign up:",e,"with user data:",r),r.firstName&&r.lastName&&sessionStorage.setItem("pendingUserData",JSON.stringify({firstName:r.firstName,lastName:r.lastName,email:e}));const i=await Wf({username:e,password:n,options:{userAttributes:{email:e}}});return{success:!0,userId:i.userId,nextStep:i.nextStep,needsVerification:i.nextStep.signUpStep==="CONFIRM_SIGN_UP"}}catch(i){return console.error("Sign up error:",i),this.handleAuthError(i)}}async confirmSignUp(e,n){try{console.log("Confirming sign up for:",e);const r=await ep({username:e,confirmationCode:n});return r.isSignUpComplete?{success:!0,autoSignIn:!0}:{success:!0,nextStep:r.nextStep}}catch(r){return console.error("Confirm sign up error:",r),this.handleAuthError(r)}}async resendSignUpCode(e){try{return console.log("Resending verification code for:",e),await Xf({username:e}),{success:!0}}catch(n){return console.error("Resend code error:",n),this.handleAuthError(n)}}async resetPassword(e){try{console.log("Initiating password reset for:",e);const n=await zf({username:e});return console.log("Password reset initiated:",n),{success:!0,nextStep:n.nextStep,codeDeliveryDetails:n.nextStep.resetPasswordStep==="CONFIRM_RESET_PASSWORD_WITH_CODE"?n.nextStep.codeDeliveryDetails:null}}catch(n){return console.error("Reset password error:",n),n.name==="UserNotFoundException"?{success:!1,error:"No account found with this email address",code:n.name}:n.name==="InvalidParameterException"?{success:!1,error:"Please enter a valid email address",code:n.name}:this.handleAuthError(n)}}async confirmResetPassword(e,n,r){try{return console.log("Confirming password reset for:",e),await Yf({username:e,confirmationCode:n,newPassword:r}),console.log("Password reset successful"),{success:!0}}catch(i){return console.error("Confirm reset password error:",i),this.handleAuthError(i)}}async createOrUpdateUserProfile(e){var n;try{await this.ensureInitialized();const r=e.userId||e.username;let i=e.attributes||{};if(!i||Object.keys(i).length===0)try{const{fetchUserAttributes:a}=await Di(async()=>{const{fetchUserAttributes:l}=await import("./index-BkpKmVbv.js");return{fetchUserAttributes:l}},[],import.meta.url);i=await a()||{}}catch(a){console.log("Could not fetch user attributes:",a)}const s=await this.client.models.UserProfile.list({filter:{userId:{eq:r}}}),o={data:s.data&&s.data.length>0?s.data[0]:null};if(o.data){const a={id:o.data.id,userId:r,lastActiveAt:new Date().toISOString()};i.name&&(a.displayName=i.name),i.given_name&&(a.firstName=i.given_name),i.family_name&&(a.lastName=i.family_name),i.email&&(a.email=i.email),i.picture&&(a.profilePicture=i.picture),i.sub&&(a.googleId=i.sub);const c=await this.client.models.UserProfile.update(a);console.log("Profile update result:",c),c.errors&&c.errors.length>0&&(console.error("Profile update errors:",c.errors),c.errors.forEach((l,u)=>{console.error(`Error ${u+1}:`,l)})),c.data?console.log("Updated existing user profile with enhanced Google data"):console.error("Profile update failed - no data returned")}else{const a=i.email||((n=e.signInDetails)==null?void 0:n.loginId)||r,c=this.generateUsername(a);let l=null;try{const d=sessionStorage.getItem("pendingUserData");d&&(l=JSON.parse(d),sessionStorage.removeItem("pendingUserData"))}catch{}const u={userId:r,username:c,email:a,displayName:l!=null&&l.firstName&&(l!=null&&l.lastName)?`${l.firstName} ${l.lastName}`:i.name||i.given_name||c,firstName:(l==null?void 0:l.firstName)||i.given_name||null,lastName:(l==null?void 0:l.lastName)||i.family_name||null,profilePicture:i.picture||null,googleId:i.sub||null,currentSeason:"2025",totalSurvivedRaces:0,isEliminated:!1,notificationsEnabled:!0,joinedAt:new Date().toISOString()};try{const d=await this.client.models.UserProfile.create(u),h=await this.client.models.UserProfile.get({userId:r})}catch(d){throw console.error("Profile creation failed:",d),d}console.log("Created new user profile with enhanced data"),await this.migrateLocalStoragePicks(r)}}catch(r){console.error("Error managing user profile:",r)}}generateUsername(e){return e?e.split("@")[0].replace(/[^a-zA-Z0-9]/g,""):`Player${Math.floor(Math.random()*1e4)}`}async migrateLocalStoragePicks(e){try{await this.ensureInitialized();const n=JSON.parse(localStorage.getItem("f1survivor_user_picks")||"{}");if(n.picks&&n.picks.length>0){console.log("Migrating picks from localStorage:",n.picks.length);for(const r of n.picks)(await this.client.models.DriverPick.list({filter:{userId:{eq:e},raceId:{eq:r.raceId}}})).data.length===0&&await this.client.models.DriverPick.create({userId:e,seasonId:"2025",raceId:r.raceId,driverId:r.driverId.toString(),driverName:r.driverName,teamName:r.teamName,raceName:r.raceName||"",submittedAt:r.timestamp,pickDeadline:new Date(r.timestamp).toISOString(),isAutoPick:r.isAutoPick||!1});localStorage.removeItem("f1survivor_user_picks"),console.log("Successfully migrated picks from localStorage")}}catch(n){console.error("Error migrating picks:",n)}}async signOut(){try{return console.log("Signing out user"),await xp(),this.currentUser=null,this.notifyAuthStateChange(!1),sessionStorage.clear(),{success:!0}}catch(e){return console.error("Sign out error:",e),this.handleAuthError(e)}}async getCurrentUser(){try{if(this.currentUser)return this.currentUser;const e=await mt();return this.currentUser=e,e}catch{return null}}async isAuthenticated(){try{return await mt(),!0}catch{return!1}}async getUserDisplayInfo(){var e,n,r;try{const i=await this.getCurrentUser();if(!i)return null;await this.ensureInitialized();const s=i.userId||i.username;let o=null;for(let c=1;c<=3;c++){const l=await this.client.models.UserProfile.list({filter:{userId:{eq:s}}});if(l.data&&l.data.length>0){o={data:l.data[0]};break}c<3&&await new Promise(u=>setTimeout(u,1e3))}return o!=null&&o.data?{...i,displayName:o.data.displayName||i.username,email:o.data.email||((e=i.signInDetails)==null?void 0:e.loginId),firstName:o.data.firstName,lastName:o.data.lastName,profilePicture:o.data.profilePicture}:{...i,displayName:((n=i.signInDetails)==null?void 0:n.loginId)||i.username,email:(r=i.signInDetails)==null?void 0:r.loginId}}catch(i){return console.error("Error getting user display info:",i),null}}async signInWithGoogle(){try{return console.log("Initiating Google OAuth flow"),await Sp({provider:"Google",customState:"f1survivor-google-auth"}),{success:!0,provider:"Google"}}catch(e){return console.error("Google sign-in error:",e),this.handleAuthError(e)}}async handleOAuthCallback(){try{await this.ensureInitialized();const e=await mt();return console.log("OAuth callback successful:",e),this.currentUser=e,await this.createOrUpdateUserProfile(e),this.notifyAuthStateChange(!0),{success:!0,user:e}}catch(e){return console.error("OAuth callback error:",e),this.handleAuthError(e)}}async refreshSession(){try{return await Un({forceRefresh:!0})}catch(e){throw console.error("Session refresh failed:",e),this.notifyAuthStateChange(!1),e}}startSessionMonitoring(){setInterval(async()=>{try{await this.refreshSession()}catch{console.log("Session expired, user needs to re-authenticate")}},15*60*1e3)}async getSession(){try{return await Un()}catch{return null}}onAuthStateChange(e){return this.authStateListeners.push(e),this.isAuthenticated().then(n=>e(n)),()=>{const n=this.authStateListeners.indexOf(e);n>-1&&this.authStateListeners.splice(n,1)}}notifyAuthStateChange(e){this.authStateListeners.forEach(n=>{n(e)})}handleAuthError(e){return{success:!1,error:{UserNotFoundException:"No account found with this email",NotAuthorizedException:"Incorrect email or password",UserNotConfirmedException:"Please verify your email first",UsernameExistsException:"An account with this email already exists",InvalidPasswordException:"Password does not meet requirements",LimitExceededException:"Too many attempts. Please try again later",NetworkError:"Network error. Please check your connection",CodeMismatchException:"Invalid verification code",ExpiredCodeException:"Verification code has expired",InvalidParameterException:"Please check your input and try again"}[e.name]||e.message||"Authentication failed",code:e.name}}}const L=new Hy,iv=Object.freeze(Object.defineProperty({__proto__:null,authManager:L},Symbol.toStringTag,{value:"Module"}));class jy{constructor(){this.initializeHandler()}async initializeHandler(){this.isOAuthCallback()?(console.log("OAuthHandler: OAuth callback detected, processing..."),await this.handleCallback()):console.log("OAuthHandler: No OAuth callback detected, ready for normal flow")}isOAuthCallback(){const e=new URL(window.location.href),n=e.searchParams,r=n.has("code"),i=e.hash.includes("access_token="),s=n.has("state"),o=r&&s;return console.log("OAuth detection:",{hasAuthCode:r,hasAccessToken:i,hasState:s,isCognitoCallback:o}),o||i}async handleCallback(){try{console.log("Processing OAuth callback..."),this.showCallbackLoading();const e=await this.waitForOAuthCompletion();e.success?(console.log("OAuth authentication successful"),this.cleanUpURL(),this.handlePostAuthFlow(e.user)):(console.error("OAuth callback failed:",e.error),this.showCallbackError(e.error))}catch(e){console.error("OAuth callback processing error:",e),this.showCallbackError("Authentication failed. Please try again.")}}async waitForOAuthCompletion(e=10,n=500){for(let r=1;r<=e;r++)try{console.log(`OAuth completion attempt ${r}/${e}`),r>1&&await new Promise(s=>setTimeout(s,n));const i=await L.handleOAuthCallback();if(i.success)return console.log("OAuth callback completed successfully"),i;console.log("OAuth not ready yet, retrying...")}catch(i){if(console.log(`OAuth attempt ${r} failed:`,i.message),r===e)return{success:!1,error:"OAuth authentication timed out. Please try again."};if(i.message&&(i.message.includes("Auth UserPool not configured")||i.message.includes("No current user")||i.message.includes("User not authenticated"))){console.log("Auth not ready, will retry...");continue}return{success:!1,error:i.message||"OAuth authentication failed"}}return{success:!1,error:"OAuth authentication timed out after multiple attempts"}}showCallbackLoading(){const e=document.createElement("div");e.id="oauth-loading-overlay",e.innerHTML=`
      <div class="oauth-loading-content">
        <div class="oauth-spinner"></div>
        <h3>Completing sign-in...</h3>
        <p>Please wait while we set up your account.</p>
      </div>
    `,e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      color: white;
      font-family: Arial, sans-serif;
    `;const n=e.querySelector(".oauth-loading-content");n.style.cssText=`
      text-align: center;
      padding: 2rem;
    `;const r=e.querySelector(".oauth-spinner");r.style.cssText=`
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #dc2626;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    `;const i=document.createElement("style");i.textContent=`
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    `,document.head.appendChild(i),document.body.appendChild(e)}hideCallbackLoading(){const e=document.getElementById("oauth-loading-overlay");e&&e.remove()}showCallbackError(e){this.hideCallbackLoading();const n=document.createElement("div");n.className="oauth-error-overlay",n.innerHTML=`
      <div class="oauth-error-content">
        <h3>Authentication Error</h3>
        <p>${e}</p>
        <button onclick="window.location.href='/'">Return to Home</button>
      </div>
    `,n.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      color: white;
      font-family: Arial, sans-serif;
    `;const r=n.querySelector(".oauth-error-content");r.style.cssText=`
      text-align: center;
      padding: 2rem;
      background: #1f2937;
      border-radius: 8px;
      border: 2px solid #dc2626;
    `;const i=n.querySelector("button");i.style.cssText=`
      background: #dc2626;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      margin-top: 1rem;
    `,document.body.appendChild(n)}cleanUpURL(){const e=new URL(window.location);e.searchParams.delete("code"),e.searchParams.delete("state"),e.hash="",window.history.replaceState({},document.title,e.pathname)}async handlePostAuthFlow(e){var r;this.hideCallbackLoading();try{const i=await L.getUserDisplayInfo(),s=(i==null?void 0:i.displayName)||((r=i==null?void 0:i.email)==null?void 0:r.split("@")[0])||"User";this.showSuccessMessage(`Welcome ${s}! Redirecting to dashboard...`)}catch{this.showSuccessMessage("Authentication successful! Redirecting...")}const n=sessionStorage.getItem("redirectAfterAuth")||"dashboard.html";sessionStorage.removeItem("redirectAfterAuth"),setTimeout(()=>{window.location.href=n},1500)}showSuccessMessage(e){const n=document.createElement("div");n.className="oauth-success-overlay",n.innerHTML=`
      <div class="oauth-success-content">
        <div class="success-icon">✓</div>
        <h3>Sign In Successful</h3>
        <p>${e}</p>
      </div>
    `,n.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      color: white;
      font-family: Arial, sans-serif;
    `;const r=n.querySelector(".oauth-success-content");r.style.cssText=`
      text-align: center;
      padding: 2rem;
      background: #1f2937;
      border-radius: 8px;
      border: 2px solid #10b981;
    `;const i=n.querySelector(".success-icon");i.style.cssText=`
      font-size: 3rem;
      color: #10b981;
      margin-bottom: 1rem;
    `,document.body.appendChild(n)}}new jy;class Vy{constructor(){this.modal=null,this.currentForm="signin",this.pendingEmail="",this.isInitialized=!1,this.init()}async init(){if(!this.isInitialized)try{await this.loadAuthModal(),this.setupEventListeners(),this.setupPasswordValidation(),this.isInitialized=!0,console.log("Auth UI initialized successfully")}catch(e){console.error("Failed to initialize Auth UI:",e)}}async loadAuthModal(){try{const e=await fetch("/auth-modal.html");if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const n=await e.text(),r=document.createElement("div");r.innerHTML=n,document.body.appendChild(r.firstElementChild),this.modal=document.getElementById("auth-modal"),console.log("Auth modal loaded successfully")}catch(e){console.error("Failed to load auth modal:",e),console.log("Using fallback modal creation"),this.createComprehensiveModal()}}createComprehensiveModal(){console.log("Creating comprehensive fallback modal"),document.body.insertAdjacentHTML("beforeend",`
      <div id="auth-modal" class="auth-modal">
        <div class="auth-modal-content">
          <button class="close-btn" id="close-auth-modal">&times;</button>
          
          <!-- Tab Navigation -->
          <div class="auth-tabs">
            <button class="auth-tab active" data-tab="signin">Sign In</button>
            <button class="auth-tab" data-tab="signup">Sign Up</button>
          </div>
          
          <!-- Sign In Form -->
          <form id="signin-form" class="auth-form active">
            <h2>Welcome Back</h2>
            <p class="auth-subtitle">Sign in to make your picks</p>
            
            <div class="form-group">
              <input type="email" id="signin-email" placeholder="Email" required>
            </div>
            
            <div class="form-group">
              <input type="password" id="signin-password" placeholder="Password" required>
            </div>
            
            <div class="form-options">
              <label>
                <input type="checkbox" id="remember-me"> Remember me
              </label>
              <a href="#" id="forgot-password-link">Forgot password?</a>
            </div>
            
            <button type="submit" class="cta-button auth-submit">
              <span class="button-text">Sign In</span>
              <span class="loading-spinner" style="display: none;">⏳</span>
            </button>
            
            <div class="auth-error" id="signin-error"></div>
          </form>
          
          <!-- Sign Up Form -->
          <form id="signup-form" class="auth-form">
            <h2>Join F1 Survivor</h2>
            <p class="auth-subtitle">Create an account to start playing</p>
            
            <div class="form-group">
              <input type="text" id="signup-first-name" placeholder="First Name" required>
            </div>
            
            <div class="form-group">
              <input type="text" id="signup-last-name" placeholder="Last Name" required>
            </div>
            
            <div class="form-group">
              <input type="email" id="signup-email" placeholder="Email" required>
            </div>
            
            <div class="form-group">
              <input type="password" id="signup-password" placeholder="Password" required>
              <div class="password-requirements">
                <span class="requirement" data-req="length">8+ characters</span>
                <span class="requirement" data-req="lowercase">Lowercase</span>
                <span class="requirement" data-req="uppercase">Uppercase</span>
                <span class="requirement" data-req="number">Number</span>
                <span class="requirement" data-req="symbol">Symbol</span>
              </div>
            </div>
            
            <div class="form-group">
              <input type="password" id="signup-confirm" placeholder="Confirm Password" required>
            </div>
            
            <button type="submit" class="cta-button auth-submit">
              <span class="button-text">Create Account</span>
              <span class="loading-spinner" style="display: none;">⏳</span>
            </button>
            
            <div class="auth-error" id="signup-error"></div>
          </form>
          
          <!-- Email Verification Form -->
          <form id="verify-form" class="auth-form" style="display: none;">
            <h2>Verify Your Email</h2>
            <p class="auth-subtitle">We sent a verification code to <span id="verify-email"></span></p>
            
            <div class="form-group">
              <input type="text" id="verification-code" placeholder="Enter 6-digit code" maxlength="6" required>
            </div>
            
            <button type="submit" class="cta-button auth-submit">
              <span class="button-text">Verify Email</span>
              <span class="loading-spinner" style="display: none;">⏳</span>
            </button>
            
            <div class="form-options">
              <a href="#" id="resend-code-link">Resend code</a>
            </div>
            
            <div class="auth-error" id="verify-error"></div>
          </form>

          <!-- Password Reset Form -->
          <form id="reset-form" class="auth-form" style="display: none;">
            <h2>Reset Password</h2>
            <p class="auth-subtitle">Enter your email to reset your password</p>
            
            <div class="form-group">
              <input type="email" id="reset-email" placeholder="Email" required>
            </div>
            
            <button type="submit" class="cta-button auth-submit">
              <span class="button-text">Send Reset Code</span>
              <span class="loading-spinner" style="display: none;">⏳</span>
            </button>
            
            <div class="form-options">
              <a href="#" id="back-to-signin-link">Back to Sign In</a>
            </div>
            
            <div class="auth-error" id="reset-error"></div>
          </form>
        </div>
      </div>
    `),this.modal=document.getElementById("auth-modal")}setupEventListeners(){if(!this.modal)return;this.modal.querySelectorAll(".auth-tab").forEach(p=>{p.addEventListener("click",g=>{g.preventDefault(),this.switchTab(p.dataset.tab)})});const n=this.modal.querySelector("#close-auth-modal");n&&n.addEventListener("click",()=>this.hideModal()),this.modal.addEventListener("click",p=>{p.target===this.modal&&this.hideModal()}),document.addEventListener("keydown",p=>{p.key==="Escape"&&this.modal.classList.contains("show")&&this.hideModal()});const r=this.modal.querySelector("#signin-form"),i=this.modal.querySelector("#signup-form"),s=this.modal.querySelector("#verify-form"),o=this.modal.querySelector("#reset-form"),a=this.modal.querySelector("#confirm-reset-form");r&&r.addEventListener("submit",p=>this.handleSignIn(p)),i&&i.addEventListener("submit",p=>this.handleSignUp(p)),s&&s.addEventListener("submit",p=>this.handleVerification(p)),o&&o.addEventListener("submit",p=>this.handlePasswordReset(p)),a&&a.addEventListener("submit",p=>this.handleConfirmPasswordReset(p));const c=this.modal.querySelector("#forgot-password-link");c&&c.addEventListener("click",p=>{p.preventDefault(),this.switchTab("reset")});const l=this.modal.querySelector("#resend-code-link");l&&l.addEventListener("click",p=>this.handleResendCode(p));const u=this.modal.querySelector("#back-to-signin-link");u&&u.addEventListener("click",p=>{p.preventDefault(),this.switchTab("signin")});const d=this.modal.querySelector("#back-to-reset-link");d&&d.addEventListener("click",p=>{p.preventDefault(),this.switchTab("reset")});const h=this.modal.querySelector("#google-signin-btn"),f=this.modal.querySelector("#google-signup-btn");h&&h.addEventListener("click",p=>this.handleGoogleAuth(p)),f&&f.addEventListener("click",p=>this.handleGoogleAuth(p))}setupPasswordValidation(){this.setupPasswordValidationForForm("#signup-password","#signup-form"),this.setupPasswordValidationForForm("#new-password","#confirm-reset-form")}setupPasswordValidationForForm(e,n){var o,a;const r=(o=this.modal)==null?void 0:o.querySelector(e),i=(a=this.modal)==null?void 0:a.querySelector(n),s=i==null?void 0:i.querySelectorAll(".requirement");!r||!s.length||r.addEventListener("input",()=>{const c=r.value;s.forEach(l=>{const u=l.dataset.req;let d=!1;switch(u){case"length":d=c.length>=8;break;case"lowercase":d=/[a-z]/.test(c);break;case"uppercase":d=/[A-Z]/.test(c);break;case"number":d=/\d/.test(c);break;case"symbol":d=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(c);break}l.classList.toggle("valid",d),l.classList.toggle("invalid",!d&&c.length>0)})})}async showModal(e="signin"){if(this.modal||(console.log("Modal not ready, initializing..."),await this.init()),!this.modal){console.error("Auth modal could not be initialized");return}this.switchTab(e),this.modal.classList.add("show"),setTimeout(()=>{const n=this.modal.querySelector(".auth-form.active input");n&&n.focus()},100)}hideModal(){this.modal&&(this.modal.classList.remove("show"),this.clearErrors(),this.clearForms())}switchTab(e){if(!this.modal)return;console.log("Switching to tab:",e),this.currentForm=e,this.modal.querySelectorAll(".auth-tab").forEach(s=>{s.classList.toggle("active",s.dataset.tab===e)}),this.modal.querySelectorAll(".auth-form").forEach(s=>{s.style.display="none",s.classList.remove("active")});const i=this.modal.querySelector(`#${e}-form`);i?(i.style.display="block",i.classList.add("active"),console.log("Form displayed:",e,i)):console.error("Form not found:",`#${e}-form`),this.clearErrors()}async handleSignIn(e){var s;e.preventDefault();const n=this.modal.querySelector("#signin-email").value,r=this.modal.querySelector("#signin-password").value,i=((s=this.modal.querySelector("#remember-me"))==null?void 0:s.checked)||!1;this.setLoading("signin",!0),this.clearErrors();try{const o=await L.signIn(n,r,i);o.success?(console.log("Sign in successful"),this.showSuccess("signin","Sign in successful!"),setTimeout(()=>{this.hideModal(),this.handleSuccessfulAuth()},1e3)):(console.log("Sign in failed:",o),o.needsVerification?(console.log("User needs email verification"),this.pendingEmail=o.email||n,this.showError("signin",o.error+" Redirecting to verification..."),setTimeout(()=>{this.switchTab("verify"),this.modal.querySelector("#verify-email").textContent=this.pendingEmail,this.clearErrors()},2e3)):this.showError("signin",o.error))}catch(o){console.error("Sign in error:",o),this.showError("signin","An unexpected error occurred. Please try again.")}finally{this.setLoading("signin",!1)}}async handleSignUp(e){e.preventDefault();const n=this.modal.querySelector("#signup-first-name").value.trim(),r=this.modal.querySelector("#signup-last-name").value.trim(),i=this.modal.querySelector("#signup-email").value,s=this.modal.querySelector("#signup-password").value,o=this.modal.querySelector("#signup-confirm").value;if(!n||!r){this.showError("signup","Please enter your first and last name");return}if(s!==o){this.showError("signup","Passwords do not match");return}if(!this.validatePassword(s)){this.showError("signup","Password does not meet requirements");return}this.setLoading("signup",!0),this.clearErrors();try{const a=await L.signUp(i,s,{firstName:n,lastName:r});a.success?(console.log("Sign up successful, result:",a),console.log("needsVerification:",a.needsVerification),console.log("nextStep:",a.nextStep),this.pendingEmail=i,this.pendingUserData={firstName:n,lastName:r,email:i},a.needsVerification!==!1?(console.log("Switching to verification tab"),this.switchTab("verify"),this.modal.querySelector("#verify-email").textContent=i):(console.log("Auto-confirmed user, showing success"),this.showSuccess("signup","Account created and confirmed successfully!"),setTimeout(()=>this.switchTab("signin"),3e3))):this.showError("signup",a.error)}catch(a){console.error("Sign up error:",a),this.showError("signup","An unexpected error occurred. Please try again.")}finally{this.setLoading("signup",!1)}}async handleVerification(e){e.preventDefault();const n=this.modal.querySelector("#verification-code").value;if(!n||n.length!==6){this.showError("verify","Please enter a valid 6-digit code");return}this.setLoading("verify",!0),this.clearErrors();try{const r=await L.confirmSignUp(this.pendingEmail,n);r.success?(console.log("Email verification successful"),this.showSuccess("verify","Email verified successfully!"),r.autoSignIn?setTimeout(async()=>{const i=this.modal.querySelector("#signup-password").value;(await L.signIn(this.pendingEmail,i)).success?(this.hideModal(),this.handleSuccessfulAuth()):this.switchTab("signin")},1e3):setTimeout(()=>this.switchTab("signin"),2e3)):this.showError("verify",r.error)}catch(r){console.error("Verification error:",r),this.showError("verify","An unexpected error occurred. Please try again.")}finally{this.setLoading("verify",!1)}}async handleResendCode(e){e.preventDefault();try{const n=await L.resendSignUpCode(this.pendingEmail);n.success?this.showSuccess("verify","Verification code sent!"):this.showError("verify",n.error)}catch(n){console.error("Resend code error:",n),this.showError("verify","Failed to resend code. Please try again.")}}async handlePasswordReset(e){e.preventDefault();const n=this.modal.querySelector("#reset-email").value;if(!n){this.showError("reset","Please enter your email address");return}this.setLoading("reset",!0),this.clearErrors();try{console.log("Initiating password reset for:",n);const r=await L.resetPassword(n);r.success?(this.pendingEmail=n,this.showSuccess("reset","If an account with this email exists, you will receive a reset code shortly."),setTimeout(()=>{this.switchTab("confirm-reset"),this.modal.querySelector("#confirm-reset-email").textContent=n,this.clearErrors()},2e3)):this.showError("reset",r.error)}catch(r){console.error("Password reset error:",r),this.showError("reset","An unexpected error occurred. Please try again.")}finally{this.setLoading("reset",!1)}}async handleConfirmPasswordReset(e){e.preventDefault();const n=this.modal.querySelector("#reset-code").value,r=this.modal.querySelector("#new-password").value,i=this.modal.querySelector("#confirm-new-password").value;if(!n||n.length!==6){this.showError("confirm-reset","Please enter a valid 6-digit code");return}if(!r){this.showError("confirm-reset","Please enter a new password");return}if(!this.validatePassword(r)){this.showError("confirm-reset","Password does not meet requirements");return}if(r!==i){this.showError("confirm-reset","Passwords do not match");return}this.setLoading("confirm-reset",!0),this.clearErrors();try{console.log("Confirming password reset");const s=await L.confirmResetPassword(this.pendingEmail,n,r);s.success?(this.showSuccess("confirm-reset","Password reset successful! You can now sign in."),setTimeout(()=>{this.switchTab("signin"),this.modal.querySelector("#signin-email").value=this.pendingEmail,this.clearForms()},2e3)):this.showError("confirm-reset",s.error)}catch(s){console.error("Confirm password reset error:",s),this.showError("confirm-reset","An unexpected error occurred. Please try again.")}finally{this.setLoading("confirm-reset",!1)}}async handleGoogleAuth(e){e.preventDefault();try{if(console.log("Starting Google OAuth flow"),await L.isAuthenticated()){console.log("User already authenticated, closing auth modal"),this.hideModal(),this.handleSuccessfulAuth();return}this.setGoogleLoading(e.target,!0),sessionStorage.setItem("redirectAfterAuth",window.location.pathname);const r=await L.signInWithGoogle();r.success?(console.log("Google OAuth initiated successfully"),this.showGoogleLoadingMessage()):(this.showError("signin",r.error||"Google sign-in failed"),this.setGoogleLoading(e.target,!1))}catch(n){console.error("Google OAuth error:",n),this.showError("signin","Google sign-in failed. Please try again."),this.setGoogleLoading(e.target,!1)}}showGoogleLoadingMessage(){const e=document.createElement("div");e.id="google-auth-loading",e.innerHTML=`
      <div class="google-loading-content">
        <div class="spinner-ring large"></div>
        <h3>Redirecting to Google...</h3>
        <p>You'll be redirected back after signing in with Google.</p>
      </div>
    `,e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10002;
      color: white;
      font-family: Arial, sans-serif;
    `;const n=e.querySelector(".google-loading-content");n.style.cssText=`
      text-align: center;
      padding: 2rem;
    `,document.body.appendChild(e)}setGoogleLoading(e,n){if(n){e.disabled=!0,e.style.opacity="0.7";const r=e.innerHTML;e.dataset.originalText=r,e.innerHTML=`
        <div class="spinner-ring small"></div>
        Connecting to Google...
      `}else e.disabled=!1,e.style.opacity="1",e.dataset.originalText&&(e.innerHTML=e.dataset.originalText)}validatePassword(e){return e.length>=8&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\d/.test(e)&&/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e)}setLoading(e,n){const r=this.modal.querySelector(`#${e}-form .auth-submit`),i=r==null?void 0:r.querySelector(".button-text"),s=r==null?void 0:r.querySelector(".loading-spinner");r&&(r.disabled=n),i&&s&&(i.style.display=n?"none":"inline",s.style.display=n?"inline":"none")}showError(e,n){const r=this.modal.querySelector(`#${e}-error`);r&&(r.textContent=n,r.classList.add("show"))}showSuccess(e,n){const r=this.modal.querySelector(".auth-success");r&&r.remove();const i=document.createElement("div");i.className="auth-success show",i.textContent=n;const s=this.modal.querySelector(`#${e}-form`);s&&s.appendChild(i)}clearErrors(){this.modal.querySelectorAll(".auth-error").forEach(r=>{r.classList.remove("show"),r.textContent=""}),this.modal.querySelectorAll(".auth-success").forEach(r=>r.remove())}clearForms(){this.modal.querySelectorAll("form").forEach(r=>r.reset()),this.modal.querySelectorAll(".requirement").forEach(r=>{r.classList.remove("valid","invalid")})}handleSuccessfulAuth(){const e=sessionStorage.getItem("redirectAfterAuth");e?(sessionStorage.removeItem("redirectAfterAuth"),window.location.href=e):window.location.reload()}}const Wy=new Vy;window.showAuthModal=async(t="signin")=>{await Wy.showModal(t)};class Ti{constructor(){try{this.client=yc()}catch{console.warn("AWS Amplify generateClient not available - using mock client"),this.client=this.createMockClient()}this.currentSeason="season_2025"}parseLeagueSettings(e){if(!e||!e.settings)return{};try{return typeof e.settings=="object"?e.settings:JSON.parse(e.settings)}catch(n){return console.warn("Failed to parse league settings JSON:",n),{}}}createMockClient(){const e={data:[],errors:[]},n={create:()=>Promise.resolve({data:{id:"mock_id",leagueId:"mock_league_"+Date.now()}}),list:()=>Promise.resolve(e),update:()=>Promise.resolve({data:{id:"mock_id"}}),delete:()=>Promise.resolve({data:{id:"mock_id"}})};return{models:{League:n,LeagueMember:n,DriverPick:n,LifeEvent:n,UserProfile:n}}}async getUserPicks(e=null,n=null){const r=await L.getCurrentUser();if(!r)throw new Error("Authentication required");const s={userId:{eq:e||r.userId||r.username},seasonId:{eq:this.currentSeason}};return n&&(s.leagueId={eq:n}),(await this.client.models.DriverPick.list({filter:s,authMode:"userPool"})).data||[]}async saveUserPick(e){const n=await L.getCurrentUser();if(!n)throw new Error("Authentication required");const r=n.userId||n.username,i=await this.getCurrentRacePick(e.leagueId);if(i){console.log(`Updating existing pick for race ${e.raceId}: ${i.driverName} → ${e.driverName}`);const s={driverId:e.driverId.toString(),driverName:e.driverName,teamName:e.teamName,raceName:e.raceName||"Unknown Race",submittedAt:new Date().toISOString(),isAutoPick:e.isAutoPick||!1};return await this.client.models.DriverPick.update({id:i.id,...s},{authMode:"userPool"})}else{console.log(`Creating new pick for race ${e.raceId}: ${e.driverName}`);const o={pickId:`pick_${r}_${e.raceId}_${Date.now()}`,userId:r,seasonId:this.currentSeason,raceId:e.raceId,driverId:e.driverId.toString(),driverName:e.driverName,teamName:e.teamName,raceName:e.raceName||"Unknown Race",submittedAt:new Date().toISOString(),pickDeadline:e.pickDeadline||new Date().toISOString(),isAutoPick:e.isAutoPick||!1};return e.leagueId&&(o.leagueId=e.leagueId),await this.client.models.DriverPick.create(o,{authMode:"userPool"})}}async isDriverAlreadyPicked(e,n=null){if(!await L.getCurrentUser())return!1;const i=JSON.parse(localStorage.getItem("nextRaceData")),s=i==null?void 0:i.raceId;return(await this.getUserPicks(null,n)).filter(c=>c.raceId!==s).some(c=>c.driverId===e.toString())}async getCurrentRacePick(e=null){if(!await L.getCurrentUser())return null;const r=JSON.parse(localStorage.getItem("nextRaceData"));if(!(r!=null&&r.raceId))return null;const s=(await this.getUserPicks(null,e)).filter(o=>o.raceId===r.raceId);return s.length===0?null:s.length>1?(console.warn(`Found ${s.length} picks for race ${r.raceId}, cleaning up duplicates...`),(await this.cleanupDuplicatePicksForRace(r.raceId)).mostRecentPick):s[0]}async updateUserPick(e,n){if(!await L.getCurrentUser())throw new Error("Authentication required");return await this.client.models.DriverPick.update({id:e,...n,submittedAt:new Date().toISOString()},{authMode:"userPool"})}async deleteUserPick(e){if(!await L.getCurrentUser())throw new Error("Authentication required");return await this.client.models.DriverPick.delete({id:e},{authMode:"userPool"})}async createLeague(e){try{const n=await L.getCurrentUser();if(!n)throw new Error("Authentication required");const r=n.userId||n.username;if((await this.getUserLeagues()).find(u=>u.name.toLowerCase().trim()===e.name.toLowerCase().trim()))return{success:!1,error:`You already have a league named "${e.name}". Please choose a different name.`};const o=`league_${r}_${Date.now()}`,a={maxMembers:e.maxMembers||50,autoPickEnabled:e.autoPickEnabled!==!1,isPrivate:e.isPrivate!==!1,livesEnabled:e.livesEnabled||!1,maxLives:e.maxLives||1,livesLockDate:e.livesLockDate||null,customRules:e.customRules||""},c=await this.client.models.League.create({leagueId:o,name:e.name,inviteCode:e.inviteCode,ownerId:r,maxMembers:a.maxMembers,season:this.currentSeason,autoPickEnabled:a.autoPickEnabled,isPrivate:a.isPrivate,status:"ACTIVE",settings:JSON.stringify(a),createdAt:new Date().toISOString(),lastActiveAt:new Date().toISOString()},{authMode:"userPool"});if(console.log("League creation response:",c),console.log("League response type:",typeof c),console.log("League response keys:",c?Object.keys(c):"null"),!c)throw new Error("League creation failed - no response from AWS");let l;if(c.data)l=c.data;else if(c.leagueId||c.id)l=c;else throw console.error("Unexpected league response structure:",c),new Error("League creation failed - unexpected response structure");console.log("League created successfully:",l);try{await this.client.models.LeagueMember.create({leagueId:l.leagueId||o,userId:r,joinedAt:new Date().toISOString(),status:"ACTIVE",isOwner:!0,survivedRaces:0,totalPicks:0,autoPickCount:0,remainingLives:a.maxLives,livesUsed:0,maxLives:a.maxLives},{authMode:"userPool"}),console.log("League member created successfully for owner")}catch(u){console.error("Failed to create league member:",u);try{await this.client.models.League.delete({id:l.id},{authMode:"userPool"}),console.log("Cleaned up league after member creation failure")}catch(d){console.error("Failed to cleanup league:",d)}throw new Error("Failed to create league membership - league creation aborted")}return{success:!0,leagueId:l.leagueId||o,leagueName:l.name||e.name,inviteCode:l.inviteCode||e.inviteCode,settings:a,...l}}catch(n){return console.error("Create league error:",n),{success:!1,error:n.message||"Failed to create league"}}}async joinLeague(e){const n=await L.getCurrentUser();if(!n)throw new Error("Authentication required");const r=await this.client.models.League.list({filter:{inviteCode:{eq:e},status:{eq:"ACTIVE"}},authMode:"userPool"});if(!r.data||r.data.length===0)throw new Error("League not found with this invite code");const i=r.data[0],s=n.userId||n.username,o=await this.client.models.LeagueMember.list({filter:{leagueId:{eq:i.leagueId},userId:{eq:s}},authMode:"userPool"});if(o.data&&o.data.length>0)throw new Error("You are already a member of this league");const c=this.parseLeagueSettings(i).maxLives||1;return await this.client.models.LeagueMember.create({leagueId:i.leagueId,userId:s,joinedAt:new Date().toISOString(),status:"ACTIVE",isOwner:!1,survivedRaces:0,totalPicks:0,autoPickCount:0,remainingLives:c,livesUsed:0,maxLives:c},{authMode:"userPool"}),i}async getLeagueByInviteCode(e){if(!await L.getCurrentUser())throw new Error("Authentication required");const r=await this.client.models.League.list({filter:{inviteCode:{eq:e},status:{eq:"ACTIVE"}},authMode:"userPool"});if(!r.data||r.data.length===0)return null;const i=r.data[0],s=await this.getLeagueMembers(i.leagueId);return{...i,memberCount:s.length,season:"2025"}}async getLeague(e){if(!await L.getCurrentUser())throw new Error("Authentication required");const r=await this.client.models.League.list({filter:{leagueId:{eq:e}}},{authMode:"userPool"});return r.data&&r.data.length>0?r.data[0]:null}async getLeagueMembers(e){if(!await L.getCurrentUser())throw new Error("Authentication required");return(await this.client.models.LeagueMember.list({filter:{leagueId:{eq:e}},authMode:"userPool"})).data||[]}async getUserLeagues(){const e=await L.getCurrentUser();if(!e)return[];const n=e.userId||e.username,r=await this.client.models.LeagueMember.list({filter:{userId:{eq:n},status:{eq:"ACTIVE"}},authMode:"userPool"});if(!r.data)return[];const i=[];for(const s of r.data){const o=await this.getLeague(s.leagueId);if(o){const a=await this.getLeagueMembers(s.leagueId);i.push({...o,membershipData:s,members:a,memberCount:a.length})}}return i}transformPickForUI(e){return{driverId:parseInt(e.driverId),raceId:e.raceId,timestamp:e.submittedAt,driverName:e.driverName,teamName:e.teamName,isAutoPick:e.isAutoPick||!1,pickId:e.id}}transformPicksForUI(e){return e.map(n=>this.transformPickForUI(n))}async addTestPreviousRacePick(e,n,r,i,s){const o=await L.getCurrentUser();if(!o)throw new Error("Authentication required");const c={pickId:`pick_${o.userId||o.username}_${i}_${Date.now()}`,userId:o.userId||o.username,seasonId:this.currentSeason,raceId:i,driverId:e.toString(),driverName:n,teamName:r,raceName:s,submittedAt:new Date(Date.now()-7*24*60*60*1e3).toISOString(),pickDeadline:new Date(Date.now()-6*24*60*60*1e3).toISOString(),isAutoPick:!1};return await this.client.models.DriverPick.create(c,{authMode:"userPool"})}async deleteUserPick(e){return await this.client.models.DriverPick.delete({id:e},{authMode:"userPool"})}async cleanupDuplicatePicksForRace(e){if(!await L.getCurrentUser())throw new Error("Authentication required");const i=(await this.getUserPicks()).filter(a=>a.raceId===e);if(i.length<=1)return console.log(`No duplicate picks found for race ${e}`),{duplicatesRemoved:0};i.sort((a,c)=>new Date(c.submittedAt)-new Date(a.submittedAt));const s=i.slice(1);console.log(`Found ${i.length} picks for race ${e}, keeping most recent, deleting ${s.length} duplicates`);const o=s.map(a=>this.client.models.DriverPick.delete({id:a.id},{authMode:"userPool"}));return await Promise.all(o),console.log(`Successfully cleaned up ${s.length} duplicate picks for race ${e}`),{duplicatesRemoved:s.length,mostRecentPick:i[0]}}async cleanupAllDuplicatePicks(){if(!await L.getCurrentUser())throw new Error("Authentication required");console.log("🧹 Starting cleanup of all duplicate picks...");const n=await this.getUserPicks(),r={};n.forEach(o=>{r[o.raceId]||(r[o.raceId]=[]),r[o.raceId].push(o)});let i=0;const s=[];for(const[o,a]of Object.entries(r))if(a.length>1){const c=await this.cleanupDuplicatePicksForRace(o);s.push({raceId:o,...c}),i+=c.duplicatesRemoved}return console.log(`✅ Cleanup complete! Removed ${i} duplicate picks across ${s.length} races`),{totalDuplicatesRemoved:i,racesWithDuplicates:s.length,details:s}}async getUserLeaguesWithCache(){const e=await L.getCurrentUser();if(!e)return[];const n="userLeagues",r=this._getFromCache(n);if(r&&Date.now()-r.timestamp<5*60*1e3)return console.log("Using cached user leagues"),Array.isArray(r.data)?r.data:[];const i=e.userId||e.username;try{const s=await this.client.models.LeagueMember.list({filter:{userId:{eq:i},status:{eq:"ACTIVE"}},authMode:"userPool"});if(!s.data||s.data.length===0)return this._setCache(n,[]),[];const o=s.data.map(async l=>{const u=await this.getLeague(l.leagueId);if(u){const d=await this.getLeagueMembers(l.leagueId);return{...u,membershipData:l,members:d,memberCount:d.length}}return null}),c=(await Promise.all(o)).filter(l=>l!==null);return this._setCache(n,c),console.log(`Loaded ${c.length} leagues with cache optimization`),c}catch(s){return console.error("Failed to load user leagues with cache:",s),[]}}async getMultiLeaguePickHistory(e=null){const n=await L.getCurrentUser();if(!n)return{byLeague:{},total:0};const r=e||n.userId||n.username;try{const i=await this.getUserLeaguesWithCache();if(!Array.isArray(i))return console.warn("getUserLeaguesWithCache did not return an array:",i),{byLeague:{},total:0,soloMode:!0,leagueCount:0};if(i.length===0)return{byLeague:{},total:0,soloMode:!0,leagueCount:0};const s=i.map(d=>this.getUserPicks(r,d.leagueId).then(h=>({leagueId:d.leagueId,leagueName:d.name,picks:h}))),o=this.getUserPicks(r,null),[a,c]=await Promise.all([Promise.all(s),o]),l={};let u=0;for(const d of a)l[d.leagueId]={leagueName:d.leagueName,picks:d.picks,count:d.picks.length},u+=d.picks.length;return c.length>0&&(l.solo={leagueName:"Solo Mode",picks:c,count:c.length},u+=c.length),console.log(`Retrieved ${u} picks across ${Object.keys(l).length} contexts`),{byLeague:l,total:u,leagueCount:i.length,hasMultipleContexts:Object.keys(l).length>1}}catch(i){return console.error("Failed to get multi-league pick history:",i),{byLeague:{},total:0,leagueCount:0,error:i.message}}}async getCrossLeagueStatistics(e=null){const n=await L.getCurrentUser();if(!n)return null;const r=e||n.userId||n.username;try{const i=await this.getMultiLeaguePickHistory(r),s=await this.getUserLeaguesWithCache(),o={totalLeagues:s.length,totalPicks:i.total,leagueBreakdown:{},overallSurvivalRate:0,bestLeaguePerformance:null,recentActivity:[],driverUsage:new Map};for(const[c,l]of Object.entries(i.byLeague)){const u=l.picks,d=new Set(u.map(h=>h.raceId)).size;o.leagueBreakdown[c]={leagueName:l.leagueName,totalPicks:u.length,raceCount:d,autoPickCount:u.filter(h=>h.isAutoPick).length,recentPicks:u.sort((h,f)=>new Date(f.submittedAt)-new Date(h.submittedAt)).slice(0,3)};for(const h of u){const f=o.driverUsage.get(h.driverName)||0;o.driverUsage.set(h.driverName,f+1)}}o.mostUsedDrivers=Array.from(o.driverUsage.entries()).sort((c,l)=>l[1]-c[1]).slice(0,5).map(([c,l])=>({driver:c,count:l}));const a=Object.values(o.leagueBreakdown);return a.length>0&&(o.bestLeaguePerformance=a.reduce((c,l)=>l.raceCount>c.raceCount?l:c)),o.totalPicks>0&&(o.overallSurvivalRate=Math.round(o.totalPicks/Math.max(s.length*10,1)*100)),console.log(`Calculated cross-league statistics for ${o.totalLeagues} leagues, ${o.totalPicks} total picks`),o}catch(i){return console.error("Failed to calculate cross-league statistics:",i),null}}async isDriverAlreadyPickedInAnyLeague(e){if(!await L.getCurrentUser())return!1;try{const r=await this.getUserLeaguesWithCache();if(!Array.isArray(r))return console.warn("getUserLeaguesWithCache did not return an array:",r),await this.isDriverAlreadyPicked(e)?(console.log(`Driver ${e} already picked in solo mode`),{picked:!0,leagueId:null,leagueName:"Solo Mode"}):{picked:!1};for(const s of r)if(await this.isDriverAlreadyPicked(e,s.leagueId))return console.log(`Driver ${e} already picked in league: ${s.name}`),{picked:!0,leagueId:s.leagueId,leagueName:s.name};return await this.isDriverAlreadyPicked(e)?(console.log(`Driver ${e} already picked in solo mode`),{picked:!0,leagueId:null,leagueName:"Solo Mode"}):{picked:!1}}catch(r){return console.error("Failed to check driver across leagues:",r),!1}}async batchGetLeagues(e){const n=e.map(r=>this.getLeague(r));return Promise.all(n)}async batchGetLeagueMembers(e){const n=e.map(s=>this.getLeagueMembers(s)),r=await Promise.all(n),i={};return e.forEach((s,o)=>{i[s]=r[o]}),i}async batchGetRecentPicks(e,n=5){const r=await L.getCurrentUser();if(!r)return{};const i=r.userId||r.username,s=e.map(c=>this.getUserPicks(i,c).then(l=>({leagueId:c,picks:l.sort((u,d)=>new Date(d.submittedAt)-new Date(u.submittedAt)).slice(0,n)}))),o=await Promise.all(s),a={};return o.forEach(c=>{a[c.leagueId]=c.picks}),a}async deleteLeague(e){var r,i;const n=await L.getCurrentUser();if(!n)throw new Error("Authentication required");try{console.log(`🗑️ Starting complete deletion of league: ${e}`);const s=await this.getLeague(e);if(!s)throw new Error("League not found");const o=n.userId||n.username;if(s.ownerId!==o)throw new Error("Only the league owner can delete the league");const a=await this.getLeagueMembers(e);console.log(`📋 Found ${a.length} members to remove`);const c=a.map(d=>this.client.models.LeagueMember.delete({id:d.id},{authMode:"userPool"}));await Promise.all(c),console.log(`✅ Removed ${a.length} league members`);const l=await this.client.models.DriverPick.list({filter:{leagueId:{eq:e}}},{authMode:"userPool"});if(l.data&&l.data.length>0){const d=l.data.map(h=>this.client.models.DriverPick.delete({id:h.id},{authMode:"userPool"}));await Promise.all(d),console.log(`✅ Removed ${l.data.length} league picks`)}const u=await this.client.models.LifeEvent.list({filter:{leagueId:{eq:e}}},{authMode:"userPool"});if(u.data&&u.data.length>0){const d=u.data.map(h=>this.client.models.LifeEvent.delete({id:h.id},{authMode:"userPool"}));await Promise.all(d),console.log(`✅ Removed ${u.data.length} life events`)}return await this.client.models.League.delete({id:s.id},{authMode:"userPool"}),console.log(`✅ League ${e} completely deleted from AWS`),this._clearCache("userLeagues"),{success:!0,message:`League "${s.name}" has been completely deleted`,deletedItems:{members:a.length,picks:((r=l.data)==null?void 0:r.length)||0,lifeEvents:((i=u.data)==null?void 0:i.length)||0}}}catch(s){throw console.error("❌ Failed to delete league:",s),new Error(`Failed to delete league: ${s.message}`)}}_getFromCache(e){const n=localStorage.getItem(`amplify_cache_${e}`);return n?JSON.parse(n):null}_setCache(e,n){const r={data:n,timestamp:Date.now()};localStorage.setItem(`amplify_cache_${e}`,JSON.stringify(r))}_clearCache(e=null){if(e)localStorage.removeItem(`amplify_cache_${e}`);else for(let n=localStorage.length-1;n>=0;n--){const r=localStorage.key(n);r&&r.startsWith("amplify_cache_")&&localStorage.removeItem(r)}}async updateLeagueLivesSettings(e,n){const r=await L.getCurrentUser();if(!r)throw new Error("Authentication required");try{const i=await this.getLeague(e);if(!i)throw new Error("League not found");const s=r.userId||r.username;if(i.ownerId!==s)throw new Error("Only league owners can update lives settings");const{maxLives:o,livesEnabled:a,livesLockDate:c}=n;if(o&&(o<1||o>5))throw new Error("Lives per player must be between 1 and 5");if(c&&new Date>new Date(c))throw new Error("Lives configuration cannot be changed after the lock date");const l=this.parseLeagueSettings(i),u={...l,maxLives:o||l.maxLives||1,livesEnabled:a!==void 0?a:l.livesEnabled||!1,livesLockDate:c||l.livesLockDate,autoPickEnabled:l.autoPickEnabled!==void 0?l.autoPickEnabled:!0,isPrivate:l.isPrivate!==void 0?l.isPrivate:!0},d=await this.updateLeagueSettings(e,{settings:u});return o&&o!==l.maxLives&&await this.updateAllMemberMaxLives(e,o),console.log(`League ${e} lives settings updated successfully`),{success:!0,settings:u}}catch(i){throw console.error("Failed to update league lives settings:",i),i}}async getLeagueLivesConfiguration(e){try{const n=await this.getLeague(e);if(!n)throw new Error("League not found");const r=this.parseLeagueSettings(n);return{maxLives:r.maxLives||1,livesEnabled:r.livesEnabled||!1,livesLockDate:r.livesLockDate,isLocked:r.livesLockDate?new Date>new Date(r.livesLockDate):!1,customRules:r.customRules||""}}catch(n){throw console.error("Failed to get league lives configuration:",n),n}}async updateMemberLives(e,n,r){const i=await L.getCurrentUser();if(!i)throw new Error("Authentication required");try{const s=await this.getLeague(e);if(!s)throw new Error("League not found");const o=i.userId||i.username;if(s.ownerId!==o)throw new Error("Only league owners can manage member lives");const a=await this.client.models.LeagueMember.list({filter:{leagueId:{eq:e},userId:{eq:n}},authMode:"userPool"});if(!a.data||a.data.length===0)throw new Error("Member not found in league");const c=a.data[0],{operation:l,value:u,reason:d}=r;let h=c.remainingLives;switch(l){case"SET":h=Math.max(0,Math.min(u,c.maxLives));break;case"ADD":h=Math.min(c.remainingLives+u,c.maxLives);break;case"SUBTRACT":h=Math.max(0,c.remainingLives-u);break;default:throw new Error("Invalid lives operation")}return await this.client.models.LeagueMember.update({id:c.id,remainingLives:h,livesUsed:c.maxLives-h,status:h===0?"ELIMINATED":"ACTIVE"},{authMode:"userPool"}),await this.createLifeEvent(n,e,"current",h===0?"FINAL_ELIMINATION":"LIFE_RESTORED",h,{adminUserId:o,adminReason:d||"Admin adjustment"}),console.log(`Member ${n} lives updated: ${c.remainingLives} → ${h}`),{success:!0,remainingLives:h}}catch(s){throw console.error("Failed to update member lives:",s),s}}async getMemberLivesStatus(e,n=null){const r=await L.getCurrentUser();if(!r)throw new Error("Authentication required");try{const i=n||r.userId||r.username,s=await this.client.models.LeagueMember.list({filter:{leagueId:{eq:e},userId:{eq:i}},authMode:"userPool"});if(!s.data||s.data.length===0)return null;const o=s.data[0];return{userId:o.userId,remainingLives:o.remainingLives,livesUsed:o.livesUsed,maxLives:o.maxLives,eliminationHistory:o.eliminationHistory||[],status:o.status}}catch(i){throw console.error("Failed to get member lives status:",i),i}}async updateAllMemberMaxLives(e,n){try{const r=await this.getLeagueMembers(e),i=r.map(s=>this.client.models.LeagueMember.update({id:s.id,maxLives:n,remainingLives:Math.min(s.remainingLives,n)},{authMode:"userPool"}));await Promise.all(i),console.log(`Updated maxLives to ${n} for ${r.length} members in league ${e}`)}catch(r){throw console.error("Failed to update member max lives:",r),r}}async createLifeEvent(e,n,r,i,s,o={}){try{const a={userId:e,leagueId:n,raceId:r,eventType:i,livesRemaining:s,eventDate:new Date().toISOString(),...o};await this.client.models.LifeEvent.create(a,{authMode:"userPool"}),console.log(`Life event created: ${i} for user ${e} in league ${n}`)}catch(a){console.error("Failed to create life event:",a)}}async setActiveLeague(e,n={}){const r=await L.getCurrentUser();if(!r)throw new Error("Authentication required");if(e){if(!await this.getLeague(e))throw new Error("League not found");const s=r.userId||r.username;if(n.isNewLeague||!1)await this.validateMembershipWithRetry(e,s,3);else if(!(await this.getLeagueMembers(e)).some(l=>l.userId===s))throw new Error("You are not a member of this league")}try{return await this.ensureUserProfile(r.userId||r.username),await this.client.models.UserProfile.update({userId:r.userId||r.username,activeLeagueId:e},{authMode:"userPool"}),this._clearCache("userLeagues"),console.log(`Active league set to: ${e||"None (Solo Mode)"}`),{success:!0,activeLeagueId:e}}catch(i){throw console.error("Failed to set active league:",i),new Error("Failed to update active league setting")}}async validateMembershipWithRetry(e,n,r=3){for(let i=1;i<=r;i++)try{if((await this.getLeagueMembers(e)).some(a=>a.userId===n))return console.log(`Membership validated for user ${n} in league ${e} on attempt ${i}`),!0;if(i<r){const a=Math.pow(2,i)*500;console.log(`Membership not found on attempt ${i}, retrying in ${a}ms...`),await new Promise(c=>setTimeout(c,a))}}catch(s){if(console.warn(`Membership validation attempt ${i} failed:`,s),i===r)throw s;const o=Math.pow(2,i)*500;await new Promise(a=>setTimeout(a,o))}throw new Error("You are not a member of this league")}async ensureUserProfile(e){try{const n=await this.client.models.UserProfile.list({filter:{userId:{eq:e}},authMode:"userPool"});(!n.data||n.data.length===0)&&(await this.client.models.UserProfile.create({userId:e,activeLeagueId:null,createdAt:new Date().toISOString()},{authMode:"userPool"}),console.log(`Created UserProfile for user ${e}`))}catch(n){console.warn("Failed to ensure UserProfile exists:",n)}}async getActiveLeague(){const e=await L.getCurrentUser();if(!e)return null;try{const n=await this.client.models.UserProfile.list({filter:{userId:{eq:e.userId||e.username}},authMode:"userPool"});if(!n.data||n.data.length===0)return console.log("No user profile found, returning null active league"),null;const r=n.data[0].activeLeagueId;return r?await this.getLeague(r):null}catch(n){return console.error("Failed to get active league:",n),null}}async getActiveLeagueId(){const e=await L.getCurrentUser();if(!e)return null;try{const n=await this.client.models.UserProfile.list({filter:{userId:{eq:e.userId||e.username}},authMode:"userPool"});return!n.data||n.data.length===0?null:n.data[0].activeLeagueId||null}catch(n){return console.error("Failed to get active league ID:",n),null}}async removeUserFromLeague(e,n=null){const r=await L.getCurrentUser();if(!r)throw new Error("Authentication required");const i=r.userId||r.username,s=n||i;try{const o=await this.getLeague(e);if(!o)throw new Error("League not found");if(s!==i&&o.ownerId!==i)throw new Error("Only league owners can remove other members");const a=await this.client.models.LeagueMember.list({filter:{leagueId:{eq:e},userId:{eq:s}},authMode:"userPool"});if(!a.data||a.data.length===0)throw new Error("User is not a member of this league");return await this.client.models.LeagueMember.delete({id:a.data[0].id},{authMode:"userPool"}),s===i&&await this.getActiveLeagueId()===e&&await this.setActiveLeague(null),this._clearCache("userLeagues"),console.log(`User ${s} removed from league ${e}`),{success:!0,removedUserId:s,leagueId:e}}catch(o){throw console.error("Failed to remove user from league:",o),o}}async updateLeagueSettings(e,n){const r=await L.getCurrentUser();if(!r)throw new Error("Authentication required");try{const i=await this.getLeague(e);if(!i)throw new Error("League not found");const s=r.userId||r.username;if(i.ownerId!==s)throw new Error("Only league owners can update league settings");const o={};n.name!==void 0&&(o.name=n.name),n.maxMembers!==void 0&&(o.maxMembers=parseInt(n.maxMembers)),n.autoPickEnabled!==void 0&&(o.autoPickEnabled=n.autoPickEnabled),n.isPrivate!==void 0&&(o.isPrivate=n.isPrivate),n.settings!==void 0&&(o.settings=JSON.stringify(n.settings));const a=await this.client.models.League.list({filter:{leagueId:{eq:e}}},{authMode:"userPool"});if(!a.data||a.data.length===0)throw new Error("League not found for update");const c=await this.client.models.League.update({id:a.data[0].id,...o,lastActiveAt:new Date().toISOString()},{authMode:"userPool"});return console.log(`League ${e} settings updated successfully`),{success:!0,league:c.data}}catch(i){throw console.error("Failed to update league settings:",i),i}}async validateLeagueDataConsistency(e){const n=await L.getCurrentUser();if(!n)throw new Error("Authentication required");try{const r=[],i=await this.getLeague(e);if(!i)return r.push("League not found in database"),{isConsistent:!1,issues:r};const s=await this.getLeagueMembers(e);s.length===0&&r.push("League has no members"),s.some(f=>f.userId===i.ownerId&&f.isOwner===!0)||r.push("League owner is not listed as a member");const a=n.userId||n.username,c=await this.getUserPicks(a,e),u=JSON.parse(localStorage.getItem("nextRaceData")||"{}").raceId;c.length>0&&!u&&r.push("User has picks but no current race data available");const d={};c.forEach(f=>{d[f.raceId]||(d[f.raceId]=[]),d[f.raceId].push(f)}),Object.entries(d).forEach(([f,p])=>{p.length>1&&r.push(`Multiple picks found for race ${f}: ${p.length} picks`)});const h=r.length===0;return console.log(`League ${e} consistency check: ${h?"PASS":"ISSUES FOUND"}`),h||console.warn("Consistency issues:",r),{isConsistent:h,issues:r,league:i,memberCount:s.length,userPickCount:c.length,checkedAt:new Date().toISOString()}}catch(r){return console.error("Failed to validate league data consistency:",r),{isConsistent:!1,issues:[`Validation failed: ${r.message}`],checkedAt:new Date().toISOString()}}}async syncLeagueData(e){const n=await L.getCurrentUser();if(!n)throw new Error("Authentication required");try{this._clearCache("userLeagues"),this._clearCache(`league_${e}`),this._clearCache(`members_${e}`);const r=await this.getLeague(e),i=await this.getLeagueMembers(e),s=n.userId||n.username,o=await this.getUserPicks(s,e);return console.log(`League ${e} data synced successfully`),{success:!0,league:r,memberCount:i.length,userPickCount:o.length,syncedAt:new Date().toISOString()}}catch(r){throw console.error("Failed to sync league data:",r),r}}}const b=new Ti;typeof window<"u"&&(window.AmplifyDataService=Ti,window.amplifyDataService=b);const sv=Object.freeze(Object.defineProperty({__proto__:null,AmplifyDataService:Ti,amplifyDataService:b},Symbol.toStringTag,{value:"Module"}));class Gy{constructor(){console.log("✅ LeagueStorageManager initialized with AWS backend proxy")}async getCurrentUserId(){const e=await at.getCurrentUser();return e?e.userId||e.username:(console.warn("No authenticated user, returning null userId"),null)}async getCurrentUsername(){const e=await at.getCurrentUser();return e?e.displayName||e.username||"Unknown Player":(console.warn("No authenticated user, returning null username"),null)}async setUsername(e){throw console.warn("setUsername() requires UserProfile update implementation"),new Error("Username updates not yet implemented in AWS backend")}async getAllLeagues(){try{const e=await b.getUserLeagues(),n={};return e.forEach(r=>{n[r.leagueId]=r}),n}catch(e){return console.error("Failed to load leagues from AWS:",e),{}}}async getLeague(e){try{return await b.getLeague(e)}catch(n){return console.error(`Failed to load league ${e} from AWS:`,n),null}}async saveLeague(e){try{return e.id?(await b.updateLeagueSettings(e.leagueId,{name:e.name,maxMembers:e.maxMembers,autoPickEnabled:e.autoPickEnabled,isPrivate:e.isPrivate})).success:(await b.createLeague(e)).success}catch(n){return console.error("Failed to save league to AWS:",n),!1}}async getUserLeagueData(){try{const e=await at.getCurrentUser();if(!e)return{userId:null,currentSeason:"season_2025",activeLeagueId:null,leagues:[],createdLeagues:[]};const n=e.userId||e.username,r=await b.getUserLeagues(),i=await b.getActiveLeagueId(),s=r.map(a=>a.leagueId),o=r.filter(a=>a.ownerId===n).map(a=>a.leagueId);return{userId:n,currentSeason:"season_2025",activeLeagueId:i,leagues:s,createdLeagues:o}}catch(e){return console.error("Failed to load user league data from AWS:",e),{userId:null,currentSeason:"season_2025",activeLeagueId:null,leagues:[],createdLeagues:[]}}}async saveUserLeagueData(e){try{return e.activeLeagueId!==void 0&&await b.setActiveLeague(e.activeLeagueId),console.log("User league data operations completed"),!0}catch(n){return console.error("Failed to save user league data to AWS:",n),!1}}async addUserToLeague(e,n=!1){try{return console.log(n?`User is owner of league ${e}, already added during creation`:`User should join league ${e} via joinLeague operation`),!0}catch(r){return console.error("Failed to add user to league:",r),!1}}async removeUserFromLeague(e){try{return await b.removeUserFromLeague(e),!0}catch(n){return console.error("Failed to remove user from league:",n),!1}}async getActiveLeagueId(){try{return await b.getActiveLeagueId()}catch(e){return console.error("Failed to get active league ID from AWS:",e),null}}async setActiveLeagueId(e){try{return(await b.setActiveLeague(e)).success}catch(n){return console.error("Failed to set active league ID in AWS:",n),!1}}async getActiveLeague(){try{return await b.getActiveLeague()}catch(e){return console.error("Failed to get active league from AWS:",e),null}}async saveUserPicksWithLeague(e,n,r=null){if(r)return this.saveLeaguePick(r,e,n);{const i=JSON.parse(localStorage.getItem("nextRaceData"));if(!i||!i.raceId)throw new Error("No valid race data found. Cannot save pick.");const s={raceId:i.raceId,driverId:parseInt(e),driverName:(n==null?void 0:n.driverName)||null,teamName:(n==null?void 0:n.teamName)||null,raceName:i.raceName||"Unknown Race",isAutoPick:(n==null?void 0:n.isAutoPick)||!1},o=await b.saveUserPick(s);return b.transformPickForUI(o.data)}}async saveLeaguePick(e,n,r){try{const i=JSON.parse(localStorage.getItem("nextRaceData"));if(!i||!i.raceId)throw new Error("No valid race data found. Cannot save pick.");const s={leagueId:e,raceId:i.raceId,driverId:parseInt(n),driverName:(r==null?void 0:r.driverName)||null,teamName:(r==null?void 0:r.teamName)||null,raceName:i.raceName||"Unknown Race",isAutoPick:(r==null?void 0:r.isAutoPick)||!1},o=await b.saveUserPick(s);return b.transformPickForUI(o.data)}catch(i){throw console.error("Failed to save league pick to AWS:",i),i}}async loadUserPicksWithLeague(e=null){if(e)return this.loadLeaguePicks(e);try{const n=await b.getUserPicks();return b.transformPicksForUI(n)}catch(n){return console.error("Failed to load user picks from AWS:",n),[]}}async loadLeaguePicks(e,n=null){try{const r=await b.getUserPicks(n,e);return b.transformPicksForUI(r)}catch(r){return console.error(`Failed to load league picks for ${e} from AWS:`,r),[]}}async isDriverAlreadyPickedInLeague(e,n){try{return await b.isDriverAlreadyPicked(e,n)}catch(r){return console.error("Failed to check driver pick status from AWS:",r),!1}}async getCurrentRacePickForLeague(e){try{const n=await b.getCurrentRacePick(e);return n?b.transformPickForUI(n):null}catch(n){return console.error("Failed to get current race pick from AWS:",n),null}}async getUserLeagues(){try{const e=await b.getUserLeagues(),n=await this.getCurrentUserId();return e.map(r=>({...r,isOwner:r.ownerId===n}))}catch(e){return console.error("Failed to get user leagues from AWS:",e),[]}}async findLeagueByInviteCode(e){try{return await b.getLeagueByInviteCode(e.toUpperCase())}catch(n){return console.error("Failed to find league by invite code from AWS:",n),null}}async validateAWSConnection(){try{const e=await at.getCurrentUser();if(!e)return{connected:!1,error:"No authenticated user"};const n=await b.getUserLeagues();return{connected:!0,userId:e.userId||e.username,leagueCount:n.length,timestamp:new Date().toISOString()}}catch(e){return{connected:!1,error:e.message}}}clearDevelopmentLocalStorageData(){try{return["f1survivor_user_leagues","f1survivor_league_data","f1survivor_active_league","f1survivor_user_id","f1survivor_user_name"].forEach(n=>{localStorage.removeItem(n)}),console.log("✅ Development localStorage data cleared (net new app)"),!0}catch(e){return console.error("Failed to clear development localStorage data:",e),!1}}}const vc=new Gy;class zy{constructor(){this.userLeagues=new Map,this.activeLeagueId=null,this.leagueCache=new Map,this.memberCache=new Map,this.pickCache=new Map,this.cacheTimeout=5*60*1e3,this.lastLoadTime=0,this.loadingPromise=null,this.eventListeners=new Set}async loadUserLeagues(e=!1){if(this.loadingPromise&&!e)return this.loadingPromise;if(!e&&this.isCacheValid())return console.log("Using cached league data"),Array.from(this.userLeagues.values());console.log("Loading user leagues from AWS..."),this.loadingPromise=this._performLeagueLoad();try{const n=await this.loadingPromise;return this.lastLoadTime=Date.now(),n}finally{this.loadingPromise=null}}async _performLeagueLoad(){if(!await L.getCurrentUser())return console.log("No authenticated user, clearing league context"),this.clearContext(),[];try{const n=await b.getUserLeagues(),r=new Map(this.userLeagues),i=this.userLeagues.size;if(console.log(`Loaded ${n.length} leagues for user (previously had ${i})`),n.length>0||i===0){this.userLeagues.clear();for(const s of n)this.userLeagues.set(s.leagueId,{...s,lastAccessed:Date.now(),memberCount:s.memberCount||0});!this.activeLeagueId&&n.length>0&&this.setActiveLeague(n[0].leagueId)}else return console.warn("AWS returned 0 leagues but we had leagues before. Keeping current context due to likely eventual consistency delay."),Array.from(r.values());return n}catch(n){return console.error("Failed to load user leagues:",n),console.warn("Preserving local league context due to AWS error"),Array.from(this.userLeagues.values())}}isCacheValid(){return this.userLeagues.size>0&&this.lastLoadTime>0&&Date.now()-this.lastLoadTime<this.cacheTimeout}getMultiLeagueContext(){const e=Array.from(this.userLeagues.keys()),n=this.activeLeagueId?this.userLeagues.get(this.activeLeagueId):null;return{userLeagues:e,activeLeague:this.activeLeagueId,activeLeagueData:n,leagueCount:this.userLeagues.size,soloMode:this.userLeagues.size===0,isMultiLeague:this.userLeagues.size>1,hasLeagues:this.userLeagues.size>0}}getActiveLeagueContext(){if(!this.activeLeagueId)return{isLeagueMode:!1,leagueId:null,league:null,soloMode:!0};const e=this.userLeagues.get(this.activeLeagueId);return{isLeagueMode:!0,leagueId:this.activeLeagueId,league:e,soloMode:!1}}getAllLeaguesContext(){const e=Array.from(this.userLeagues.values());return{leagues:e,count:e.length,activeLeagueId:this.activeLeagueId}}setActiveLeague(e){if(!e){this.activeLeagueId=null,this.notifyLeagueChange(null);return}if(this.userLeagues.has(e)){const n=this.activeLeagueId;this.activeLeagueId=e;const r=this.userLeagues.get(e);return r&&(r.lastAccessed=Date.now()),console.log(`Switched to league: ${e}`),this.notifyLeagueChange(e,n),!0}else return console.warn(`⚠️ League ${e} not found in user leagues (Available leagues: ${Array.from(this.userLeagues.keys()).join(", ")||"none"})`),!1}addLeague(e){this.userLeagues.set(e.leagueId,{...e,lastAccessed:Date.now(),memberCount:e.memberCount||1}),this.userLeagues.size===1&&this.setActiveLeague(e.leagueId),console.log(`Added league to context: ${e.name}`)}removeLeague(e){if(this.userLeagues.has(e)){if(this.userLeagues.delete(e),this.memberCache.delete(e),this.pickCache.delete(e),this.activeLeagueId===e){const n=Array.from(this.userLeagues.keys());n.length>0?this.setActiveLeague(n[0]):this.setActiveLeague(null)}console.log(`Removed league from context: ${e}`)}}async getLeagueMembers(e,n=!0){const r=`members_${e}`;if(n&&this.memberCache.has(r)){const i=this.memberCache.get(r);if(Date.now()-i.timestamp<this.cacheTimeout)return i.data}try{const i=await b.getLeagueMembers(e);this.memberCache.set(r,{data:i,timestamp:Date.now()});const s=this.userLeagues.get(e);return s&&(s.memberCount=i.length),i}catch(i){return console.error(`Failed to load members for league ${e}:`,i),[]}}async getLeaguePicks(e,n=null,r=!0){const i=`picks_${e}_${n||"all"}`;if(r&&this.pickCache.has(i)){const s=this.pickCache.get(i);if(Date.now()-s.timestamp<this.cacheTimeout)return s.data}try{const s=await b.getUserPicks(n,e);return this.pickCache.set(i,{data:s,timestamp:Date.now()}),s}catch(s){return console.error(`Failed to load picks for league ${e}:`,s),[]}}clearCache(e=null,n=null){if(e==="members"&&n)this.memberCache.delete(`members_${n}`);else if(e==="picks"&&n)for(const r of this.pickCache.keys())r.startsWith(`picks_${n}_`)&&this.pickCache.delete(r);else e==="all"?(this.memberCache.clear(),this.pickCache.clear(),this.leagueCache.clear()):this.clearExpiredCaches()}clearExpiredCaches(){const e=Date.now();for(const[n,r]of this.memberCache.entries())e-r.timestamp>this.cacheTimeout&&this.memberCache.delete(n);for(const[n,r]of this.pickCache.entries())e-r.timestamp>this.cacheTimeout&&this.pickCache.delete(n)}clearContext(){this.userLeagues.clear(),this.activeLeagueId=null,this.clearCache("all"),this.lastLoadTime=0,console.log("League context cleared")}async refreshLeagues(){return console.log("Refreshing league data..."),this.clearCache("all"),this.loadUserLeagues(!0)}addLeagueChangeListener(e){this.eventListeners.add(e)}removeLeagueChangeListener(e){this.eventListeners.delete(e)}notifyLeagueChange(e,n=null){const r=this.getActiveLeagueContext();for(const i of this.eventListeners)try{i({type:"league-change",newLeagueId:e,previousLeagueId:n,context:r,timestamp:Date.now()})}catch(s){console.error("Error in league change listener:",s)}}getLeague(e){return this.userLeagues.get(e)||null}isInLeague(e){return this.userLeagues.has(e)}getLeagueStats(){const e=Array.from(this.userLeagues.values());return{totalLeagues:e.length,activeLeague:this.activeLeagueId,recentlyAccessed:e.sort((n,r)=>r.lastAccessed-n.lastAccessed).slice(0,3).map(n=>({leagueId:n.leagueId,name:n.name}))}}}const He=new zy;async function Jy(){try{return await b.getActiveLeagueId()}catch(t){return console.error("Error getting active league ID from AWS:",t),null}}class Ec{constructor(){this.currentSeason="2025"}async getCurrentUser(){const e=await L.getCurrentUser();if(!e)throw new Error("Authentication required for league operations");return e}async createLeague(e,n={}){if(!e||e.trim().length===0)throw new Error("League name cannot be empty");if(e.trim().length>50)throw new Error("League name cannot exceed 50 characters");await this.getCurrentUser();const r=this.generateInviteCode(),i={name:e.trim(),inviteCode:r,maxMembers:n.maxMembers||20,isPrivate:n.isPrivate!==!1,autoPickEnabled:n.autoPickEnabled!==!1};return await b.createLeague(i)}async joinLeague(e){if(!e||e.trim().length===0)throw new Error("Invalid invite code");return await this.getCurrentUser(),await b.joinLeague(e.trim())}async leaveLeague(e){try{return await b.removeUserFromLeague(e),!0}catch(n){throw console.error("Failed to leave league:",n),n}}async deleteLeague(e){await this.getCurrentUser();const n=await b.deleteLeague(e);return console.log("✅ League deletion completed:",n),n}async kickMember(e,n){const r=await this.getCurrentUser(),i=await b.getLeague(e);if(!i)throw new Error("League not found");const s=r.userId||r.username;if(i.ownerId!==s)throw new Error("Only the league owner can kick members");if(n===s)throw new Error("Cannot kick yourself from the league");try{return await b.removeUserFromLeague(e,n),!0}catch(o){throw console.error("Failed to kick member:",o),o}}async updateLeagueSettings(e,n){const r=await this.getCurrentUser(),i=await b.getLeague(e);if(!i)throw new Error("League not found");const s=r.userId||r.username;if(i.ownerId!==s)throw new Error("Only the league owner can update settings");const o=await b.getLeagueMembers(e);if(n.maxMembers&&n.maxMembers<o.length)throw new Error("Cannot set max members below current member count");if(n.livesEnabled!==void 0||n.maxLives!==void 0){if(n.maxLives&&(n.maxLives<1||n.maxLives>5))throw new Error("Lives per player must be between 1 and 5");const c=b.parseLeagueSettings(i);if(c.livesLockDate&&new Date>new Date(c.livesLockDate))throw new Error("Lives configuration cannot be changed after the season has started");if(n.livesEnabled!==void 0||n.maxLives!==void 0){const u={livesEnabled:n.livesEnabled,maxLives:n.maxLives,livesLockDate:n.livesLockDate},d=await b.updateLeagueLivesSettings(e,u),h={...n};return delete h.livesEnabled,delete h.maxLives,delete h.livesLockDate,Object.keys(h).length>0&&await b.updateLeagueSettings(e,h),d}}return(await b.updateLeagueSettings(e,n)).league}async getLeagueStandings(e){if(!await b.getLeague(e))throw new Error("League not found");const r=await b.getLeagueMembers(e),i=await Promise.all(r.map(async s=>{const o=await b.getUserPicks(s.userId,e),a=o.length;return{userId:s.userId,username:s.userId,survivedRaces:a,totalPicks:o.length,lastPick:o[o.length-1]||null,isEliminated:!1,isOwner:s.isOwner}}));return i.sort((s,o)=>o.survivedRaces-s.survivedRaces),i}generateLeagueId(){return`league_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateInviteCode(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let n="";for(let r=0;r<8;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}async getActiveLeague(){const e=await Jy();if(!e)return null;try{return await b.getLeague(e)}catch(n){return console.error("Error getting active league:",n),null}}async setActiveLeague(e,n=!1){try{return await b.setActiveLeague(e,{isNewLeague:n}),wc(e),!0}catch(r){return console.error("Error setting active league:",r),!1}}async getUserLeagues(){try{return await b.getUserLeagues()}catch(e){return console.error("Error getting user leagues:",e),[]}}async isLeagueOwner(e){try{const n=await this.getCurrentUser(),r=await b.getLeague(e);return r&&r.ownerId===(n.userId||n.username)}catch(n){return console.error("Error checking league ownership:",n),!1}}async getLeague(e){try{return await b.getLeague(e)}catch(n){return console.error("Error getting league:",n),null}}async previewLeague(e){try{if(!e||e.trim().length===0)return null;const n=await b.getLeagueByInviteCode(e.trim());return n?{name:n.name,leagueName:n.name,memberCount:n.memberCount||0,maxMembers:n.maxMembers||20,season:n.season||"2025",createdAt:n.createdAt}:null}catch(n){return console.error("Error previewing league:",n),null}}}const at=new Ec;typeof window<"u"&&(window.LeagueManager=Ec,window.leagueManager=at);async function Yy(){if(!await L.getCurrentUser())return console.log("No authenticated user, initializing empty multi-league context"),He;try{return await He.loadUserLeagues(),console.log("Multi-league system initialized successfully"),He}catch(e){return console.error("Failed to initialize multi-league system:",e),He}}function Ft(){return He.getMultiLeagueContext()}function wc(t){return He.setActiveLeague(t)?(Ci(),!0):!1}async function Qy(t,e,n=null){if(!await L.getCurrentUser())throw new Error("Authentication required to save picks");const i=Ft();let s=n;if(!s&&i.hasLeagues&&(s=i.activeLeague,!s))throw new Error("No active league selected. Please select a league or specify targetLeagueId.");if(console.log(`Saving pick to ${s?`league: ${s}`:"solo mode"}`),s)return vc.saveLeaguePick(s,t,e);{const o=JSON.parse(localStorage.getItem("nextRaceData"));if(!o||!o.raceId)throw new Error("No valid race data found. Cannot save pick.");const a={raceId:o.raceId,driverId:parseInt(t),driverName:(e==null?void 0:e.driverName)||null,teamName:(e==null?void 0:e.teamName)||null,raceName:o.raceName||"Unknown Race",isAutoPick:(e==null?void 0:e.isAutoPick)||!1},c=await b.saveUserPick(a);return He.clearCache("picks",s),c}}async function Xy(t=null){if(!await L.getCurrentUser())return console.log("No authenticated user, returning empty picks"),[];const n=Ft();let r=t;if(!r&&n.hasLeagues&&(r=n.activeLeague),console.log(`Loading picks from ${r?`league: ${r}`:"solo mode"}`),r){const i=await He.getLeaguePicks(r);return b.transformPicksForUI(i)}else{const i=await b.getUserPicks();return b.transformPicksForUI(i)}}async function ov(t,e=null){if(!await L.getCurrentUser())return!1;const r=Ft();let i=e;return!i&&r.hasLeagues&&(i=r.activeLeague),i?b.isDriverAlreadyPicked(t,i):b.isDriverAlreadyPicked(t)}async function av(t=null){if(!await L.getCurrentUser())return null;const n=Ft();let r=t;return!r&&n.hasLeagues&&(r=n.activeLeague),r?vc.getCurrentRacePickForLeague(r):b.getCurrentRacePick()}function Ci(){const t=Ft();if(document.querySelectorAll(".league-indicator").forEach(n=>n.remove()),t.hasLeagues){const n=t.activeLeagueData,r=t.isMultiLeague?`${(n==null?void 0:n.name)||"Unknown League"} (${t.leagueCount} leagues)`:(n==null?void 0:n.name)||"Unknown League",i=document.querySelector("#driver-selection-screen .modal-header");if(i){const o=document.createElement("div");o.className="league-indicator",o.innerHTML=`
        <span class="indicator-label">League:</span>
        <span class="indicator-value">${r}</span>
      `,i.appendChild(o)}const s=document.querySelector(".hero-section");if(s){const o=document.createElement("div");o.className="league-indicator main-page",o.innerHTML=`
        <span>Playing in: <strong>${r}</strong></span>
      `,s.appendChild(o)}}else{const n=document.querySelector(".hero-section");if(n){const r=document.createElement("div");r.className="league-indicator main-page solo-mode",r.innerHTML=`
        <span>Mode: <strong>Solo</strong></span>
      `,n.appendChild(r)}}}async function Zy(){try{await He.refreshLeagues(),Ci(),console.log("League data refreshed successfully")}catch(t){throw console.error("Failed to refresh league data:",t),t}}async function Io(){var t;try{await Yy(),Ci();const e=Ft();e.hasLeagues?console.log(`Multi-league mode active: ${e.leagueCount} leagues, active: ${((t=e.activeLeagueData)==null?void 0:t.name)||"None"}`):console.log("Solo mode active")}catch(e){console.error("Failed to initialize league integration:",e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Io):Io();class Sc{constructor(){this.activeModal=null;try{this.leagueManager=at}catch{this.leagueManager=this.createMockLeagueManager()}}createMockLeagueManager(){return console.warn("leagueManager not available - using mock"),{createLeague:()=>Promise.resolve({success:!1,error:"Mock leagueManager"}),joinLeague:()=>Promise.resolve({leagueName:"Mock League"}),getUserLeagues:()=>[],getLeague:()=>null,isLeagueOwner:()=>!1,previewLeague:()=>Promise.resolve(null),setActiveLeague:()=>{},currentUserId:"mock_user"}}getRefreshLeagueData(){try{return Zy}catch{return console.warn("refreshLeagueData not available - using mock"),()=>Promise.resolve()}}showCreateLeagueModal(){this.closeActiveModal(),document.body.insertAdjacentHTML("beforeend",`
      <div id="league-modal" class="league-modal">
        <div class="league-modal-content">
          <button class="close-btn">&times;</button>
          <h3>Create New League</h3>
          
          <form id="create-league-form">
            <div class="form-group">
              <label for="league-name">League Name</label>
              <input type="text" id="league-name" maxlength="50" required>
              <small>Choose a memorable name for your league</small>
            </div>
            
            <div class="form-group">
              <label for="max-members">Max Members</label>
              <select id="max-members">
                <option value="10">10 Players</option>
                <option value="15">15 Players</option>
                <option value="20" selected>20 Players</option>
                <option value="30">30 Players</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="auto-pick-enabled" checked>
                Enable auto-pick for missed deadlines
              </label>
            </div>
            
            <div class="form-group lives-configuration">
              <h4>Lives Configuration</h4>
              
              <div class="form-row">
                <label>
                  <input type="checkbox" id="lives-enabled" />
                  Enable Multiple Lives System
                </label>
              </div>
              
              <div id="lives-options" class="lives-options" style="display: none;">
                <div class="form-row">
                  <label for="max-lives">Lives per Player</label>
                  <select id="max-lives">
                    <option value="1">1 Life (Classic)</option>
                    <option value="2">2 Lives</option>
                    <option value="3" selected>3 Lives</option>
                    <option value="4">4 Lives</option>
                    <option value="5">5 Lives (Maximum)</option>
                  </select>
                </div>
                
                <div class="lives-explanation">
                  <p>Players will be eliminated when they lose all their lives. Lives are lost when picked drivers finish outside the top 10.</p>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" id="cancel-create">Cancel</button>
              <button type="submit" id="create-league-btn">Create League</button>
            </div>
          </form>
        </div>
      </div>
    `),this.activeModal=document.getElementById("league-modal"),this.attachCreateLeagueEvents()}showJoinLeagueModal(){this.closeActiveModal(),document.body.insertAdjacentHTML("beforeend",`
      <div id="league-modal" class="league-modal">
        <div class="league-modal-content">
          <button class="close-btn">&times;</button>
          <h3>Join League</h3>
          
          <form id="join-league-form">
            <div class="form-group">
              <label for="invite-code">Invite Code</label>
              <input type="text" id="invite-code" placeholder="Enter 8-character code" maxlength="8" required>
              <small>Ask your league organizer for the invite code</small>
            </div>
            
            <div id="league-preview" class="league-preview" style="display: none;">
              <h4>League Preview</h4>
              <div class="preview-info">
                <p><strong>Name:</strong> <span id="preview-name"></span></p>
                <p><strong>Members:</strong> <span id="preview-members"></span></p>
                <p><strong>Season:</strong> <span id="preview-season"></span></p>
              </div>
            </div>
            
            <div id="join-error" class="error-message" style="display: none;"></div>
            
            <div class="form-actions">
              <button type="button" id="cancel-join">Cancel</button>
              <button type="submit" id="join-league-btn">Join League</button>
            </div>
          </form>
        </div>
      </div>
    `),this.activeModal=document.getElementById("league-modal"),this.attachJoinLeagueEvents()}async showManageLeaguesModal(){this.closeActiveModal();const e=await this.leagueManager.getUserLeagues(),n=`
      <div id="league-modal" class="league-modal">
        <div class="league-modal-content large">
          <button class="close-btn">&times;</button>
          <h3>Manage Leagues</h3>
          
          <div class="league-actions">
            <button id="create-league-action" class="action-btn create">
              <span class="icon">+</span>
              Create New League
            </button>
            <button id="join-league-action" class="action-btn join">
              <span class="icon">🔗</span>
              Join League
            </button>
          </div>
          
          <div class="user-leagues">
            <h4>Your Leagues</h4>
            <div class="leagues-list">
              ${e.length===0?`<p class="no-leagues">You haven't joined any leagues yet.</p>`:e.map(r=>{var i,s,o,a,c,l,u,d,h,f,p,g,m,v,E,I,S,w,A,P;return`
                  <div class="league-item" data-league-id="${r.leagueId}">
                    <div class="league-info">
                      <h5>${this.escapeHtml(r.name)}</h5>
                      <p>${r.members?r.members.length:0} members • ${(i=r.membershipData)!=null&&i.isOwner||r.ownerId===(((o=(s=window.authManager)==null?void 0:s.currentUser)==null?void 0:o.userId)||((c=(a=window.authManager)==null?void 0:a.currentUser)==null?void 0:c.username))?"Owner":"Member"}</p>
                      ${(l=r.membershipData)!=null&&l.isOwner||r.ownerId===(((d=(u=window.authManager)==null?void 0:u.currentUser)==null?void 0:d.userId)||((f=(h=window.authManager)==null?void 0:h.currentUser)==null?void 0:f.username))?`<p class="invite-code">Invite Code: <strong>${r.inviteCode}</strong></p>`:""}
                    </div>
                    <div class="league-actions-item">
                      <button class="select-league" data-league-id="${r.leagueId}">Select</button>
                      ${(p=r.membershipData)!=null&&p.isOwner||r.ownerId===(((m=(g=window.authManager)==null?void 0:g.currentUser)==null?void 0:m.userId)||((E=(v=window.authManager)==null?void 0:v.currentUser)==null?void 0:E.username))?`<button class="manage-league" data-league-id="${r.leagueId}">Settings</button>`:""}
                      <button class="leave-league" data-league-id="${r.leagueId}">${(I=r.membershipData)!=null&&I.isOwner||r.ownerId===(((w=(S=window.authManager)==null?void 0:S.currentUser)==null?void 0:w.userId)||((P=(A=window.authManager)==null?void 0:A.currentUser)==null?void 0:P.username))?"Delete":"Leave"}</button>
                    </div>
                  </div>
                `}).join("")}
            </div>
          </div>
        </div>
      </div>
    `;document.body.insertAdjacentHTML("beforeend",n),this.activeModal=document.getElementById("league-modal"),this.attachManageLeaguesEvents()}async showLeagueSettingsModal(e){this.closeActiveModal();const n=await this.leagueManager.getLeague(e),r=await authManager.getCurrentUser(),i=(r==null?void 0:r.userId)||(r==null?void 0:r.username);if(!n||n.ownerId!==i){this.showError("You do not have permission to manage this league.");return}const s=await amplifyDataService.getLeagueMembers(e);n.members=s;const o=amplifyDataService.parseLeagueSettings(n),a=`
      <div id="league-modal" class="league-modal">
        <div class="league-modal-content">
          <button class="close-btn">&times;</button>
          <h3>League Settings: ${this.escapeHtml(n.name)}</h3>
          
          <div class="league-info-section">
            <p><strong>Invite Code:</strong> <span class="invite-code-display">${n.inviteCode}</span></p>
            <button class="copy-invite-code" data-code="${n.inviteCode}">Copy Code</button>
          </div>
          
          <form id="league-settings-form">
            <div class="form-group">
              <label for="max-members-setting">Max Members</label>
              <select id="max-members-setting">
                <option value="10" ${o.maxMembers===10?"selected":""}>10 Players</option>
                <option value="15" ${o.maxMembers===15?"selected":""}>15 Players</option>
                <option value="20" ${o.maxMembers===20?"selected":""}>20 Players</option>
                <option value="30" ${o.maxMembers===30?"selected":""}>30 Players</option>
              </select>
              <small>Current members: ${n.members.length}</small>
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="auto-pick-enabled-setting" ${o.autoPickEnabled?"checked":""}>
                Enable auto-pick for missed deadlines
              </label>
            </div>
            
            <div class="form-group lives-settings">
              <h4>Lives System</h4>
              
              <div class="current-lives-status">
                <p><strong>Current Setting:</strong> <span id="current-lives-display">${(o==null?void 0:o.maxLives)||1} Lives per Player</span></p>
                <p class="lives-lock-info" id="lives-lock-info">${o!=null&&o.livesLockDate?"Lives settings are locked for this season":"Lives can be configured until season starts"}</p>
              </div>
              
              <div id="lives-modification" class="lives-modification" ${o!=null&&o.livesLockDate&&new Date>new Date(o.livesLockDate)?'style="display: none;"':""}>
                <div class="form-row">
                  <label>
                    <input type="checkbox" id="lives-enabled-setting" ${o!=null&&o.livesEnabled?"checked":""}>
                    Enable Multiple Lives System
                  </label>
                </div>
                
                <div id="lives-options-setting" class="lives-options" ${o!=null&&o.livesEnabled?"":'style="display: none;"'}>
                  <div class="form-row">
                    <label for="max-lives-setting">Lives per Player</label>
                    <select id="max-lives-setting">
                      <option value="1" ${(o==null?void 0:o.maxLives)===1?"selected":""}>1 Life (Classic)</option>
                      <option value="2" ${(o==null?void 0:o.maxLives)===2?"selected":""}>2 Lives</option>
                      <option value="3" ${(o==null?void 0:o.maxLives)===3?"selected":""}>3 Lives</option>
                      <option value="4" ${(o==null?void 0:o.maxLives)===4?"selected":""}>4 Lives</option>
                      <option value="5" ${(o==null?void 0:o.maxLives)===5?"selected":""}>5 Lives (Maximum)</option>
                    </select>
                    <small>Changes affect all current and future members</small>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="button" id="cancel-settings">Cancel</button>
              <button type="submit" id="save-settings-btn">Save Settings</button>
            </div>
          </form>
          
          <div class="members-section">
            <h4>Member Management</h4>
            <div class="members-list enhanced">
              ${n.members.map(c=>{var l;return`
                <div class="member-item enhanced" data-user-id="${c.userId}">
                  <div class="member-info">
                    <span class="member-name">${this.escapeHtml(c.username)} ${c.isOwner?"(Owner)":""}</span>
                    <div class="member-stats">
                      <span class="member-picks">${c.totalPicks||0} picks</span>
                      <span class="member-status status-${((l=c.status)==null?void 0:l.toLowerCase())||"active"}">${c.status||"Active"}</span>
                    </div>
                    <div class="member-lives" data-league-id="${e}" data-user-id="${c.userId}">
                      <span class="lives-label">Lives:</span>
                      <div class="lives-display">
                        ${this.generateLivesDisplay(c.remainingLives||(o==null?void 0:o.maxLives)||1,c.maxLives||(o==null?void 0:o.maxLives)||1)}
                      </div>
                      <span class="lives-count">${c.remainingLives||(o==null?void 0:o.maxLives)||1}/${c.maxLives||(o==null?void 0:o.maxLives)||1}</span>
                    </div>
                  </div>
                  <div class="member-actions">
                    ${o!=null&&o.livesEnabled&&!c.isOwner?`
                      <div class="lives-controls">
                        <button class="lives-btn subtract" data-action="subtract" data-user-id="${c.userId}" title="Remove Life">-</button>
                        <button class="lives-btn add" data-action="add" data-user-id="${c.userId}" title="Add Life">+</button>
                        <button class="lives-btn reset" data-action="reset" data-user-id="${c.userId}" title="Reset Lives">↻</button>
                      </div>
                    `:""}
                    ${!c.isOwner&&c.userId!==this.leagueManager.currentUserId?`<button class="kick-member" data-user-id="${c.userId}">Remove</button>`:""}
                  </div>
                </div>
              `}).join("")}
            </div>
            
            ${o!=null&&o.livesEnabled?`
              <div class="bulk-actions">
                <h5>Bulk Actions</h5>
                <div class="bulk-controls">
                  <button class="bulk-btn" data-action="reset-all-lives">Reset All Lives</button>
                  <button class="bulk-btn" data-action="eliminate-inactive">Eliminate Inactive</button>
                </div>
              </div>
              
              <div class="audit-trail-section">
                <h5>Lives Audit Trail</h5>
                <div class="audit-trail-controls">
                  <button class="audit-btn" id="view-audit-trail">View Recent Activity</button>
                  <button class="audit-btn" id="export-audit-trail">Export Full History</button>
                </div>
                <div class="audit-trail-container" id="audit-trail-display" style="display: none;">
                  <div class="audit-loading">Loading audit trail...</div>
                </div>
              </div>
            `:""}
          </div>
        </div>
      </div>
    `;document.body.insertAdjacentHTML("beforeend",a),this.activeModal=document.getElementById("league-modal"),this.attachLeagueSettingsEvents(e)}attachCreateLeagueEvents(){const e=this.activeModal,n=e.querySelector("#create-league-form"),r=e.querySelector(".close-btn"),i=e.querySelector("#cancel-create");r.addEventListener("click",()=>this.closeActiveModal()),i.addEventListener("click",()=>this.closeActiveModal());const s=e.querySelector("#lives-enabled"),o=e.querySelector("#lives-options");s.addEventListener("change",a=>{o.style.display=a.target.checked?"block":"none"}),n.addEventListener("submit",async a=>{a.preventDefault();const c=document.getElementById("league-name").value,l=parseInt(document.getElementById("max-members").value),u=document.getElementById("auto-pick-enabled").checked,d=document.getElementById("lives-enabled").checked,h=d?parseInt(document.getElementById("max-lives").value):1,f=n.querySelector('button[type="submit"]'),p=f.textContent;f.disabled=!0,f.textContent="Creating League...",f.style.opacity="0.7";try{const g=await this.leagueManager.createLeague(c,{maxMembers:l,autoPickEnabled:u,livesEnabled:d,maxLives:h});if(!g.success)throw new Error(g.error||"Failed to create league");this.showLeagueCreatedSuccessModal(g.name,g.inviteCode),window.multiLeagueContext&&window.multiLeagueContext.addLeague({leagueId:g.leagueId,name:g.name,inviteCode:g.inviteCode,memberCount:1,isOwner:!0,status:"ACTIVE",ownerId:g.ownerId,season:g.season,maxMembers:g.maxMembers,isPrivate:g.isPrivate,autoPickEnabled:g.autoPickEnabled}),this.leagueManager.setActiveLeague(g.leagueId,!0),window.leagueSelector&&typeof window.leagueSelector.refreshAndRender=="function"&&await window.leagueSelector.refreshAndRender(),setTimeout(async()=>{try{const m=window.multiLeagueContext?window.multiLeagueContext.userLeagues.size:0;m>0&&(await this.getRefreshLeagueData()(),(window.multiLeagueContext?window.multiLeagueContext.userLeagues.size:0)>=m?window.leagueSelector&&typeof window.leagueSelector.refreshAndRender=="function"&&await window.leagueSelector.refreshAndRender():console.warn("AWS returned fewer leagues than expected, keeping local context"))}catch(m){console.warn("Failed to refresh league data from AWS:",m)}},3e3)}catch(g){this.showError(g.message),f.disabled=!1,f.textContent=p,f.style.opacity="1"}})}attachJoinLeagueEvents(){const e=this.activeModal,n=e.querySelector("#join-league-form"),r=e.querySelector(".close-btn"),i=e.querySelector("#cancel-join"),s=e.querySelector("#invite-code"),o=e.querySelector("#league-preview"),a=e.querySelector("#join-error");r.addEventListener("click",()=>this.closeActiveModal()),i.addEventListener("click",()=>this.closeActiveModal());let c;s.addEventListener("input",l=>{clearTimeout(c);const u=l.target.value.trim();u.length===8?c=setTimeout(async()=>{try{const d=await this.leagueManager.previewLeague(u);d?(e.querySelector("#preview-name").textContent=d.name,e.querySelector("#preview-members").textContent=`${d.memberCount||0}/${d.maxMembers||"N/A"}`,e.querySelector("#preview-season").textContent=d.season||"2025",o.style.display="block",a.style.display="none"):o.style.display="none"}catch(d){console.error("Error previewing league:",d),o.style.display="none"}},300):o.style.display="none"}),n.addEventListener("submit",async l=>{l.preventDefault();const u=s.value.trim();try{const d=await this.leagueManager.joinLeague(u);if(this.showSuccessModal("Joined League!",`You have successfully joined "${d.name}".`),window.multiLeagueContext&&window.multiLeagueContext.addLeague){console.log(`🔄 Adding joined league to local context: ${d.name}`);let f=1;try{f=(await amplifyDataService.getLeagueMembers(d.leagueId)).length}catch(p){console.warn("Could not get member count for joined league, using default:",p)}window.multiLeagueContext.addLeague({leagueId:d.leagueId,name:d.name,inviteCode:d.inviteCode,memberCount:f,isOwner:!1,status:"ACTIVE",ownerId:d.ownerId,season:d.season,maxMembers:d.maxMembers,isPrivate:d.isPrivate,autoPickEnabled:d.autoPickEnabled})}const h=this.leagueManager.setActiveLeague(d.leagueId);h?console.log(`✅ Successfully set joined league as active: ${d.name}`):console.warn("⚠️ Failed to set joined league as active, will retry after refresh"),await this.getRefreshLeagueData()(),window.leagueSelector&&typeof window.leagueSelector.refreshAndRender=="function"&&await window.leagueSelector.refreshAndRender(),h||setTimeout(()=>{this.leagueManager.setActiveLeague(d.leagueId)},500),setTimeout(()=>{this.closeActiveModal()},2e3)}catch(d){a.textContent=d.message,a.style.display="block"}})}attachManageLeaguesEvents(){const e=this.activeModal,n=e.querySelector(".close-btn"),r=e.querySelector("#create-league-action"),i=e.querySelector("#join-league-action");n.addEventListener("click",()=>this.closeActiveModal()),r.addEventListener("click",()=>this.showCreateLeagueModal()),i.addEventListener("click",()=>this.showJoinLeagueModal()),e.querySelectorAll(".select-league").forEach(s=>{s.addEventListener("click",o=>{const a=o.target.dataset.leagueId;this.leagueManager.setActiveLeague(a),window.location.reload()})}),e.querySelectorAll(".manage-league").forEach(s=>{s.addEventListener("click",async o=>{const a=o.target.dataset.leagueId;await this.showLeagueSettingsModal(a)})}),e.querySelectorAll(".leave-league").forEach(s=>{s.addEventListener("click",async o=>{var d,h,f,p;const a=o.target.dataset.leagueId,c=await this.leagueManager.getLeague(a),l=this.leagueManager.isLeagueOwner?await this.leagueManager.isLeagueOwner(a):c&&c.ownerId===(((h=(d=window.authManager)==null?void 0:d.currentUser)==null?void 0:h.userId)||((p=(f=window.authManager)==null?void 0:f.currentUser)==null?void 0:p.username)),u=l?`Are you sure you want to delete "${c.name}"? This action cannot be undone.`:`Are you sure you want to leave "${c.name}"?`;if(confirm(u))try{s.disabled=!0,s.textContent=l?"Deleting...":"Leaving...";let g;l?g=await this.leagueManager.deleteLeague(a):await this.leagueManager.leaveLeague(a);const m=e.querySelector(`[data-league-id="${a}"]`);if(m&&(m.style.transition="opacity 0.3s ease-out, transform 0.3s ease-out",m.style.opacity="0",m.style.transform="translateX(-20px)",setTimeout(()=>{if(m.remove(),e.querySelectorAll(".league-item").length===0){const I=e.querySelector(".leagues-list");I&&(I.innerHTML=`<p class="no-leagues">You haven't joined any leagues yet.</p>`)}},300)),l){const E=g.deletedItems?` (${g.deletedItems.members} members, ${g.deletedItems.picks} picks, ${g.deletedItems.lifeEvents} events removed)`:"";this.showQuickNotification(`League "${c.name}" completely deleted${E}`,"success")}else this.showQuickNotification(`Left league "${c.name}" successfully`,"success");if(window.multiLeagueContext&&window.multiLeagueContext.removeLeague&&window.multiLeagueContext.removeLeague(a),window.leagueSelector&&typeof window.leagueSelector.refreshAndRender=="function"&&setTimeout(async()=>{try{await window.leagueSelector.refreshAndRender()}catch(E){console.warn("Failed to refresh league selector:",E)}},500),localStorage.getItem("activeLeagueId")===a&&(localStorage.removeItem("activeLeagueId"),window.multiLeagueContext&&window.multiLeagueContext.userLeagues.size>0)){const E=Array.from(window.multiLeagueContext.userLeagues.values())[0];E&&E.leagueId!==a&&this.leagueManager.setActiveLeague(E.leagueId)}}catch(g){this.showError(g.message),s.disabled=!1,s.textContent=l?"Delete":"Leave"}})})}attachLeagueSettingsEvents(e){const n=this.activeModal,r=n.querySelector("#league-settings-form"),i=n.querySelector(".close-btn"),s=n.querySelector("#cancel-settings"),o=n.querySelector(".copy-invite-code");i.addEventListener("click",()=>this.closeActiveModal()),s.addEventListener("click",()=>this.closeActiveModal());const a=n.querySelector("#lives-enabled-setting"),c=n.querySelector("#lives-options-setting");a&&c&&a.addEventListener("change",d=>{c.style.display=d.target.checked?"block":"none"}),o.addEventListener("click",d=>{const h=d.target.dataset.code;navigator.clipboard.writeText(h).then(()=>{d.target.textContent="Copied!",setTimeout(()=>{d.target.textContent="Copy Code"},2e3)})}),r.addEventListener("submit",async d=>{d.preventDefault();const h=parseInt(document.getElementById("max-members-setting").value),f=document.getElementById("auto-pick-enabled-setting").checked,p=document.getElementById("lives-enabled-setting"),g=document.getElementById("max-lives-setting"),m={maxMembers:h,autoPickEnabled:f};p&&g&&(m.livesEnabled=p.checked,m.maxLives=m.livesEnabled?parseInt(g.value):1);try{await this.leagueManager.updateLeagueSettings(e,m),this.showSuccessModal("Settings Updated","League settings have been updated successfully."),setTimeout(()=>{this.showManageLeaguesModal()},1500)}catch(v){this.showError(v.message)}}),n.querySelectorAll(".lives-btn").forEach(d=>{d.addEventListener("click",async h=>{h.preventDefault();const f=h.target.dataset.action,p=h.target.dataset.userId;d.disabled=!0;const g=d.textContent;d.textContent="...";try{await this.handleLivesAdjustment(e,p,f)}catch{}finally{d.disabled=!1,d.textContent=g}})}),n.querySelectorAll(".bulk-btn").forEach(d=>{d.addEventListener("click",async h=>{h.preventDefault();const f=h.target.dataset.action;let p="";switch(f){case"reset-all-lives":p="Are you sure you want to reset all members' lives to maximum? This cannot be undone.";break;case"eliminate-inactive":p="Are you sure you want to eliminate all inactive members? This cannot be undone.";break}if(confirm(p)){d.disabled=!0;const g=d.textContent;d.textContent="Processing...";try{await this.handleBulkAction(e,f),this.showQuickNotification("Bulk action completed successfully","success"),setTimeout(async()=>{await this.showLeagueSettingsModal(e)},1e3)}catch(m){this.showError(m.message)}finally{d.disabled=!1,d.textContent=g}}})});const l=n.querySelector("#view-audit-trail"),u=n.querySelector("#export-audit-trail");l&&l.addEventListener("click",async d=>{d.preventDefault(),await this.toggleAuditTrail(e)}),u&&u.addEventListener("click",async d=>{d.preventDefault(),await this.exportAuditTrail(e)}),n.querySelectorAll(".kick-member").forEach(d=>{d.addEventListener("click",async h=>{const f=h.target.dataset.userId;await this.leagueManager.getLeague(e);const g=(await amplifyDataService.getLeagueMembers(e)).find(m=>m.userId===f);if(confirm(`Are you sure you want to remove ${g.username||g.userId} from the league?`))try{await this.leagueManager.kickMember(e,f),await this.showLeagueSettingsModal(e)}catch(m){this.showError(m.message)}})})}showLeagueCreatedSuccessModal(e,n){this.closeActiveModal();const r=`
      <div id="league-modal" class="league-modal">
        <div class="league-modal-content success">
          <button class="close-btn">&times;</button>
          <div class="success-header">
            <div class="success-icon">🎉</div>
            <h3>League Created Successfully!</h3>
          </div>
          
          <div class="league-created-info">
            <div class="league-name">
              <strong>${this.escapeHtml(e)}</strong>
            </div>
            <p class="creation-message">Your F1 Survivor league is ready! Share the invite code below with friends and family.</p>
          </div>

          <div class="invite-code-section">
            <label class="invite-label">Invite Code</label>
            <div class="invite-code-container">
              <input type="text" id="invite-code-display" value="${n}" readonly class="invite-code-input">
              <button id="copy-invite-btn" class="copy-btn" data-code="${n}">
                <span class="copy-icon">📋</span>
                Copy
              </button>
            </div>
            <p class="invite-instructions">Anyone with this code can join your league</p>
          </div>

          <div class="sharing-options">
            <h4>Share Your League</h4>
            <div class="share-buttons">
              <button id="share-native-btn" class="share-btn native-share" style="display: none;">
                <span class="share-icon">📤</span>
                Share
              </button>
              <button id="share-link-btn" class="share-btn">
                <span class="share-icon">🔗</span>
                Copy Link
              </button>
            </div>
          </div>
          
          <div class="form-actions">
            <button class="cta-button" id="continue-btn">Continue</button>
          </div>
        </div>
      </div>
    `;document.body.insertAdjacentHTML("beforeend",r),this.activeModal=document.getElementById("league-modal"),this.attachLeagueCreatedEvents(n)}showSuccessModal(e,n){this.closeActiveModal();const r=`
      <div id="league-modal" class="league-modal">
        <div class="league-modal-content small success">
          <h3>${e}</h3>
          <p>${n}</p>
        </div>
      </div>
    `;document.body.insertAdjacentHTML("beforeend",r),this.activeModal=document.getElementById("league-modal"),setTimeout(()=>{this.closeActiveModal()},3e3)}showError(e){const n=document.createElement("div");n.className="error-toast",n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.remove()},3e3)}attachLeagueCreatedEvents(e){const n=this.activeModal,r=n.querySelector(".close-btn"),i=n.querySelector("#continue-btn"),s=n.querySelector("#copy-invite-btn"),o=n.querySelector("#share-native-btn"),a=n.querySelector("#share-link-btn");r.addEventListener("click",()=>this.closeActiveModal()),i.addEventListener("click",()=>this.closeActiveModal()),s.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(e),s.innerHTML='<span class="copy-icon">✅</span> Copied!',setTimeout(()=>{s.innerHTML='<span class="copy-icon">📋</span> Copy'},2e3)}catch{this.fallbackCopyText(e),s.innerHTML='<span class="copy-icon">✅</span> Copied!',setTimeout(()=>{s.innerHTML='<span class="copy-icon">📋</span> Copy'},2e3)}}),navigator.share&&(o.style.display="inline-flex",o.addEventListener("click",async()=>{try{await navigator.share({title:"Join my F1 Survivor League!",text:`You're invited to join my F1 Survivor league! Use invite code: ${e}`,url:window.location.origin})}catch{console.log("Native sharing cancelled or failed")}})),a.addEventListener("click",async()=>{const l=`🏎️ Join my F1 Survivor league!
      
Use invite code: ${e}
      
Play at: ${window.location.origin}

Pick one driver each race, can't pick the same driver twice. Last player standing wins!`;try{await navigator.clipboard.writeText(l),a.innerHTML='<span class="share-icon">✅</span> Copied!',setTimeout(()=>{a.innerHTML='<span class="share-icon">🔗</span> Copy Link'},2e3)}catch{this.fallbackCopyText(l),a.innerHTML='<span class="share-icon">✅</span> Copied!',setTimeout(()=>{a.innerHTML='<span class="share-icon">🔗</span> Copy Link'},2e3)}});const c=n.querySelector("#invite-code-display");c.addEventListener("focus",()=>{c.select()})}fallbackCopyText(e){const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy")}catch(r){console.error("Fallback copy failed:",r)}document.body.removeChild(n)}closeActiveModal(){this.activeModal&&(this.activeModal.remove(),this.activeModal=null)}generateLivesDisplay(e,n){let r="";for(let i=0;i<n;i++)i<e?r+='<span class="life-indicator remaining">❤️</span>':r+='<span class="life-indicator lost">🖤</span>';return r}async handleLivesAdjustment(e,n,r){try{let i,s=1,o="";switch(r){case"add":i="ADD",o="Admin granted additional life";break;case"subtract":i="SUBTRACT",o="Admin removed life";break;case"reset":i="SET",s=await this.getMaxLivesForLeague(e),o="Admin reset lives to maximum";break;default:throw new Error("Invalid lives action")}const a=await amplifyDataService.updateMemberLives(e,n,{operation:i,value:s,reason:o});return a.success&&(this.updateMemberLivesDisplay(n,a.remainingLives),this.showQuickNotification("Lives updated successfully","success")),a}catch(i){throw console.error("Failed to adjust member lives:",i),this.showError(i.message),i}}async getMaxLivesForLeague(e){try{const n=await amplifyDataService.getLeague(e);return amplifyDataService.parseLeagueSettings(n).maxLives||1}catch(n){return console.error("Failed to get max lives for league:",n),1}}updateMemberLivesDisplay(e,n){const r=document.querySelector(`[data-user-id="${e}"]`);if(r){const i=r.querySelector(".lives-display"),s=r.querySelector(".lives-count");if(i&&s){const o=parseInt(s.textContent.split("/")[1]);i.innerHTML=this.generateLivesDisplay(n,o),s.textContent=`${n}/${o}`;const a=r.querySelector(".member-status");a&&n===0?(a.textContent="Eliminated",a.className="member-status status-eliminated"):a&&n>0&&(a.textContent="Active",a.className="member-status status-active")}}}async handleBulkAction(e,n){try{const r=await amplifyDataService.getLeague(e),i=await amplifyDataService.getLeagueMembers(e),s=amplifyDataService.parseLeagueSettings(r);switch(n){case"reset-all-lives":const o=s.maxLives||1,a=i.filter(u=>!u.isOwner).map(u=>amplifyDataService.updateMemberLives(e,u.userId,{operation:"SET",value:o,reason:"Admin bulk reset - all lives restored"}));await Promise.all(a),console.log(`Reset lives for ${a.length} members in league ${e}`);break;case"eliminate-inactive":const c=i.filter(u=>!u.isOwner&&(u.totalPicks||0)===0),l=c.map(u=>amplifyDataService.updateMemberLives(e,u.userId,{operation:"SET",value:0,reason:"Admin bulk elimination - inactive member"}));await Promise.all(l),console.log(`Eliminated ${c.length} inactive members in league ${e}`);break;default:throw new Error("Unknown bulk action")}return{success:!0}}catch(r){throw console.error("Bulk action failed:",r),r}}async toggleAuditTrail(e){const n=document.getElementById("audit-trail-display"),r=document.getElementById("view-audit-trail");if(!(!n||!r))if(n.style.display==="none"){n.style.display="block",r.textContent="Hide Activity";try{await this.loadAuditTrail(e)}catch(i){this.showError("Failed to load audit trail: "+i.message),n.style.display="none",r.textContent="View Recent Activity"}}else n.style.display="none",r.textContent="View Recent Activity"}async loadAuditTrail(e){const n=document.getElementById("audit-trail-display");if(n)try{const r=await this.getLeagueAuditTrail(e,20);if(r.length===0){n.innerHTML=`
          <div class="audit-empty">
            <p>No recent lives activity found.</p>
          </div>
        `;return}const i=`
        <div class="audit-trail-list">
          ${r.map(s=>this.renderAuditEvent(s)).join("")}
        </div>
      `;n.innerHTML=i}catch(r){console.error("Failed to load audit trail:",r),n.innerHTML=`
        <div class="audit-error">
          <p>Failed to load audit trail. Please try again.</p>
        </div>
      `}}async getLeagueAuditTrail(e,n=20){try{const r=await amplifyDataService.client.models.LifeEvent.list({filter:{leagueId:{eq:e}},limit:n,authMode:"userPool"});return r.data?r.data.sort((i,s)=>new Date(s.eventDate)-new Date(i.eventDate)):[]}catch(r){return console.error("Failed to get audit trail:",r),[]}}renderAuditEvent(e){const n=new Date(e.eventDate),r=n.toLocaleDateString()+" "+n.toLocaleTimeString();let i="📝",s="",o="";switch(e.eventType){case"LIFE_LOST":i="💔",s="life-lost",o=`Lost a life - ${e.livesRemaining} remaining`;break;case"LIFE_RESTORED":i="💚",s="life-restored",o=`Life restored - ${e.livesRemaining} remaining`;break;case"FINAL_ELIMINATION":i="❌",s="elimination",o="Eliminated from league (0 lives remaining)";break;case"ADMIN_ADJUSTMENT":i="⚙️",s="admin-action",o=`Admin adjustment - ${e.livesRemaining} lives remaining`;break;default:o=`Lives update - ${e.livesRemaining} remaining`}return`
      <div class="audit-event ${s}">
        <div class="event-icon">${i}</div>
        <div class="event-details">
          <div class="event-header">
            <span class="event-user">${this.escapeHtml(e.userId)}</span>
            <span class="event-date">${r}</span>
          </div>
          <div class="event-description">${o}</div>
          ${e.adminUserId?`<div class="event-admin">By admin: ${this.escapeHtml(e.adminUserId)}</div>`:""}
          ${e.adminReason?`<div class="event-reason">"${this.escapeHtml(e.adminReason)}"</div>`:""}
        </div>
      </div>
    `}async exportAuditTrail(e){const n=document.getElementById("export-audit-trail");if(!n)return;const r=n.textContent;n.disabled=!0,n.textContent="Exporting...";try{const i=await this.getLeagueAuditTrail(e,1e3);if(i.length===0){this.showQuickNotification("No audit events to export","warning");return}const o=[["Date","User","Event Type","Lives Remaining","Admin User","Reason"].join(","),...i.map(u=>[new Date(u.eventDate).toISOString(),`"${u.userId}"`,`"${u.eventType}"`,u.livesRemaining,`"${u.adminUserId||""}"`,`"${u.adminReason||""}"`].join(","))].join(`
`),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a"),l=URL.createObjectURL(a);c.setAttribute("href",l),c.setAttribute("download",`league_${e}_audit_trail_${new Date().toISOString().split("T")[0]}.csv`),c.style.visibility="hidden",document.body.appendChild(c),c.click(),document.body.removeChild(c),this.showQuickNotification("Audit trail exported successfully","success")}catch(i){console.error("Failed to export audit trail:",i),this.showError("Failed to export audit trail: "+i.message)}finally{n.disabled=!1,n.textContent=r}}showQuickNotification(e,n="info"){const r=document.createElement("div");r.className=`quick-notification ${n}`,r.textContent=e,document.body.appendChild(r),setTimeout(()=>{r.remove()},3e3)}escapeHtml(e){return e==null||e===void 0?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}const Ce=new Sc;typeof window<"u"&&(window.LeagueModalManager=Sc,window.leagueModalManager=Ce);class ev{constructor(){this.leagueManager=at,this.modalManager=Ce,this.currentLeague=null}async initialize(){if(!await L.isAuthenticated()){console.log("User not authenticated, skipping league dashboard initialization");return}this.currentLeague=await this.leagueManager.getActiveLeague(),await this.renderLeagueSelector(),this.currentLeague&&await this.updateDashboardForLeague()}async renderLeagueSelector(){const e=document.querySelector(".dashboard-container");if(!e)return;const n=document.querySelector(".league-selector-wrapper");n&&n.remove();const r=await this.leagueManager.getUserLeagues(),i=await b.getActiveLeagueId(),s=`
      <div class="league-selector-wrapper">
        <div class="league-selector">
          <label>Current Mode:</label>
          <select id="league-selector">
            <option value="" ${i?"":"selected"}>Solo Play</option>
            ${r.map(o=>`
              <option value="${o.leagueId}" ${o.leagueId===i?"selected":""}>
                ${this.escapeHtml(o.name)}
              </option>
            `).join("")}
          </select>
          <button id="manage-leagues-btn" class="manage-leagues-btn">
            <span class="icon">⚙️</span>
            Manage Leagues
          </button>
        </div>
      </div>
    `;e.insertAdjacentHTML("afterbegin",s),this.attachSelectorEvents()}attachSelectorEvents(){const e=document.getElementById("league-selector"),n=document.getElementById("manage-leagues-btn");e&&e.addEventListener("change",async r=>{const i=r.target.value;i?await this.leagueManager.setActiveLeague(i):await this.leagueManager.setActiveLeague(null),window.location.reload()}),n&&n.addEventListener("click",()=>{this.modalManager.showManageLeaguesModal()})}async updateDashboardForLeague(){const e=document.querySelector(".dashboard-container h1");e&&this.currentLeague&&(e.innerHTML=`Dashboard - <span class="league-name">${this.escapeHtml(this.currentLeague.name)}</span>`),await this.updateEliminationZoneForLeague(),await this.updateStatsForLeague()}async updateEliminationZoneForLeague(){if(this.currentLeague)try{const e=await this.leagueManager.getLeagueStandings(this.currentLeague.leagueId),n=b.parseLeagueSettings(this.currentLeague),r=n.livesEnabled||!1;let i={};if(r){const c=await b.getLeagueMembers(this.currentLeague.leagueId);for(const l of c)try{const u=await b.getMemberLivesStatus(this.currentLeague.leagueId,l.userId);u&&(i[l.userId]=u)}catch(u){console.warn(`Failed to get lives status for member ${l.userId}:`,u)}}const s=await L.getCurrentUser(),o=(s==null?void 0:s.userId)||(s==null?void 0:s.username),a=document.querySelector(".elimination-zone");if(a){const c=a.querySelector(".players-container");c&&(c.innerHTML=e.map((u,d)=>{const h=i[u.userId],f=r?(h==null?void 0:h.remainingLives)===0:u.isEliminated;return`
              <div class="player-card enhanced ${u.userId===o?"current-user":""} ${f?"eliminated":""}">
                <div class="player-rank ${f?"eliminated":""}">${d+1}</div>
                <div class="player-info">
                  <h3>${this.escapeHtml(u.username)} ${u.isOwner?'<span class="owner-badge">👑</span>':""}</h3>
                  <div class="player-stats">
                    <p class="races-survived">${u.survivedRaces} races survived</p>
                    ${r&&h?`
                      <div class="player-lives">
                        <span class="lives-label">Lives:</span>
                        <div class="lives-display-small">
                          ${this.generateLivesDisplayMini(h.remainingLives,h.maxLives)}
                        </div>
                        <span class="lives-count">${h.remainingLives}/${h.maxLives}</span>
                      </div>
                    `:""}
                    ${u.lastPick?`<p class="last-pick">Last pick: ${u.lastPick.driverName}</p>`:""}
                  </div>
                </div>
                <div class="player-status">
                  ${f?'<div class="status eliminated">ELIMINATED</div>':'<div class="status active">ACTIVE</div>'}
                </div>
              </div>
            `}).join(""));const l=a.querySelector("h2");if(l){const u=e.filter(h=>{if(r){const f=i[h.userId];return(f==null?void 0:f.remainingLives)>0}return!h.isEliminated}).length,d=r?` (${n.maxLives} Lives System)`:"";l.innerHTML=`League Standings - ${this.escapeHtml(this.currentLeague.name)}${d}`}await this.addEliminationZoneSummary(e,i,r)}}catch(e){console.error("Failed to update elimination zone for league:",e)}}async addEliminationZoneSummary(e,n,r){const i=document.querySelector(".elimination-zone");if(!i)return;const s=i.querySelector(".league-summary");s&&s.remove();const o=e.length;let a,c;r?(a=Object.values(n).filter(d=>d.remainingLives>0).length,c=Object.values(n).filter(d=>d.remainingLives===0).length):(a=e.filter(d=>!d.isEliminated).length,c=e.filter(d=>d.isEliminated).length);const l=`
      <div class="league-summary">
        <div class="summary-stats">
          <div class="summary-stat">
            <span class="stat-icon">👥</span>
            <span class="stat-label">Total Members</span>
            <span class="stat-value">${o}</span>
          </div>
          <div class="summary-stat active">
            <span class="stat-icon">🟢</span>
            <span class="stat-label">Active</span>
            <span class="stat-value">${a}</span>
          </div>
          <div class="summary-stat eliminated">
            <span class="stat-icon">🔴</span>
            <span class="stat-label">Eliminated</span>
            <span class="stat-value">${c}</span>
          </div>
        </div>
      </div>
    `,u=i.querySelector("h2");u&&u.insertAdjacentHTML("afterend",l)}async updateStatsForLeague(){if(this.currentLeague)try{const e=await b.getUserPicks(null,this.currentLeague.leagueId),n=await L.getCurrentUser(),r=(n==null?void 0:n.userId)||(n==null?void 0:n.username),i=b.parseLeagueSettings(this.currentLeague),s=i.livesEnabled||!1;let o=null;s&&(o=await b.getMemberLivesStatus(this.currentLeague.leagueId,r));const a=document.querySelector('[data-stat="races-survived"]');a&&(a.textContent=e.length);const c=await this.leagueManager.getLeagueStandings(this.currentLeague.leagueId),l=c.findIndex(d=>d.userId===r)+1,u=document.querySelector('[data-stat="league-position"]');if(u)u.textContent=`${l}/${c.length}`;else{const d=document.querySelector(".stats-grid");if(d){const h=document.createElement("div");h.className="stat-card",h.innerHTML=`
            <h3>League Position</h3>
            <p class="stat-value" data-stat="league-position">${l}/${c.length}</p>
          `,d.appendChild(h)}}s&&o&&await this.updateLivesStatistics(o,i),await this.updateLeagueOverviewStats(c,i)}catch(e){console.error("Failed to update league stats:",e)}}async updateLivesStatistics(e,n){const r=document.querySelector(".stats-grid");if(!r)return;r.querySelectorAll('[data-stat-type="lives"]').forEach(a=>a.remove());const s=document.createElement("div");s.className="stat-card lives-stat",s.setAttribute("data-stat-type","lives"),s.innerHTML=`
      <div class="stat-icon">❤️</div>
      <div class="stat-content">
        <h3>Lives Remaining</h3>
        <p class="stat-value" data-stat="lives-remaining">${e.remainingLives}/${e.maxLives}</p>
        <div class="lives-display-mini">
          ${this.generateLivesDisplayMini(e.remainingLives,e.maxLives)}
        </div>
      </div>
    `,r.appendChild(s);const o=document.createElement("div");o.className=`stat-card status-stat ${e.status.toLowerCase()}`,o.setAttribute("data-stat-type","lives"),o.innerHTML=`
      <div class="stat-icon">${e.status==="ACTIVE"?"🟢":"🔴"}</div>
      <div class="stat-content">
        <h3>Status</h3>
        <p class="stat-value status-${e.status.toLowerCase()}">${e.status}</p>
      </div>
    `,r.appendChild(o)}async updateLeagueOverviewStats(e,n){const r=document.querySelector(".stats-grid");if(!r)return;r.querySelectorAll('[data-stat-type="league-overview"]').forEach(c=>c.remove());const s=e.filter(c=>!c.isEliminated).length,o=e.length,a=document.createElement("div");if(a.className="stat-card members-stat",a.setAttribute("data-stat-type","league-overview"),a.innerHTML=`
      <div class="stat-icon">👥</div>
      <div class="stat-content">
        <h3>Active Members</h3>
        <p class="stat-value">${s}/${o}</p>
      </div>
    `,r.appendChild(a),n.livesEnabled){const c=document.createElement("div");c.className="stat-card lives-system-stat",c.setAttribute("data-stat-type","league-overview"),c.innerHTML=`
        <div class="stat-icon">💙</div>
        <div class="stat-content">
          <h3>Lives System</h3>
          <p class="stat-value">${n.maxLives} Lives</p>
        </div>
      `,r.appendChild(c)}}generateLivesDisplayMini(e,n){let r="";for(let i=0;i<n;i++)i<e?r+='<span class="life-mini remaining">❤️</span>':r+='<span class="life-mini lost">🖤</span>';return r}async getPickContext(){const e=await b.getActiveLeagueId();return{isLeagueMode:!!e,leagueId:e,league:e?await this.leagueManager.getLeague(e):null}}async savePickWithContext(e,n){return await Qy(e,n)}async loadPicksWithContext(){return await Xy()}async isDriverAlreadyPickedInContext(e){const n=await this.getPickContext();return n.isLeagueMode?await b.isDriverAlreadyPicked(e,n.leagueId):await b.isDriverAlreadyPicked(e)}escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}const bo=new ev;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{bo.initialize()}):bo.initialize();class tv{constructor(e){this.containerId=e,this.container=document.getElementById(e),this.isDropdownOpen=!1,this.currentContext=null,document.addEventListener("click",this.handleClickOutside.bind(this))}async initialize(){if(console.log(`🔍 League selector initializing with container ID: ${this.containerId}`),!this.container){console.warn(`❌ League selector container '${this.containerId}' not found in DOM`);return}console.log("✅ League selector container found:",this.container),window.multiLeagueContext?(window.multiLeagueContext.addLeagueChangeListener(this.handleLeagueContextChange.bind(this)),console.log("✅ League context listener added")):console.warn("⚠️ No multiLeagueContext available during initialization"),await this.render(),console.log("✅ League selector render completed")}async render(){if(!await L.isAuthenticated()){console.log("🔍 League nav selector - user not authenticated, hiding selector"),this.renderHidden();return}if(!window.multiLeagueContext){console.log("🔍 League nav selector - no multiLeagueContext available"),this.renderHidden();return}const n=window.multiLeagueContext.getMultiLeagueContext();console.log("🔍 League nav selector - render context:",n),this.currentContext=n,console.log(`🔍 League nav selector - rendering dropdown (${n.leagueCount} leagues)`),this.renderNavDropdown(n)}renderHidden(){this.container.innerHTML=""}renderNavDropdown(e){console.log("🎨 Rendering nav dropdown for context:",e);const n=e.activeLeagueData,r=n?n.name:e.leagueCount===0?"Leagues":"Select League";console.log(`🏆 Active league: ${r}`,n);const o=window.multiLeagueContext.getAllLeaguesContext().leagues||[];console.log("📋 All leagues for dropdown:",o);const a=`
      <div class="league-nav-dropdown ${this.isDropdownOpen?"active":""}">
        <button class="league-nav-trigger" data-action="toggle">
              <span class="league-icon">🏆</span>
                <span class="league-name">${this.escapeHtml(r)}</span>
          <span class="nav-arrow ${this.isDropdownOpen?"up":"down"}">▼</span>
        </button>
        
        <div class="league-nav-menu ${this.isDropdownOpen?"open":""}">
          <div class="league-nav-header">
            <span class="menu-title">Your Leagues</span>
              </div>
          
          <div class="league-nav-list">
            ${this.renderNavLeagueList(o,e.activeLeague)}
            </div>
          
          <div class="league-nav-actions">
            <button class="nav-action-btn" data-action="create">
              <span class="action-icon">+</span>
              Create League
            </button>
            <button class="nav-action-btn" data-action="join">
              <span class="action-icon">🔗</span>
              Join League
            </button>
            <button class="nav-action-btn" data-action="manage">
              <span class="action-icon">⚙️</span>
              Manage Leagues
            </button>
          </div>
        </div>
      </div>
    `;console.log("📝 Generated HTML for nav dropdown:",a),this.container.innerHTML=a,console.log("✅ HTML set to container, attaching event listeners..."),this.attachNavEventListeners(),console.log("✅ Nav dropdown rendering completed")}renderNavLeagueList(e,n){return e.length===0?'<div class="no-leagues-nav">Ready to join your first league?</div>':e.map(r=>{const i=r.leagueId===n,s=r.memberCount||0;return`
        <button class="league-nav-option ${i?"active":""}" data-league-id="${r.leagueId}">
          <div class="league-nav-info">
            <span class="nav-league-name">${this.escapeHtml(r.name)}</span>
            <span class="nav-league-members">${s} members</span>
          </div>
          ${i?'<span class="nav-active-indicator">✓</span>':""}
        </button>
      `}).join("")}attachNavEventListeners(){const e=this.container.querySelector('[data-action="toggle"]');e&&e.addEventListener("click",o=>{o.stopPropagation(),this.toggleDropdown()}),this.container.querySelectorAll(".league-nav-option").forEach(o=>{o.addEventListener("click",a=>{a.stopPropagation();const c=o.dataset.leagueId;this.handleLeagueSwitch(c)})});const r=this.container.querySelector('[data-action="create"]'),i=this.container.querySelector('[data-action="join"]'),s=this.container.querySelector('[data-action="manage"]');r&&r.addEventListener("click",o=>{o.stopPropagation(),this.closeDropdown(),this.handleCreateLeague()}),i&&i.addEventListener("click",o=>{o.stopPropagation(),this.closeDropdown(),this.handleJoinLeague()}),s&&s.addEventListener("click",o=>{o.stopPropagation(),this.closeDropdown(),this.handleManageLeagues()})}toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen,this.updateDropdownState()}closeDropdown(){this.isDropdownOpen&&(this.isDropdownOpen=!1,this.updateDropdownState())}updateDropdownState(){const e=this.container.querySelector(".league-nav-dropdown"),n=this.container.querySelector(".league-nav-menu"),r=this.container.querySelector(".nav-arrow");e&&n&&r&&(this.isDropdownOpen?(e.classList.add("active"),n.classList.add("open"),r.classList.remove("down"),r.classList.add("up")):(e.classList.remove("active"),n.classList.remove("open"),r.classList.remove("up"),r.classList.add("down")))}async handleLeagueSwitch(e){if(e){console.log(`Switching to league: ${e}`);try{if(this.closeDropdown(),wc(e))await this.render(),this.notifyLeagueSwitch(e);else throw new Error("Failed to switch league")}catch(n){console.error("League switch failed:",n),this.showError("Failed to switch leagues. Please try again.")}}}async handleJoinLeague(){try{if(Ce&&Ce.showJoinLeagueModal)await Ce.showJoinLeagueModal();else{const e=prompt("Enter League Invite Code:");e&&await this.joinLeagueByCode(e)}}catch(e){console.error("Join league failed:",e),this.showError("Failed to join league. Please try again.")}}async handleCreateLeague(){try{if(Ce&&Ce.showCreateLeagueModal)await Ce.showCreateLeagueModal();else{const e=prompt("Enter League Name:");e&&await this.createLeague(e)}}catch(e){console.error("Create league failed:",e),this.showError("Failed to create league. Please try again.")}}async handleManageLeagues(){try{Ce&&Ce.showManageLeaguesModal?await Ce.showManageLeaguesModal():this.showError("League management not available")}catch(e){console.error("Manage leagues failed:",e),this.showError("Failed to open league management. Please try again.")}}async joinLeagueByCode(e){try{console.log("Joining league with code:",e);const n=await b.joinLeague(e);if(n.success)console.log("✅ Successfully joined league"),await this.refreshAndRender(),alert("Successfully joined league!");else throw new Error(n.error||"Failed to join league")}catch(n){console.error("Failed to join league:",n),alert(`Failed to join league: ${n.message}`)}}async createLeague(e){try{console.log("Creating league:",e);const n={name:e,description:"",maxMembers:20,isPrivate:!0,autoPickEnabled:!0},r=await b.createLeague(n);if(r.success)console.log("✅ Successfully created league"),await this.refreshAndRender(),alert(`Successfully created league "${e}"!`);else throw new Error(r.error||"Failed to create league")}catch(n){console.error("Failed to create league:",n),alert(`Failed to create league: ${n.message}`)}}async refreshAndRender(){window.multiLeagueContext&&await window.multiLeagueContext.refreshLeagues(),await this.render()}handleLeagueContextChange(e,n){console.log("League context changed:",n,"->",e),this.render()}handleClickOutside(e){this.container.contains(e.target)||this.closeDropdown()}showError(e){console.error(e)}notifyLeagueSwitch(e){const n=new CustomEvent("leagueChanged",{detail:{leagueId:e}});document.dispatchEvent(n)}escapeHtml(e){if(!e)return"";const n=document.createElement("div");return n.textContent=e,n.innerHTML}destroy(){document.removeEventListener("click",this.handleClickOutside.bind(this)),window.multiLeagueContext&&window.multiLeagueContext.removeLeagueChangeListener(this.handleLeagueContextChange.bind(this))}}function cv(t){return new tv(t)}export{oe as A,Yf as B,Bf as C,Fe as D,Xf as E,Ao as F,ep as G,mt as H,Sp as I,xp as J,Ve as K,Un as L,N as M,iv as N,sv as O,nv as R,Di as _,Ft as a,L as b,Wy as c,av as d,ov as e,Yy as f,Ac as g,cv as h,Io as i,b as j,Ie as k,Xy as l,Je as m,De as n,Ue as o,U as p,yu as q,Hd as r,Qy as s,de as t,te as u,rv as v,ne as w,B as x,Wf as y,zf as z};
